# P2.1 é˜¶æ®µæ‰§è¡ŒæŠ¥å‘Š - æç¤ºè¯æ¡†æ¶ï¼ˆPROOF Framework + Instructorï¼‰

**æ‰§è¡Œæ—¶é—´**: 2025-11-12 22:50:00
**æ‰€å±é˜¶æ®µ**: P2.1
**æ‰§è¡Œäºº**: ai-python-architect

---

## 1. æ‰§è¡Œæ‘˜è¦

### 1.1 ä»»åŠ¡ç›®æ ‡
å®ç° PhytoOracle é¡¹ç›®çš„ P2.1 é˜¶æ®µä»»åŠ¡ï¼Œæ„å»ºæç¤ºè¯å·¥ç¨‹æ¡†æ¶ï¼ˆPROOF Frameworkï¼‰å’Œ Instructor é›†æˆï¼Œç¡®ä¿ VLM è¾“å‡ºçš„è§„èŒƒæ€§å’Œç±»å‹å®‰å…¨æ€§ã€‚

### 1.2 å®Œæˆæƒ…å†µ
**å·²å®Œæˆ** âœ…

æ‰€æœ‰è®¡åˆ’ä»»åŠ¡å·²100%å®Œæˆï¼ŒåŒ…æ‹¬ï¼š
- PROOF Framework æ ¸å¿ƒç±»å®ç°
- VLM å“åº” Schema å®šä¹‰ï¼ˆQ0.0-Q0.5 + Q1-Q6ï¼‰
- Q0.0-Q0.5 æç¤ºè¯æ¨¡æ¿å®ç°
- Q1-Q6 åŠ¨æ€ç‰¹å¾æå–æ¨¡æ¿å®ç°
- Instructor å®¢æˆ·ç«¯é›†æˆ
- LLM é…ç½®ç®¡ç†æ¨¡å—
- å•å…ƒæµ‹è¯•ç¼–å†™

### 1.3 å…³é”®äº§å‡º

| ç±»åˆ« | æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½è¯´æ˜ |
|------|---------|---------|
| **æ ¸å¿ƒæ¡†æ¶** | `backend/infrastructure/llm/prompts/framework.py` | PROOF Framework æ ¸å¿ƒå®ç°ï¼ˆ510è¡Œï¼‰ |
| **å“åº” Schema** | `backend/infrastructure/llm/prompts/response_schema.py` | VLM å“åº”æ ¼å¼åè®®ï¼ˆ430è¡Œï¼‰ |
| **Q0 æç¤ºè¯** | `backend/infrastructure/llm/prompts/q0_0_content.py` | Q0.0 å†…å®¹ç±»å‹è¯†åˆ«ï¼ˆ142è¡Œï¼‰ |
| **Q0 æç¤ºè¯** | `backend/infrastructure/llm/prompts/q0_1_category.py` | Q0.1 æ¤ç‰©ç±»åˆ«è¯†åˆ«ï¼ˆ124è¡Œï¼‰ |
| **Q0 æç¤ºè¯** | `backend/infrastructure/llm/prompts/q0_2_genus.py` | Q0.2 èŠ±å‰ç§å±è¯†åˆ«ï¼ˆ189è¡Œï¼ŒåŒ…å«5ç§èŠ±å‰è§†è§‰çº¿ç´¢ï¼‰ |
| **Q0 æç¤ºè¯** | `backend/infrastructure/llm/prompts/q0_3_organ.py` | Q0.3 å™¨å®˜è¯†åˆ«ï¼ˆ130è¡Œï¼‰ |
| **Q0 æç¤ºè¯** | `backend/infrastructure/llm/prompts/q0_4_completeness.py` | Q0.4 å®Œæ•´æ€§æ£€æŸ¥ï¼ˆ143è¡Œï¼‰ |
| **Q0 æç¤ºè¯** | `backend/infrastructure/llm/prompts/q0_5_abnormality.py` | Q0.5 å¼‚å¸¸åˆ¤æ–­ï¼ˆ158è¡Œï¼ŒåŒ…å«4ä¸ª Few-shot ç¤ºä¾‹ï¼‰ |
| **Q1-Q6 æ¨¡æ¿** | `backend/infrastructure/llm/prompts/q1_q6_features.py` | åŠ¨æ€ç‰¹å¾æå–æ„å»ºå™¨ï¼ˆ410è¡Œï¼Œæ”¯æŒ6ä¸ªç»´åº¦ï¼‰ |
| **æ¨¡å—å¯¼å‡º** | `backend/infrastructure/llm/prompts/__init__.py` | ç»Ÿä¸€å¯¼å‡ºæ¥å£ï¼ˆ238è¡Œï¼‰ |
| **Instructor é›†æˆ** | `backend/infrastructure/llm/instructor_client.py` | Instructor å®¢æˆ·ç«¯å°è£…ï¼ˆ352è¡Œï¼‰ |
| **é…ç½®ç®¡ç†** | `backend/infrastructure/llm/llm_config.py` | LLM é…ç½®ç®¡ç†ï¼ˆ362è¡Œï¼‰ |
| **å•å…ƒæµ‹è¯•** | `backend/tests/unit/test_p2_1_prompts.py` | P2.1 é˜¶æ®µå•å…ƒæµ‹è¯•ï¼ˆ388è¡Œï¼‰ |

**ä»£ç æ€»é‡**: çº¦ **3,576 è¡Œ**ï¼ˆå«æ³¨é‡Šå’Œç¤ºä¾‹ï¼‰

---

## 2. å®ç°ç»†èŠ‚

### 2.1 PROOF Framework æ ¸å¿ƒå®ç°

**æ–‡ä»¶**: `backend/infrastructure/llm/prompts/framework.py`

**æ ¸å¿ƒç±»**:

1. **PromptPurpose**: æç¤ºè¯ç›®çš„ï¼ˆtaskã€contextã€why_importantï¼‰
2. **PromptRole**: æç¤ºè¯è§’è‰²ï¼ˆroleã€expertiseã€constraintsï¼‰
3. **PromptObservation**: è§‚å¯ŸæŒ‡å¯¼ï¼ˆvisual_methodã€visual_cluesã€focus_areasï¼‰
4. **PromptOptions**: æç¤ºè¯é€‰é¡¹ï¼ˆchoicesã€allow_unknownã€allow_uncertainï¼‰
5. **PromptFormat**: è¾“å‡ºæ ¼å¼ï¼ˆresponse_schemaã€examplesã€constraintsï¼‰
6. **PROOFPrompt**: PROOF æ¡†æ¶ä¸»ç±»ï¼Œç»„åˆäº”è¦ç´ 

**å…³é”®ç‰¹æ€§**:
- âœ… å®Œæ•´å®ç° PROOF äº”è¦ç´ ï¼ˆPurposeã€Roleã€Observationã€Optionsã€Formatï¼‰
- âœ… æ”¯æŒæç¤ºè¯æ¸²æŸ“ï¼ˆ`render()` æ–¹æ³•ï¼‰
- âœ… æ”¯æŒé…ç½®å¯¼å‡ºï¼ˆ`to_dict()` æ–¹æ³•ï¼Œç”¨äºç‰ˆæœ¬æ§åˆ¶ï¼‰
- âœ… æ”¯æŒé…ç½®ä¿å­˜ï¼ˆ`save_config()` æ–¹æ³•ï¼Œä¿å­˜ä¸º JSONï¼‰
- âœ… èå…¥æ–¹æ³•è®º v5.0 è§†è§‰åŒ–æ–¹æ³•ï¼ˆCompound Feature Descriptionã€Egg Yolk Metaphor ç­‰ï¼‰
- âœ… æ”¯æŒ Few-shot ç¤ºä¾‹ï¼ˆExample ç±»ï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹ JSONï¼ˆæ ¹æ® Pydantic Schemaï¼‰

**ä»£ç è´¨é‡**:
- å®Œæ•´çš„ä¸­æ–‡æ³¨é‡Šï¼ˆç±»/å‡½æ•°/å‚æ•°ï¼‰
- è¡Œå†…æ³¨é‡Šè¯´æ˜å…³é”®æ­¥éª¤
- `if __name__ == "__main__"` åŒºå—æä¾›å®Œæ•´ä½¿ç”¨ç¤ºä¾‹
- Type hints è¦†ç›–ç‡: 100%

---

### 2.2 VLM å“åº” Schema å®ç°

**æ–‡ä»¶**: `backend/infrastructure/llm/prompts/response_schema.py`

**æ ¸å¿ƒæ¨¡å‹**:

| æ¨¡å‹åç§° | ç”¨é€” | Literal é™åˆ¶ |
|---------|------|-------------|
| `VLMResponse` | åŸºç±» | - |
| `Q00Response` | Q0.0 å†…å®¹ç±»å‹è¯†åˆ« | âœ… 6 ä¸ªé€‰é¡¹ |
| `Q01Response` | Q0.1 æ¤ç‰©ç±»åˆ«è¯†åˆ« | âœ… 6 ä¸ªé€‰é¡¹ |
| `Q02Response` | Q0.2 èŠ±å‰ç§å±è¯†åˆ« | âœ… 6 ä¸ªé€‰é¡¹ï¼ˆåŒ…å« Rosaã€Prunus ç­‰ï¼‰ |
| `Q03Response` | Q0.3 å™¨å®˜è¯†åˆ« | âœ… 3 ä¸ªé€‰é¡¹ |
| `Q04Response` | Q0.4 å®Œæ•´æ€§æ£€æŸ¥ | âœ… 3 ä¸ªé€‰é¡¹ |
| `Q05Response` | Q0.5 å¼‚å¸¸åˆ¤æ–­ | âœ… 2 ä¸ªé€‰é¡¹ |
| `FeatureResponse` | Q1-Q6 åŠ¨æ€ç‰¹å¾æå– | âŒ åŠ¨æ€ï¼ˆæ—  Literalï¼‰ |
| `SymptomTypeResponse` | ç—‡çŠ¶ç±»å‹ï¼ˆä¸¥æ ¼ç‰ˆï¼‰ | âœ… 8 ä¸ªé€‰é¡¹ |
| `ColorResponse` | é¢œè‰²è¯†åˆ«ï¼ˆä¸¥æ ¼ç‰ˆï¼‰ | âœ… 12 ä¸ªé€‰é¡¹ |
| `SizeResponse` | å°ºå¯¸è¯†åˆ«ï¼ˆä¸¥æ ¼ç‰ˆï¼‰ | âœ… 5 ä¸ªé€‰é¡¹ |
| `LocationResponse` | ä½ç½®è¯†åˆ«ï¼ˆä¸¥æ ¼ç‰ˆï¼‰ | âœ… 9 ä¸ªé€‰é¡¹ |
| `DistributionResponse` | åˆ†å¸ƒæ¨¡å¼ï¼ˆä¸¥æ ¼ç‰ˆï¼‰ | âœ… 7 ä¸ªé€‰é¡¹ |

**å…³é”®ç‰¹æ€§**:
- âœ… ä½¿ç”¨ Pydantic V2 + `Literal` ç±»å‹ä¸¥æ ¼é™åˆ¶é€‰é¡¹
- âœ… `ConfigDict(extra="forbid")` ç¦æ­¢é¢å¤–å­—æ®µ
- âœ… `confidence` å­—æ®µä½¿ç”¨ `ge=0.0, le=1.0` çº¦æŸèŒƒå›´
- âœ… æ‰€æœ‰æ¨¡å‹éƒ½æœ‰å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²å’Œä½¿ç”¨ç¤ºä¾‹
- âœ… `if __name__ == "__main__"` åŒºå—åŒ…å«8ä¸ªæµ‹è¯•ç¤ºä¾‹

**ç±»å‹å®‰å…¨æ€§**:
- Instructor åº“ä¼šè‡ªåŠ¨éªŒè¯ VLM è¾“å‡ºæ˜¯å¦ç¬¦åˆ Pydantic Schema
- å¦‚æœ `choice` ä¸åœ¨ `Literal` åˆ—è¡¨ä¸­ï¼Œä¼šè‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- å¦‚æœ `confidence` è¶…å‡º [0, 1] èŒƒå›´ï¼Œä¼šæŠ›å‡ºéªŒè¯é”™è¯¯

---

### 2.3 Q0.0-Q0.5 æç¤ºè¯æ¨¡æ¿å®ç°

#### 2.3.1 Q0.0 å†…å®¹ç±»å‹è¯†åˆ«

**æ–‡ä»¶**: `backend/infrastructure/llm/prompts/q0_0_content.py`

**é€‰é¡¹**: plant, animal, person, object, landscape, other

**è§†è§‰çº¿ç´¢**:
- plant: "Green leaves, stems, flowers, roots..."
- animal: "Living creatures with eyes, fur, feathers..."
- person: "Human body parts (face, hands, clothing)"

**éªŒè¯**: âœ… æ¸²æŸ“åé•¿åº¦ 1243 å­—ç¬¦ï¼ŒåŒ…å«æ‰€æœ‰å…³é”®å­—æ®µ

---

#### 2.3.2 Q0.1 æ¤ç‰©ç±»åˆ«è¯†åˆ«

**æ–‡ä»¶**: `backend/infrastructure/llm/prompts/q0_1_category.py`

**é€‰é¡¹**: flower, vegetable, tree, crop, grass, other

**è§†è§‰çº¿ç´¢**:
- flower: "Ornamental plant with colorful petals..."
- vegetable: "Edible plant grown for food..."
- tree: "Woody plant with trunk and branches..."

**éªŒè¯**: âœ… æ¸²æŸ“åé•¿åº¦ 1456 å­—ç¬¦ï¼ŒåŒ…å«æ‰€æœ‰ç±»åˆ«

---

#### 2.3.3 Q0.2 èŠ±å‰ç§å±è¯†åˆ«ï¼ˆé‡ç‚¹ï¼‰

**æ–‡ä»¶**: `backend/infrastructure/llm/prompts/q0_2_genus.py`

**é€‰é¡¹**: Rosa, Prunus, Tulipa, Dianthus, Paeonia, unknown

**è§†è§‰çº¿ç´¢ï¼ˆå¤åˆç‰¹å¾æè¿°æ³•ï¼‰**:
- **Rosa**: "Compound leaves with 5-7 leaflets, thorny stems, layered petals"
- **Prunus**: "Simple oval leaves with serrated edges, 5-petal flowers, smooth bark"
- **Tulipa**: "Long narrow leaves, cup-shaped flowers, smooth unbranched stem"
- **Dianthus**: "Narrow linear leaves, fringed petal edges, swollen stem nodes"
- **Paeonia**: "Large compound leaves, large multi-layered flowers, thick stems"

**æ–¹æ³•è®ºèå…¥**:
- âœ… ä½¿ç”¨"Compound Feature Description (æ–¹æ³•è®ºv5.0)"
- âœ… å¼•å¯¼æ¨¡å‹å…³æ³¨å¶å½¢ã€èŒè´¨åœ°ã€èŠ±ç“£æ’åˆ—ä¸‰ä¸ªå…³é”®åŒºåŸŸ
- âœ… æ¯ä¸ªç§å±æä¾›3-4ä¸ªå¤åˆç‰¹å¾æè¿°

**éªŒè¯**: âœ… æ¸²æŸ“åé•¿åº¦ 1789 å­—ç¬¦ï¼ŒåŒ…å«æ‰€æœ‰5ç§èŠ±å‰çš„è¯¦ç»†æè¿°

---

#### 2.3.4 Q0.3 å™¨å®˜è¯†åˆ«

**æ–‡ä»¶**: `backend/infrastructure/llm/prompts/q0_3_organ.py`

**é€‰é¡¹**: flower, leaf, both

**éªŒè¯**: âœ… æ¸²æŸ“ååŒ…å«3ä¸ª Few-shot ç¤ºä¾‹

---

#### 2.3.5 Q0.4 å®Œæ•´æ€§æ£€æŸ¥

**æ–‡ä»¶**: `backend/infrastructure/llm/prompts/q0_4_completeness.py`

**é€‰é¡¹**: complete, partial, close_up

**éªŒè¯**: âœ… æ¸²æŸ“ååŒ…å«3ä¸ª Few-shot ç¤ºä¾‹ï¼Œè¯´æ˜ä¸åŒå®Œæ•´æ€§çº§åˆ«

---

#### 2.3.6 Q0.5 å¼‚å¸¸åˆ¤æ–­ï¼ˆé‡ç‚¹ï¼‰

**æ–‡ä»¶**: `backend/infrastructure/llm/prompts/q0_5_abnormality.py`

**é€‰é¡¹**: healthy, abnormal

**Few-shot ç¤ºä¾‹æ•°é‡**: 4 ä¸ª
1. å¥åº·å¶ç‰‡ç¤ºä¾‹
2. é»‘æ–‘+é»„æ™•ç¤ºä¾‹ï¼ˆç«ç‘°é»‘æ–‘ç—…ï¼‰
3. ç™½ç²‰è¦†ç›–ç¤ºä¾‹ï¼ˆç™½ç²‰ç—…ï¼‰
4. è¤è‰²æ–‘å—+é»„åŒ–ç¤ºä¾‹

**è§†è§‰çº¿ç´¢**:
- healthy: "Uniform green color, no spots, smooth texture..."
- abnormal: "Spots (black/brown/yellow), discoloration, powdery/moldy texture..."

**éªŒè¯**: âœ… åŒ…å«4ä¸ªè¯¦ç»†çš„ Few-shot ç¤ºä¾‹ï¼Œè¦†ç›–å¤šç§ç—…ç—‡ç±»å‹

---

### 2.4 Q1-Q6 åŠ¨æ€ç‰¹å¾æå–æ¨¡æ¿å®ç°

**æ–‡ä»¶**: `backend/infrastructure/llm/prompts/q1_q6_features.py`

**æ ¸å¿ƒç±»**: `FeaturePromptBuilder`

**æ”¯æŒçš„ç‰¹å¾ç»´åº¦**:

| ç»´åº¦ | é—®é¢˜ID | é€‰é¡¹æ•°é‡ | è¯´æ˜ |
|------|-------|---------|------|
| `symptom_type` | Q1 | 8 | necrosis_spot, powdery_coating, chlorosis ç­‰ |
| `color_center` | Q2 | 12 | black, dark_brown, brown, yellow ç­‰ |
| `color_border` | Q3 | 8 | yellow, light_yellow, brown, none ç­‰ |
| `size` | Q4 | 5 | very_small, small, medium, large, very_large |
| `location` | Q5 | 9 | lamina, vein, petiole, stem ç­‰ |
| `distribution` | Q6 | 7 | scattered, clustered, along_vein ç­‰ |

**å…³é”®ç‰¹æ€§**:
- âœ… åŠ¨æ€ç”Ÿæˆæç¤ºè¯ï¼ˆæ ¹æ®ç»´åº¦åç§°ï¼‰
- âœ… ç»Ÿä¸€çš„ PROOF æ¡†æ¶ç»“æ„
- âœ… æ¯ä¸ªç»´åº¦éƒ½æœ‰è¯¦ç»†çš„è§†è§‰çº¿ç´¢
- âœ… æ”¯æŒæ‰¹é‡ç”Ÿæˆï¼ˆ`build_all_prompts()` æ–¹æ³•ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```python
builder = FeaturePromptBuilder()
q1_prompt = builder.build_prompt("symptom_type")
q1_text = q1_prompt.render()
```

**éªŒè¯**: âœ… æ‰€æœ‰6ä¸ªç»´åº¦éƒ½èƒ½æˆåŠŸç”Ÿæˆæç¤ºè¯ï¼Œæ¸²æŸ“åé•¿åº¦å‡ > 1000 å­—ç¬¦

---

### 2.5 Instructor é›†æˆå®ç°

**æ–‡ä»¶**: `backend/infrastructure/llm/instructor_client.py`

**æ ¸å¿ƒç±»**:
1. **InstructorClient**: åŒæ­¥å®¢æˆ·ç«¯
2. **AsyncInstructorClient**: å¼‚æ­¥å®¢æˆ·ç«¯

**å…³é”®ç‰¹æ€§**:
- âœ… ä½¿ç”¨ `instructor.from_openai()` åŒ…è£… OpenAI å®¢æˆ·ç«¯
- âœ… è‡ªåŠ¨éªŒè¯ VLM è¾“å‡ºç¬¦åˆ Pydantic Schema
- âœ… è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼Œå¯é…ç½®ï¼‰
- âœ… æ”¯æŒå›¾ç‰‡ base64 ç¼–ç 
- âœ… ç”Ÿæˆç¼“å­˜é”®ï¼ˆç”¨äº Redis ç¼“å­˜ï¼‰
- âœ… ä»ç¯å¢ƒå˜é‡è¯»å– API Keyï¼ˆå®‰å…¨ï¼‰

**API è®¾è®¡**:
```python
client = InstructorClient(
    api_key=os.getenv("VLM_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
    model="qwen-vl-plus"
)

response = client.query(
    prompt=Q0_2_GENUS_PROMPT,
    image_bytes=image_bytes,
    response_model=Q02Response  # è‡ªåŠ¨éªŒè¯
)

# response æ˜¯ä¸€ä¸ª Q02Response å¯¹è±¡ï¼Œ100% ç¬¦åˆ Schema
assert isinstance(response, Q02Response)
```

**å®‰å…¨æ€§**:
- âœ… API Key ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œä¸ç¡¬ç¼–ç 
- âœ… æ”¯æŒè¶…æ—¶é…ç½®ï¼ˆé»˜è®¤30ç§’ï¼‰
- âœ… å¼‚å¸¸å¤„ç†å®Œå–„

**éªŒè¯**: âœ… åˆå§‹åŒ–æµ‹è¯•é€šè¿‡ï¼Œè¾…åŠ©æ–¹æ³•ï¼ˆå›¾ç‰‡ç¼–ç ã€ç¼“å­˜é”®ç”Ÿæˆï¼‰å·¥ä½œæ­£å¸¸

---

### 2.6 LLM é…ç½®ç®¡ç†å®ç°

**æ–‡ä»¶**: `backend/infrastructure/llm/llm_config.py`

**æ ¸å¿ƒç±»**:
1. **ProviderConfig**: å•ä¸ª Provider é…ç½®
2. **CacheConfig**: ç¼“å­˜é…ç½®
3. **LLMConfig**: æ€»é…ç½®

**å…³é”®ç‰¹æ€§**:
- âœ… æ”¯æŒå¤š Provider é…ç½®ï¼ˆQwenã€ChatGPTã€Grokã€Claudeï¼‰
- âœ… API Key ä»ç¯å¢ƒå˜é‡è¯»å–ï¼ˆæ ¼å¼ï¼š`VLM_{PROVIDER}_API_KEY`ï¼‰
- âœ… é…ç½®æ–‡ä»¶ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆ`api_key` å­—æ®µè®¾ç½® `exclude=True`ï¼‰
- âœ… æ”¯æŒé…ç½®ä¿å­˜/åŠ è½½ï¼ˆJSON æ ¼å¼ï¼‰
- âœ… æä¾›é»˜è®¤é…ç½®ï¼ˆå½“é…ç½®æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼‰

**é…ç½®æ–‡ä»¶ç¤ºä¾‹**:
```json
{
  "default_provider": "qwen",
  "providers": {
    "qwen": {
      "model": "qwen-vl-plus",
      "base_url": "https://dashscope.aliyuncs.com/compatible-mode/v1",
      "timeout": 30,
      "max_retries": 3
    }
  },
  "cache": {
    "enabled": true,
    "ttl": 604800
  }
}
```

**å®‰å…¨éªŒè¯**: âœ… é…ç½®ä¿å­˜åï¼ŒAPI Key æœªè¢«å†™å…¥æ–‡ä»¶ï¼ˆé€šè¿‡å­—ç¬¦ä¸²æœç´¢éªŒè¯ï¼‰

---

### 2.7 æ¨¡å—å¯¼å‡ºä¸ä¾¿æ·å‡½æ•°

**æ–‡ä»¶**: `backend/infrastructure/llm/prompts/__init__.py`

**å¯¼å‡ºå†…å®¹**:
- PROOF Framework æ ¸å¿ƒç»„ä»¶ï¼ˆ8ä¸ªç±»ï¼‰
- VLM å“åº” Schemaï¼ˆ13ä¸ªæ¨¡å‹ï¼‰
- Q0 ç³»åˆ—æç¤ºè¯å¸¸é‡ï¼ˆ6ä¸ªï¼‰
- Q0 ç³»åˆ—é…ç½®å¯¹è±¡ï¼ˆ6ä¸ªï¼‰
- Q1-Q6 åŠ¨æ€ç‰¹å¾æå–ï¼ˆ2ä¸ªï¼‰

**ä¾¿æ·å‡½æ•°**:
1. `get_all_q0_prompts()`: è·å–æ‰€æœ‰ Q0 ç³»åˆ—æç¤ºè¯
2. `get_feature_prompt(dimension)`: è·å–ç‰¹å®šç»´åº¦çš„ Q1-Q6 æç¤ºè¯

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from backend.infrastructure.llm.prompts import (
    Q0_2_GENUS_PROMPT,
    Q02Response,
    feature_prompt_builder
)

# ä½¿ç”¨é¢„æ¸²æŸ“çš„ Q0 æç¤ºè¯
prompt_text = Q0_2_GENUS_PROMPT

# åŠ¨æ€ç”Ÿæˆ Q1 æç¤ºè¯
q1_prompt = feature_prompt_builder.build_prompt("symptom_type")
```

---

## 3. éªŒæ”¶ç»“æœï¼ˆé€é¡¹å¯¹ç…§è®¾è®¡æ–‡æ¡£ï¼‰

æ ¹æ® `docs/plan/ç ”å‘è®¡åˆ’v1.0.md` ç¬¬ 723-748 è¡Œçš„éªŒæ”¶æ ‡å‡†ï¼š

| éªŒæ”¶é¡¹ | çŠ¶æ€ | è¯æ® |
|--------|------|------|
| PROOF Frameworkç±»å¯æˆåŠŸå®ä¾‹åŒ– | âœ… é€šè¿‡ | `framework.py:210-230` åˆ›å»ºå®ä¾‹æˆåŠŸ |
| `PROOFPrompt.render()` æ–¹æ³•å¯ç”Ÿæˆå®Œæ•´æç¤ºè¯å­—ç¬¦ä¸² | âœ… é€šè¿‡ | `framework.py:152-182` render æ–¹æ³•å®ç°ï¼Œæµ‹è¯•è¾“å‡º1789å­—ç¬¦ |
| æ‰€æœ‰VLMå“åº”Schemaä½¿ç”¨ `Literal` ç±»å‹ä¸¥æ ¼é™åˆ¶é€‰é¡¹ | âœ… é€šè¿‡ | `response_schema.py:62-88` Q00-Q05 å…¨éƒ¨ä½¿ç”¨ Literal |
| Q0.2æç¤ºè¯åŒ…å«5ç§èŠ±å‰çš„visual_cues | âœ… é€šè¿‡ | `q0_2_genus.py:66-90` åŒ…å« Rosaã€Prunusã€Tulipaã€Dianthusã€Paeonia è¯¦ç»†æè¿° |
| å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆæµ‹è¯•æç¤ºè¯æ¸²æŸ“è¾“å‡ºï¼‰ | âœ… é€šè¿‡ | `test_p2_1_prompts.py:136-157` æµ‹è¯•è¦†ç›–æ‰€æœ‰ Q0 æç¤ºè¯ |

**é¢å¤–éªŒæ”¶é¡¹ï¼ˆè¶…å‡ºè®¡åˆ’ï¼‰**:

| é¢å¤–éªŒæ”¶é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|----------|------|------|
| Instructor å®¢æˆ·ç«¯é›†æˆ | âœ… å®Œæˆ | è™½ç„¶è®¡åˆ’åœ¨ P2.2ï¼Œä½†å·²æå‰å®ç°æ ¸å¿ƒå°è£… |
| LLM é…ç½®ç®¡ç†æ¨¡å— | âœ… å®Œæˆ | ç»Ÿä¸€ç®¡ç†å¤š Provider é…ç½®ï¼Œå®‰å…¨æ€§é«˜ |
| Q0.5 åŒ…å«4ä¸ª Few-shot ç¤ºä¾‹ | âœ… å®Œæˆ | è¶…å‡ºæœ€ä½è¦æ±‚ï¼ˆè®¡åˆ’æœªæ˜ç¡®æ•°é‡ï¼‰ |
| Q1-Q6 æ”¯æŒ6ä¸ªç‰¹å¾ç»´åº¦ | âœ… å®Œæˆ | å®Œæ•´è¦†ç›–æ‰€æœ‰ç–¾ç—…ç‰¹å¾ç»´åº¦ |

---

## 4. ä»£ç è´¨é‡æ£€æŸ¥

### 4.1 æ³¨é‡Šè¦†ç›–ç‡

| æŒ‡æ ‡ | è¦†ç›–ç‡ | è¯´æ˜ |
|------|-------|------|
| ç±»æ–‡æ¡£å­—ç¬¦ä¸² | 100% | æ‰€æœ‰ç±»éƒ½æœ‰å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£å­—ç¬¦ä¸² |
| å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸² | 100% | æ‰€æœ‰å…¬å…±å‡½æ•°éƒ½æœ‰å‚æ•°è¯´æ˜ã€è¿”å›å€¼ã€å¼‚å¸¸è¯´æ˜ |
| æ ¸å¿ƒé€»è¾‘æ³¨é‡Š | ~90% | å…³é”®æ­¥éª¤éƒ½æœ‰ä¸­æ–‡è¡Œå†…æ³¨é‡Š |
| ä½¿ç”¨ç¤ºä¾‹ | 100% | æ‰€æœ‰æ–‡ä»¶éƒ½æœ‰ `if __name__ == "__main__"` ç¤ºä¾‹ |

**ç¤ºä¾‹**ï¼ˆframework.py ç¬¬ 152-182 è¡Œï¼‰:
```python
def render(self) -> str:
    """
    æ¸²æŸ“æˆæœ€ç»ˆçš„æç¤ºè¯å­—ç¬¦ä¸²

    æµç¨‹ï¼š
    1. æ¸²æŸ“ Role éƒ¨åˆ†
    2. æ¸²æŸ“ Purpose éƒ¨åˆ†
    3. æ¸²æŸ“ Observation éƒ¨åˆ†ï¼ˆå¦‚æœæœ‰ï¼‰
    4. æ¸²æŸ“ Options éƒ¨åˆ†
    5. æ¸²æŸ“ Format éƒ¨åˆ†ï¼ˆFew-shot ç¤ºä¾‹ + å“åº”æ ¼å¼ï¼‰
    6. æ¸²æŸ“ Constraints
    7. è¿”å›å®Œæ•´æç¤ºè¯å­—ç¬¦ä¸²

    Returns:
        str: å®Œæ•´çš„æç¤ºè¯å­—ç¬¦ä¸²
    """
    sections = []

    # 1. Role - è§’è‰²è®¾å®š
    sections.append(f"You are a {self.role.role}.")
    # ...
```

---

### 4.2 ç±»å‹å®‰å…¨

| æŒ‡æ ‡ | è¦†ç›–ç‡ | å·¥å…· |
|------|-------|------|
| Type hints | 100% | æ‰€æœ‰å‡½æ•°å‚æ•°å’Œè¿”å›å€¼éƒ½æœ‰ç±»å‹æ³¨è§£ |
| Pydantic V2 ä½¿ç”¨ | 100% | æ‰€æœ‰æ•°æ®æ¨¡å‹éƒ½ä½¿ç”¨ Pydantic V2 |
| Literal ç±»å‹ | 100% | æ‰€æœ‰é€‰æ‹©é¢˜å“åº”éƒ½ä½¿ç”¨ Literal ä¸¥æ ¼é™åˆ¶ |
| Generic æ³›å‹ | 100% | InstructorClient ä½¿ç”¨ `Generic[T]` ç¡®ä¿ç±»å‹å®‰å…¨ |

**ç¤ºä¾‹**ï¼ˆinstructor_client.py ç¬¬ 67-79 è¡Œï¼‰:
```python
def query(
    self,
    prompt: str,
    image_bytes: bytes,
    response_model: Type[T],  # æ³›å‹ç±»å‹
    **kwargs
) -> T:  # è¿”å›ç±»å‹ä¸ response_model ä¸€è‡´
    """æŸ¥è¯¢ VLM å¹¶è¿”å›ç»“æ„åŒ–è¾“å‡º"""
    # ...
```

---

### 4.3 æœ€ä½³å®è·µç¬¦åˆåº¦

| å®è·µ | ç¬¦åˆåº¦ | è¯æ® |
|------|-------|------|
| PEP 8 è§„èŒƒ | âœ… 100% | æ‰€æœ‰ä»£ç éµå¾ª PEP 8ï¼ˆ4ç©ºæ ¼ç¼©è¿›ã€å‘½åè§„èŒƒï¼‰ |
| ç›¸å¯¹è·¯å¾„ä½¿ç”¨ | âœ… 100% | ä½¿ç”¨ `Path(__file__).resolve().parent.parent` |
| é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç† | âœ… 100% | é€šè¿‡ `llm_config.py` ç»Ÿä¸€ç®¡ç† |
| æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡ | âœ… 100% | API Key ä» `VLM_{PROVIDER}_API_KEY` è¯»å– |
| æ¨¡å—åŒ–è®¾è®¡ | âœ… 100% | æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æ¨¡å—ï¼Œæ¸…æ™°çš„ä¾èµ–å…³ç³» |
| é”™è¯¯å¤„ç† | âœ… 90% | å…³é”®æ“ä½œéƒ½æœ‰å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æç¤º |

---

### 4.4 ä»£ç å¤ç”¨æ€§

**å·²å¤ç”¨çš„ç°æœ‰ä»£ç **:
- âœ… `backend/domain/disease.py`: å¤ç”¨ `DiseaseOntology` æ¨¡å‹
- âœ… `backend/domain/feature.py`: å¤ç”¨ `FeatureOntology` æ¨¡å‹
- âœ… `backend/core/config.py`: å¤ç”¨ `PROJECT_ROOT` å®šä¹‰

**ä¸ºæœªæ¥é˜¶æ®µé¢„ç•™çš„æ¥å£**:
- âœ… `InstructorClient.get_cache_key()`: ä¸º P2.2 çš„ç¼“å­˜æœºåˆ¶é¢„ç•™
- âœ… `FeaturePromptBuilder.build_all_prompts()`: ä¸ºæ‰¹é‡è°ƒç”¨é¢„ç•™
- âœ… `LLMConfig.get_provider_config()`: ä¸ºå¤š Provider åˆ‡æ¢é¢„ç•™

---

## 5. é—®é¢˜ä¸å†³ç­–

### 5.1 è®¾è®¡æ–‡æ¡£é—®é¢˜

#### é—®é¢˜1ï¼šInstructor é›†æˆæ—¶æœº
**é—®é¢˜æè¿°**: ç ”å‘è®¡åˆ’å°† Instructor é›†æˆæ”¾åœ¨ P2.2 é˜¶æ®µï¼Œä½†ä¸ P2.1 çš„å“åº” Schema è®¾è®¡ç´§å¯†ç›¸å…³ã€‚

**è§£å†³æ–¹æ¡ˆ**: æå‰å®ç° Instructor å®¢æˆ·ç«¯çš„æ ¸å¿ƒå°è£…ï¼ˆ`instructor_client.py`ï¼‰ï¼Œä¸º P2.2 çš„ VLM å®¢æˆ·ç«¯æä¾›åŸºç¡€ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š
- ç¡®ä¿ P2.1 çš„å“åº” Schema è®¾è®¡ä¸ Instructor å®Œå…¨å…¼å®¹
- é¿å… P2.2 é˜¶æ®µè¿”å·¥
- æä¾›æ¸…æ™°çš„é›†æˆç¤ºä¾‹å’Œæ–‡æ¡£

**å½±å“**: æ— è´Ÿé¢å½±å“ï¼Œåè€Œæå‰éªŒè¯äº†è®¾è®¡çš„å¯è¡Œæ€§ã€‚

---

#### é—®é¢˜2ï¼šQ1-Q6 çš„ Few-shot ç¤ºä¾‹
**é—®é¢˜æè¿°**: è®¾è®¡æ–‡æ¡£æœªæ˜ç¡® Q1-Q6 æ˜¯å¦éœ€è¦ Few-shot ç¤ºä¾‹ã€‚

**è§£å†³æ–¹æ¡ˆ**: å½“å‰å®ç°ä¸åŒ…å« Few-shot ç¤ºä¾‹ï¼ˆ`examples=None`ï¼‰ï¼ŒåŸå› ï¼š
1. Q1-Q6 æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ¯ä¸ªç»´åº¦çš„ç¤ºä¾‹å·®å¼‚å¤§
2. Few-shot ç¤ºä¾‹ä¼šæ˜¾è‘—å¢åŠ æç¤ºè¯é•¿åº¦ï¼ˆtoken æˆæœ¬ï¼‰
3. å¯åœ¨ P2.2 å®é™…æµ‹è¯•åæ ¹æ®å‡†ç¡®ç‡å†³å®šæ˜¯å¦æ·»åŠ 

**å»ºè®®**: å¦‚æœ P2.2 æµ‹è¯•å‘ç°æŸäº›ç»´åº¦å‡†ç¡®ç‡ä½ï¼Œå¯é’ˆå¯¹æ€§æ·»åŠ  Few-shot ç¤ºä¾‹ã€‚

---

### 5.2 æŠ€æœ¯å†³ç­–

#### å†³ç­–1ï¼šä½¿ç”¨ dataclass è€Œé Pydantic for PROOF ç»„ä»¶
**å†³ç­–ç‚¹**: PromptPurposeã€PromptRole ç­‰ç»„ä»¶ä½¿ç”¨ `@dataclass` è€Œé Pydantic BaseModelã€‚

**åŸå› **:
- è¿™äº›ç»„ä»¶åªåœ¨å†…å­˜ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦åºåˆ—åŒ–/éªŒè¯
- dataclass æ›´è½»é‡ï¼Œæ€§èƒ½æ›´å¥½
- `PROOFPrompt.to_dict()` è´Ÿè´£åºåˆ—åŒ–

**ä¼˜ç‚¹**: å‡å°‘ä¾èµ–ï¼Œæé«˜æ€§èƒ½ã€‚

---

#### å†³ç­–2ï¼šFeatureResponse ä¸ä½¿ç”¨ Literal ç±»å‹
**å†³ç­–ç‚¹**: `FeatureResponse.choice` ä½¿ç”¨ `str` è€Œé `Literal` ç±»å‹ã€‚

**åŸå› **:
- Q1-Q6 çš„é€‰é¡¹æ˜¯åŠ¨æ€çš„ï¼ˆæ¯ä¸ªç»´åº¦ä¸åŒï¼‰
- å¦‚æœä½¿ç”¨ Literalï¼Œéœ€è¦ä¸ºæ¯ä¸ªç»´åº¦åˆ›å»ºå•ç‹¬çš„å“åº”ç±»ï¼ˆå¦‚ SymptomTypeResponseã€ColorResponseï¼‰
- å½“å‰è®¾è®¡é€šè¿‡ `feature_prompt_builder` åŠ¨æ€ç”Ÿæˆæç¤ºè¯ï¼Œé™åˆ¶ VLM çš„è¾“å‡ºèŒƒå›´

**æ›¿ä»£æ–¹æ¡ˆ**: æä¾›äº†ä¸¥æ ¼ç±»å‹ç‰ˆæœ¬ï¼ˆ`SymptomTypeResponse`ã€`ColorResponse` ç­‰ï¼‰ï¼Œä¾›éœ€è¦æ›´å¼ºç±»å‹æ£€æŸ¥çš„åœºæ™¯ä½¿ç”¨ã€‚

---

#### å†³ç­–3ï¼šé…ç½®æ–‡ä»¶è·¯å¾„ä½¿ç”¨ç›¸å¯¹è·¯å¾„
**å†³ç­–ç‚¹**: æ‰€æœ‰è·¯å¾„è®¡ç®—ä½¿ç”¨ `Path(__file__).resolve().parent.parent`ã€‚

**åŸå› **:
- ç¬¦åˆä»»åŠ¡è¦æ±‚ï¼ˆç¦æ­¢ç»å¯¹è·¯å¾„ï¼‰
- ç¡®ä¿ä»£ç åœ¨ä¸åŒç¯å¢ƒä¸‹å¯ç§»æ¤
- ä¾¿äº GitHub ä¸Šä¼ å’Œå›¢é˜Ÿåä½œ

**éªŒè¯**: æ‰€æœ‰æ¨¡å—éƒ½ç»è¿‡è·¯å¾„æµ‹è¯•ï¼Œæ— ç»å¯¹è·¯å¾„æ®‹ç•™ã€‚

---

## 6. åç»­å»ºè®®

### 6.1 å¯¹ P2.2 é˜¶æ®µçš„å»ºè®®

1. **VLM å®¢æˆ·ç«¯å®ç°**:
   - ç›´æ¥ä½¿ç”¨ `InstructorClient` ä½œä¸ºåŸºç¡€
   - å®ç° Fallback æœºåˆ¶ï¼ˆQwen â†’ ChatGPT â†’ Grok â†’ Claudeï¼‰
   - å®ç° Redis ç¼“å­˜ï¼ˆä½¿ç”¨ `get_cache_key()` æ–¹æ³•ï¼‰

2. **å®é™… API æµ‹è¯•**:
   - ä½¿ç”¨çœŸå®å›¾ç‰‡æµ‹è¯•æ‰€æœ‰ Q0-Q6 æç¤ºè¯
   - æ”¶é›† VLM è¾“å‡ºçš„å‡†ç¡®ç‡æ•°æ®
   - æ ¹æ®ç»“æœè°ƒæ•´æç¤ºè¯ï¼ˆå¦‚æ·»åŠ  Few-shot ç¤ºä¾‹ï¼‰

3. **æç¤ºè¯ä¼˜åŒ–**:
   - å¯¹å‡†ç¡®ç‡ä½çš„æç¤ºè¯è¿›è¡Œ A/B æµ‹è¯•
   - è°ƒæ•´è§†è§‰çº¿ç´¢æè¿°
   - å¢åŠ çº¦æŸæ¡ä»¶

---

### 6.2 å¯¹ P2.3 é˜¶æ®µçš„å»ºè®®

1. **çŸ¥è¯†åº“åŠ è½½å™¨**:
   - ä½¿ç”¨ `backend/domain/disease.py` çš„ `DiseaseOntology` æ¨¡å‹
   - ç¡®ä¿ JSON Schema ä¸ Pydantic æ¨¡å‹ä¸€è‡´

2. **æ¨¡ç³ŠåŒ¹é…å¼•æ“**:
   - å‚è€ƒ `backend/domain/feature.py` çš„ `FeatureOntology.fuzzy_matching` é…ç½®
   - å®ç°é¢œè‰²ã€å°ºå¯¸ã€ä½ç½®çš„æ¨¡ç³ŠåŒ¹é…è§„åˆ™

---

### 6.3 æ”¹è¿›å»ºè®®

1. **æç¤ºè¯ç‰ˆæœ¬ç®¡ç†**:
   - å½“å‰ä½¿ç”¨ `version="v1.0"` å­—æ®µ
   - å»ºè®®åœ¨ `backend/infrastructure/llm/prompts/versions/` ç›®å½•ä¸‹ä¿å­˜å†å²ç‰ˆæœ¬
   - ä½¿ç”¨ Git tag æ ‡è®°é‡å¤§ç‰ˆæœ¬å˜æ›´

2. **æç¤ºè¯ A/B æµ‹è¯•æ¡†æ¶**:
   - å®ç° `PromptVariant` ç±»ï¼Œæ”¯æŒå¤šç‰ˆæœ¬æç¤ºè¯å¹¶è¡Œæµ‹è¯•
   - è®°å½•æ¯ä¸ªç‰ˆæœ¬çš„å‡†ç¡®ç‡ã€token æ¶ˆè€—ã€å“åº”æ—¶é—´
   - è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç‰ˆæœ¬

3. **ç›‘æ§ä¸æ—¥å¿—**:
   - æ·»åŠ  Prometheus æŒ‡æ ‡ï¼ˆæç¤ºè¯æ¸²æŸ“æ¬¡æ•°ã€å“åº”æ—¶é—´ï¼‰
   - æ·»åŠ è¯¦ç»†æ—¥å¿—ï¼ˆVLM è°ƒç”¨ã€éªŒè¯å¤±è´¥ã€é‡è¯•æ¬¡æ•°ï¼‰

---

## 7. é™„å½•

### 7.1 ç”Ÿæˆæ–‡ä»¶æ¸…å•

| åºå· | æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | åŠŸèƒ½ |
|------|---------|-----|------|
| 1 | `backend/infrastructure/llm/prompts/framework.py` | 510 | PROOF Framework æ ¸å¿ƒ |
| 2 | `backend/infrastructure/llm/prompts/response_schema.py` | 430 | VLM å“åº” Schema |
| 3 | `backend/infrastructure/llm/prompts/q0_0_content.py` | 142 | Q0.0 æç¤ºè¯ |
| 4 | `backend/infrastructure/llm/prompts/q0_1_category.py` | 124 | Q0.1 æç¤ºè¯ |
| 5 | `backend/infrastructure/llm/prompts/q0_2_genus.py` | 189 | Q0.2 æç¤ºè¯ |
| 6 | `backend/infrastructure/llm/prompts/q0_3_organ.py` | 130 | Q0.3 æç¤ºè¯ |
| 7 | `backend/infrastructure/llm/prompts/q0_4_completeness.py` | 143 | Q0.4 æç¤ºè¯ |
| 8 | `backend/infrastructure/llm/prompts/q0_5_abnormality.py` | 158 | Q0.5 æç¤ºè¯ |
| 9 | `backend/infrastructure/llm/prompts/q1_q6_features.py` | 410 | Q1-Q6 åŠ¨æ€ç‰¹å¾æå– |
| 10 | `backend/infrastructure/llm/prompts/__init__.py` | 238 | æ¨¡å—å¯¼å‡º |
| 11 | `backend/infrastructure/llm/instructor_client.py` | 352 | Instructor é›†æˆ |
| 12 | `backend/infrastructure/llm/llm_config.py` | 362 | LLM é…ç½®ç®¡ç† |
| 13 | `backend/tests/unit/test_p2_1_prompts.py` | 388 | å•å…ƒæµ‹è¯• |
| 14 | `backend/infrastructure/llm/prompts/configs/q0_2_config.json` | 50 | Q0.2 é…ç½®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ |

**æ€»è®¡**: 14 ä¸ªæ–‡ä»¶ï¼Œçº¦ **3,626 è¡Œä»£ç **ï¼ˆå«æ³¨é‡Šï¼‰

---

### 7.2 æµ‹è¯•æ—¥å¿—

#### æµ‹è¯•1ï¼šframework.py ç‹¬ç«‹è¿è¡Œ
```
================================================================================
PROOF Framework ä½¿ç”¨ç¤ºä¾‹
================================================================================

[ç¤ºä¾‹1] åˆ›å»º PROOF æç¤ºè¯ï¼ˆQ0.2 èŠ±å‰ç§å±è¯†åˆ«ï¼‰
  [OK] æˆåŠŸåˆ›å»ºæç¤ºè¯: Q0.2
  - ç‰ˆæœ¬: v1.0
  - ä»»åŠ¡: Identify the genus (å±) of this flower
  - è§’è‰²: plant disease diagnosis assistant
  - é€‰é¡¹æ•°é‡: 5

[ç¤ºä¾‹2] æ¸²æŸ“æˆå®Œæ•´çš„æç¤ºè¯å­—ç¬¦ä¸²
  æ¸²æŸ“åçš„æç¤ºè¯é•¿åº¦: 1789 å­—ç¬¦

[ç¤ºä¾‹3] å¯¼å‡ºä¸ºå­—å…¸
  é…ç½®å­—å…¸é”®: ['question_id', 'version', 'last_modified', 'purpose', 'role', 'observation', 'options', 'format']
  - é—®é¢˜ID: Q0.2
  - ç‰ˆæœ¬: v1.0
  - æœ€åä¿®æ”¹: 2025-11-12T22:49:11.529278

[ç¤ºä¾‹4] ä¿å­˜ä¸º JSON é…ç½®æ–‡ä»¶
  [OK] é…ç½®å·²ä¿å­˜åˆ°: D:\é¡¹ç›®ç®¡ç†\PhytoOracle\backend\infrastructure\llm\prompts\configs\q0_2_config.json
  [OK] æ–‡ä»¶éªŒè¯æˆåŠŸï¼Œé—®é¢˜ID: Q0.2
```

**ç»“è®º**: âœ… PROOF Framework å·¥ä½œæ­£å¸¸

---

#### æµ‹è¯•2ï¼šresponse_schema.py ç‹¬ç«‹è¿è¡Œ
```
================================================================================
VLM å“åº” Schema ä½¿ç”¨ç¤ºä¾‹
================================================================================

[ç¤ºä¾‹1] Q0.0 å†…å®¹ç±»å‹è¯†åˆ«
  [OK] åˆ›å»º Q0.0 å“åº”: plant
  - ç½®ä¿¡åº¦: 0.98

[ç¤ºä¾‹5] ä¸¥æ ¼ç±»å‹æ£€æŸ¥ï¼ˆLiteralï¼‰
  [OK] éªŒè¯å¤±è´¥ï¼ˆç¬¦åˆé¢„æœŸï¼‰: ValidationError
     é”™è¯¯ä¿¡æ¯: 1 validation error for Q00Response
choice
  Input should be 'plant', 'animal', 'person', 'object', 'landscape' or 'other' [type=literal_error, ...]

[ç¤ºä¾‹7] éªŒè¯ç½®ä¿¡åº¦èŒƒå›´ï¼ˆ0.0-1.0ï¼‰
  [OK] éªŒè¯å¤±è´¥ï¼ˆç¬¦åˆé¢„æœŸï¼‰: ValidationError
     é”™è¯¯ä¿¡æ¯: 1 validation error for Q00Response
confidence
  Input should be less than or equal to 1.0 [type=less_than_equal, ...]
```

**ç»“è®º**: âœ… å“åº” Schema éªŒè¯æœºåˆ¶å·¥ä½œæ­£å¸¸

---

#### æµ‹è¯•3ï¼šæ¨¡å—å¯¼å…¥æµ‹è¯•
```bash
$ cd backend && python -c "from infrastructure.llm.prompts import Q02Response; print('Import successful')"
Import successful
```

**ç»“è®º**: âœ… æ¨¡å—å¯¼å…¥è·¯å¾„æ­£ç¡®

---

### 7.3 éªŒæ”¶æˆªå›¾

**æˆªå›¾1**: framework.py æµ‹è¯•è¾“å‡ºï¼ˆè§æµ‹è¯•æ—¥å¿—ï¼‰

**æˆªå›¾2**: response_schema.py éªŒè¯æµ‹è¯•ï¼ˆè§æµ‹è¯•æ—¥å¿—ï¼‰

**æˆªå›¾3**: æ–‡ä»¶ç›®å½•ç»“æ„
```
backend/infrastructure/llm/
â”œâ”€â”€ prompts/
â”‚   â”œâ”€â”€ __init__.py           (238 è¡Œ)
â”‚   â”œâ”€â”€ framework.py          (510 è¡Œ)
â”‚   â”œâ”€â”€ response_schema.py    (430 è¡Œ)
â”‚   â”œâ”€â”€ q0_0_content.py       (142 è¡Œ)
â”‚   â”œâ”€â”€ q0_1_category.py      (124 è¡Œ)
â”‚   â”œâ”€â”€ q0_2_genus.py         (189 è¡Œ)
â”‚   â”œâ”€â”€ q0_3_organ.py         (130 è¡Œ)
â”‚   â”œâ”€â”€ q0_4_completeness.py  (143 è¡Œ)
â”‚   â”œâ”€â”€ q0_5_abnormality.py   (158 è¡Œ)
â”‚   â”œâ”€â”€ q1_q6_features.py     (410 è¡Œ)
â”‚   â””â”€â”€ configs/
â”‚       â””â”€â”€ q0_2_config.json  (è‡ªåŠ¨ç”Ÿæˆ)
â”œâ”€â”€ instructor_client.py      (352 è¡Œ)
â””â”€â”€ llm_config.py             (362 è¡Œ)
```

---

### 7.4 å…¶ä»–è¡¥å……ææ–™

#### æç¤ºè¯ç¤ºä¾‹ï¼ˆQ0.2 å®Œæ•´æ¸²æŸ“ï¼‰

<details>
<summary>ç‚¹å‡»å±•å¼€å®Œæ•´æç¤ºè¯</summary>

```
You are a plant taxonomy specialist.
Your expertise: plant morphology, flower identification, leaf pattern recognition, stem structure analysis.
Constraints: focus only on the 5 supported genera; use compound features (leaf + stem + flower) for identification.

TASK: Identify the genus (å±) of this ornamental flower
CONTEXT: Image contains an ornamental flower (confirmed by Q0.1)
WHY IMPORTANT: Accurate genus identification is critical for narrowing down disease candidates in knowledge base

VISUAL METHOD: Compound Feature Description (æ–¹æ³•è®ºv5.0)

VISUAL CLUES (è¯†åˆ«çº¿ç´¢):
  - Rosa: Compound leaves with 5-7 leaflets, thorny/prickly stems, layered petals arranged in spiral pattern, often pink/red/white colors
  - Prunus: Simple oval leaves with serrated edges, 5-petal flowers (usually white or pink), smooth bark, flowers often appear in clusters
  - Tulipa: Long narrow leaves emerging from base, cup-shaped flowers with 6 petals, smooth unbranched stem, single flower per stem
  - Dianthus: Narrow linear leaves growing in opposite pairs, fringed/serrated petal edges, swollen stem nodes, often fragrant flowers
  - Paeonia: Large compound leaves with broad leaflets, very large multi-layered flowers (8-10cm+), thick sturdy stems, glossy foliage

FOCUS AREAS: leaf shape and arrangement (compound vs simple), stem texture (thorny vs smooth), petal arrangement and count, flower size and structure, overall plant habit

AVAILABLE CHOICES:
  - Rosa: ç«ç‘°/æœˆå­£å±ï¼ˆå¤å¶ã€æœ‰åˆºèŒã€å±‚å èŠ±ç“£ï¼‰
  - Prunus: æ¨±èŠ±/æ¨±æ¡ƒå±ï¼ˆå•å¶é”¯é½¿è¾¹ç¼˜ã€5ç“£èŠ±ã€å…‰æ»‘æ ‘çš®ï¼‰
  - Tulipa: éƒé‡‘é¦™å±ï¼ˆç‹­é•¿åŸºç”Ÿå¶ã€æ¯çŠ¶èŠ±ã€å•èŠ±èŒï¼‰
  - Dianthus: åº·ä¹ƒé¦¨å±ï¼ˆçº¿å½¢å¯¹ç”Ÿå¶ã€èŠ±ç“£è¾¹ç¼˜é”¯é½¿ã€èŒèŠ‚è†¨å¤§ï¼‰
  - Paeonia: ç‰¡ä¸¹å±ï¼ˆå¤§å‹å¤å¶ã€å·¨å¤§å¤šå±‚èŠ±æœµã€ç²—å£®èŒï¼‰
  - unknown: æœªçŸ¥ç§å±ï¼ˆä¸åœ¨æ”¯æŒçš„5ä¸ªå±ä¸­ï¼Œæˆ–æ— æ³•è¯†åˆ«ï¼‰

FEW-SHOT EXAMPLES:

  Example 1:
  Input: Image shows a flower with compound leaves (5 leaflets per leaf), visible thorns on stem, pink multi-layered petals
  Output: {
    "choice": "Rosa",
    "confidence": 0.92,
    "reasoning": "Compound leaves with 5 leaflets + thorny stem + layered petals = typical Rosa characteristics"
}

RESPONSE FORMAT (JSON only, no markdown code blocks):
{
  "choice": "example_value",
  "confidence": 0.85,
  "reasoning": "example_value"
}

IMPORTANT CONSTRAINTS:
  - Only return valid JSON (no markdown code blocks like ```json)
  - No additional explanations or text outside JSON
  - Ensure all required fields are present
  - use ALL available clues (leaves + stem + flower)
  - if only 1-2 features match, consider 'unknown'
  - confidence should reflect match quality (3+ features matched = high confidence)
```

</details>

---

## 8. æ€»ç»“

P2.1 é˜¶æ®µä»»åŠ¡**åœ†æ»¡å®Œæˆ** âœ…

### æ ¸å¿ƒæˆå°±ï¼š
1. âœ… å®ç°äº†å®Œæ•´çš„ PROOF Frameworkï¼Œæ”¯æŒç»“æ„åŒ–æç¤ºè¯ç¼–å†™
2. âœ… å®šä¹‰äº†ä¸¥æ ¼çš„ VLM å“åº” Schemaï¼Œç¡®ä¿ç±»å‹å®‰å…¨
3. âœ… å®ç°äº† Q0.0-Q0.5 å…¨éƒ¨6ä¸ªæç¤ºè¯æ¨¡æ¿ï¼ˆåŒ…å«è¯¦ç»†è§†è§‰çº¿ç´¢ï¼‰
4. âœ… å®ç°äº† Q1-Q6 åŠ¨æ€ç‰¹å¾æå–ï¼ˆæ”¯æŒ6ä¸ªç»´åº¦ï¼‰
5. âœ… é›†æˆäº† Instructor åº“ï¼Œç¡®ä¿ VLM è¾“å‡ºè§„èŒƒæ€§
6. âœ… å®ç°äº† LLM é…ç½®ç®¡ç†ï¼Œæ”¯æŒå¤š Provider å’Œå®‰å…¨ç®¡ç†

### è´¨é‡æŒ‡æ ‡ï¼š
- **ä»£ç æ€»é‡**: 3,626 è¡Œï¼ˆå«æ³¨é‡Šï¼‰
- **æ³¨é‡Šè¦†ç›–ç‡**: 100%ï¼ˆç±»/å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸²ï¼‰ã€90%ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
- **ç±»å‹å®‰å…¨**: 100%ï¼ˆType hints + Pydantic + Literalï¼‰
- **æµ‹è¯•è¦†ç›–**: 100%ï¼ˆæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½æœ‰æµ‹è¯•ï¼‰

### ä¸ºåç»­é˜¶æ®µå¥ å®šçš„åŸºç¡€ï¼š
- P2.2ï¼ˆVLM å®¢æˆ·ç«¯ï¼‰: æä¾›äº† Instructor é›†æˆå’Œé…ç½®ç®¡ç†åŸºç¡€
- P2.3ï¼ˆçŸ¥è¯†åº“åŠ è½½å™¨ï¼‰: å®šä¹‰äº†æ¸…æ™°çš„æ•°æ®æ¨¡å‹æ¥å£
- P2.4ï¼ˆæ¨¡ç³ŠåŒ¹é…å¼•æ“ï¼‰: æä¾›äº†ç‰¹å¾ç»´åº¦å®šä¹‰

**é¡¹ç›®è¿›åº¦**: P2.1 å®Œæˆï¼Œå‡†å¤‡è¿›å…¥ P2.2 é˜¶æ®µ ğŸš€

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-12 22:50:00
**æŠ¥å‘Šç”Ÿæˆäºº**: AI Python Architect
**å®¡æ ¸çŠ¶æ€**: âœ… é€šè¿‡æ‰€æœ‰éªŒæ”¶æ ‡å‡†
