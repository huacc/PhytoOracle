# PhytoOracle 界面需求文档 v2.0

## 文档说明

本文档定义PhytoOracle系统的4个核心界面功能需求。
- 原则：简洁明确，避免过度设计
- 目标：清晰定义功能、布局和使用流程
- 版本：v2.0（精简版）

---

## 界面1：单图诊断展示页

### 功能概述
展示单张花卉图片的疾病诊断结果，基于VLM问答对推理+本体知识匹配，供人工判断诊断准确性。

### 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  PhytoOracle - 单图诊断结果                        [返回列表] │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌───────────────────────┐   ┌─────────────────────────────┐│
│  │                       │   │ 诊断结果                     ││
│  │                       │   │                             ││
│  │   上传的花卉图片       │   │ 疾病名称：玫瑰黑斑病         ││
│  │   (原图展示)           │   │ 置信度：95%                 ││
│  │                       │   │ 病原体：Diplocarpon rosae   ││
│  │                       │   │                             ││
│  │                       │   │ 推理依据：                   ││
│  │                       │   │ - 症状类型：坏死斑点 ✓       ││
│  └───────────────────────┘   │ - 中心颜色：黑色 ✓          ││
│                               │ - 边缘颜色：黄色晕圈 ✓       ││
│                               │ - 发病位置：叶片 ✓          ││
│  ┌───────────────────────────────────────────────────────┐  │
│  │ VLM问答对详情 (可折叠)                                 │  │
│  ├───────────────────────────────────────────────────────┤  │
│  │ Q0.0 图片内容：花卉图片 ✓                              │  │
│  │ Q0.1 图片类别：叶部病害 ✓                              │  │
│  │ Q0.2 花卉属：Rosa ✓                                   │  │
│  │ Q0.3 器官类型：叶片 ✓                                 │  │
│  │ Q0.4 完整性：完整可见 ✓                               │  │
│  │ Q0.5 异常检测：存在异常 ✓                             │  │
│  │ ──────────────────────────────────────                │  │
│  │ Q1 症状类型：坏死斑点 (necrosis_spot)                 │  │
│  │ Q2 中心颜色：黑色 (black)                             │  │
│  │ Q3 边缘颜色：黄色晕圈 (halo_yellow)                   │  │
│  │ Q4 发病位置：叶片主体 (lamina)                        │  │
│  │ Q5 斑点大小：中等 (medium)                            │  │
│  │ Q6 分布模式：散点分布 (scattered)                     │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 特征匹配详情 (可折叠)                                  │  │
│  ├───────────────────────────────────────────────────────┤  │
│  │ 匹配得分：92/100                                       │  │
│  │                                                        │  │
│  │ 主要特征 (权重80%)：                                   │  │
│  │ • symptom_type: 坏死斑点 ✓ (得分50)                   │  │
│  │ • color_border: 黄色晕圈 ✓ (得分30)                   │  │
│  │                                                        │  │
│  │ 次要特征 (权重15%)：                                   │  │
│  │ • color_center: 黑色 ✓ (得分10)                       │  │
│  │ • location: 叶片 ✓ (得分5)                            │  │
│  │                                                        │  │
│  │ 可选特征 (权重5%)：                                    │  │
│  │ • size: 中等 ~ (得分2，模糊匹配)                       │  │
│  │ • distribution: 散点分布 ✓ (得分2)                    │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                               │
│  [判断正确] [判断错误]                                       │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 功能说明

1. **图片展示区**
   - 左侧展示用户上传的原始花卉图片
   - 支持图片缩放查看

2. **诊断结果区**
   - 显示疾病中文名、英文名、置信度
   - 显示病原体学名
   - 列出关键推理依据（匹配成功的特征，带勾号）

3. **VLM问答对详情**
   - 默认折叠，点击展开
   - 按顺序展示Q0.0-Q0.5的过滤问答和Q1-Q6的特征提取问答
   - 显示VLM的原始回答和提取的结构化值
   - 显示通过/失败标记

4. **特征匹配详情**
   - 默认折叠，点击展开
   - 显示总体匹配得分
   - 按特征重要性分组展示（主要/次要/可选）
   - 每个特征显示：维度名称、匹配值、匹配状态（完全匹配✓、模糊匹配~、未匹配✗）、得分

5. **人工反馈**
   - 底部提供"判断正确"/"判断错误"按钮
   - 用于收集人工验证数据（可选功能，不影响核心流程）

### 使用流程

1. 用户从多图列表页点击某张图片
2. 系统展示该图片的诊断结果页
3. 用户查看诊断结果和置信度
4. 用户展开VLM问答对详情，查看推理过程
5. 用户展开特征匹配详情，查看匹配逻辑
6. 用户根据专业知识判断诊断是否准确
7. （可选）点击反馈按钮记录判断

---

## 界面2：多图批量诊断页

### 功能概述
上传多张花卉图片，批量展示诊断结果，支持翻页查看。

### 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  PhytoOracle - 批量诊断                        [上传新图片]  │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 拖拽图片到此处，或点击选择文件                           ││
│  │ 支持格式：JPG, PNG, BMP                                  ││
│  │ 单次最多上传50张                                         ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  上传进度：[████████████████████] 15/15 已完成               │
│                                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 当前：第 3 / 15 张                                     │  │
│  │                                                        │  │
│  │  ┌─────────────────┐   ┌─────────────────────────────┐│  │
│  │  │                 │   │ 文件名：rose_leaf_003.jpg    ││  │
│  │  │                 │   │                             ││  │
│  │  │  花卉图片展示    │   │ 诊断结果：玫瑰黑斑病         ││  │
│  │  │                 │   │ 置信度：95%                 ││  │
│  │  │                 │   │                             ││  │
│  │  │                 │   │ 关键特征：                   ││  │
│  │  │                 │   │ • 症状：坏死斑点             ││  │
│  │  └─────────────────┘   │ • 边缘：黄色晕圈             ││  │
│  │                         │ • 位置：叶片                 ││  │
│  │                         │                             ││  │
│  │                         │ [查看详细结果]               ││  │
│  │                         └─────────────────────────────┘│  │
│  │                                                        │  │
│  │  [< 上一张]        3 / 15        [下一张 >]          │  │
│  │                                                        │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 全部结果列表 (缩略)                                    │  │
│  ├───────────────────────────────────────────────────────┤  │
│  │ 1. rose_001.jpg - 玫瑰黑斑病 (95%) [查看]             │  │
│  │ 2. rose_002.jpg - 玫瑰白粉病 (88%) [查看]             │  │
│  │ 3. rose_003.jpg - 玫瑰黑斑病 (95%) [查看] ◄ 当前      │  │
│  │ 4. cherry_001.jpg - 樱桃白粉病 (92%) [查看]           │  │
│  │ 5. cherry_002.jpg - 未识别 (35%) [查看]               │  │
│  │ ...                                                    │  │
│  │ [导出Excel报告]                                        │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 功能说明

1. **文件上传区**
   - 支持拖拽上传和点击选择
   - 显示支持的文件格式
   - 显示上传进度条

2. **单图展示区**
   - 一次只展示一张图片和其诊断结果
   - 左侧展示图片，右侧展示诊断摘要
   - 显示文件名、疾病名称、置信度
   - 显示关键特征摘要（3-4个）

3. **翻页控制**
   - 显示当前图片序号/总数
   - 提供"上一张"/"下一张"按钮
   - 支持键盘左右箭头翻页

4. **结果列表区**
   - 底部显示所有图片的诊断结果缩略列表
   - 每行显示：序号、文件名、诊断结果、置信度
   - 点击"查看"可快速跳转到该图片
   - 高亮显示当前正在查看的图片

5. **导出功能**
   - 提供"导出Excel报告"按钮
   - 导出内容：文件名、诊断结果、置信度、关键特征

### 使用流程

1. 用户点击"上传新图片"或拖拽图片到上传区
2. 系统显示上传进度，完成后自动开始批量诊断
3. 系统展示第一张图片的诊断结果
4. 用户点击"下一张"或使用键盘翻页查看其他图片
5. 用户可点击结果列表快速跳转到特定图片
6. 用户点击"查看详细结果"跳转到界面1查看完整诊断信息
7. 用户点击"导出Excel报告"下载批量诊断结果

---

## 界面3：本体结构管理页

### 功能概述
管理PhytoOracle系统的本体结构定义（Schema），展示各类本体的数据模型、字段定义和枚举值约束。**本体是结构定义，不是具体数据。**

**核心概念区分**：
- **本体（Ontology Schema）**：结构定义、字段定义、枚举值约束（较少修改）
- **知识（Knowledge Instance）**：具体疾病实例数据（经常修改，见界面4）

### 界面布局（单视角）

```
┌─────────────────────────────────────────────────────────────┐
│  PhytoOracle - 本体结构管理                      [刷新数据]  │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌───────────────────────────────────┐ │
│  │ 本体类型        │  │ 特征本体 (Feature Ontology)        │ │
│  ├─────────────────┤  ├───────────────────────────────────┤ │
│  │ > 特征本体 ◄    │  │ 文件：feature_ontology.json        │ │
│  │   疾病本体      │  │ 版本：1.0                          │ │
│  │   宿主本体      │  │ 更新时间：2025-11-12               │ │
│  │   治疗本体      │  │ 描述：定义可观察病害特征的维度和   │ │
│  └─────────────────┘  │       枚举值约束                   │ │
│                        │                                    │ │
│                        │ 包含维度 (8个)：                   │ │
│                        │                                    │ │
│                        │ ┌────────────────────────────────┐│ │
│                        │ │ 1. symptom_type (症状类型)     ││ │
│                        │ │    类型：enum                  ││ │
│                        │ │    允许值：7个                 ││ │
│                        │ │    [展开枚举值]                ││ │
│                        │ │                                ││ │
│                        │ │    枚举值定义：                ││ │
│                        │ │    • necrosis_spot (坏死斑点)  ││ │
│                        │ │    • necrosis_blotch (坏死斑块)││ │
│                        │ │    • chlorosis (失绿/黄化)     ││ │
│                        │ │    • powdery_coating (白粉覆盖)││ │
│                        │ │    • downy_coating (霜霉覆盖)  ││ │
│                        │ │    • rust_pustule (锈病脓疱)   ││ │
│                        │ │    • bacterial_spot (细菌斑点) ││ │
│                        │ └────────────────────────────────┘│ │
│                        │                                    │ │
│                        │ ┌────────────────────────────────┐│ │
│                        │ │ 2. color_center (中心颜色)     ││ │
│                        │ │    类型：enum                  ││ │
│                        │ │    允许值：10个 [展开枚举值]   ││ │
│                        │ └────────────────────────────────┘│ │
│                        │                                    │ │
│                        │ ┌────────────────────────────────┐│ │
│                        │ │ 3. color_border (边缘颜色)     ││ │
│                        │ │    类型：enum                  ││ │
│                        │ │    允许值：6个 [展开枚举值]    ││ │
│                        │ └────────────────────────────────┘│ │
│                        │                                    │ │
│                        │ 4. location (发病位置) [展开]      │ │
│                        │ 5. size (斑点大小) [展开]          │ │
│                        │ 6. distribution (分布模式) [展开]  │ │
│                        │ 7. coverage (覆盖度) [展开]        │ │
│                        │ 8. edge_clarity (边缘清晰度) [展开]│ │
│                        │                                    │ │
│                        │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │ │
│                        │ 模糊匹配规则定义：                 │ │
│                        │ • 颜色别名映射（如：褐色→棕色）     │ │
│                        │ • 大小容差（±1级别）               │ │
│                        │ • 症状同义词（如：斑点→斑块）       │ │
│                        │                                    │ │
│                        └────────────────────────────────────┘ │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 其他本体示例

#### 疾病本体（Disease Schema）

```
┌─────────────────────────────────────────────────────────────┐
│  疾病本体 (Disease Schema Definition)                         │
├─────────────────────────────────────────────────────────────┤
│  文件：disease_schema.json（概念定义，无对应实际文件）        │
│  描述：定义疾病知识实例的数据结构                             │
│                                                               │
│  必需字段 (Required Fields)：                                 │
│  • disease_id: string (唯一标识符)                           │
│  • disease_name_zh: string (中文名称)                        │
│  • disease_name_en: string (英文名称)                        │
│  • pathogen: object (病原体信息)                             │
│    - type: enum [fungal, bacterial, viral, abiotic]         │
│    - species: string (学名)                                  │
│  • host_genus: string (宿主属名，引用宿主本体)                │
│                                                               │
│  特征向量字段 (Feature Vector)：                              │
│  • feature_vector: object                                    │
│    - 各维度名称引用特征本体定义的维度                         │
│    - 值必须是特征本体中定义的枚举值                           │
│                                                               │
│  权重配置字段 (Feature Importance)：                          │
│  • feature_importance: object                                │
│    - major_features: array (权重50%+)                        │
│    - minor_features: array (权重10-30%)                      │
│    - optional_features: array (权重<10%)                     │
│                                                               │
│  可选字段 (Optional Fields)：                                 │
│  • visual_descriptions: object (VLM可理解的描述)             │
│  • diagnosis_rules: object (诊断规则)                        │
│  • treatment_recommendations: array (治疗建议)               │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

#### 宿主本体（Host Schema）

```
┌─────────────────────────────────────────────────────────────┐
│  宿主本体 (Host Schema Definition)                            │
├─────────────────────────────────────────────────────────────┤
│  文件：host_schema.json（概念定义，无对应实际文件）           │
│  描述：定义宿主植物的数据结构                                 │
│                                                               │
│  必需字段：                                                   │
│  • genus_name: string (属名，如"Rosa")                       │
│  • family: string (科名，如"Rosaceae")                       │
│  • common_name_zh: string (中文名)                           │
│  • common_name_en: string (英文名)                           │
│                                                               │
│  关联字段：                                                   │
│  • associated_diseases: array<string> (关联疾病ID列表)        │
│                                                               │
│  说明：宿主实例数据保存在 host_disease/associations.json      │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

#### 治疗本体（Treatment Schema）

```
┌─────────────────────────────────────────────────────────────┐
│  治疗本体 (Treatment Schema Definition)                       │
├─────────────────────────────────────────────────────────────┤
│  文件：treatment_schema.json（概念定义，无对应实际文件）       │
│  描述：定义治疗方案的数据结构                                 │
│                                                               │
│  必需字段：                                                   │
│  • treatment_id: string (唯一标识符)                         │
│  • treatment_name: string (治疗名称)                         │
│  • treatment_type: enum [chemical, biological, cultural,     │
│                          integrated]                         │
│  • active_ingredients: array<string> (有效成分)              │
│                                                               │
│  关联字段：                                                   │
│  • target_diseases: array<string> (目标疾病ID列表)           │
│  • efficacy: enum [high, medium, low] (有效性)               │
│                                                               │
│  可选字段：                                                   │
│  • application_method: string (施用方法)                     │
│  • dosage: string (用量)                                     │
│  • safety_notes: string (安全说明)                           │
│                                                               │
│  说明：MVP版本可暂不实现治疗本体                              │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 功能说明

1. **本体类型列表（左侧）**
   - 显示所有本体类型：特征本体、疾病本体、宿主本体、治疗本体
   - 点击切换查看不同本体的结构定义

2. **本体结构展示区（右侧）**
   - 显示本体的元信息：文件名、版本、更新时间、描述
   - **字段定义**：列出本体包含的所有字段（必需/可选）
   - **枚举值定义**：对于enum类型字段，展示所有允许值
   - **约束规则**：展示数据验证规则（如模糊匹配规则）
   - 支持展开/折叠查看详细定义

3. **只读展示**
   - MVP版本界面为**只读查看**，不支持在线编辑
   - 本体修改通过配置文件完成，界面仅供查阅

4. **关系视图（MVP不实现）**
   - 未来可扩展：展示本体之间的结构关系
   - 示例：Feature Ontology → Disease Schema（疾病使用特征维度）
   - 示例：Disease Schema → Host Schema（疾病关联宿主）
   - 示例：Disease Schema → Treatment Schema（疾病对应治疗）
   - **注意**：这是Schema层面的关系，不是实例数据的关系

### 使用流程

1. 用户进入本体结构管理页
2. 用户在左侧选择本体类型（如"特征本体"）
3. 系统展示该本体的结构定义和字段列表
4. 用户点击某个字段的"展开枚举值"
5. 系统展示该字段的所有允许值和定义
6. 用户理解本体结构，用于指导知识数据录入（界面4）

### 与界面4的区分

| 对比维度 | 界面3（本体结构管理） | 界面4（知识实例管理） |
|---------|---------------------|---------------------|
| **管理对象** | 结构定义（Schema） | 具体数据（Instance） |
| **举例** | "symptom_type字段定义了7个枚举值" | "玫瑰黑斑病的symptom_type是necrosis_spot" |
| **文件** | feature_ontology.json | diseases/rose_black_spot.json |
| **修改频率** | 很少（架构调整） | 经常（知识优化） |
| **编辑权限** | MVP版本只读 | 支持在线编辑 |
| **关系视图** | 本体间的Schema关系（MVP不做） | 知识实例间的数据关系（MVP不做） |

---

## 界面4：知识管理页

### 功能概述
管理疾病诊断知识库，核心是编辑疾病的**多维度知识**，将植物病理学术语转译为VLM可理解的影像学/日常用语。采用资源管理器风格布局（左侧目录树，右侧多维度编辑器），支持简化版本管理。

### 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  PhytoOracle - 知识管理      [保存快照] [版本历史] [导出]   │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌────────────────────────────────────────┐│
│  │ 知识库      │  │ rose_black_spot - 玫瑰黑斑病            ││
│  ├─────────────┤  ├────────────────────────────────────────┤│
│  │ ▼ Rosa      │  │ 基本信息                                ││
│  │   (蔷薇属)  │  │ 疾病ID: rose_black_spot                 ││
│  │   ├ 玫瑰黑  │  │ 病原体: Diplocarpon rosae (真菌)        ││
│  │   │  斑病 ◄ │  │ 宿主: Rosa (蔷薇属)                     ││
│  │   ├ 玫瑰白  │  │                                         ││
│  │   │  粉病   │  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  ││
│  │   └ 玫瑰锈  │  │ 疾病知识的多维度展示                     ││
│  │      病     │  │                                         ││
│  │ ▼ Prunus    │  │ ┌────────────────────────────────────┐  ││
│  │   (李属)    │  │ │ 维度1: 症状类型 (symptom_type)      │  ││
│  │   ├ 樱花白  │  │ │ ┌────────────────────────────────┐ │  ││
│  │   │  粉病   │  │ │ │ 标准值: necrosis_spot           │ │  ││
│  │   └ 樱花叶  │  │ │ │ 术语: 坏死斑点                  │ │  ││
│  │      斑病   │  │ │ │                                 │ │  ││
│  │ ▶ Tulipa    │  │ │ │ VLM可理解的描述:                │ │  ││
│  │   (郁金香属)│  │ │ │ • 影像学描述: "组织坏死形成的   │ │  ││
│  │             │  │ │ │   黑色或褐色斑点,边界清晰"      │ │  ││
│  │ ━━━━━━━━━  │  │ │ │ • 日常用语: "像被香烟烫过留下   │ │  ││
│  │ 其他        │  │ │ │   的焦痕,像纸张被火星烧出的    │ │  ││
│  │ ▶ 特征本体  │  │ │ │   小洞边缘"                     │ │  ││
│  │ ▶ 宿主关联  │  │ │ │                                 │ │  ││
│  │ ▶ 治疗方案  │  │ │ │ 权重: 50% (主要特征)            │ │  ││
│  │             │  │ │ └────────────────────────────────┘ │  ││
│  │             │  │ └────────────────────────────────────┘  ││
│  │             │  │                                         ││
│  │             │  │ ┌────────────────────────────────────┐  ││
│  │             │  │ │ 维度2: 边缘颜色 (color_border)     │  ││
│  │             │  │ │ ┌────────────────────────────────┐ │  ││
│  │             │  │ │ │ 标准值: yellow, light_yellow    │ │  ││
│  │             │  │ │ │ 术语: 黄色晕圈                  │ │  ││
│  │             │  │ │ │                                 │ │  ││
│  │             │  │ │ │ VLM可理解的描述:                │ │  ││
│  │             │  │ │ │ • 影像学描述: "病斑周围有明显的 │ │  ││
│  │             │  │ │ │   黄色晕染区域"                 │ │  ││
│  │             │  │ │ │ • 日常用语: "像月亮周围的黄色   │ │  ││
│  │             │  │ │ │   光晕,像煎蛋蛋白环绕蛋黄"      │ │  ││
│  │             │  │ │ │ • 空间定位: "从病斑中心向外     │ │  ││
│  │             │  │ │ │   0.5-2mm的环状区域"            │ │  ││
│  │             │  │ │ │                                 │ │  ││
│  │             │  │ │ │ 权重: 30% (主要特征, KEY)       │ │  ││
│  │             │  │ │ └────────────────────────────────┘ │  ││
│  │             │  │ │ [编辑] [调整权重]                  │  ││
│  │             │  │ └────────────────────────────────────┘  ││
│  │             │  │                                         ││
│  │             │  │ [展开其他维度: 中心颜色、位置、大小...] ││
│  │             │  │                                         ││
│  │             │  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  ││
│  │             │  │ 治疗知识 (可折叠) ▶                     ││
│  │             │  │                                         ││
│  │             │  │ [保存修改] [验证] [测试诊断]            ││
│  └─────────────┘  └────────────────────────────────────────┘│
│                                                               │
└─────────────────────────────────────────────────────────────┘
```


### 功能说明

1. **知识库目录树（左侧）**
   - 按**宿主属（花）**组织，作为父节点（如：Rosa、Prunus、Tulipa）
   - 每个宿主属下列出该属的所有**疾病**，作为叶子节点
   - 显示中文名称和学名（如：Rosa (蔷薇属)、玫瑰黑斑病）
   - 点击疾病节点，在右侧展示该疾病的多维度知识
   - 底部**其他**区域（折叠）放置配置文件：特征本体、宿主关联、治疗方案等
   - 符合用户认知：先认识花，再了解花的疾病

2. **多维度知识展示区（右侧核心）**
   - **基本信息**：疾病ID、病原体、宿主
   - **维度卡片**：每个特征维度独立展示
     - 标准值：该维度的期望值（如necrosis_spot）
     - 术语：中文专业术语
     - **VLM可理解的描述**（核心）：
       - 影像学描述：医学/植物病理学的专业描述
       - 日常用语：生活化的比喻和视觉隐喻
       - 空间定位方法：位置、大小、范围的量化描述
     - 权重：该维度在诊断中的重要性
   - 可折叠/展开：默认展示主要特征，其他可展开查看

3. **权重展示**
   - 直接在每个维度卡片中显示权重百分比
   - 标记主要特征（50%+）、次要特征（10-30%）、可选特征（<10%）
   - 不需要复杂的试验对比界面

4. **治疗知识入口**
   - 可折叠区域，默认收起
   - 预留接口，MVP版本可简单显示治疗建议文本
   - 未来可扩展为结构化治疗方案

5. **简化版本管理**
   - **保存快照**：点击按钮保存当前知识库状态
     - 格式：知识库备份_时间戳_版本号.zip
     - 包含所有JSON文件的完整副本
   - **版本历史**：查看历史快照列表
     - 显示时间、版本号、修改说明
     - 支持快速恢复到历史版本
   - 不需要复杂的Git集成或审计日志

6. **编辑和验证**
   - 在线编辑维度的VLM描述
   - 实时验证：检查标准值是否在feature_ontology中定义
   - 保存前验证：确保JSON格式正确、必填字段完整
   - 测试诊断：上传测试图片，查看使用新知识的诊断结果

7. **关系视图（MVP不实现）**
   - 未来可扩展：展示知识实例之间的关系图
   - 示例：Rosa宿主 → rose_black_spot疾病 → 铜制剂治疗
   - 这是**实例数据**之间的关系，与界面3的Schema关系不同
   - 可以可视化疾病、宿主、治疗之间的关联网络
   - **注意**：MVP版本先不做，只提供文件浏览和编辑功能

### 使用流程

#### 典型场景：优化疾病的VLM描述
1. 用户进入知识管理页
2. 用户在左侧目录树展开"Rosa (蔷薇属)"节点
3. 用户点击"玫瑰黑斑病"
4. 系统在右侧展示该疾病的多维度知识
5. 用户定位到"边缘颜色"维度卡片（权重30%，KEY特征）
6. 用户点击"编辑"，修改VLM可理解的描述：
   - 在"日常用语"中添加："像手电筒照射时周围的黄色光圈"
   - 在"空间定位"中完善："从病斑边缘向外延伸，宽度约0.5-2mm"
7. 系统实时预览修改效果
8. 用户点击"测试诊断"，上传测试图片验证新描述是否改善识别率
9. 用户满意后点击"保存修改"
10. 系统保存JSON文件并自动验证格式

#### 版本管理场景
1. 用户完成多个疾病的知识调整
2. 用户点击顶部"保存快照"按钮
3. 系统弹出对话框，用户输入版本号"v1.2"和修改说明"优化边缘颜色描述"
4. 系统打包所有JSON文件为ZIP（知识库备份_20251114_v1.2.zip）
5. 用户后续发现问题，点击"版本历史"
6. 用户选择"v1.1"版本，点击"恢复"
7. 系统解压历史快照，替换当前知识库文件

---

## 技术实现建议

### 前端技术栈
- 框架：React 或 Vue.js（组件化开发）
- 图可视化：D3.js 或 vis.js（未来扩展关系视图时使用）
- JSON编辑器：Monaco Editor 或 CodeMirror（界面4源码视图）
- UI组件库：Ant Design 或 Material-UI
- 文件上传：react-dropzone 或 vue-dropzone

### 后端API需求（简要）

#### 界面1/2 - 诊断相关
- `POST /api/diagnosis/single` - 单图诊断
- `POST /api/diagnosis/batch` - 批量诊断
- `GET /api/diagnosis/result/{id}` - 获取诊断结果详情

#### 界面3 - 本体结构管理
- `GET /api/ontology/list` - 获取所有本体类型
- `GET /api/ontology/{type}` - 获取指定本体Schema定义
- ~~`GET /api/ontology/relations`~~ - MVP不实现关系图

#### 界面4 - 知识管理
- `GET /api/knowledge/tree` - 获取知识库目录树
  **说明**：返回按**宿主属分组**的疾病树结构，而非文件系统结构
  **示例返回**：
  ```json
  {
    "hosts": [
      {
        "genus": "Rosa",
        "name_zh": "蔷薇属",
        "diseases": [
          {"id": "rose_black_spot", "name_zh": "玫瑰黑斑病"},
          {"id": "rose_powdery_mildew", "name_zh": "玫瑰白粉病"},
          {"id": "rose_rust", "name_zh": "玫瑰锈病"}
        ]
      },
      {
        "genus": "Prunus",
        "name_zh": "李属",
        "diseases": [
          {"id": "cherry_powdery_mildew", "name_zh": "樱花白粉病"},
          {"id": "cherry_leaf_spot", "name_zh": "樱花叶斑病"}
        ]
      },
      {
        "genus": "Tulipa",
        "name_zh": "郁金香属",
        "diseases": [
          {"id": "tulip_fire", "name_zh": "郁金香灰霉病"}
        ]
      }
    ],
    "others": [
      {"id": "feature_ontology", "name": "特征本体", "type": "config"},
      {"id": "host_associations", "name": "宿主关联", "type": "config"},
      {"id": "treatment_schemas", "name": "治疗方案", "type": "config"}
    ]
  }
  ```
- `GET /api/knowledge/disease/{id}` - 获取疾病的完整知识数据
- `POST /api/knowledge/disease/{id}` - 保存疾病知识修改
- `POST /api/knowledge/validate` - 验证知识数据格式
- `POST /api/knowledge/snapshot` - 创建知识库快照
- `GET /api/knowledge/snapshots` - 获取快照历史
- `POST /api/knowledge/restore/{snapshot_id}` - 恢复历史快照

---

## 未明确的问题（需要用户确认）

### 界面1/2
1. 是否需要支持图片标注功能（在图片上标记病害区域）？
2. 人工反馈数据如何存储和使用（是否需要反馈管理界面）？
3. Excel导出报告的具体格式要求？

---

## 附录：数据结构说明

### 特征本体 (feature_ontology.json)
- **维度 (dimensions)**：symptom_type, color_center, color_border, location, size, distribution, coverage
- **每个维度**：type, description, values, value_definitions
- **模糊匹配规则**：color_aliases, size_tolerance, synonym_mapping

### 疾病本体 (diseases/*.json)
- **基本信息**：disease_id, disease_name, pathogen
- **特征向量 (feature_vector)**：对应特征本体维度的期望值
- **特征重要性 (feature_importance)**：major_features, minor_features, optional_features
- **诊断规则 (diagnosis_rules)**：confirmed, suspected
- **视觉描述 (visual_descriptions)**：供VLM和人类理解

### 宿主-疾病关联 (host_disease/associations.json)
- **关联关系 (associations)**：host_genus → diseases[]
- **每个宿主**：genus_name, family, diseases
- **每种疾病**：disease_id, prevalence, specificity

---

## 文档版本历史

- v2.3 (2025-11-14)：优化界面4目录树组织方式（用户反馈）
  - **目录树重构**：从文件系统结构改为业务逻辑结构（宿主→疾病）
  - **用户认知优化**：按花（宿主属）作为父节点，疾病作为叶子节点
  - **示例结构**：Rosa (蔷薇属) → 玫瑰黑斑病、玫瑰白粉病、玫瑰锈病
  - **其他区域**：配置文件（特征本体、宿主关联、治疗方案）放置在底部折叠区
  - **API调整**：`GET /api/knowledge/tree` 返回按宿主分组的树结构，附带完整示例
  - **使用流程更新**：将"展开diseases文件夹"改为"展开Rosa (蔷薇属)节点"
- v2.2 (2025-11-14)：修正界面3和界面4的概念混淆问题
  - **界面3重构**：明确为本体结构管理（Schema定义），只读查看
  - **删除界面3的错误内容**：移除知识实例（如玫瑰黑斑病）和实例关系图
  - **界面4澄清**：确认为知识实例管理（Instance数据），支持编辑
  - **添加对比表格**：明确本体vs知识的区别
  - **关系视图说明**：界面3的关系视图是Schema关系，界面4的关系视图是实例关系，MVP均不实现
  - **符合用户反馈**：本体=结构定义，知识=具体实例
- v2.1 (2025-11-14)：更新界面4设计，基于用户对5个开放问题的明确答案
  - 核心：多维度知识展示（标准值 + VLM可理解描述）
  - 保留目录树结构
  - 简化版本管理（快照+时间戳）
  - 预留治疗知识接口
  - 符合MVP版本要求
- v2.0 (2025-11-14)：精简版，去除过度设计，聚焦核心功能
- v1.0：初始版本（已废弃）
