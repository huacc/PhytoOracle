# PhytoOracle MVP v1.1 ç ”å‘è®¡åˆ’ v2.0

**ç‰ˆæœ¬**: v2.0
**åˆ›å»ºæ—¶é—´**: 2025-11-14
**åŸºäºç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: å¾…è¯„å®¡
**ç›®æ ‡ç‰ˆæœ¬**: MVP v1.1 (ç«¯åˆ°ç«¯å®ç°)

---

## ğŸ“‹ v2.0 ç‰ˆæœ¬è¯´æ˜

æœ¬æ–‡æ¡£åŸºäº `ç ”å‘è®¡åˆ’v1.0.md` åˆ›å»ºï¼Œä¸»è¦å˜æ›´å¦‚ä¸‹ï¼š

### ğŸ”„ æ ¸å¿ƒå˜æ›´
1. **å‰ç«¯æŠ€æœ¯æ ˆè°ƒæ•´**: Streamlitç®¡ç†åå° + Next.jsè¯Šæ–­ç•Œé¢ â†’ **React/Vueå•ä¸€æŠ€æœ¯æ ˆå®ç°4ä¸ªç•Œé¢**
2. **ç•Œé¢æ•°é‡æ‰©å±•**: 2ä¸ªä¸»è¦ç•Œé¢ â†’ **4ä¸ªå®Œæ•´ç•Œé¢**ï¼ˆå•å›¾è¯Šæ–­ã€æ‰¹é‡è¯Šæ–­ã€æœ¬ä½“ç®¡ç†ã€çŸ¥è¯†ç®¡ç†ï¼‰
3. **APIèŒƒå›´æ‰©å±•**: åŸºç¡€è¯Šæ–­API â†’ **å®Œæ•´CRUD API**ï¼ˆè¯Šæ–­ã€å›¾ç‰‡ã€çŸ¥è¯†åº“ã€æœ¬ä½“ï¼‰
4. **æ–°å¢è”è°ƒé˜¶æ®µ**: å¢åŠ P6å‰åç«¯è”è°ƒé˜¶æ®µï¼Œç¡®ä¿ç«¯åˆ°ç«¯æµç¨‹ç•…é€š
5. **æ¥å£åè®®æ¢³ç†**: åœ¨P4é˜¶æ®µè¯¦ç»†æ¢³ç†æ‰€æœ‰æ¥å£åè®®ï¼Œä¸è®¾è®¡æ–‡æ¡£ç¬¬6ç« å¯¹åº”

### âœ… ä¿æŒä¸å˜
- P0-P3çš„æ‰€æœ‰å†…å®¹ï¼ˆå·²å®Œæˆï¼Œä¸ä¿®æ”¹ï¼‰
- æŠ€æœ¯æ¶æ„å’Œè®¾è®¡åŸåˆ™
- æµ‹è¯•ç­–ç•¥å’Œè´¨é‡æ ‡å‡†
- é£é™©ç®¡ç†å’Œåº”å¯¹ç­–ç•¥

### ğŸ“ ç« èŠ‚ä¿®æ”¹æ ‡è®°
- âœ… **ä¿æŒä¸å˜**: å†…å®¹ä¸v1.0å®Œå…¨ä¸€è‡´
- ğŸ”„ **å·²ä¿®æ”¹**: å†…å®¹å·²æ›´æ–°ï¼Œä¸v1.0ä¸åŒ
- âœ¨ **æ–°å¢**: v2.0æ–°å¢çš„å†…å®¹

---

## ç›®å½•

- [1. é¡¹ç›®èƒŒæ™¯](#1-é¡¹ç›®èƒŒæ™¯) âœ…
- [2. æ€»ä½“ç›®æ ‡](#2-æ€»ä½“ç›®æ ‡) ğŸ”„
- [3. é˜¶æ®µåˆ’åˆ†æ€»è§ˆ](#3-é˜¶æ®µåˆ’åˆ†æ€»è§ˆ) ğŸ”„
- [4. å…³é”®é‡Œç¨‹ç¢‘](#4-å…³é”®é‡Œç¨‹ç¢‘) ğŸ”„
- [5. è¯¦ç»†é˜¶æ®µè§„åˆ’](#5-è¯¦ç»†é˜¶æ®µè§„åˆ’)
  - [P0: ç¯å¢ƒå‡†å¤‡ä¸æ¶æ„è®¾è®¡](#p0-ç¯å¢ƒå‡†å¤‡ä¸æ¶æ„è®¾è®¡) âœ…
  - [P1: æ¥å£åè®®ä¸æ•°æ®åº“è®¾è®¡](#p1-æ¥å£åè®®ä¸æ•°æ®åº“è®¾è®¡) âœ…
  - [P2: æ ¸å¿ƒåŸºç¡€è®¾æ–½å¼€å‘](#p2-æ ¸å¿ƒåŸºç¡€è®¾æ–½å¼€å‘) âœ…
  - [P3: è¯Šæ–­å¼•æ“æ ¸å¿ƒé€»è¾‘](#p3-è¯Šæ–­å¼•æ“æ ¸å¿ƒé€»è¾‘) âœ…
  - [P4: å®Œæ•´åç«¯APIå¼€å‘](#p4-å®Œæ•´åç«¯apiå¼€å‘) ğŸ”„
  - [P5: React/Vueå‰ç«¯å¼€å‘](#p5-reactvueå‰ç«¯å¼€å‘) ğŸ”„
  - [P6: å‰åç«¯è”è°ƒ](#p6-å‰åç«¯è”è°ƒ) âœ¨
  - [P7: æµ‹è¯•å¼€å‘ä¸æ‰§è¡Œ](#p7-æµ‹è¯•å¼€å‘ä¸æ‰§è¡Œ) ğŸ”„
  - [P8: æœ¬åœ°éƒ¨ç½²ä¸éªŒæ”¶](#p8-æœ¬åœ°éƒ¨ç½²ä¸éªŒæ”¶) ğŸ”„
- [6. é£é™©ä¸åº”å¯¹](#6-é£é™©ä¸åº”å¯¹) ğŸ”„
- [7. é™„å½•](#7-é™„å½•) ğŸ”„
- [8. æ–‡æ¡£ä¿®è®¢è®°å½•](#8-æ–‡æ¡£ä¿®è®¢è®°å½•) âœ¨

---

## 1. é¡¹ç›®èƒŒæ™¯ âœ…

**ä¸v1.0ä¿æŒä¸€è‡´ï¼Œå†…å®¹ä¸å˜**

PhytoOracle æ˜¯åŸºäºæœ¬ä½“å»ºæ¨¡çš„èŠ±å‰ç–¾ç—…è¯Šæ–­ç³»ç»Ÿï¼Œæ ¸å¿ƒæŠ€æœ¯è·¯çº¿ä¸ºï¼š**VLMè§†è§‰ç†è§£ + æœ¬ä½“çŸ¥è¯†åº“ + æç¤ºè¯å·¥ç¨‹ + åŠ æƒè¯Šæ–­å¼•æ“**ã€‚

### 1.1 æŠ€æœ¯éªŒè¯åŸºç¡€

- **FlowerSpecialist v4.1**ï¼šå·²éªŒè¯ç«ç‘°é»‘æ–‘ç—…ï¼ˆ100%ç‰¹å¾æ£€æµ‹ç‡ï¼‰ã€æ¨±èŠ±ç™½ç²‰ç—…ï¼ˆ70.8%ç¡®è¯Šç‡ï¼‰
- **æ–¹æ³•è®ºv5.0**ï¼šé›¶è®­ç»ƒè¯Šæ–­ã€äº”çŸ¥è¯†åº“æ¶æ„ã€è§†è§‰æè¿°ä¼˜åŒ–5å¤§æ–¹æ³•
- **æµ‹è¯•æ•°æ®é›†**ï¼š
  - `D:\é¡¹ç›®ç®¡ç†\æ¤ç‰©ç—…è™«å®³\æ•°æ®é›†\flower_data`
  - `D:\é¡¹ç›®ç®¡ç†\æ¤ç‰©ç—…è™«å®³\æ•°æ®é›†\Rose_leaf`

### 1.2 æ ¸å¿ƒæŒ‘æˆ˜

1. **çŸ¥è¯†åº“æ•°æ®æœªå®Œå…¨å‡†å¤‡**ï¼š18-24ç§ç–¾ç—…JSONéœ€è¦é€æ­¥æ„å»º
2. **å¯æ‰©å±•æ€§è¦æ±‚é«˜**ï¼šåç»­ä¸èƒ½å¤§è§„æ¨¡é‡å†™ï¼Œå¿…é¡»ä¸€æ¬¡æ€§è®¾è®¡å¥½æ¶æ„
3. **æœ¬åœ°éƒ¨ç½²ç¯å¢ƒ**ï¼šPostgreSQL + Rediséœ€è¦æœ¬åœ°æ­å»ºå¹¶éªŒè¯
4. **ç®¡ç†åå°ä¼˜å…ˆçº§é«˜**ï¼šç–¾ç—…æ¨¡å‹ç®¡ç†åŠŸèƒ½æ˜¯å…³é”®ï¼ˆé€šè¿‡AIè¾…åŠ©æ„å»ºç–¾ç—…JSONï¼‰

---

## 2. æ€»ä½“ç›®æ ‡ ğŸ”„

### 2.1 æ ¸å¿ƒç›®æ ‡

**äº§å‡ºä¸€ä¸ªå¯è¿è¡Œçš„èŠ±å‰ç–¾ç—…è¯Šæ–­ç³»ç»ŸMVP**ï¼Œå…·å¤‡ï¼š

1. âœ… **è¯Šæ–­èƒ½åŠ›**ï¼šæ”¯æŒQ0-Q6é—®è¯Šåºåˆ— + ä¸‰å±‚æ¸è¿›è¯Šæ–­
2. ğŸ”„ **ç®¡ç†èƒ½åŠ›**ï¼šWebç•Œé¢ï¼Œæ”¯æŒç–¾ç—…CRUDã€æœ¬ä½“æŸ¥çœ‹ã€è¯Šæ–­æµ‹è¯•ã€ç»Ÿè®¡åˆ†æ
3. ğŸ”„ **ç”¨æˆ·ç•Œé¢**ï¼šReact/Vueå®ç°çš„4ä¸ªå®Œæ•´ç•Œé¢ï¼ˆå•å›¾è¯Šæ–­ã€æ‰¹é‡è¯Šæ–­ã€æœ¬ä½“ç®¡ç†ã€çŸ¥è¯†ç®¡ç†ï¼‰
4. âœ… **å¯æ‰©å±•æ€§**ï¼šåç»­æ–°å¢èŠ±å‰/ç–¾ç—…æ— éœ€å¤§è§„æ¨¡é‡æ„

**ğŸ†• v2.0æ–°å¢**: å®Œæ•´çš„ç«¯åˆ°ç«¯ç³»ç»Ÿå®ç°ï¼Œç”¨æˆ·å¯æ­£å¸¸ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ï¼ˆä»ä¸Šä¼ åˆ°è¯Šæ–­åˆ°VLMç»™å‡ºç»“æœï¼‰

### 2.2 è´¨é‡ç›®æ ‡

- **è¯Šæ–­å‡†ç¡®ç‡**ï¼šâ‰¥65%ï¼ˆä½¿ç”¨æµ‹è¯•æ•°æ®é›†éªŒè¯ï¼‰
- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**ï¼šâ‰¥80%ï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰
- **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šå®Œæ•´è¯Šæ–­æµç¨‹é€šè¿‡
- **ä»£ç è´¨é‡**ï¼šé€šè¿‡Pylint/Flake8æ£€æŸ¥
- ğŸ†• **APIå“åº”æ—¶é—´**: < 5ç§’ï¼ˆå•æ¬¡VLMè°ƒç”¨ï¼‰
- ğŸ†• **å‰ç«¯ç•Œé¢å“åº”**: æµç•…ï¼Œæ— æ˜æ˜¾å¡é¡¿

### 2.3 è¾¹ç•Œè¯´æ˜

**æœ¬è®¡åˆ’èŒƒå›´å†…**ï¼š
- âœ… åç«¯è¯Šæ–­APIï¼ˆFastAPIï¼‰
- ğŸ”„ å®Œæ•´Webç•Œé¢ï¼ˆReact/Vueï¼Œ4ä¸ªç•Œé¢ï¼‰
- âœ… æœ¬åœ°PostgreSQL + Rediséƒ¨ç½²
- âœ… ç®€å•è´¦å·å¯†ç è®¤è¯ï¼ˆåå°ç™»å½•ï¼‰
- âœ… å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + E2Eæµ‹è¯•

**æœ¬è®¡åˆ’èŒƒå›´å¤–**ï¼š
- âŒ äº‘æœåŠ¡å™¨éƒ¨ç½²
- âŒ CI/CDæµæ°´çº¿
- âŒ å¤æ‚çš„API Keyè®¤è¯æœºåˆ¶
- âŒ ç”Ÿäº§çº§ç›‘æ§å‘Šè­¦

---

## 3. é˜¶æ®µåˆ’åˆ†æ€»è§ˆ ğŸ”„

| é˜¶æ®µ | åç§° | æ ¸å¿ƒäº§å‡º | é¢„ä¼°å·¥ä½œé‡ | v2.0å˜åŒ– | Gate |
|------|------|----------|-----------|---------|------|
| **P0** | ç¯å¢ƒå‡†å¤‡ä¸æ¶æ„è®¾è®¡ | å®Œæ•´ç›®å½•è“å›¾ + ç¯å¢ƒéªŒè¯ | 0.5å¤© | âœ… ä¿æŒä¸å˜ | G0 |
| **P1** | æ¥å£åè®®ä¸æ•°æ®åº“è®¾è®¡ | OpenAPIè§„èŒƒ + DDLè„šæœ¬ + Pydanticæ¨¡å‹ + çŸ¥è¯†åº“JSON | 1.5å¤© | âœ… ä¿æŒä¸å˜ | G1 |
| **P2** | æ ¸å¿ƒåŸºç¡€è®¾æ–½å¼€å‘ | VLMå®¢æˆ·ç«¯ + çŸ¥è¯†åº“åŠ è½½å™¨ + æç¤ºè¯æ¡†æ¶ + æœ¬åœ°å›¾ç‰‡å­˜å‚¨ | 3å¤© | âœ… ä¿æŒä¸å˜ | G2 |
| **P3** | è¯Šæ–­å¼•æ“æ ¸å¿ƒé€»è¾‘ | Q0-Q6é—®è¯Š + ä¸‰å±‚æ¸è¿›è¯Šæ–­ + çŸ¥è¯†åº“æœåŠ¡ + å›¾ç‰‡æœåŠ¡ | 3å¤© | âœ… ä¿æŒä¸å˜ | G3 |
| **P3.9** | P0-P3å·²å®ç°æ¨¡å—å°å¹…ä¿®æ”¹ | 3ä¸ªServiceå°å¹…ä¿®æ”¹ï¼ˆImageService+KnowledgeService+DiagnosisServiceï¼‰ | 0.6å¤© | âœ¨ æ–°å¢ï¼šP0-P3æ¨¡å—å°å¹…ä¿®æ”¹ | G3.9 |
| **P4** | å®Œæ•´åç«¯APIå¼€å‘ | FastAPIæœåŠ¡ + å®Œæ•´APIï¼ˆè¯Šæ–­+çŸ¥è¯†åº“+æœ¬ä½“+å›¾ç‰‡ï¼‰ | 2.5å¤© | ğŸ”„ æ‰©å±•APIèŒƒå›´ï¼Œå¢åŠ æ¥å£åè®®æ¢³ç† | G4 |
| **P5** | React/Vueå‰ç«¯å¼€å‘ | 4ä¸ªå®Œæ•´ç•Œé¢ï¼ˆå•å›¾/æ‰¹é‡è¯Šæ–­+æœ¬ä½“/çŸ¥è¯†ç®¡ç†ï¼‰ | 4.5å¤© | ğŸ”„ æ”¹ä¸ºReact/Vueï¼Œ4ä¸ªç•Œé¢ï¼Œå·¥æœŸå¢åŠ 0.5å¤© | G5 |
| **P6** | å‰åç«¯è”è°ƒ | APIå¯¹æ¥å®Œæˆ + ç«¯åˆ°ç«¯æµç¨‹éªŒè¯ | 1.5å¤© | âœ¨ æ–°å¢é˜¶æ®µ | G6 |
| **P7** | æµ‹è¯•å¼€å‘ä¸æ‰§è¡Œ | å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + E2Eæµ‹è¯• | 2.5å¤© | ğŸ”„ å¢åŠ å‰åç«¯æµ‹è¯• | G7 |
| **P8** | æœ¬åœ°éƒ¨ç½²ä¸éªŒæ”¶ | å®Œæ•´ç³»ç»Ÿè¿è¡Œ + éªŒæ”¶æŠ¥å‘Š | 1å¤© | ğŸ”„ æ›´æ–°éªŒæ”¶æ ‡å‡† | G8 |
| **æ€»è®¡** | - | - | **20.1å¤©** | ğŸ”„ æ€»å·¥æœŸä»16.5å¤©è°ƒæ•´åˆ°20.1å¤©ï¼ˆ+3.6å¤©ï¼‰ | - |

**v1.0 â†’ v2.0 ä¸»è¦å˜åŒ–**ï¼š
- âœ¨ **æ–°å¢P3.9é˜¶æ®µ**: P0-P3æ¨¡å—å°å¹…ä¿®æ”¹ï¼ˆ0.6å¤©ï¼‰ï¼Œä¿®æ”¹3ä¸ªå·²å®ç°Serviceä»¥æ”¯æŒæ–°åŠŸèƒ½
- ~~P5: ç®¡ç†åå°å¼€å‘ï¼ˆStreamlitï¼‰2å¤©~~ â†’ P5: React/Vueå‰ç«¯å¼€å‘ 4.5å¤©ï¼ˆå¢åŠ 2.5å¤©ï¼‰
- ~~P6: WebéªŒè¯ç•Œé¢å¼€å‘ï¼ˆNext.jsï¼‰1.5å¤©~~ â†’ P6: å‰åç«¯è”è°ƒ 1.5å¤©
- P4å·¥æœŸ: 1.25å¤© â†’ 2.5å¤©ï¼ˆå¢åŠ 1.25å¤©ï¼Œæ‰©å±•APIèŒƒå›´ï¼‰
- P7å·¥æœŸ: 2å¤© â†’ 2.5å¤©ï¼ˆå¢åŠ 0.5å¤©ï¼Œå¢åŠ å‰ç«¯æµ‹è¯•ï¼‰
- **æ€»å·¥æœŸ**: 16.5å¤© â†’ 20.1å¤©ï¼ˆ+3.6å¤©ï¼‰

---

## 4. å…³é”®é‡Œç¨‹ç¢‘ ğŸ”„

```mermaid
gantt
    title PhytoOracle MVP v1.1 å…³é”®é‡Œç¨‹ç¢‘ (v2.0)
    dateFormat  YYYY-MM-DD
    section åŸºç¡€è®¾æ–½
    P0 ç¯å¢ƒå‡†å¤‡           :p0, 2025-11-14, 0.5d
    P1 æ¥å£ä¸æ•°æ®åº“è®¾è®¡    :p1, after p0, 1.5d
    P2 æ ¸å¿ƒåŸºç¡€è®¾æ–½å¼€å‘    :p2, after p1, 3d
    section æ ¸å¿ƒåŠŸèƒ½
    P3 è¯Šæ–­å¼•æ“æ ¸å¿ƒé€»è¾‘    :p3, after p2, 3d
    P3.9 P0-P3æ¨¡å—å°å¹…ä¿®æ”¹ :p39, after p3, 0.6d
    P4 å®Œæ•´åç«¯APIå¼€å‘     :p4, after p39, 2.5d
    section å‰ç«¯å¼€å‘
    P5 React/Vueå‰ç«¯å¼€å‘   :p5, after p4, 4.5d
    P6 å‰åç«¯è”è°ƒ         :p6, after p5, 1.5d
    section æµ‹è¯•ä¸éªŒæ”¶
    P7 æµ‹è¯•å¼€å‘ä¸æ‰§è¡Œ      :p7, after p6, 2.5d
    P8 æœ¬åœ°éƒ¨ç½²ä¸éªŒæ”¶      :p8, after p7, 1d
```

**å…³é”®é‡Œç¨‹ç¢‘èŠ‚ç‚¹ï¼ˆv2.0ï¼‰**ï¼š

- **D+2ï¼ˆG1é€šè¿‡ï¼‰**ï¼šæ•°æ®åº“è¡¨åˆ›å»ºå®Œæˆï¼ŒAPIæ¥å£è§„èŒƒè¯„å®¡é€šè¿‡ï¼ŒçŸ¥è¯†åº“JSONè®¾è®¡å®Œæˆ
- **D+5ï¼ˆG2é€šè¿‡ï¼‰**ï¼šVLMè°ƒç”¨æˆåŠŸï¼ŒçŸ¥è¯†åº“åŠ è½½éªŒè¯é€šè¿‡
- **D+8ï¼ˆG3é€šè¿‡ï¼‰**ï¼šå®Œæ•´è¯Šæ–­å¼•æ“é€»è¾‘éªŒè¯é€šè¿‡ï¼ˆå•ç–¾ç—…æµ‹è¯•ï¼‰
- **D+8.6ï¼ˆG3.9é€šè¿‡ï¼‰**ï¼šâœ¨ P0-P3æ¨¡å—å°å¹…ä¿®æ”¹å®Œæˆï¼ˆImageService+KnowledgeService+DiagnosisServiceï¼‰
- **D+11.1ï¼ˆG4é€šè¿‡ï¼‰**ï¼šğŸ”„ å®Œæ•´åç«¯APIè¿è¡Œï¼Œæ‰€æœ‰æ¥å£åè®®å·²æ¢³ç†ï¼ŒPostmanæµ‹è¯•é€šè¿‡ï¼ˆ26ä¸ªæ¥å£ï¼‰
- **D+15.6ï¼ˆG5é€šè¿‡ï¼‰**ï¼šğŸ”„ 4ä¸ªå‰ç«¯ç•Œé¢å¼€å‘å®Œæˆï¼Œæ ·å¼ä¸åŸå‹ä¸€è‡´
- **D+17.1ï¼ˆG6é€šè¿‡ï¼‰**ï¼šâœ¨ å‰åç«¯å®Œå…¨è”é€šï¼Œç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•é€šè¿‡ï¼Œç¬¬16.5èŠ‚20+è”è°ƒæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- **D+19.6ï¼ˆG7é€šè¿‡ï¼‰**ï¼šæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼ˆå•å…ƒ+é›†æˆ+E2Eï¼‰ï¼Œç¬¬16.6èŠ‚4ä¸ªE2Eåœºæ™¯å…¨éƒ¨é€šè¿‡
- **D+20.6ï¼ˆG8é€šè¿‡ï¼‰**ï¼šéªŒæ”¶æµ‹è¯•é€šè¿‡ï¼ŒMVPäº¤ä»˜

---

## 5. è¯¦ç»†é˜¶æ®µè§„åˆ’

---

### P0: ç¯å¢ƒå‡†å¤‡ä¸æ¶æ„è®¾è®¡ âœ…

**âœ… ä¸v1.0ä¿æŒå®Œå…¨ä¸€è‡´ï¼Œå†…å®¹ä¸å˜**

**ç›®æ ‡**ï¼šæ­å»ºå¼€å‘ç¯å¢ƒï¼Œäº§å‡ºå®Œæ•´ç›®å½•è“å›¾ï¼ŒéªŒè¯æŠ€æœ¯æ ˆå¯ç”¨æ€§

**é¢„ä¼°æ—¶é—´**ï¼š0.5å¤©ï¼ˆ4å°æ—¶ï¼‰

---

#### P0.1 å¼€å‘ç¯å¢ƒæ­å»º

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®‰è£…Python 3.10+ï¼ˆéªŒè¯ç‰ˆæœ¬ï¼‰
2. å®‰è£…PostgreSQL 14+ï¼ˆæœ¬åœ°ï¼‰
3. å®‰è£…Redis 7+ï¼ˆæœ¬åœ°ï¼‰
4. å®‰è£…Node.js 18+ï¼ˆç”¨äºNext.jså‰ç«¯ï¼‰
5. åˆ›å»ºé¡¹ç›®æ ¹ç›®å½• `D:\é¡¹ç›®ç®¡ç†\PhytoOracle`

**äº§å‡ºç‰©**ï¼š
- `backend/.env.example`ï¼šç¯å¢ƒå˜é‡æ¨¡æ¿
- `backend/pyproject.toml`ï¼šPoetryä¾èµ–é…ç½®ï¼ˆåˆå§‹ç‰ˆæœ¬ï¼‰
- `frontend/package.json`ï¼šNode.jsä¾èµ–é…ç½®ï¼ˆåˆå§‹ç‰ˆæœ¬ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG0.1ï¼‰**ï¼š
- [x] Pythonç‰ˆæœ¬ â‰¥ 3.10
- [x] PostgreSQLæœåŠ¡è¿è¡ŒæˆåŠŸï¼ˆ`psql --version`ï¼‰
- [x] RedisæœåŠ¡è¿è¡ŒæˆåŠŸï¼ˆ`redis-cli ping` è¿”å› `PONG`ï¼‰
- [x] Node.jsç‰ˆæœ¬ â‰¥ 18

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šæ— 

---

#### P0.2 å®Œæ•´ç›®å½•è“å›¾æ„å»º

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬4ç« ï¼Œåˆ›å»ºå®Œæ•´ç›®å½•ç»“æ„
2. åˆ›å»ºæ‰€æœ‰ `__init__.py` æ–‡ä»¶ï¼ˆPythonåŒ…ç»“æ„ï¼‰
3. åˆ›å»ºå…³é”®é…ç½®æ–‡ä»¶æ¨¡æ¿

**äº§å‡ºç‰©**ï¼š
- **å®Œæ•´ç›®å½•æ ‘**ï¼ˆè§é™„å½•Aï¼‰
- `backend/core/config.py`ï¼ˆç©ºç™½æ¨¡æ¿ï¼ŒåŒ…å«Settingsç±»å®šä¹‰ï¼‰
- `backend/apps/api/main.py`ï¼ˆFastAPIåº”ç”¨éª¨æ¶ï¼‰
- `backend/apps/admin/app.py`ï¼ˆStreamlitåº”ç”¨éª¨æ¶ï¼‰
- `frontend/app/page.tsx`ï¼ˆNext.jsé¦–é¡µéª¨æ¶ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG0.2ï¼‰**ï¼š
- [x] ç›®å½•ç»“æ„ä¸è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬4ç« å®Œå…¨ä¸€è‡´
- [x] æ‰€æœ‰PythonåŒ…åŒ…å« `__init__.py`
- [x] `backend/` å’Œ `frontend/` ç»“æ„åˆ†ç¦»æ¸…æ™°
- [x] ç›®å½•æ ‘å¯é€šè¿‡ `tree` å‘½ä»¤è¾“å‡ºéªŒè¯

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP0.1å®Œæˆ

**äº§å‡ºç¤ºä¾‹**ï¼š
```
PhytoOracle/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ apps/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ main.py            # âœ“ åˆ›å»ºéª¨æ¶
â”‚   â”‚   â”‚   â”œâ”€â”€ deps.py            # âœ“ åˆ›å»ºç©ºæ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”‚   â”‚       â””â”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ app.py             # âœ“ åˆ›å»ºéª¨æ¶
â”‚   â”‚       â””â”€â”€ pages/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py              # âœ“ Settingsç±»æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ knowledge_base/
â”‚   â”‚   â”œâ”€â”€ diseases/
â”‚   â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”œâ”€â”€ plants/
â”‚   â”‚   â””â”€â”€ host_disease/
â”‚   â””â”€â”€ storage/
â”‚       â””â”€â”€ images/
â””â”€â”€ frontend/
    â”œâ”€â”€ app/
    â”‚   â”œâ”€â”€ layout.tsx
    â”‚   â””â”€â”€ page.tsx               # âœ“ åˆ›å»ºéª¨æ¶
    â”œâ”€â”€ components/
    â””â”€â”€ lib/
```

---

#### P0.3 æŠ€æœ¯æ ˆéªŒè¯

**ä»»åŠ¡æ¸…å•**ï¼š
1. åˆ›å»ºæœ€å°åŒ–FastAPI Hello Worldï¼ˆéªŒè¯FastAPIå¯è¿è¡Œï¼‰
2. åˆ›å»ºæœ€å°åŒ–Streamlit Hello Worldï¼ˆéªŒè¯Streamlitå¯è¿è¡Œï¼‰
3. åˆ›å»ºæœ€å°åŒ–Next.jsé¡µé¢ï¼ˆéªŒè¯Next.jså¯è¿è¡Œï¼‰
4. æµ‹è¯•PostgreSQLè¿æ¥ï¼ˆä½¿ç”¨asyncpgï¼‰
5. æµ‹è¯•Redisè¿æ¥ï¼ˆä½¿ç”¨redis-pyï¼‰
6. æµ‹è¯•Qwen VL Plus APIè°ƒç”¨ï¼ˆä½¿ç”¨llm_config.jsonä¸­çš„API Keyï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/tests/test_env_validation.py`ï¼šç¯å¢ƒéªŒè¯æµ‹è¯•è„šæœ¬
- `backend/scripts/test_qwen_api.py`ï¼šQwen VL APIæµ‹è¯•è„šæœ¬

**éªŒæ”¶æ ‡å‡†ï¼ˆG0.3ï¼‰**ï¼š
- [x] FastAPIæœåŠ¡å¯åŠ¨æˆåŠŸï¼ˆ`http://localhost:8000/docs` å¯è®¿é—®ï¼‰
- [x] Streamlitåº”ç”¨å¯åŠ¨æˆåŠŸï¼ˆ`http://localhost:8501` å¯è®¿é—®ï¼‰
- [x] Next.jså¼€å‘æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼ˆ`http://localhost:3000` å¯è®¿é—®ï¼‰
- [x] PostgreSQLè¿æ¥æˆåŠŸï¼ˆåˆ›å»ºæµ‹è¯•æ•°æ®åº“ `phytooracle_test`ï¼‰
- [x] Redisè¿æ¥æˆåŠŸï¼ˆ`SET test_key test_value` æˆåŠŸï¼‰
- [x] Qwen VL Plus APIè°ƒç”¨æˆåŠŸï¼ˆè¿”å›æœ‰æ•ˆå“åº”ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP0.1 + P0.2å®Œæˆ

---

**P0é˜¶æ®µGateï¼ˆG0ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G0.1ï¼šå¼€å‘ç¯å¢ƒéªŒè¯é€šè¿‡
- [x] G0.2ï¼šå®Œæ•´ç›®å½•è“å›¾åˆ›å»ºå®Œæˆ
- [x] G0.3ï¼šæŠ€æœ¯æ ˆéªŒè¯å…¨éƒ¨é€šè¿‡

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœPostgreSQL/Redisè¿æ¥å¤±è´¥ â†’ æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼Œé‡æ–°å®‰è£…
- å¦‚æœQwen APIè°ƒç”¨å¤±è´¥ â†’ æ£€æŸ¥API Keyæœ‰æ•ˆæ€§ï¼Œæ ‡è®°ä¸º **[å¾…å†³ç­–]**ï¼Œå‘ç”¨æˆ·æé—®

---

### P1: æ¥å£åè®®ä¸æ•°æ®åº“è®¾è®¡ âœ…

**âœ… ä¸v1.0ä¿æŒå®Œå…¨ä¸€è‡´ï¼Œå†…å®¹ä¸å˜**

**ç›®æ ‡**ï¼šå®ŒæˆAPIæ¥å£è®¾è®¡ã€æ•°æ®åº“è¡¨è®¾è®¡ã€æ•°æ®æ¨¡å‹è®¾è®¡ï¼Œäº§å‡ºå¯è¯„å®¡çš„è®¾è®¡æ–‡æ¡£

**é¢„ä¼°æ—¶é—´**ï¼š1.5å¤©ï¼ˆ12å°æ—¶ï¼‰

---

#### P1.1 APIæ¥å£è®¾è®¡ï¼ˆOpenAPIè§„èŒƒï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬6ç« ï¼Œç¼–å†™å®Œæ•´OpenAPI 3.0è§„èŒƒ
2. å®šä¹‰æ ¸å¿ƒæ¥å£ï¼š
   - `POST /api/v1/diagnose`ï¼šè¯Šæ–­æ¥å£
   - `GET /api/v1/diseases`ï¼šè·å–ç–¾ç—…åˆ—è¡¨
   - `POST /api/v1/admin/reload`ï¼šé‡è½½çŸ¥è¯†åº“
   - `POST /api/v1/auth/login`ï¼šåå°ç™»å½•
3. å®šä¹‰æ‰€æœ‰è¯·æ±‚/å“åº”Schema

**äº§å‡ºç‰©**ï¼š
- `docs/api/openapi.yaml`ï¼šå®Œæ•´OpenAPI 3.0è§„èŒƒæ–‡æ¡£
- `docs/api/æ¥å£åè®®è¯´æ˜.md`ï¼šæ¥å£ä½¿ç”¨è¯´æ˜ï¼ˆä¸­æ–‡ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG1.1ï¼‰**ï¼š
- [x] OpenAPIè§„èŒƒé€šè¿‡Swagger EditoréªŒè¯ï¼ˆæ— è¯­æ³•é”™è¯¯ï¼‰
- [x] æ‰€æœ‰æ ¸å¿ƒæ¥å£å®šä¹‰å®Œæ•´ï¼ˆè·¯å¾„ã€æ–¹æ³•ã€å‚æ•°ã€å“åº”ï¼‰
- [x] Schemaå®šä¹‰ç¬¦åˆè¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬7ç« æ•°æ®æ¨¡å‹
- [x] æ¥å£åè®®è¯„å®¡é€šè¿‡ï¼ˆæ¶æ„å¸ˆå®¡æ ¸ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP0å®Œæˆ

**è¯„å®¡æ£€æŸ¥ç‚¹**ï¼š
- è¯Šæ–­æ¥å£æ˜¯å¦æ”¯æŒ `multipart/form-data`ï¼Ÿ
- å“åº”Schemaæ˜¯å¦åŒ…å« `feature_vector`ã€`diagnosis_result`ã€`scores`ï¼Ÿ
- æ˜¯å¦å®šä¹‰äº†é”™è¯¯å“åº”æ ¼å¼ï¼ˆ400/401/500ï¼‰ï¼Ÿ

---

#### P1.2 æ•°æ®åº“è¡¨è®¾è®¡ï¼ˆDDLï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬9ç« ï¼Œç¼–å†™å®Œæ•´PostgreSQL DDLè„šæœ¬
2. åˆ›å»º5å¼ æ ¸å¿ƒè¡¨ï¼š
   - `diagnoses`ï¼šè¯Šæ–­è®°å½•
   - `images`ï¼šå›¾ç‰‡å…ƒæ•°æ®
   - `api_keys`ï¼šAPIå¯†é’¥ï¼ˆæš‚ä¸ä½¿ç”¨ï¼Œé¢„ç•™ï¼‰
   - `admin_users`ï¼šç®¡ç†å‘˜è´¦å·
   - `knowledge_versions`ï¼šçŸ¥è¯†åº“ç‰ˆæœ¬
3. è®¾è®¡ç´¢å¼•ï¼ˆtimestampã€plant_genusã€accuracy_labelç­‰ï¼‰
4. è®¾è®¡çº¦æŸï¼ˆCHECKçº¦æŸã€å¤–é”®çº¦æŸï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/scripts/init_db.sql`ï¼šå®Œæ•´DDLè„šæœ¬
- `backend/scripts/seed_data.sql`ï¼šåˆå§‹åŒ–æ•°æ®è„šæœ¬ï¼ˆç®¡ç†å‘˜è´¦å·ï¼‰
- `docs/design/æ•°æ®åº“è®¾è®¡è¯„å®¡.md`ï¼šæ•°æ®åº“è®¾è®¡è¯´æ˜ï¼ˆè¡¨ç»“æ„ã€ç´¢å¼•ç­–ç•¥ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG1.2ï¼‰**ï¼š
- [x] DDLè„šæœ¬åœ¨PostgreSQLä¸­æ‰§è¡ŒæˆåŠŸï¼ˆæ— é”™è¯¯ï¼‰
- [x] æ‰€æœ‰è¡¨åˆ›å»ºæˆåŠŸï¼ˆ`\dt` å‘½ä»¤å¯æŸ¥çœ‹ï¼‰
- [x] ç´¢å¼•åˆ›å»ºæˆåŠŸï¼ˆ`\di` å‘½ä»¤å¯æŸ¥çœ‹ï¼‰
- [x] åˆå§‹åŒ–æ•°æ®æ’å…¥æˆåŠŸï¼ˆè‡³å°‘1ä¸ªç®¡ç†å‘˜è´¦å·ï¼‰
- [x] æ•°æ®åº“è®¾è®¡è¯„å®¡é€šè¿‡ï¼ˆæ£€æŸ¥è¡¨ç»“æ„ã€ç´¢å¼•åˆç†æ€§ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP0å®Œæˆ

**è¯„å®¡æ£€æŸ¥ç‚¹**ï¼š
- `diagnoses` è¡¨æ˜¯å¦ä½¿ç”¨JSONBå­˜å‚¨ `feature_vector`ï¼Ÿ
- `images` è¡¨æ˜¯å¦æœ‰ `accuracy_label` å­—æ®µï¼ˆunlabeled/correct/incorrectï¼‰ï¼Ÿ
- `admin_users` è¡¨æ˜¯å¦å­˜å‚¨å¯†ç å“ˆå¸Œï¼ˆbcryptï¼‰ï¼Ÿ
- æ˜¯å¦åˆ›å»ºäº†åˆé€‚çš„ç´¢å¼•ï¼ˆé¿å…å…¨è¡¨æ‰«æï¼‰ï¼Ÿ

---

#### P1.3 æ•°æ®æ¨¡å‹è®¾è®¡ï¼ˆPydanticï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬7ç« ï¼Œç¼–å†™æ‰€æœ‰Pydantic V2æ•°æ®æ¨¡å‹
2. åˆ›å»ºé¢†åŸŸæ¨¡å‹ï¼ˆ`domain/`ï¼‰ï¼š
   - `DiagnosisAggregate`ï¼šè¯Šæ–­èšåˆæ ¹
   - `DiseaseOntology`ï¼šç–¾ç—…æœ¬ä½“
   - `FeatureVector`ï¼šç‰¹å¾å‘é‡
   - `PlantOntology`ï¼šæ¤ç‰©æœ¬ä½“
3. åˆ›å»ºAPI Schemaï¼ˆ`apps/api/schemas/`ï¼‰ï¼š
   - `DiagnosisRequest`/`DiagnosisResponse`
   - `DiseaseSchema`
   - `LoginRequest`/`LoginResponse`
4. ä½¿ç”¨Pydantic V2ç‰¹æ€§ï¼ˆFieldã€validatorã€model_validatorï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/domain/diagnosis.py`
- `backend/domain/disease.py`
- `backend/domain/feature.py`
- `backend/domain/plant.py`
- `backend/domain/value_objects.py`
- `backend/apps/api/schemas/diagnosis.py`
- `backend/apps/api/schemas/auth.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG1.3ï¼‰**ï¼š
- [x] æ‰€æœ‰Pydanticæ¨¡å‹å¯æˆåŠŸå¯¼å…¥ï¼ˆæ— è¯­æ³•é”™è¯¯ï¼‰
- [x] ä½¿ç”¨ `pydantic.BaseModel` V2è¯­æ³•
- [x] å¿…å¡«å­—æ®µä½¿ç”¨ `Field(..., description="...")` å®šä¹‰
- [x] å¯é€‰å­—æ®µä½¿ç”¨ `Optional[T] = None` æˆ– `T | None = None`
- [x] æ¨¡å‹é€šè¿‡å•å…ƒæµ‹è¯•éªŒè¯ï¼ˆåˆ›å»ºç¤ºä¾‹å®ä¾‹ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.1å®Œæˆï¼ˆAPI Schemaéœ€å‚è€ƒOpenAPIå®šä¹‰ï¼‰

**ä»£ç ç¤ºä¾‹**ï¼š
```python
# backend/domain/diagnosis.py
from pydantic import BaseModel, Field
from typing import Optional
from uuid import UUID

class DiagnosisResult(BaseModel):
    """è¯Šæ–­ç»“æœé¢†åŸŸæ¨¡å‹"""
    diagnosis_id: UUID
    status: str = Field(..., description="è¯Šæ–­çŠ¶æ€ï¼šconfirmed/suspected/uncertain/rejected")
    confirmed_disease: Optional[str] = Field(None, description="ç¡®è¯Šç–¾ç—…ID")
    suspected_diseases: Optional[list[str]] = Field(None, description="ç–‘ä¼¼ç–¾ç—…IDåˆ—è¡¨")
    confidence: float = Field(..., ge=0.0, le=1.0, description="ç½®ä¿¡åº¦")
    reasoning: Optional[str] = Field(None, description="è¯Šæ–­æ¨ç†è¿‡ç¨‹")
```

---

#### P1.4 çŸ¥è¯†åº“è®¾è®¡ï¼ˆJSON Schemaï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®P1.3çš„Pydanticæ¨¡å‹ï¼ˆ`DiseaseOntology`/`PlantOntology`/`FeatureOntology`ï¼‰ï¼Œè®¾è®¡å¯¹åº”çš„JSON Schema
2. è®¾è®¡ç–¾ç—…æœ¬ä½“JSONç»“æ„ï¼š
   - ç–¾ç—…å…ƒä¿¡æ¯ï¼ˆdisease_idã€disease_nameã€pathogenç­‰ï¼‰
   - ç‰¹å¾å‘é‡ï¼ˆfeature_vectorï¼‰
   - ç‰¹å¾é‡è¦æ€§ï¼ˆfeature_importanceï¼šmajor/minor/optionalï¼‰
   - è¯Šæ–­è§„åˆ™ï¼ˆdiagnosis_rulesï¼šconfirmed_rules/suspected_rulesï¼‰
   - è§†è§‰æè¿°ï¼ˆvisual_descriptionsï¼Œç”¨äºVLMè¯†åˆ«ï¼‰
3. è®¾è®¡æ¤ç‰©æœ¬ä½“JSONç»“æ„ï¼ˆv1.2+é¢„ç•™ï¼‰ï¼š
   - æ—å¥ˆåˆ†ç±»å­¦ï¼ˆkingdom/family/genus/speciesï¼‰
   - å™¨å®˜è§£å‰–ï¼ˆorgan_anatomyï¼‰
   - VLMè¯†åˆ«çº¿ç´¢ï¼ˆvisual_cuesï¼‰
   - æ˜“æ„Ÿç–¾ç—…åˆ—è¡¨ï¼ˆsusceptible_diseasesï¼‰
4. è®¾è®¡ç‰¹å¾æœ¬ä½“JSONç»“æ„ï¼š
   - ç‰¹å¾ç»´åº¦å®šä¹‰ï¼ˆdimensionsï¼‰
   - æ¨¡ç³ŠåŒ¹é…è§„åˆ™ï¼ˆfuzzy_matchingï¼‰
   - ç—‡çŠ¶ç±»å‹/é¢œè‰²/å°ºå¯¸/åˆ†å¸ƒæ¨¡å¼æšä¸¾å€¼
5. è®¾è®¡å®¿ä¸»-ç–¾ç—…å…³ç³»JSONç»“æ„ï¼š
   - èŠ±å‰å±ï¼ˆgenusï¼‰â†’ ç–¾ç—…åˆ—è¡¨ï¼ˆdiseasesï¼‰æ˜ å°„
6. åˆ›å»ºåˆå§‹çŸ¥è¯†åº“JSONæ–‡ä»¶ï¼ˆå¤åˆ¶FlowerSpecialist v4.1æ•°æ®ï¼‰ï¼š
   - ç«ç‘°é»‘æ–‘ç—…ï¼ˆ`rose_black_spot.json`ï¼‰
   - æ¨±èŠ±ç™½ç²‰ç—…ï¼ˆ`cherry_powdery_mildew.json`ï¼‰
   - ç‰¹å¾æœ¬ä½“ï¼ˆ`feature_ontology.json`ï¼‰
   - å®¿ä¸»-ç–¾ç—…å…³ç³»ï¼ˆ`host_disease_associations.json`ï¼‰

**äº§å‡ºç‰©**ï¼š
- `docs/knowledge_base/disease_schema.json`ï¼šç–¾ç—…æœ¬ä½“JSON Schema
- `docs/knowledge_base/plant_schema.json`ï¼šæ¤ç‰©æœ¬ä½“JSON Schema
- `docs/knowledge_base/feature_schema.json`ï¼šç‰¹å¾æœ¬ä½“JSON Schema
- `docs/knowledge_base/çŸ¥è¯†åº“è®¾è®¡è¯´æ˜.md`ï¼šçŸ¥è¯†åº“ç»“æ„è¯´æ˜æ–‡æ¡£
- `backend/knowledge_base/diseases/rose_black_spot.json`ï¼šç«ç‘°é»‘æ–‘ç—…JSON
- `backend/knowledge_base/diseases/cherry_powdery_mildew.json`ï¼šæ¨±èŠ±ç™½ç²‰ç—…JSON
- `backend/knowledge_base/features/feature_ontology.json`ï¼šç‰¹å¾æœ¬ä½“JSON
- `backend/knowledge_base/host_disease/associations.json`ï¼šå®¿ä¸»-ç–¾ç—…å…³ç³»JSON

**éªŒæ”¶æ ‡å‡†ï¼ˆG1.4ï¼‰**ï¼š
- [x] æ‰€æœ‰JSON Schemaç¬¦åˆJSON Schema Draft 7è§„èŒƒ
- [x] ç–¾ç—…JSONæ–‡ä»¶é€šè¿‡SchemaéªŒè¯ï¼ˆä½¿ç”¨jsonschemaåº“ï¼‰
- [x] ç–¾ç—…JSONå¯è¢«Pydantic `DiseaseOntology` æ¨¡å‹æ­£ç¡®è§£æï¼ˆæ— ValidationErrorï¼‰
- [x] ç‰¹å¾æœ¬ä½“JSONå¯è¢«Pydantic `FeatureOntology` æ¨¡å‹æ­£ç¡®è§£æ
- [x] è‡³å°‘åˆ›å»º2ç§ç–¾ç—…JSONï¼ˆRose Black Spot + Cherry Powdery Mildewï¼‰
- [x] çŸ¥è¯†åº“è®¾è®¡è¯´æ˜æ–‡æ¡£å®Œæˆï¼ˆåŒ…å«å­—æ®µè¯´æ˜ã€æ‰©å±•æŒ‡å—ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.3å®Œæˆï¼ˆéœ€è¦Pydanticæ¨¡å‹å®šä¹‰ï¼‰

**ç–¾ç—…æœ¬ä½“JSONç¤ºä¾‹**ï¼ˆå®Œæ•´ç»“æ„è¯·å‚è€ƒv1.0æ–‡æ¡£ï¼‰ï¼š
```json
{
  "version": "4.1",
  "disease_id": "rose_black_spot",
  "disease_name": "ç«ç‘°é»‘æ–‘ç—…",
  "feature_vector": {
    "symptom_type": "necrosis_spot",
    "color_center": "black",
    "color_border": "yellow"
  },
  "feature_importance": {
    "major_features": { "_weight": 0.8, "features": [...] },
    "minor_features": { "_weight": 0.15, "features": [...] },
    "optional_features": { "_weight": 0.05, "features": [...] }
  },
  "visual_descriptions": {
    "color_border": "åƒç…è›‹çš„è›‹ç™½éƒ¨åˆ†ç¯ç»•ç€è›‹é»„ï¼ˆé»„è‰²æ™•åœˆï¼‰"
  }
}
```

**è®¾è®¡åŸåˆ™**ï¼š
1. **ç±»å‹å®‰å…¨**ï¼šJSONç»“æ„ä¸¥æ ¼å¯¹åº”Pydanticæ¨¡å‹ï¼Œç¡®ä¿å¯ä»¥æ— æŸè§£æ
2. **å¯æ‰©å±•æ€§**ï¼šä½¿ç”¨`additional_features`/`environmental_conditions`ç­‰å­—æ®µæ”¯æŒåŠ¨æ€æ‰©å±•
3. **äººç±»å¯è¯»**ï¼šåŒ…å«å®Œæ•´çš„ä¸­æ–‡æè¿°ã€å­—æ®µè¯´æ˜ã€æ³¨é‡Š
4. **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ¯ä¸ªJSONæ–‡ä»¶åŒ…å«`version`å­—æ®µï¼Œæ”¯æŒçŸ¥è¯†åº“ç‰ˆæœ¬ç®¡ç†
5. **éªŒè¯å‹å¥½**ï¼šæ‰€æœ‰æšä¸¾å€¼ä¸`domain/diagnosis.py`ä¸­çš„æšä¸¾ç±»ä¸€è‡´

**çŸ¥è¯†åº“æ‰©å±•æµç¨‹**ï¼ˆå‚è€ƒéœ€æ±‚æ–‡æ¡£v1.3ï¼‰ï¼š
1. **æ–°èŠ±å‰æ·»åŠ **ï¼šåˆ›å»º`PlantOntology` JSONï¼ˆv1.2+ï¼‰
2. **æ–°ç–¾ç—…æ·»åŠ **ï¼šåˆ›å»º`DiseaseOntology` JSON â†’ æ›´æ–°`host_disease/associations.json` â†’ æµ‹è¯•éªŒè¯ â†’ æäº¤Git
3. **ç‰¹å¾ç»´åº¦æ‰©å±•**ï¼šä¿®æ”¹`feature_ontology.json` â†’ æ›´æ–°Pydanticæšä¸¾ â†’ æ›´æ–°æç¤ºè¯æ¨¡æ¿

---

**P1é˜¶æ®µGateï¼ˆG1ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G1.1ï¼šOpenAPIè§„èŒƒè¯„å®¡é€šè¿‡
- [x] G1.2ï¼šæ•°æ®åº“DDLæ‰§è¡ŒæˆåŠŸï¼Œåˆå§‹åŒ–æ•°æ®æ’å…¥æˆåŠŸ
- [x] G1.3ï¼šPydanticæ¨¡å‹åˆ›å»ºå®Œæˆï¼Œå•å…ƒæµ‹è¯•é€šè¿‡
- [x] G1.4ï¼šçŸ¥è¯†åº“JSON Schemaè®¾è®¡å®Œæˆï¼Œåˆå§‹ç–¾ç—…JSONåˆ›å»ºå¹¶é€šè¿‡éªŒè¯

äº§å‡ºç‰©æ¸…å•ï¼š
- [x] `docs/api/openapi.yaml`
- [x] `backend/scripts/init_db.sql`
- [x] `backend/scripts/seed_data.sql`
- [x] `backend/domain/` ä¸‹æ‰€æœ‰æ¨¡å‹æ–‡ä»¶
- [x] `backend/apps/api/schemas/` ä¸‹æ‰€æœ‰Schemaæ–‡ä»¶
- [x] `docs/knowledge_base/` ä¸‹æ‰€æœ‰JSON Schemaæ–‡ä»¶
- [x] `backend/knowledge_base/` ä¸‹åˆå§‹ç–¾ç—…JSONæ–‡ä»¶ï¼ˆè‡³å°‘2ç§ï¼‰

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœOpenAPIè§„èŒƒè¯„å®¡ä¸é€šè¿‡ â†’ ä¿®æ­£åé‡æ–°è¯„å®¡
- å¦‚æœDDLæ‰§è¡Œå¤±è´¥ â†’ æ£€æŸ¥SQLè¯­æ³•ï¼Œä¿®æ­£åé‡è¯•
- å¦‚æœå‘ç°æ•°æ®æ¨¡å‹é—æ¼ â†’ æ ‡è®°ä¸º **[å¾…å†³ç­–]**ï¼Œå‘ç”¨æˆ·æé—®
- å¦‚æœJSON SchemaéªŒè¯å¤±è´¥ â†’ æ£€æŸ¥JSONæ ¼å¼ï¼Œä¿®æ­£åé‡è¯•
- å¦‚æœPydanticè§£æå¤±è´¥ â†’ æ£€æŸ¥JSONå­—æ®µä¸æ¨¡å‹å®šä¹‰ä¸€è‡´æ€§

---

### P2: æ ¸å¿ƒåŸºç¡€è®¾æ–½å¼€å‘ âœ…

**âœ… ä¸v1.0ä¿æŒå®Œå…¨ä¸€è‡´ï¼Œå†…å®¹ä¸å˜**


**ç›®æ ‡**ï¼šå®ç°VLMå®¢æˆ·ç«¯ã€çŸ¥è¯†åº“åŠ è½½å™¨ã€æç¤ºè¯æ¡†æ¶ã€æ¨¡ç³ŠåŒ¹é…å¼•æ“ã€åŠ æƒè¯Šæ–­è¯„åˆ†å™¨ã€æœ¬åœ°å›¾ç‰‡å­˜å‚¨

**é¢„ä¼°æ—¶é—´**ï¼š3å¤©ï¼ˆ24å°æ—¶ï¼‰

---

#### P2.1 æç¤ºè¯æ¡†æ¶ï¼ˆPROOF Framework + Instructorï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®è¯¦ç»†è®¾è®¡æ–‡æ¡£5.6èŠ‚ï¼Œå®ç°PROOF Framework
2. å®ç°Instructoré›†æˆï¼ˆåŒ…è£…Qwen VL Plus APIï¼‰
3. å®šä¹‰æ‰€æœ‰VLMå“åº”Schemaï¼ˆQ00Response ~ Q05Response + FeatureResponseï¼‰
4. ç¼–å†™Q0-Q6æç¤ºè¯æ¨¡æ¿

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/llm/prompts/framework.py`ï¼šPROOF FrameworkåŸºç±»
- `backend/infrastructure/llm/prompts/response_schema.py`ï¼šVLMå“åº”Schema
- `backend/infrastructure/llm/prompts/q0_0_content.py`ï¼šQ0.0æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q0_1_category.py`ï¼šQ0.1æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q0_2_genus.py`ï¼šQ0.2æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q0_3_organ.py`ï¼šQ0.3æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q0_4_completeness.py`ï¼šQ0.4æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q0_5_abnormality.py`ï¼šQ0.5æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q1_q6_features.py`ï¼šQ1-Q6åŠ¨æ€ç‰¹å¾æå–æ¨¡æ¿

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.1ï¼‰**ï¼š
- [ ] PROOF Frameworkç±»å¯æˆåŠŸå®ä¾‹åŒ–
- [ ] `PROOFPrompt.render()` æ–¹æ³•å¯ç”Ÿæˆå®Œæ•´æç¤ºè¯å­—ç¬¦ä¸²
- [ ] æ‰€æœ‰VLMå“åº”Schemaä½¿ç”¨ `Literal` ç±»å‹ä¸¥æ ¼é™åˆ¶é€‰é¡¹
- [ ] Q0.2æç¤ºè¯åŒ…å«5ç§èŠ±å‰çš„visual_cuesï¼ˆè¯¦ç»†è®¾è®¡æ–‡æ¡£5.6.3ç¤ºä¾‹ï¼‰
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆæµ‹è¯•æç¤ºè¯æ¸²æŸ“è¾“å‡ºï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.3å®Œæˆï¼ˆéœ€è¦Pydanticæ¨¡å‹ï¼‰

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_proof_framework.py
def test_q0_2_genus_prompt_render():
    """æµ‹è¯•Q0.2æç¤ºè¯æ¸²æŸ“"""
    from infrastructure.llm.prompts.q0_2_genus import q0_2_prompt

    rendered = q0_2_prompt.render()

    # éªŒè¯åŒ…å«å…³é”®å­—æ®µ
    assert "ROLE: plant disease diagnosis assistant" in rendered
    assert "TASK: Identify the genus" in rendered
    assert "Rosa" in rendered
    assert "Prunus" in rendered
    assert "RESPONSE FORMAT (JSON only)" in rendered
```

---

#### P2.2 VLMå®¢æˆ·ç«¯ï¼ˆFallbackæœºåˆ¶ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°VLM ProvideræŠ½è±¡æ¥å£ï¼ˆ`VLMProtocol`ï¼‰
2. å®ç°Qwen VL Plus Providerï¼ˆè¯»å– `llm_config.json`ï¼‰
3. å®ç°Instructoré›†æˆï¼ˆè‡ªåŠ¨éªŒè¯ + é‡è¯•ï¼‰
4. å®ç°Fallbackæœºåˆ¶ï¼ˆQwen â†’ ChatGPT â†’ Grok â†’ Claudeï¼Œå½“å‰ä»…Qwenå¯ç”¨ï¼‰
5. å®ç°ç¼“å­˜æœºåˆ¶ï¼ˆRedisï¼Œkey = `vlm:{image_hash}:{question_id}`ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/llm/base.py`ï¼šVLMProtocolæŠ½è±¡æ¥å£
- `backend/infrastructure/llm/client.py`ï¼šVLMClientä¸»ç±»
- `backend/infrastructure/llm/providers/qwen.py`ï¼šQwenVLPlusProvider
- `backend/infrastructure/llm/providers/chatgpt.py`ï¼šChatGPTProviderï¼ˆå ä½ï¼Œæ ‡è®°TODOï¼‰
- `backend/core/cache.py`ï¼šRedisCacheå°è£…ç±»

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.2ï¼‰**ï¼š
- [ ] VLMClientå¯æˆåŠŸåˆå§‹åŒ–ï¼ˆåŠ è½½Qwen API Keyï¼‰
- [ ] è°ƒç”¨ `VLMClient.call_with_fallback()` æˆåŠŸï¼ˆä½¿ç”¨æµ‹è¯•å›¾ç‰‡ï¼‰
- [ ] è¿”å›çš„å“åº”ç¬¦åˆPydantic Schemaï¼ˆå¦‚ `Q00Response`ï¼‰
- [ ] ç¼“å­˜æœºåˆ¶ç”Ÿæ•ˆï¼ˆç¬¬äºŒæ¬¡è°ƒç”¨åŒä¸€å›¾ç‰‡æ—¶ä»Redisè¯»å–ï¼‰
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆæµ‹è¯•å®Œæ•´VLMè°ƒç”¨æµç¨‹ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.1å®Œæˆï¼ˆéœ€è¦å“åº”Schemaï¼‰

**é›†æˆæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/integration/test_vlm_client.py
async def test_vlm_client_q0_0_call():
    """æµ‹è¯•VLMå®¢æˆ·ç«¯Q0.0è°ƒç”¨"""
    from infrastructure.llm.client import VLMClient
    from infrastructure.llm.prompts.q0_0_content import Q0_0_PROMPT
    from infrastructure.llm.prompts.response_schema import Q00Response

    client = VLMClient()

    # åŠ è½½æµ‹è¯•å›¾ç‰‡
    with open("tests/fixtures/rose_black_spot.jpg", "rb") as f:
        image_bytes = f.read()

    # è°ƒç”¨VLM
    response = await client.call_with_fallback(
        prompt=Q0_0_PROMPT,
        image=image_bytes,
        response_model=Q00Response,
        question_id="Q0.0"
    )

    # éªŒè¯å“åº”
    assert response.choice in ["plant", "animal", "person", "object", "landscape", "other"]
    assert 0.0 <= response.confidence <= 1.0
```

---

#### P2.3 çŸ¥è¯†åº“åŠ è½½å™¨

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°JSONçŸ¥è¯†åº“åŠ è½½å™¨ï¼ˆ`JSONKnowledgeLoader`ï¼‰
2. åŠ è½½ç–¾ç—…æœ¬ä½“ï¼ˆ`knowledge_base/diseases/*.json`ï¼‰
3. åŠ è½½ç‰¹å¾æœ¬ä½“ï¼ˆ`knowledge_base/features/feature_ontology.json`ï¼‰
4. åŠ è½½æ¤ç‰©æœ¬ä½“ï¼ˆ`knowledge_base/plants/*.json`ï¼Œv1.2+é¢„ç•™ï¼‰
5. åŠ è½½å®¿ä¸»-ç–¾ç—…å…³ç³»ï¼ˆ`knowledge_base/host_disease/associations.json`ï¼‰
6. è§£æJSON â†’ Pydanticç±»ï¼ˆç±»å‹å®‰å…¨ï¼‰
7. æ”¯æŒçƒ­æ›´æ–°ï¼ˆç®¡ç†åå°è°ƒç”¨ `reload()` æ–¹æ³•ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/ontology/loader.py`ï¼šJSONKnowledgeLoader
- `backend/knowledge_base/diseases/rose_black_spot.json`ï¼šç«ç‘°é»‘æ–‘ç—…JSONï¼ˆå¤åˆ¶FlowerSpecialistæ•°æ®ï¼‰
- `backend/knowledge_base/diseases/cherry_powdery_mildew.json`ï¼šæ¨±èŠ±ç™½ç²‰ç—…JSON
- `backend/knowledge_base/features/feature_ontology.json`ï¼šç‰¹å¾æœ¬ä½“JSON
- `backend/knowledge_base/host_disease/associations.json`ï¼šå®¿ä¸»-ç–¾ç—…å…³ç³»JSON

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.3ï¼‰**ï¼š
- [ ] çŸ¥è¯†åº“åŠ è½½æˆåŠŸï¼ˆè‡³å°‘2ç§ç–¾ç—…ï¼šRose Black Spot + Cherry Powdery Mildewï¼‰
- [ ] JSONè§£æä¸ºPydanticå¯¹è±¡ï¼ˆ`DiseaseOntology`ï¼‰
- [ ] å¯é€šè¿‡ `knowledge_base.get_disease_by_id("rose_black_spot")` æŸ¥è¯¢
- [ ] çƒ­æ›´æ–°æœºåˆ¶éªŒè¯ï¼ˆä¿®æ”¹JSONæ–‡ä»¶åè°ƒç”¨ `reload()` ç”Ÿæ•ˆï¼‰
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆæµ‹è¯•åŠ è½½ã€æŸ¥è¯¢ã€é‡è½½ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.3å®Œæˆï¼ˆéœ€è¦ `DiseaseOntology` æ¨¡å‹ï¼‰

**çŸ¥è¯†åº“JSONç¤ºä¾‹**ï¼š
```json
{
  "version": "4.1",
  "disease_id": "rose_black_spot",
  "disease_name": "ç«ç‘°é»‘æ–‘ç—…",
  "common_name_en": "Rose Black Spot",
  "pathogen": "Diplocarpon rosae",
  "feature_vector": {
    "symptom_type": "necrosis_spot",
    "color_center": "black",
    "color_border": "yellow",
    "location": "lamina",
    "size": "medium",
    "distribution": "scattered"
  },
  "feature_importance": {
    "major_features": {
      "_weight": 0.8,
      "features": [
        {
          "dimension": "symptom_type",
          "expected_values": ["necrosis_spot"],
          "weight": 0.5
        },
        {
          "dimension": "color_center",
          "expected_values": ["black", "dark_brown"],
          "weight": 0.3
        }
      ]
    }
  },
  "visual_descriptions": {
    "color_border": "åƒç…è›‹çš„è›‹ç™½éƒ¨åˆ†ç¯ç»•ç€è›‹é»„ï¼ˆé»„è‰²æ™•åœˆï¼‰"
  }
}
```

---

#### P2.4 æ¨¡ç³ŠåŒ¹é…å¼•æ“

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°é¢œè‰²æ¨¡ç³ŠåŒ¹é…ï¼ˆ`COLOR_GROUPS`ï¼‰
2. å®ç°å°ºå¯¸æ¨¡ç³ŠåŒ¹é…ï¼ˆ`SIZE_ORDER`ï¼Œå…è®¸Â±1çº§åˆ«è¯¯å·®ï¼‰
3. å®ç°ä½ç½®æ¨¡ç³ŠåŒ¹é…ï¼ˆå¦‚ `lamina` åŒ¹é… `["lamina", "petiole"]`ï¼‰
4. å°è£…ä¸º `FuzzyMatcher` ç±»

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/ontology/matcher.py`ï¼šFuzzyMatcherç±»

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.4ï¼‰**ï¼š
- [ ] é¢œè‰²æ¨¡ç³ŠåŒ¹é…æµ‹è¯•é€šè¿‡ï¼ˆå¦‚ `black` åŒ¹é… `dark_brown`ï¼‰
- [ ] å°ºå¯¸æ¨¡ç³ŠåŒ¹é…æµ‹è¯•é€šè¿‡ï¼ˆå¦‚ `medium` åŒ¹é… `medium_small`ï¼‰
- [ ] ä½ç½®æ¨¡ç³ŠåŒ¹é…æµ‹è¯•é€šè¿‡
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.3å®Œæˆï¼ˆéœ€è¦çŸ¥è¯†åº“æ•°æ®ï¼‰

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_matcher.py
def test_color_fuzzy_match():
    """æµ‹è¯•é¢œè‰²æ¨¡ç³ŠåŒ¹é…"""
    from infrastructure.ontology.matcher import FuzzyMatcher

    matcher = FuzzyMatcher()

    # åŒè‰²ç³»åŒ¹é…
    assert matcher.match_color("black", "dark_brown") == True
    assert matcher.match_color("yellow", "light_yellow") == True

    # ä¸åŒè‰²ç³»ä¸åŒ¹é…
    assert matcher.match_color("black", "yellow") == False

def test_size_fuzzy_match():
    """æµ‹è¯•å°ºå¯¸æ¨¡ç³ŠåŒ¹é…"""
    from infrastructure.ontology.matcher import FuzzyMatcher

    matcher = FuzzyMatcher()

    # Â±1çº§åˆ«åŒ¹é…
    assert matcher.match_size("medium", "medium_small") == True
    assert matcher.match_size("medium", "small") == False  # ç›¸å·®2çº§
```

---

#### P2.5 åŠ æƒè¯Šæ–­è¯„åˆ†å™¨

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°åŠ æƒè¯Šæ–­è¯„åˆ†ç®—æ³•ï¼ˆè¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬5.4èŠ‚ï¼‰
2. ä¸»è¦ç‰¹å¾æƒé‡0.8ï¼ˆsymptom_type: 0.5 + color_center: 0.3ï¼‰
3. æ¬¡è¦ç‰¹å¾æƒé‡0.15ï¼ˆlocation: 0.1 + additional_features: 0.05ï¼‰
4. å¯é€‰ç‰¹å¾æƒé‡0.05ï¼ˆsize: 0.03 + distribution: 0.02ï¼‰
5. å®Œæ•´æ€§ä¿®æ­£ç³»æ•°ï¼ˆcomplete: 1.0, partial: 0.8, close_up: 0.6ï¼‰
6. è¯Šæ–­è§„åˆ™ï¼ˆconfirmed: â‰¥0.85ä¸”ä¸»è¦ç‰¹å¾â‰¥2/2, suspected: 0.6-0.85ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/ontology/scorer.py`ï¼šDiagnosisScorerç±»

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.5ï¼‰**ï¼š
- [ ] è¯„åˆ†ç®—æ³•ä¸FlowerSpecialist v11å®éªŒç»“æœä¸€è‡´
- [ ] ä¸»è¦ç‰¹å¾å®Œå…¨åŒ¹é…æ—¶ï¼Œtotal_score â‰¥ 0.8
- [ ] è¯Šæ–­è§„åˆ™æ­£ç¡®ï¼ˆconfirmed/suspected/unlikelyï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 95%

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.3 + P2.4å®Œæˆ

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_scorer.py
def test_weighted_scoring():
    """æµ‹è¯•åŠ æƒè¯„åˆ†ç®—æ³•"""
    from infrastructure.ontology.scorer import DiagnosisScorer
    from domain.feature import FeatureVector
    from domain.disease import DiseaseOntology

    scorer = DiagnosisScorer()

    # æ„å»ºç‰¹å¾å‘é‡ï¼ˆå®Œå…¨åŒ¹é…ï¼‰
    feature_vector = FeatureVector(
        symptom_type="necrosis_spot",
        color_center="black",
        color_border="yellow",
        location="lamina"
    )

    # åŠ è½½ç–¾ç—…
    disease = load_disease("rose_black_spot")

    # è®¡ç®—è¯„åˆ†
    score = scorer.calculate_score(feature_vector, disease)

    # éªŒè¯
    assert score.total_score >= 0.85  # åº”ä¸ºconfirmed
    assert score.major_matched == 2   # ä¸»è¦ç‰¹å¾å…¨åŒ¹é…
    assert score.diagnosis_level == "confirmed"
```

---

#### P2.6 æœ¬åœ°å›¾ç‰‡å­˜å‚¨ï¼ˆLocalImageStorageï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå›¾ç‰‡å­˜å‚¨ï¼ˆ`LocalImageStorage`ç±»ï¼‰
2. æŒ‰å‡†ç¡®ç‡+èŠ±å‰å+æ—¥æœŸåˆ†ç±»å­˜å‚¨è§„åˆ™ï¼š
   - è·¯å¾„è§„èŒƒï¼š`storage/images/{accuracy_label}/{genus}/{year-month}/{day}/{diagnosis_id}.jpg`
   - accuracy_label: unlabeled / correct / incorrect
3. å®ç°æ–‡ä»¶è·¯å¾„ç”Ÿæˆè§„èŒƒåŒ–ï¼ˆ`get_path`æ–¹æ³•ï¼‰
4. å®ç°æ–‡ä»¶ç§»åŠ¨åŠŸèƒ½ï¼ˆ`move`æ–¹æ³•ï¼Œç”¨äºå‡†ç¡®æ€§æ ‡æ³¨æ—¶ç§»åŠ¨æ–‡ä»¶ï¼‰
5. å®ç°å›¾ç‰‡ä¿å­˜åŠŸèƒ½ï¼ˆ`save`æ–¹æ³•ï¼Œå¼‚æ­¥ä¿å­˜å›¾ç‰‡ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/storage/local_storage.py`ï¼šLocalImageStorageç±»
- `backend/infrastructure/storage/__init__.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.6ï¼‰**ï¼š
- [ ] LocalImageStorageç±»å¯æˆåŠŸå®ä¾‹åŒ–
- [ ] `save()` æ–¹æ³•æµ‹è¯•é€šè¿‡ï¼ˆç”Ÿæˆæ­£ç¡®çš„æ–‡ä»¶è·¯å¾„ï¼Œä¿å­˜å›¾ç‰‡æˆåŠŸï¼‰
- [ ] `move()` æ–¹æ³•æµ‹è¯•é€šè¿‡ï¼ˆç§»åŠ¨æ–‡ä»¶åˆ°correct/incorrectæ–‡ä»¶å¤¹ï¼‰
- [ ] `get_path()` æ–¹æ³•æµ‹è¯•é€šè¿‡ï¼ˆè·¯å¾„ç”Ÿæˆè§„èŒƒæ­£ç¡®ï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šæ— ï¼ˆLayer 1æ¨¡å—ï¼Œæ— ä¾èµ–ï¼‰

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_local_storage.py
import pytest
from infrastructure.storage.local_storage import LocalImageStorage
from pathlib import Path

@pytest.mark.asyncio
async def test_save_image():
    """æµ‹è¯•å›¾ç‰‡ä¿å­˜"""
    storage = LocalImageStorage(base_path="tests/storage_test")

    # æ¨¡æ‹Ÿå›¾ç‰‡æ•°æ®
    image_bytes = b"fake_image_data"
    diagnosis_id = "diag_20251111_001"
    plant_genus = "rosa"

    # ä¿å­˜å›¾ç‰‡
    saved_path = await storage.save(
        image_bytes=image_bytes,
        diagnosis_id=diagnosis_id,
        plant_genus=plant_genus,
        accuracy_label="unlabeled"
    )

    # éªŒè¯è·¯å¾„æ ¼å¼
    assert "unlabeled/rosa/2025-11/" in saved_path
    assert diagnosis_id in saved_path

    # éªŒè¯æ–‡ä»¶å­˜åœ¨
    assert Path(saved_path).exists()

@pytest.mark.asyncio
async def test_move_file():
    """æµ‹è¯•æ–‡ä»¶ç§»åŠ¨ï¼ˆå‡†ç¡®æ€§æ ‡æ³¨ï¼‰"""
    storage = LocalImageStorage(base_path="tests/storage_test")

    # å…ˆä¿å­˜ä¸€å¼ å›¾ç‰‡
    image_bytes = b"fake_image_data"
    old_path = await storage.save(
        image_bytes=image_bytes,
        diagnosis_id="diag_20251111_002",
        plant_genus="rosa",
        accuracy_label="unlabeled"
    )

    # ç§»åŠ¨åˆ°correctæ–‡ä»¶å¤¹
    new_path = await storage.move(
        old_path=old_path,
        new_accuracy_label="correct"
    )

    # éªŒè¯
    assert "correct/rosa/" in new_path
    assert Path(new_path).exists()
    assert not Path(old_path).exists()  # æ—§æ–‡ä»¶å·²åˆ é™¤
```

**æ¶æ„è¯´æ˜**ï¼š
- LocalImageStorageæ˜¯**Layer 1åŸºç¡€è®¾æ–½æ¨¡å—**ï¼ˆæ— ä¾èµ–ï¼‰
- è¢«ImageServiceï¼ˆLayer 3æœåŠ¡ï¼‰è°ƒç”¨
- å®ç°é¡ºåºï¼šP2.6 â†’ P3.6ï¼ˆImageServiceï¼‰ â†’ P4.3ï¼ˆå›¾ç‰‡ç®¡ç†APIï¼‰

---

**P2é˜¶æ®µGateï¼ˆG2ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G2.1ï¼šPROOF Framework + VLMå“åº”Schemaåˆ›å»ºå®Œæˆï¼Œå•å…ƒæµ‹è¯•é€šè¿‡
- [x] G2.2ï¼šVLMå®¢æˆ·ç«¯è°ƒç”¨æˆåŠŸï¼Œé›†æˆæµ‹è¯•é€šè¿‡
- [x] G2.3ï¼šçŸ¥è¯†åº“åŠ è½½æˆåŠŸï¼ˆè‡³å°‘2ç§ç–¾ç—…ï¼‰
- [x] G2.4ï¼šæ¨¡ç³ŠåŒ¹é…å¼•æ“å•å…ƒæµ‹è¯•é€šè¿‡
- [x] G2.5ï¼šåŠ æƒè¯Šæ–­è¯„åˆ†å™¨å•å…ƒæµ‹è¯•é€šè¿‡
- [x] G2.6ï¼šæœ¬åœ°å›¾ç‰‡å­˜å‚¨å•å…ƒæµ‹è¯•é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `backend/infrastructure/llm/` ä¸‹æ‰€æœ‰æ–‡ä»¶
- [ ] `backend/infrastructure/ontology/` ä¸‹æ‰€æœ‰æ–‡ä»¶
- [ ] `backend/infrastructure/storage/` ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆLocalImageStorageï¼‰
- [ ] `backend/knowledge_base/` ä¸‹è‡³å°‘2ç§ç–¾ç—…JSON
- [ ] `backend/tests/unit/` ä¸‹æ‰€æœ‰å•å…ƒæµ‹è¯•
- [ ] `backend/tests/integration/test_vlm_client.py`

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœVLMè°ƒç”¨å¤±è´¥ â†’ æ£€æŸ¥API Keyï¼Œæ£€æŸ¥ç½‘ç»œï¼Œæ ‡è®°ä¸º **[å¾…å†³ç­–]**
- å¦‚æœçŸ¥è¯†åº“åŠ è½½å¤±è´¥ â†’ æ£€æŸ¥JSONæ ¼å¼ï¼Œä½¿ç”¨JSON SchemaéªŒè¯
- å¦‚æœè¯„åˆ†ç®—æ³•ä¸v11ä¸ä¸€è‡´ â†’ å¯¹ç…§v11æºç ä¿®æ­£

---


---

### P3: è¯Šæ–­å¼•æ“æ ¸å¿ƒé€»è¾‘ âœ…

**âœ… ä¸v1.0ä¿æŒå®Œå…¨ä¸€è‡´ï¼Œå†…å®¹ä¸å˜**


**ç›®æ ‡**ï¼šå®ç°Q0-Q6é—®è¯Šåºåˆ—ã€ä¸‰å±‚æ¸è¿›è¯Šæ–­æµç¨‹ã€VLMå…œåº•ç­–ç•¥ã€çŸ¥è¯†åº“æœåŠ¡ã€å›¾ç‰‡æœåŠ¡

**é¢„ä¼°æ—¶é—´**ï¼š3å¤©ï¼ˆ24å°æ—¶ï¼‰

---

#### P3.1 Q0é€çº§è¿‡æ»¤å®ç°

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°Q0.0å†…å®¹ç±»å‹è¯†åˆ«ï¼ˆplant/animal/person/object/landscape/otherï¼‰
2. å®ç°Q0.1æ¤ç‰©ç±»åˆ«è¯†åˆ«ï¼ˆflower/vegetable/tree/crop/grass/otherï¼‰
3. å®ç°Q0.2èŠ±å‰ç§å±è¯†åˆ«ï¼ˆRosa/Prunus/Tulipa/Dianthus/Paeonia/unknownï¼‰
4. å®ç°Q0.3å™¨å®˜è¯†åˆ«ï¼ˆflower/leafï¼‰
5. å®ç°Q0.4å®Œæ•´æ€§æ£€æŸ¥ï¼ˆcomplete/partial/close_upï¼‰
6. å®ç°Q0.5å¼‚å¸¸åˆ¤æ–­ï¼ˆhealthy/abnormalï¼‰
7. æ—©æœŸé€€å‡ºæœºåˆ¶ï¼ˆå¦‚Q0.0 != plant â†’ ç›´æ¥è¿”å›é”™è¯¯ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/services/diagnosis_service.py`ï¼šDiagnosisServiceç±»ï¼ˆéƒ¨åˆ†å®ç°ï¼‰
  - `_execute_q0_sequence()` æ–¹æ³•
  - `_check_content_type()` æ–¹æ³•
  - `_check_plant_category()` æ–¹æ³•
  - `_check_flower_genus()` æ–¹æ³•

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.1ï¼‰**ï¼š
- [ ] Q0é€çº§è¿‡æ»¤å®Œæ•´æµç¨‹æµ‹è¯•é€šè¿‡
- [ ] éæ¤ç‰©å›¾ç‰‡è¿”å›"ä¸æ”¯æŒçš„å›¾ç‰‡ç±»å‹"
- [ ] éèŠ±å‰å›¾ç‰‡è¿”å›"å½“å‰ä»…æ”¯æŒèŠ±å‰è¯Šæ–­"
- [ ] Q0.2è¿”å›çš„flower_genuså¯ç”¨äºå€™é€‰ç–¾ç—…å‰ªæ
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨æµ‹è¯•æ•°æ®é›†ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.1 + P2.2å®Œæˆ

**é›†æˆæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/integration/test_q0_filtering.py
async def test_q0_sequence_with_rose_image():
    """æµ‹è¯•Q0åºåˆ—ï¼ˆç«ç‘°å›¾ç‰‡ï¼‰"""
    from services.diagnosis_service import DiagnosisService

    service = DiagnosisService(...)

    # åŠ è½½ç«ç‘°å›¾ç‰‡
    with open("tests/fixtures/rose_black_spot.jpg", "rb") as f:
        image_bytes = f.read()

    # æ‰§è¡ŒQ0åºåˆ—
    q0_responses = await service._execute_q0_sequence(image_bytes)

    # éªŒè¯
    assert q0_responses["content_type"] == "plant"
    assert q0_responses["plant_category"] == "flower"
    assert q0_responses["flower_genus"] in ["Rosa", "Prunus", "unknown"]
    assert q0_responses["organ"] in ["flower", "leaf"]
    assert q0_responses["completeness"] in ["complete", "partial", "close_up"]
    assert q0_responses["has_abnormality"] in ["healthy", "abnormal"]
```

---

#### P3.2 Q1-Q6åŠ¨æ€ç‰¹å¾æå–

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°Q1ç—‡çŠ¶ç±»å‹è¯†åˆ«ï¼ˆsymptom_typeï¼‰
2. æ ¹æ®Q1ç»“æœåŠ¨æ€ç”ŸæˆQ2-Q6é—®é¢˜ï¼š
   - å¦‚symptom_type = "necrosis_spot" â†’ Q2: color_center, Q3: color_border, Q4: location
   - å¦‚symptom_type = "powdery_coating" â†’ Q2: coverage_color, Q3: coverage_density
3. å®ç°ç‰¹å¾å‘é‡æ„å»ºï¼ˆ`FeatureVector` Pydanticå¯¹è±¡ï¼‰
4. å¤„ç†VLMä¸ç¡®å®šæ€§ï¼ˆconfidence < 0.5æ—¶æ ‡è®°ä¸ºuncertainï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/services/diagnosis_service.py`ï¼šDiagnosisServiceç±»ï¼ˆéƒ¨åˆ†å®ç°ï¼‰
  - `_execute_q1_q6_sequence()` æ–¹æ³•
  - `_build_feature_vector()` æ–¹æ³•

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.2ï¼‰**ï¼š
- [ ] Q1-Q6åŠ¨æ€é—®é¢˜ç”ŸæˆæˆåŠŸ
- [ ] ç‰¹å¾å‘é‡æ„å»ºå®Œæ•´ï¼ˆåŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µï¼‰
- [ ] VLMä¸ç¡®å®šæ€§å¤„ç†æ­£ç¡®
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨æµ‹è¯•æ•°æ®é›†ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP3.1å®Œæˆ

---

#### P3.3 ä¸‰å±‚æ¸è¿›è¯Šæ–­æµç¨‹

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°Layer1ï¼šVLMè§†è§‰ç‰¹å¾æå–ï¼ˆQ0-Q6ï¼‰
2. å®ç°Layer2ï¼šçŸ¥è¯†åº“åŒ¹é…å¼•æ“
   - å€™é€‰ç–¾ç—…ç­›é€‰ï¼ˆæ ¹æ®flower_genuså‰ªæï¼‰
   - åŠ æƒè¯Šæ–­è¯„åˆ†ï¼ˆè°ƒç”¨DiagnosisScorerï¼‰
   - æ’åºï¼ˆæŒ‰total_scoreé™åºï¼‰
3. å®ç°Layer3ï¼šç½®ä¿¡åº¦åˆ†å±‚å†³ç­–
   - High Confidence (â‰¥0.85) â†’ è¿”å›confirmed
   - Medium Confidence (0.60-0.85) â†’ è¿”å›suspectedï¼ˆTop 2-3å€™é€‰ï¼‰
   - Low Confidence (<0.60) â†’ è§¦å‘å…œåº•ç­–ç•¥ï¼ˆP3.4ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/services/diagnosis_service.py`ï¼šDiagnosisServiceç±»ï¼ˆå®Œæ•´å®ç°ï¼‰
  - `diagnose()` ä¸»æ–¹æ³•ï¼ˆç¼–æ’å®Œæ•´æµç¨‹ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.3ï¼‰**ï¼š
- [ ] å®Œæ•´è¯Šæ–­æµç¨‹æµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨Rose Black Spotæµ‹è¯•å›¾ç‰‡ï¼‰
- [ ] ç¡®è¯Šç»“æœæ­£ç¡®ï¼ˆtotal_score â‰¥ 0.85ï¼Œdisease_idæ­£ç¡®ï¼‰
- [ ] ç–‘ä¼¼ç»“æœæ­£ç¡®ï¼ˆè¿”å›Top 2-3å€™é€‰ç–¾ç—…ï¼‰
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–confirmed/suspectedä¸¤ç§åœºæ™¯ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP3.2 + P2.3 + P2.5å®Œæˆ

**é›†æˆæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/integration/test_diagnosis_flow.py
async def test_complete_diagnosis_rose_black_spot():
    """æµ‹è¯•å®Œæ•´è¯Šæ–­æµç¨‹ï¼ˆç«ç‘°é»‘æ–‘ç—…ï¼‰"""
    from services.diagnosis_service import DiagnosisService

    service = DiagnosisService(...)

    # åŠ è½½æµ‹è¯•å›¾ç‰‡
    with open("tests/fixtures/rose_black_spot.jpg", "rb") as f:
        image_bytes = f.read()

    # æ‰§è¡Œè¯Šæ–­
    result = await service.diagnose(image_bytes)

    # éªŒè¯
    assert result.status == "confirmed"
    assert result.confirmed_disease == "rose_black_spot"
    assert result.confidence >= 0.85
    assert "feature_vector" in result.dict()
    assert "scores" in result.dict()
```

---

#### P3.4 VLMå…œåº•ç­–ç•¥

**ä»»åŠ¡æ¸…å•**ï¼š
1. å½“æ‰€æœ‰å€™é€‰ç–¾ç—…score < 0.6æ—¶è§¦å‘å…œåº•ç­–ç•¥
2. è°ƒç”¨VLMå¼€æ”¾å¼è¯Šæ–­ï¼ˆä½¿ç”¨fallbackæç¤ºè¯æ¨¡æ¿ï¼‰
3. è¿”å›VLMæ¨æµ‹ç»“æœï¼Œæ ‡è®°ä¸º"VLMæ¨æµ‹"
4. è®°å½•caseç”¨äºåç»­çŸ¥è¯†åº“è¡¥å……

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/llm/prompts/fallback.py`ï¼šVLMå¼€æ”¾å¼è¯Šæ–­æç¤ºè¯
- `backend/services/diagnosis_service.py`ï¼šDiagnosisServiceç±»
  - `_vlm_fallback_diagnosis()` æ–¹æ³•

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.4ï¼‰**ï¼š
- [ ] å…œåº•ç­–ç•¥è§¦å‘æµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨çŸ¥è¯†åº“å¤–ç–¾ç—…å›¾ç‰‡ï¼‰
- [ ] VLMå¼€æ”¾å¼è¯Šæ–­è¿”å›æœ‰æ•ˆç»“æœ
- [ ] ç»“æœæ ‡è®°ä¸º"VLMæ¨æµ‹"
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP3.3å®Œæˆ

---

#### P3.5 çŸ¥è¯†åº“æœåŠ¡å®ç°ï¼ˆKnowledgeServiceï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°KnowledgeServiceç±»ï¼ˆ`backend/services/knowledge_service.py`ï¼‰
2. å®ç°çŸ¥è¯†åº“åˆå§‹åŒ–ï¼ˆ`initialize`æ–¹æ³•ï¼Œè°ƒç”¨KnowledgeLoaderåŠ è½½æ‰€æœ‰çŸ¥è¯†åº“ï¼‰
3. å®ç°çŸ¥è¯†åº“çƒ­æ›´æ–°ï¼ˆ`reload`æ–¹æ³•ï¼Œæ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½ï¼‰
4. å®ç°å€™é€‰ç–¾ç—…æŸ¥è¯¢ï¼ˆ`get_diseases_by_genus`æ–¹æ³•ï¼Œç”¨äºP3.3çš„å€™é€‰ç–¾ç—…ç­›é€‰ï¼‰
5. å®ç°å…¨éƒ¨ç–¾ç—…æŸ¥è¯¢ï¼ˆ`get_all_diseases`æ–¹æ³•ï¼Œç”¨äºç®¡ç†åå°ï¼‰
6. å®ç°å•ä¸ªç–¾ç—…æŸ¥è¯¢ï¼ˆ`get_disease_by_id`æ–¹æ³•ï¼‰
7. å®ç°çŸ¥è¯†åº“ç‰ˆæœ¬ç®¡ç†ï¼ˆè®°å½•Git commit hashï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/services/knowledge_service.py`ï¼šKnowledgeServiceç±»
- `backend/services/__init__.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.5ï¼‰**ï¼š
- [ ] KnowledgeServiceå¯æˆåŠŸåˆå§‹åŒ–ï¼ˆåŠ è½½è‡³å°‘2ç§ç–¾ç—…ï¼‰
- [ ] `get_diseases_by_genus("Rosa")` è¿”å›ç«ç‘°å±ç–¾ç—…åˆ—è¡¨
- [ ] `get_all_diseases()` è¿”å›æ‰€æœ‰ç–¾ç—…åˆ—è¡¨
- [ ] `get_disease_by_id("rose_black_spot")` è¿”å›æ­£ç¡®çš„ç–¾ç—…å¯¹è±¡
- [ ] `reload()` çƒ­æ›´æ–°æµ‹è¯•é€šè¿‡ï¼ˆä¿®æ”¹JSONåé‡æ–°åŠ è½½ç”Ÿæ•ˆï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.3ï¼ˆKnowledgeLoaderï¼‰å®Œæˆ

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_knowledge_service.py
import pytest
from services.knowledge_service import KnowledgeService
from infrastructure.ontology.loader import JSONKnowledgeLoader

@pytest.mark.asyncio
async def test_initialize_knowledge_service():
    """æµ‹è¯•çŸ¥è¯†åº“æœåŠ¡åˆå§‹åŒ–"""
    loader = JSONKnowledgeLoader(base_path="backend/knowledge_base")
    service = KnowledgeService(loader=loader)

    # åˆå§‹åŒ–çŸ¥è¯†åº“
    await service.initialize()

    # éªŒè¯
    assert service.knowledge_base is not None
    all_diseases = service.get_all_diseases()
    assert len(all_diseases) >= 2  # è‡³å°‘2ç§ç–¾ç—…

@pytest.mark.asyncio
async def test_get_diseases_by_genus():
    """æµ‹è¯•æŒ‰èŠ±å‰å±æŸ¥è¯¢ç–¾ç—…"""
    loader = JSONKnowledgeLoader(base_path="backend/knowledge_base")
    service = KnowledgeService(loader=loader)
    await service.initialize()

    # æŸ¥è¯¢ç«ç‘°å±ç–¾ç—…
    rosa_diseases = service.get_diseases_by_genus("Rosa")

    # éªŒè¯
    assert len(rosa_diseases) > 0
    assert all(d.host_genus == "Rosa" for d in rosa_diseases)

@pytest.mark.asyncio
async def test_reload_knowledge_base():
    """æµ‹è¯•çŸ¥è¯†åº“çƒ­æ›´æ–°"""
    loader = JSONKnowledgeLoader(base_path="backend/knowledge_base")
    service = KnowledgeService(loader=loader)
    await service.initialize()

    # è®°å½•åˆå§‹ç–¾ç—…æ•°é‡
    initial_count = len(service.get_all_diseases())

    # çƒ­æ›´æ–°
    await service.reload()

    # éªŒè¯ï¼ˆæ•°é‡åº”è¯¥ä¸€è‡´ï¼Œè¯æ˜é‡æ–°åŠ è½½æˆåŠŸï¼‰
    new_count = len(service.get_all_diseases())
    assert new_count == initial_count
```

**æ¶æ„è¯´æ˜**ï¼š
- KnowledgeServiceæ˜¯**Layer 3åº”ç”¨æœåŠ¡**ï¼ˆä¾èµ–KnowledgeLoaderï¼‰
- è¢«DiagnosisServiceï¼ˆLayer 4æœåŠ¡ï¼‰è°ƒç”¨
- å®ç°é¡ºåºï¼šP2.3ï¼ˆKnowledgeLoaderï¼‰ â†’ P3.5ï¼ˆKnowledgeServiceï¼‰ â†’ P3.1-P3.4ï¼ˆDiagnosisServiceï¼‰

---

#### P3.6 å›¾ç‰‡æœåŠ¡å®ç°ï¼ˆImageServiceï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°ImageServiceç±»ï¼ˆ`backend/services/image_service.py`ï¼‰
2. å®ç°å›¾ç‰‡ä¿å­˜ï¼ˆ`save_image`æ–¹æ³•ï¼Œè°ƒç”¨LocalImageStorageä¿å­˜å›¾ç‰‡ï¼‰
3. å®ç°å›¾ç‰‡å…ƒæ•°æ®æŒä¹…åŒ–ï¼ˆè°ƒç”¨ImageRepositoryä¿å­˜åˆ°æ•°æ®åº“ï¼‰
4. å®ç°å‡†ç¡®æ€§æ ‡æ³¨ï¼ˆ`update_accuracy_label`æ–¹æ³•ï¼Œç§»åŠ¨æ–‡ä»¶åˆ°correct/incorrectæ–‡ä»¶å¤¹ï¼‰
5. å®ç°å›¾ç‰‡æŸ¥è¯¢ï¼ˆ`query_images`æ–¹æ³•ï¼ŒæŒ‰èŠ±å‰å±ã€å‡†ç¡®æ€§ã€æ—¥æœŸèŒƒå›´ç­›é€‰ï¼‰
6. å®ç°å›¾ç‰‡åˆ é™¤ï¼ˆ`delete_image`æ–¹æ³•ï¼Œè½¯åˆ é™¤ï¼‰
7. å®ç°ImageRepositoryï¼ˆ`backend/infrastructure/persistence/repositories/image_repo.py`ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/services/image_service.py`ï¼šImageServiceç±»
- `backend/infrastructure/persistence/repositories/image_repo.py`ï¼šImageRepositoryç±»

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.6ï¼‰**ï¼š
- [ ] ImageServiceå¯æˆåŠŸä¿å­˜å›¾ç‰‡ï¼ˆæ–‡ä»¶å­˜åœ¨äºæ­£ç¡®è·¯å¾„ï¼‰
- [ ] å›¾ç‰‡å…ƒæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆ`images`è¡¨ï¼‰
- [ ] `update_accuracy_label()` æµ‹è¯•é€šè¿‡ï¼ˆæ–‡ä»¶ç§»åŠ¨æˆåŠŸï¼‰
- [ ] `query_images()` æµ‹è¯•é€šè¿‡ï¼ˆæŒ‰æ¡ä»¶ç­›é€‰ï¼‰
- [ ] `delete_image()` æµ‹è¯•é€šè¿‡ï¼ˆè½¯åˆ é™¤ï¼Œæ–‡ä»¶å’Œæ•°æ®åº“è®°å½•éƒ½æ ‡è®°ä¸ºå·²åˆ é™¤ï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.6ï¼ˆLocalImageStorageï¼‰å®Œæˆ

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_image_service.py
import pytest
from services.image_service import ImageService
from infrastructure.storage.local_storage import LocalImageStorage
from infrastructure.persistence.repositories.image_repo import ImageRepository

@pytest.mark.asyncio
async def test_save_image():
    """æµ‹è¯•å›¾ç‰‡ä¿å­˜"""
    storage = LocalImageStorage(base_path="tests/storage_test")
    repo = ImageRepository(db_pool=...)
    service = ImageService(storage=storage, image_repo=repo)

    # ä¿å­˜å›¾ç‰‡
    image_bytes = b"fake_image_data"
    image_id = await service.save_image(
        image_bytes=image_bytes,
        diagnosis_id="diag_20251111_001",
        plant_genus="rosa",
        organ="leaf"
    )

    # éªŒè¯æ–‡ä»¶å­˜åœ¨
    assert image_id is not None

    # éªŒè¯æ•°æ®åº“è®°å½•
    image_metadata = await repo.get_by_id(image_id)
    assert image_metadata.plant_genus == "rosa"
    assert image_metadata.accuracy_label == "unlabeled"

@pytest.mark.asyncio
async def test_update_accuracy_label():
    """æµ‹è¯•å‡†ç¡®æ€§æ ‡æ³¨"""
    storage = LocalImageStorage(base_path="tests/storage_test")
    repo = ImageRepository(db_pool=...)
    service = ImageService(storage=storage, image_repo=repo)

    # å…ˆä¿å­˜ä¸€å¼ å›¾ç‰‡
    image_bytes = b"fake_image_data"
    image_id = await service.save_image(
        image_bytes=image_bytes,
        diagnosis_id="diag_20251111_002",
        plant_genus="rosa",
        organ="leaf"
    )

    # æ›´æ–°å‡†ç¡®æ€§æ ‡ç­¾
    await service.update_accuracy_label(
        image_id=image_id,
        label="correct"
    )

    # éªŒè¯æ•°æ®åº“æ›´æ–°
    image_metadata = await repo.get_by_id(image_id)
    assert image_metadata.accuracy_label == "correct"

    # éªŒè¯æ–‡ä»¶å·²ç§»åŠ¨
    assert "correct/rosa/" in image_metadata.file_path

@pytest.mark.asyncio
async def test_query_images():
    """æµ‹è¯•å›¾ç‰‡æŸ¥è¯¢"""
    storage = LocalImageStorage(base_path="tests/storage_test")
    repo = ImageRepository(db_pool=...)
    service = ImageService(storage=storage, image_repo=repo)

    # æŸ¥è¯¢æ‰€æœ‰ç«ç‘°å±å›¾ç‰‡
    images = await service.query_images(
        genus="rosa",
        accuracy_label="unlabeled"
    )

    # éªŒè¯
    assert len(images) > 0
    assert all(img.plant_genus == "rosa" for img in images)
    assert all(img.accuracy_label == "unlabeled" for img in images)
```

**æ¶æ„è¯´æ˜**ï¼š
- ImageServiceæ˜¯**Layer 3åº”ç”¨æœåŠ¡**ï¼ˆä¾èµ–LocalImageStorage + ImageRepositoryï¼‰
- è¢«DiagnosisServiceï¼ˆLayer 4æœåŠ¡ï¼‰å’ŒAdminRouterè°ƒç”¨
- å®ç°é¡ºåºï¼šP2.6ï¼ˆLocalImageStorageï¼‰ â†’ P3.6ï¼ˆImageServiceï¼‰ â†’ P4.3ï¼ˆå›¾ç‰‡ç®¡ç†APIï¼‰

---

**P3é˜¶æ®µGateï¼ˆG3ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G3.1ï¼šQ0é€çº§è¿‡æ»¤æµ‹è¯•é€šè¿‡
- [x] G3.2ï¼šQ1-Q6åŠ¨æ€ç‰¹å¾æå–æµ‹è¯•é€šè¿‡
- [x] G3.3ï¼šä¸‰å±‚æ¸è¿›è¯Šæ–­æµç¨‹æµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨Rose Black Spot + Cherry Powdery Mildewæµ‹è¯•ï¼‰
- [x] G3.4ï¼šVLMå…œåº•ç­–ç•¥æµ‹è¯•é€šè¿‡
- [x] G3.5ï¼šçŸ¥è¯†åº“æœåŠ¡å•å…ƒæµ‹è¯•é€šè¿‡
- [x] G3.6ï¼šå›¾ç‰‡æœåŠ¡å•å…ƒæµ‹è¯•é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `backend/services/diagnosis_service.py`ï¼ˆDiagnosisServiceå®Œæ•´å®ç°ï¼‰
- [ ] `backend/services/knowledge_service.py`ï¼ˆKnowledgeServiceå®Œæ•´å®ç°ï¼‰
- [ ] `backend/services/image_service.py`ï¼ˆImageServiceå®Œæ•´å®ç°ï¼‰
- [ ] `backend/infrastructure/persistence/repositories/image_repo.py`ï¼ˆImageRepositoryï¼‰
- [ ] `backend/tests/integration/test_q0_filtering.py`
- [ ] `backend/tests/integration/test_diagnosis_flow.py`

éªŒæ”¶æµ‹è¯•ï¼š
- [ ] ä½¿ç”¨æµ‹è¯•æ•°æ®é›†ï¼ˆRose Black Spot 12å¼ å›¾ç‰‡ï¼‰ï¼Œç¡®è¯Šç‡ â‰¥ 65%
- [ ] ä½¿ç”¨æµ‹è¯•æ•°æ®é›†ï¼ˆCherry Powdery Mildew 12å¼ å›¾ç‰‡ï¼‰ï¼Œç¡®è¯Šç‡ â‰¥ 65%

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœç¡®è¯Šç‡ < 65% â†’ è°ƒæ•´æç¤ºè¯ã€ç‰¹å¾æƒé‡ï¼Œé‡æ–°æµ‹è¯•
- å¦‚æœVLMå…œåº•å¤±è´¥ â†’ æ ‡è®°ä¸º **[å¾…å†³ç­–]**ï¼Œå‘ç”¨æˆ·æé—®

---


---

### P3.9: P0-P3å·²å®ç°æ¨¡å—å°å¹…ä¿®æ”¹ âœ¨

**âœ¨ v2.0æ–°å¢é˜¶æ®µ**: æ ¹æ®éœ€æ±‚äº¤ä»˜èƒ½åŠ›ç»¼åˆè¯„å®¡æŠ¥å‘Šv2.0ç¬¬3.3èŠ‚ï¼Œå¯¹P0-P3å·²å®ç°æ¨¡å—è¿›è¡Œå°å¹…ä¿®æ”¹ä»¥æ»¡è¶³æ–°éœ€æ±‚

**ç›®æ ‡**: ä¿®æ”¹ImageServiceã€KnowledgeServiceã€DiagnosisServiceä¸‰ä¸ªå·²å®ç°çš„Serviceï¼Œæ”¯æŒæ–°å¢çš„åŠŸèƒ½éœ€æ±‚

**é¢„ä¼°æ—¶é—´**: 0.6å¤©ï¼ˆçº¦5å°æ—¶ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**:
- è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬6ç«  APIè®¾è®¡ï¼ˆ6.1èŠ‚è¯Šæ–­APIã€6.4èŠ‚çŸ¥è¯†åº“APIã€6.7èŠ‚å›¾ç‰‡ç®¡ç†APIï¼‰
- è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬7ç«  æœåŠ¡å±‚è®¾è®¡

**è¯„å®¡æŠ¥å‘Šæ¥æº**: `docs/reports/éœ€æ±‚äº¤ä»˜èƒ½åŠ›ç»¼åˆè¯„å®¡æŠ¥å‘Š_v2.0.md` ç¬¬3.3èŠ‚

---

#### P3.9.1 ä¿®æ”¹ImageServiceï¼šæ–°å¢å‡†ç¡®åº¦æ ‡æ³¨æ¥å£ï¼ˆ0.2å¤©ï¼‰

**ä»»åŠ¡èƒŒæ™¯**:
è¯„å®¡æŠ¥å‘Š3.3èŠ‚æŒ‡å‡ºï¼ŒImageServiceéœ€æ‰©å±•æ ‡æ³¨åŠŸèƒ½ï¼Œæ”¯æŒç”¨æˆ·å¯¹è¯Šæ–­ç»“æœè¿›è¡Œå‡†ç¡®æ€§åé¦ˆï¼ˆæ­£ç¡®/é”™è¯¯ï¼‰ã€‚

**ä»»åŠ¡æ¸…å•**:

1. **ä¿®æ”¹ImageServiceç±»** (`backend/services/image_service.py`):
   ```python
   class ImageService:
       async def update_accuracy_label(
           self,
           image_id: str,
           is_accurate: bool,
           user_feedback: Optional[str] = None
       ) -> None:
           """æ ‡æ³¨è¯Šæ–­å‡†ç¡®æ€§"""
           # 1. ä»æ•°æ®åº“æŸ¥è¯¢imageè®°å½•
           # 2. æ›´æ–°accuracy_labelå­—æ®µ
           # 3. å¯é€‰ï¼šä¿å­˜ç”¨æˆ·åé¦ˆæ–‡æœ¬
           pass
   ```

2. **æ–°å¢APIè·¯ç”±** (`backend/apps/api/routers/images.py`):
   ```python
   @router.patch("/images/{image_id}/accuracy")
   async def update_accuracy(
       image_id: str,
       accuracy: AccuracyLabelRequest,
       service: ImageService = Depends(get_image_service)
   ):
       """PATCH /api/v1/images/{image_id}/accuracy"""
       await service.update_accuracy_label(
           image_id=image_id,
           is_accurate=accuracy.is_accurate,
           user_feedback=accuracy.feedback
       )
       return {"message": "æ ‡æ³¨æˆåŠŸ"}
   ```

3. **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**:
   - å•å…ƒæµ‹è¯•: `test_image_service.py::test_update_accuracy_label`
   - é›†æˆæµ‹è¯•: `test_images_api.py::test_patch_accuracy_success`

**äº§å‡ºç‰©**:
- ä¿®æ”¹ `backend/services/image_service.py`
- æ–°å¢ `backend/apps/api/routers/images.py` è·¯ç”±
- æ–°å¢æµ‹è¯•ç”¨ä¾‹

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.9.1ï¼‰**:
- [ ] `update_accuracy_label()` æ–¹æ³•å®ç°å®Œæˆ
- [ ] PATCHæ¥å£æµ‹è¯•é€šè¿‡ï¼ˆPostman/cURLï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- [ ] æ•°æ®åº“ä¸­accuracy_labelå­—æ®µæ­£ç¡®æ›´æ–°

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬6.7èŠ‚å›¾ç‰‡ç®¡ç†APIã€ç¬¬7ç« ImageService

---

#### P3.9.2 ä¿®æ”¹KnowledgeServiceï¼šæ–°å¢çŸ¥è¯†åº“æ ‘æ–¹æ³•ï¼ˆ0.25å¤©ï¼‰

**ä»»åŠ¡èƒŒæ™¯**:
è¯„å®¡æŠ¥å‘Š3.3èŠ‚æŒ‡å‡ºï¼ŒKnowledgeServiceéœ€æ”¯æŒæ ‘ç»“æ„æŸ¥è¯¢ï¼ŒæŒ‰"å®¿ä¸»å±â†’ç–¾ç—…"åˆ†ç»„è¿”å›çŸ¥è¯†åº“æ•°æ®ã€‚

**ä»»åŠ¡æ¸…å•**:

1. **ä¿®æ”¹KnowledgeServiceç±»** (`backend/services/knowledge_service.py`):
   ```python
   class KnowledgeService:
       async def get_knowledge_tree(self) -> KnowledgeTree:
           """è·å–æŒ‰å®¿ä¸»å±åˆ†ç»„çš„ç–¾ç—…æ ‘ç»“æ„"""
           # 1. è¯»å–knowledge_base/host_disease/associations.json
           # 2. æŒ‰genusåˆ†ç»„
           # 3. è¿”å›æ ‘å½¢ç»“æ„
           hosts = []
           for genus, diseases in grouped_data.items():
               hosts.append({
                   "genus": genus,
                   "name_zh": genus_zh_name,
                   "diseases": [
                       {"id": d.id, "name_zh": d.name_zh}
                       for d in diseases
                   ]
               })
           return KnowledgeTree(hosts=hosts)
   ```

2. **æ–°å¢APIè·¯ç”±** (`backend/apps/api/routers/knowledge.py`):
   ```python
   @router.get("/knowledge/tree")
   async def get_tree(
       service: KnowledgeService = Depends(get_knowledge_service)
   ) -> KnowledgeTreeResponse:
       """GET /api/v1/knowledge/tree"""
       return await service.get_knowledge_tree()
   ```

3. **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**:
   - å•å…ƒæµ‹è¯•: éªŒè¯æ ‘ç»“æ„æ­£ç¡®åˆ†ç»„
   - é›†æˆæµ‹è¯•: éªŒè¯APIè¿”å›æ ¼å¼

**äº§å‡ºç‰©**:
- ä¿®æ”¹ `backend/services/knowledge_service.py`
- æ–°å¢ `GET /api/v1/knowledge/tree` è·¯ç”±
- æ–°å¢æµ‹è¯•ç”¨ä¾‹

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.9.2ï¼‰**:
- [ ] `get_knowledge_tree()` æ–¹æ³•å®ç°å®Œæˆ
- [ ] è¿”å›æ•°æ®æŒ‰å®¿ä¸»å±æ­£ç¡®åˆ†ç»„ï¼ˆRosaã€Prunusç­‰ï¼‰
- [ ] APIè·¯ç”±æµ‹è¯•é€šè¿‡
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬6.4èŠ‚çŸ¥è¯†åº“ç®¡ç†APIã€ç¬¬7ç« KnowledgeService

---

#### P3.9.3 ä¿®æ”¹DiagnosisServiceï¼šè°ƒæ•´å“åº”æ ¼å¼ï¼ˆ0.15å¤©ï¼‰

**ä»»åŠ¡èƒŒæ™¯**:
è¯„å®¡æŠ¥å‘Š3.3èŠ‚æŒ‡å‡ºï¼ŒDiagnosisServiceçš„APIå“åº”éœ€è¦åŒ…å«VLMé—®ç­”å¯¹è¯¦æƒ…ï¼ˆQ0-Q6ï¼‰ï¼Œæ”¯æŒç•Œé¢1å±•ç¤ºå®Œæ•´æ¨ç†è¿‡ç¨‹ã€‚

**ä»»åŠ¡æ¸…å•**:

1. **è°ƒæ•´DiagnosisResponseæ¨¡å‹** (`backend/domain/models/diagnosis.py`):
   ```python
   class DiagnosisResponse(BaseModel):
       diagnosis_id: str
       disease_name: str
       confidence: float
       description: str
       # âœ¨ æ–°å¢å­—æ®µ
       qa_details: List[QADetail]  # VLMé—®ç­”å¯¹ï¼ˆQ0-Q6ï¼‰

   class QADetail(BaseModel):
       question_id: str  # "Q0.0", "Q1", etc.
       question: str
       answer: str
       image_url: Optional[str]  # å¦‚æœæœ‰æ ‡æ³¨å›¾
   ```

2. **ä¿®æ”¹DiagnosisService.diagnose()æ–¹æ³•**:
   - åœ¨è¿”å›æ—¶åŒ…å«VLMçš„Q0-Q6é—®ç­”å¯¹
   - è°ƒç”¨VLMClientæ—¶ä¿å­˜ä¸­é—´ç»“æœ

3. **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**:
   - é›†æˆæµ‹è¯•: éªŒè¯å“åº”ä¸­åŒ…å«qa_detailså­—æ®µ

**äº§å‡ºç‰©**:
- ä¿®æ”¹ `backend/domain/models/diagnosis.py`
- ä¿®æ”¹ `backend/services/diagnosis_service.py`
- æ›´æ–°æµ‹è¯•ç”¨ä¾‹

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.9.3ï¼‰**:
- [ ] DiagnosisResponseåŒ…å«qa_detailså­—æ®µ
- [ ] qa_detailsåŒ…å«Q0-Q6å®Œæ•´é—®ç­”å¯¹
- [ ] APIæµ‹è¯•é€šè¿‡ï¼Œå“åº”æ ¼å¼æ­£ç¡®
- [ ] ä¸å½±å“ç°æœ‰æµ‹è¯•ç”¨ä¾‹

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬6.1èŠ‚è¯Šæ–­APIã€ç¬¬7ç« DiagnosisService

---

**P3.9é˜¶æ®µGateï¼ˆG3.9ï¼‰**:

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰:
- [ ] G3.9.1: ImageServiceæ–°å¢`update_accuracy_label()`æ–¹æ³•ï¼Œæµ‹è¯•é€šè¿‡
- [ ] G3.9.2: KnowledgeServiceæ–°å¢`get_knowledge_tree()`æ–¹æ³•ï¼Œæµ‹è¯•é€šè¿‡
- [ ] G3.9.3: DiagnosisServiceå“åº”æ ¼å¼è°ƒæ•´ï¼ŒåŒ…å«qa_detailså­—æ®µ
- [ ] G3.9.4: æ‰€æœ‰ä¿®æ”¹çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- [ ] G3.9.5: é›†æˆæµ‹è¯•é€šè¿‡ï¼Œä¸å½±å“å·²æœ‰åŠŸèƒ½
- [ ] G3.9.6: P0-P3é˜¶æ®µçš„85%+æµ‹è¯•ç”¨ä¾‹ä»ç„¶é€šè¿‡

äº§å‡ºç‰©æ¸…å•:
- [ ] ä¿®æ”¹ `backend/services/image_service.py`
- [ ] ä¿®æ”¹ `backend/services/knowledge_service.py`
- [ ] ä¿®æ”¹ `backend/services/diagnosis_service.py`
- [ ] ä¿®æ”¹ `backend/domain/models/diagnosis.py`
- [ ] æ–°å¢ 3ä¸ªAPIè·¯ç”±
- [ ] æ–°å¢/æ›´æ–°æµ‹è¯•ç”¨ä¾‹

å¤±è´¥æ—¶è¡ŒåŠ¨:
- å¦‚æœæµ‹è¯•ä¸é€šè¿‡ â†’ è°ƒè¯•ä¿®å¤ï¼Œè®°å½•é—®é¢˜æ—¥å¿—
- å¦‚æœç ´åå·²æœ‰åŠŸèƒ½ â†’ å›æ»šä¿®æ”¹ï¼Œé‡æ–°è®¾è®¡æ–¹æ¡ˆ
- å¦‚æœå‘ç°æ–°çš„ä¾èµ–é—®é¢˜ â†’ æ ‡è®°ä¸º **[å¾…å†³ç­–]**ï¼Œå‘ç”¨æˆ·æé—®

**è¯´æ˜**: æœ¬é˜¶æ®µä»…ä¿®æ”¹P0-P3å·²å®ç°çš„æ¨¡å—ï¼Œä¸æ¶‰åŠæ–°æ¨¡å—å¼€å‘ã€‚æ–°API(15ä¸ª)ã€æ–°æ•°æ®åº“è¡¨(3å¼ )ã€æ–°Service(5ä¸ª)çš„å®ç°åœ¨P4é˜¶æ®µå®Œæˆã€‚

---


---

### P4: å®Œæ•´åç«¯APIå¼€å‘ ğŸ”„

**ğŸ”„ v2.0é‡å¤§ä¿®æ”¹**: æ‰©å±•APIèŒƒå›´ï¼Œå®ç°26ä¸ªAPIæ¥å£ã€åˆ›å»º8å¼ æ•°æ®åº“è¡¨ã€å¼€å‘12ä¸ªServiceæ¨¡å—

**ç›®æ ‡**ï¼šå®ç°å®Œæ•´çš„åç«¯APIæœåŠ¡ï¼ŒåŒ…æ‹¬è¯Šæ–­ã€çŸ¥è¯†åº“ç®¡ç†ã€æœ¬ä½“ç®¡ç†ã€æ‰¹é‡è¯Šæ–­ã€å›¾ç‰‡ç®¡ç†ç­‰åŠŸèƒ½

**æ ¸å¿ƒä»»åŠ¡**ï¼ˆå¯¹åº”è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0ï¼‰:
1. **å®ç°26ä¸ªAPIæ¥å£**ï¼ˆè¯¦ç»†è®¾è®¡ç¬¬6ç« ï¼‰:
   - ç°æœ‰APIï¼š5ä¸ªï¼ˆè¯Šæ–­ã€å¥åº·æ£€æŸ¥ã€è®¤è¯ç­‰ï¼‰
   - âœ¨ æ–°å¢15ä¸ªAPIï¼ˆè¯¦ç»†è®¾è®¡6.4-6.7èŠ‚ï¼‰ï¼š
     - çŸ¥è¯†åº“ç®¡ç†API 9ä¸ªï¼ˆ6.4èŠ‚ï¼‰ï¼štree, get, create, update, delete, validate, snapshot, snapshots, restore
     - æœ¬ä½“ç®¡ç†API 2ä¸ªï¼ˆ6.5èŠ‚ï¼‰ï¼šlist, get by type
     - æ‰¹é‡è¯Šæ–­API 3ä¸ªï¼ˆ6.6èŠ‚ï¼‰ï¼šbatch upload, get status, get progress
     - å›¾ç‰‡ç®¡ç†API 2ä¸ªï¼ˆ6.7èŠ‚ï¼‰ï¼šlist images, update accuracyï¼ˆå«P3.9.1å®ç°çš„æ¥å£ï¼‰

2. **åˆ›å»º8å¼ æ•°æ®åº“è¡¨**ï¼ˆè¯¦ç»†è®¾è®¡ç¬¬9ç« ï¼‰:
   - ç°æœ‰è¡¨ï¼š5å¼ ï¼ˆimages, diagnoses, diagnosis_features, knowledge_base_meta, api_keysï¼‰
   - âœ¨ æ–°å¢3å¼ è¡¨ï¼ˆè¯¦ç»†è®¾è®¡9.2èŠ‚ï¼‰ï¼š
     - knowledge_snapshotsï¼šçŸ¥è¯†åº“ç‰ˆæœ¬ç®¡ç†
     - ontology_changesï¼šæœ¬ä½“å˜æ›´å†å²
     - batch_diagnosis_sessionsï¼šæ‰¹é‡è¯Šæ–­ä¼šè¯

3. **å¼€å‘12ä¸ªServiceæ¨¡å—**ï¼ˆè¯¦ç»†è®¾è®¡ç¬¬7ç« ï¼‰:
   - å·²å®ç°ï¼ˆP0-P3ï¼‰ï¼š7ä¸ªï¼ˆDiagnosisService, VLMClient, ImageService, KnowledgeService, FuzzyMatcher, DiagnosisScorer, LocalImageStorageï¼‰
   - âœ¨ æ–°å¢5ä¸ªServiceï¼ˆè¯„å®¡æŠ¥å‘Š3.2èŠ‚ï¼‰ï¼š
     - BatchDiagnosisServiceï¼šæ‰¹é‡è¯Šæ–­ç¼–æ’
     - KnowledgeCRUDServiceï¼šç–¾ç—…CRUDæ“ä½œ
     - OntologyServiceï¼šæœ¬ä½“SchemaæŸ¥è¯¢
     - SnapshotServiceï¼šç‰ˆæœ¬å¿«ç…§ç®¡ç†
     - FeedbackServiceï¼šäººå·¥åé¦ˆè®°å½•

**é¢„ä¼°æ—¶é—´**ï¼š2.5å¤©ï¼ˆ20å°æ—¶ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**:
- è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬6ç«  APIè®¾è®¡ï¼ˆ6.1-6.7èŠ‚ï¼Œ26ä¸ªæ¥å£ï¼‰
- è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬7ç«  æœåŠ¡å±‚è®¾è®¡ï¼ˆ12ä¸ªServiceï¼‰
- è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬9ç«  æ•°æ®åº“è®¾è®¡ï¼ˆ9.1åŸºç¡€è¡¨+9.2æ‰©å±•è¡¨ï¼Œå…±8å¼ ï¼‰

---

#### P4.1 FastAPIåŸºç¡€æ¡†æ¶ï¼ˆ0.5å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°FastAPIåº”ç”¨ä¸»å…¥å£ï¼ˆ`apps/api/main.py`ï¼‰
2. é…ç½®CORSä¸­é—´ä»¶ï¼ˆå…è®¸å‰ç«¯è·¨åŸŸï¼‰
3. é…ç½®å¼‚å¸¸å¤„ç†å™¨ï¼ˆç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼ï¼‰
4. å®ç°ä¾èµ–æ³¨å…¥ï¼ˆ`apps/api/deps.py`ï¼‰ï¼š
   - `get_db_pool()`ï¼šPostgreSQLè¿æ¥æ± 
   - `get_redis_client()`ï¼šRediså®¢æˆ·ç«¯
   - `get_vlm_client()`ï¼šVLMå®¢æˆ·ç«¯
   - `get_knowledge_service()`ï¼šçŸ¥è¯†åº“æœåŠ¡
   - `get_diagnosis_service()`ï¼šè¯Šæ–­æœåŠ¡
5. å®ç°é…ç½®ç®¡ç†ï¼ˆ`core/config.py`ï¼‰ï¼šä» `.env` åŠ è½½é…ç½®

**äº§å‡ºç‰©**ï¼š
- `backend/apps/api/main.py`
- `backend/apps/api/deps.py`
- `backend/core/config.py`
- `backend/.env.example`

**éªŒæ”¶æ ‡å‡†ï¼ˆG4.1ï¼‰**ï¼š
- [ ] FastAPIæœåŠ¡å¯åŠ¨æˆåŠŸï¼ˆ`uvicorn apps.api.main:app --reload`ï¼‰
- [ ] `/docs` å¯è®¿é—®ï¼ˆSwagger UIè‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£ï¼‰
- [ ] ä¾èµ–æ³¨å…¥æµ‹è¯•é€šè¿‡ï¼ˆæ•°æ®åº“è¿æ¥æ± ã€Redisã€VLMå®¢æˆ·ç«¯å¯æ­£å¸¸è·å–ï¼‰
- [ ] é…ç½®ç®¡ç†æµ‹è¯•é€šè¿‡ï¼ˆä» `.env` è¯»å–é…ç½®ï¼‰
- [ ] CORSé…ç½®æ­£ç¡®ï¼ˆå‰ç«¯å¯è·¨åŸŸè°ƒç”¨ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.1å®Œæˆï¼ˆéœ€è¦APIæ¥å£å®šä¹‰ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬6.1èŠ‚ FastAPIåŸºç¡€é…ç½®

---

#### P4.2 è¯Šæ–­APIå®ç°ï¼ˆ1å¤©ï¼‰

**ğŸ”„ v2.0æ‰©å±•**: åŸºäºinterface1å’Œinterface2åŸå‹éœ€æ±‚ï¼Œå®ç°å®Œæ•´è¯Šæ–­API

**ä»»åŠ¡æ¸…å•**ï¼š

1. **å•å›¾è¯Šæ–­API**: `POST /api/v1/diagnosis/single`
   - æ¥æ”¶å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ ï¼ˆmultipart/form-dataï¼‰
   - è°ƒç”¨DiagnosisServiceæ‰§è¡Œå®Œæ•´è¯Šæ–­æµç¨‹
   - è¿”å›å®Œæ•´è¯Šæ–­ç»“æœï¼š
     - åŸºæœ¬ä¿¡æ¯ï¼ˆç–¾ç—…åç§°ã€ç½®ä¿¡åº¦ã€ç—…åŸä½“ï¼‰
     - VLMé—®ç­”å¯¹è¯¦æƒ…ï¼ˆQ0.0-Q0.5, Q1-Q6ï¼ŒåŒ…å«åŸå§‹é—®ç­”å¯¹å†…å®¹ï¼‰
     - ç‰¹å¾åŒ¹é…è¯¦æƒ…ï¼ˆæŒ‰æƒé‡åˆ†ç»„ï¼Œæ˜¾ç¤ºå¾—åˆ†ï¼‰
     - æ¨ç†ä¾æ®ï¼ˆåŒ¹é…æˆåŠŸçš„ç‰¹å¾ï¼‰

2. **æ‰¹é‡è¯Šæ–­API**: `POST /api/v1/diagnosis/batch`
   - æ¥æ”¶å¤šå¼ å›¾ç‰‡ä¸Šä¼ ï¼ˆæœ€å¤š50å¼ ï¼‰
   - å¼‚æ­¥å¤„ç†å¤šå¼ å›¾ç‰‡è¯Šæ–­
   - è¿”å›æ‰¹é‡è¯Šæ–­ç»“æœåˆ—è¡¨ï¼ˆåŒ…å«è¿›åº¦çŠ¶æ€ï¼‰

3. **è¯Šæ–­ç»“æœæŸ¥è¯¢API**: `GET /api/v1/diagnosis/result/{diagnosis_id}`
   - æ”¯æŒinterface2åŒå‡»æŸ¥çœ‹è¯¦æƒ…åŠŸèƒ½
   - è¿”å›å•ä¸ªè¯Šæ–­çš„å®Œæ•´ä¿¡æ¯ï¼ˆä¸å•å›¾è¯Šæ–­APIè¿”å›æ ¼å¼ä¸€è‡´ï¼‰

**æ¥å£åè®®è¯¦ç»†å®šä¹‰**ï¼ˆå‚è€ƒè®¾è®¡æ–‡æ¡£v2.0 ç¬¬6.2èŠ‚ï¼‰ï¼š

```yaml
# POST /api/v1/diagnosis/single
Request:
  ContentType: multipart/form-data
  Body:
    image: File (required) - å›¾ç‰‡æ–‡ä»¶ï¼Œæ”¯æŒJPG/PNGï¼Œæœ€å¤§10MB

Response:
  StatusCode: 200 OK
  ContentType: application/json
  Body:
    diagnosis_id: string        # è¯Šæ–­ID
    image_path: string           # å›¾ç‰‡å­˜å‚¨è·¯å¾„
    timestamp: string            # è¯Šæ–­æ—¶é—´
    disease:                     # è¯Šæ–­ç»“æœ
      disease_id: string         # ç–¾ç—…ID
      disease_name_zh: string    # ä¸­æ–‡åç§°
      disease_name_en: string    # è‹±æ–‡åç§°
      confidence: float          # ç½®ä¿¡åº¦ (0-1)
      pathogen: object           # ç—…åŸä½“ä¿¡æ¯
        type: string             # ç±»å‹ (fungal/bacterial/viral)
        species: string          # å­¦å
    vlm_qa_details:              # VLMé—®ç­”å¯¹è¯¦æƒ…
      q0_responses: array        # Q0.0-Q0.5è¿‡æ»¤é—®ç­”
        - question_id: string    # é—®é¢˜ID (q0_0)
          question_text: string  # åŸå§‹é—®é¢˜
          answer: string         # VLMåŸå§‹å›ç­”
          extracted_value: string # æå–çš„ç»“æ„åŒ–å€¼
          passed: boolean        # æ˜¯å¦é€šè¿‡
      q1_q6_responses: array     # Q1-Q6ç‰¹å¾æå–é—®ç­”
        - question_id: string    # é—®é¢˜ID (q1-q6)
          dimension: string      # ç‰¹å¾ç»´åº¦
          question_text: string  # åŸå§‹é—®é¢˜
          answer: string         # VLMåŸå§‹å›ç­”
          extracted_value: string # æå–çš„ç‰¹å¾å€¼
    feature_match_details:       # ç‰¹å¾åŒ¹é…è¯¦æƒ…
      total_score: int           # æ€»å¾—åˆ†
      max_score: int             # æœ€å¤§åˆ†æ•°
      match_percentage: float    # åŒ¹é…ç™¾åˆ†æ¯”
      feature_groups:            # æŒ‰æƒé‡åˆ†ç»„
        major_features: array    # ä¸»è¦ç‰¹å¾ (æƒé‡50%+)
          - dimension: string    # ç»´åº¦åç§°
            expected_value: string # æœŸæœ›å€¼
            actual_value: string # å®é™…å€¼
            match_status: string # åŒ¹é…çŠ¶æ€ (exact/fuzzy/mismatch)
            score: int           # å¾—åˆ†
            weight: float        # æƒé‡
        minor_features: array    # æ¬¡è¦ç‰¹å¾ (æƒé‡10-30%)
        optional_features: array # å¯é€‰ç‰¹å¾ (æƒé‡<10%)
    æ¨ç†ä¾æ®: array               # åŒ¹é…æˆåŠŸçš„å…³é”®ç‰¹å¾
      - ç—‡çŠ¶ç±»å‹: åæ­»æ–‘ç‚¹ âœ“
      - è¾¹ç¼˜é¢œè‰²: é»„è‰²æ™•åœˆ âœ“

Error Response:
  400 Bad Request:
    message: "Invalid image format"
  500 Internal Server Error:
    message: "VLM service unavailable"
```

**äº§å‡ºç‰©**ï¼š
- `backend/apps/api/routers/diagnosis.py`
- `backend/apps/api/schemas/diagnosis.py`
- `backend/apps/api/schemas/diagnosis_response.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG4.2ï¼‰**ï¼š
- [ ] å•å›¾è¯Šæ–­APIæµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨Postmanï¼‰
- [ ] æ‰¹é‡è¯Šæ–­APIæµ‹è¯•é€šè¿‡ï¼ˆä¸Šä¼ 5å¼ å›¾ç‰‡ï¼‰
- [ ] è¯Šæ–­ç»“æœæŸ¥è¯¢APIæµ‹è¯•é€šè¿‡
- [ ] è¿”å›æ•°æ®åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µï¼ˆVLMé—®ç­”å¯¹ã€ç‰¹å¾åŒ¹é…è¯¦æƒ…ï¼‰
- [ ] å“åº”æ ¼å¼ç¬¦åˆOpenAPIè§„èŒƒ
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®ï¼ˆå¦‚ä¸Šä¼ éå›¾ç‰‡æ–‡ä»¶ â†’ 400é”™è¯¯ï¼‰
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP3.3å®Œæˆï¼ˆéœ€è¦DiagnosisServiceï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬6.2èŠ‚ è¯Šæ–­APIè¯¦ç»†è®¾è®¡

**Postmanæµ‹è¯•æ­¥éª¤**ï¼š
1. å•å›¾è¯Šæ–­ï¼š
   - POST `http://localhost:8000/api/v1/diagnosis/single`
   - Body: form-dataï¼Œkey=`image`ï¼Œvalue=é€‰æ‹©ç«ç‘°é»‘æ–‘ç—…å›¾ç‰‡
   - éªŒè¯å“åº”åŒ…å«å®Œæ•´VLMé—®ç­”å¯¹å’Œç‰¹å¾åŒ¹é…è¯¦æƒ…

2. æ‰¹é‡è¯Šæ–­ï¼š
   - POST `http://localhost:8000/api/v1/diagnosis/batch`
   - Body: form-dataï¼Œkey=`images`ï¼Œvalue=é€‰æ‹©5å¼ ä¸åŒç–¾ç—…å›¾ç‰‡
   - éªŒè¯è¿”å›æ‰¹é‡è¯Šæ–­ç»“æœåˆ—è¡¨

---

#### P4.3 çŸ¥è¯†åº“ç®¡ç†APIå®ç°ï¼ˆ0.75å¤©ï¼‰

**âœ¨ v2.0æ–°å¢**: åŸºäºinterface4åŸå‹éœ€æ±‚ï¼Œå®ç°çŸ¥è¯†åº“CRUD API

**ä»»åŠ¡æ¸…å•**ï¼š

1. **çŸ¥è¯†åº“ç›®å½•æ ‘API**: `GET /api/v1/knowledge/tree`
   - è¿”å›æŒ‰å®¿ä¸»å±åˆ†ç»„çš„ç–¾ç—…æ ‘ç»“æ„
   - æ”¯æŒinterface4å·¦ä¾§ç›®å½•æ ‘å±•ç¤º

2. **ç–¾ç—…è¯¦æƒ…æŸ¥è¯¢API**: `GET /api/v1/knowledge/disease/{disease_id}`
   - è¿”å›ç–¾ç—…çš„å®Œæ•´çŸ¥è¯†æ•°æ®
   - åŒ…å«åŸºæœ¬ä¿¡æ¯ã€ç‰¹å¾ç»´åº¦ã€VLMæè¿°ã€æƒé‡

3. **ç–¾ç—…çŸ¥è¯†æ›´æ–°API**: `PUT /api/v1/knowledge/disease/{disease_id}`
   - æ”¯æŒç¼–è¾‘VLMå¯ç†è§£çš„æè¿°
   - æ”¯æŒè°ƒæ•´ç‰¹å¾æƒé‡
   - éªŒè¯æ•°æ®æ ¼å¼å¹¶ä¿å­˜åˆ°JSONæ–‡ä»¶

4. **ç–¾ç—…çŸ¥è¯†æ–°å¢API**: `POST /api/v1/knowledge/disease`
   - æ”¯æŒinterface4æ·»åŠ æ–°ç–¾ç—…

5. **ç–¾ç—…çŸ¥è¯†åˆ é™¤API**: `DELETE /api/v1/knowledge/disease/{disease_id}`
   - è½¯åˆ é™¤ç–¾ç—…çŸ¥è¯†ï¼ˆæ ‡è®°ä¸ºå·²åˆ é™¤ï¼‰

**æ¥å£åè®®è¯¦ç»†å®šä¹‰**ï¼ˆå‚è€ƒè®¾è®¡æ–‡æ¡£v2.0 ç¬¬6.3èŠ‚ï¼‰ï¼š

```yaml
# GET /api/v1/knowledge/tree
Response:
  StatusCode: 200 OK
  Body:
    hosts: array
      - genus: string           # å±å (å¦‚ "Rosa")
        name_zh: string         # ä¸­æ–‡å (å¦‚ "è”·è–‡å±")
        diseases: array         # è¯¥å±çš„æ‰€æœ‰ç–¾ç—…
          - disease_id: string  # ç–¾ç—…ID
            name_zh: string     # ä¸­æ–‡åç§°
    others: array               # å…¶ä»–é…ç½®æ–‡ä»¶
      - id: string
        name: string
        type: string            # ç±»å‹ (config/ontology)

# GET /api/v1/knowledge/disease/{disease_id}
Response:
  StatusCode: 200 OK
  Body:
    disease_id: string
    disease_name_zh: string
    disease_name_en: string
    pathogen: object
    host_genus: string
    feature_vector: object      # ç‰¹å¾å‘é‡ï¼ˆ8ä¸ªç»´åº¦ï¼‰
      symptom_type: string
      color_center: string
      color_border: string
      location: string
      size: string
      distribution: string
      coverage: string
      edge_clarity: string
    visual_descriptions: object # VLMå¯ç†è§£çš„æè¿°
      symptom_type:
        standard_value: string  # æ ‡å‡†å€¼
        terminology: string     # ä¸“ä¸šæœ¯è¯­
        vlm_descriptions:
          medical_imaging: string    # å½±åƒå­¦æè¿°
          everyday_language: string  # æ—¥å¸¸ç”¨è¯­
          spatial_positioning: string # ç©ºé—´å®šä½
      color_border:
        ...ï¼ˆç›¸åŒç»“æ„ï¼‰
    feature_importance: object  # ç‰¹å¾æƒé‡
      major_features: array     # ä¸»è¦ç‰¹å¾åŠæƒé‡
        - dimension: string
          weight: float
      minor_features: array
      optional_features: array

# PUT /api/v1/knowledge/disease/{disease_id}
Request:
  Body: (åŒGETå“åº”æ ¼å¼ï¼Œå…è®¸ä¿®æ”¹visual_descriptionså’Œfeature_importance)

Response:
  StatusCode: 200 OK
  Body:
    message: "Disease knowledge updated successfully"
    updated_at: string
```

**äº§å‡ºç‰©**ï¼š
- `backend/apps/api/routers/knowledge.py`
- `backend/apps/api/schemas/knowledge.py`
- `backend/services/knowledge_service.py`ï¼ˆæ‰©å±•CRUDæ–¹æ³•ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG4.3ï¼‰**ï¼š
- [ ] çŸ¥è¯†åº“ç›®å½•æ ‘APIæµ‹è¯•é€šè¿‡
- [ ] ç–¾ç—…è¯¦æƒ…æŸ¥è¯¢APIæµ‹è¯•é€šè¿‡
- [ ] ç–¾ç—…çŸ¥è¯†æ›´æ–°APIæµ‹è¯•é€šè¿‡ï¼ˆæ›´æ–°åé‡æ–°æŸ¥è¯¢éªŒè¯ï¼‰
- [ ] ç–¾ç—…çŸ¥è¯†æ–°å¢APIæµ‹è¯•é€šè¿‡
- [ ] ç–¾ç—…çŸ¥è¯†åˆ é™¤APIæµ‹è¯•é€šè¿‡
- [ ] æ›´æ–°åçš„çŸ¥è¯†ç«‹å³ç”Ÿæ•ˆï¼ˆåˆ·æ–°çŸ¥è¯†åº“ç¼“å­˜ï¼‰
- [ ] JSONæ–‡ä»¶æ ¼å¼éªŒè¯æ­£ç¡®

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP3.5å®Œæˆï¼ˆéœ€è¦KnowledgeServiceï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬6.3èŠ‚ çŸ¥è¯†åº“ç®¡ç†APIè¯¦ç»†è®¾è®¡

---

#### P4.4 æœ¬ä½“ç®¡ç†APIå®ç°ï¼ˆ0.25å¤©ï¼‰

**âœ¨ v2.0æ–°å¢**: åŸºäºinterface3åŸå‹éœ€æ±‚ï¼Œå®ç°æœ¬ä½“æŸ¥è¯¢API

**ä»»åŠ¡æ¸…å•**ï¼š

1. **æœ¬ä½“ç±»å‹åˆ—è¡¨API**: `GET /api/v1/ontology/list`
   - è¿”å›æ‰€æœ‰æœ¬ä½“ç±»å‹ï¼ˆç‰¹å¾æœ¬ä½“ã€ç–¾ç—…æœ¬ä½“ã€å®¿ä¸»æœ¬ä½“ã€æ²»ç–—æœ¬ä½“ï¼‰

2. **æœ¬ä½“SchemaæŸ¥è¯¢API**: `GET /api/v1/ontology/{type}`
   - è¿”å›æŒ‡å®šæœ¬ä½“çš„Schemaå®šä¹‰
   - åŒ…å«å­—æ®µå®šä¹‰ã€æšä¸¾å€¼ã€çº¦æŸè§„åˆ™
   - æ”¯æŒinterface3æœ¬ä½“ç»“æ„å±•ç¤º

**æ¥å£åè®®è¯¦ç»†å®šä¹‰**ï¼ˆå‚è€ƒè®¾è®¡æ–‡æ¡£v2.0 ç¬¬6.4èŠ‚ï¼‰ï¼š

```yaml
# GET /api/v1/ontology/list
Response:
  StatusCode: 200 OK
  Body:
    ontologies: array
      - type: string            # ç±»å‹æ ‡è¯† (feature/disease/host/treatment)
        name_zh: string         # ä¸­æ–‡åç§°
        name_en: string         # è‹±æ–‡åç§°
        file_path: string       # æ–‡ä»¶è·¯å¾„
        version: string         # ç‰ˆæœ¬å·
        updated_at: string      # æ›´æ–°æ—¶é—´

# GET /api/v1/ontology/feature
Response:
  StatusCode: 200 OK
  Body:
    type: "feature"
    name_zh: "ç‰¹å¾æœ¬ä½“"
    file_path: "knowledge_base/ontology/feature_ontology.json"
    version: "1.0"
    description: "å®šä¹‰å¯è§‚å¯Ÿç—…å®³ç‰¹å¾çš„ç»´åº¦å’Œæšä¸¾å€¼çº¦æŸ"
    dimensions: array           # ç»´åº¦åˆ—è¡¨
      - dimension_name: string  # ç»´åº¦åç§° (symptom_type)
        name_zh: string         # ä¸­æ–‡åç§°
        type: string            # æ•°æ®ç±»å‹ (enum)
        allowed_values: array   # å…è®¸å€¼åˆ—è¡¨
          - value: string       # å€¼ (necrosis_spot)
            label_zh: string    # ä¸­æ–‡æ ‡ç­¾
            label_en: string    # è‹±æ–‡æ ‡ç­¾
        fuzzy_matching_rules: object # æ¨¡ç³ŠåŒ¹é…è§„åˆ™
```

**äº§å‡ºç‰©**ï¼š
- `backend/apps/api/routers/ontology.py`
- `backend/apps/api/schemas/ontology.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG4.4ï¼‰**ï¼š
- [ ] æœ¬ä½“ç±»å‹åˆ—è¡¨APIæµ‹è¯•é€šè¿‡
- [ ] ç‰¹å¾æœ¬ä½“æŸ¥è¯¢APIæµ‹è¯•é€šè¿‡
- [ ] è¿”å›æ•°æ®æ ¼å¼ç¬¦åˆinterface3å±•ç¤ºéœ€æ±‚
- [ ] æšä¸¾å€¼å±•ç¤ºå®Œæ•´

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.3å®Œæˆï¼ˆéœ€è¦çŸ¥è¯†åº“åŠ è½½å™¨ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬6.4èŠ‚ æœ¬ä½“ç®¡ç†APIè¯¦ç»†è®¾è®¡

---

**P4é˜¶æ®µGateï¼ˆG4ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [ ] G4.1: FastAPIæœåŠ¡å¯åŠ¨æˆåŠŸï¼ŒSwagger UIå¯è®¿é—®
- [ ] G4.2: å•å›¾è¯Šæ–­APIæµ‹è¯•é€šè¿‡ï¼Œè¿”å›åŒ…å«å®Œæ•´VLMé—®ç­”å¯¹å’Œç‰¹å¾åŒ¹é…è¯¦æƒ…
- [ ] G4.3: æ‰¹é‡è¯Šæ–­APIæµ‹è¯•é€šè¿‡
- [ ] G4.4: çŸ¥è¯†åº“CRUD APIå…¨éƒ¨æµ‹è¯•é€šè¿‡
- [ ] G4.5: æœ¬ä½“ç®¡ç†APIæµ‹è¯•é€šè¿‡
- [ ] G4.6: æ‰€æœ‰æ¥å£åè®®å·²åœ¨è®¾è®¡æ–‡æ¡£v2.0ç¬¬6ç« æ¢³ç†å®Œæˆ
- [ ] G4.7: Postmanæµ‹è¯•é›†åˆå·²åˆ›å»ºå¹¶å…¨éƒ¨é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `backend/apps/api/` ä¸‹æ‰€æœ‰è·¯ç”±å’ŒSchemaæ–‡ä»¶
- [ ] OpenAPIè§„èŒƒæ–‡æ¡£ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼Œå¯é€šè¿‡/docsè®¿é—®ï¼‰
- [ ] Postmanæµ‹è¯•é›†åˆï¼ˆJSONå¯¼å‡ºæ–‡ä»¶ï¼‰
- [ ] æ¥å£åè®®æ¢³ç†æ–‡æ¡£ï¼ˆè®¾è®¡æ–‡æ¡£v2.0ç¬¬6ç« ï¼‰

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœAPIæµ‹è¯•å¤±è´¥ â†’ æ£€æŸ¥è·¯ç”±é…ç½®ã€Schemaå®šä¹‰ã€æœåŠ¡å±‚è°ƒç”¨
- å¦‚æœæ¥å£åè®®ä¸å®Œæ•´ â†’ è¡¥å……è®¾è®¡æ–‡æ¡£ç¬¬6ç« ï¼Œæ›´æ–°Swaggeræ³¨é‡Š
- å¦‚æœPostmanæµ‹è¯•ä¸é€šè¿‡ â†’ è°ƒè¯•APIï¼Œè®°å½•é—®é¢˜æ—¥å¿—

---

### P5: React/Vueå‰ç«¯å¼€å‘ ğŸ”„

**ğŸ”„ v2.0é‡å¤§ä¿®æ”¹**: æ”¹ä¸ºReact/Vueå•ä¸€æŠ€æœ¯æ ˆï¼Œå®ç°4ä¸ªå®Œæ•´ç•Œé¢

**ç›®æ ‡**ï¼šåŸºäºè¯¦ç»†è®¾è®¡ç¬¬15ç« å‰ç«¯æ¶æ„è®¾è®¡ï¼Œå®ç°4ä¸ªç•Œé¢ï¼ˆå•å›¾è¯Šæ–­ã€æ‰¹é‡è¯Šæ–­ã€æœ¬ä½“ç®¡ç†ã€çŸ¥è¯†åº“ç®¡ç†ï¼‰

**é¢„ä¼°æ—¶é—´**ï¼š4.5å¤©ï¼ˆ36å°æ—¶ï¼‰

**v2.0å·¥æœŸè°ƒæ•´è¯´æ˜**: ä»4å¤©å¢åŠ åˆ°4.5å¤©ï¼ˆ+0.5å¤©ï¼‰ï¼ŒåŸå› ï¼š
- ç•Œé¢2æ‰¹é‡è¯Šæ–­æ‰‹åŠ¨åˆ·æ–°æ–¹æ¡ˆå®ç°å¤æ‚åº¦é«˜ï¼ˆéœ€è¦è½®è¯¢å’ŒçŠ¶æ€ç®¡ç†ï¼‰
- ç•Œé¢4çŸ¥è¯†åº“ç®¡ç†çš„çŸ¥è¯†æ ‘å±•ç¤ºåŠŸèƒ½ï¼ˆæŒ‰å®¿ä¸»å±åˆ†ç»„ï¼‰éœ€è¦é¢å¤–å¼€å‘æ—¶é—´
- 4ä¸ªç•Œé¢çš„æ ·å¼ä¸åŸå‹åŒ¹é…å·¥ä½œé‡è¾ƒå¤§

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**:
- è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬15ç«  å‰ç«¯æ¶æ„è®¾è®¡ï¼ˆ15.2-15.7èŠ‚ï¼‰
- 15.2èŠ‚ï¼šç•Œé¢1ç»„ä»¶è®¾è®¡ã€æ•°æ®æµã€çŠ¶æ€ç®¡ç†
- 15.3èŠ‚ï¼šç•Œé¢2ç»„ä»¶è®¾è®¡ï¼ˆæ‰¹é‡è¯Šæ–­æ‰‹åŠ¨åˆ·æ–°æ–¹æ¡ˆï¼‰
- 15.4èŠ‚ï¼šç•Œé¢3ç»„ä»¶è®¾è®¡
- 15.5èŠ‚ï¼šç•Œé¢4ç»„ä»¶è®¾è®¡ï¼ˆçŸ¥è¯†åº“æ ‘ï¼‰
- 15.6èŠ‚ï¼šå…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆZustand storesï¼‰
- 15.7èŠ‚ï¼šAPI Clientå±‚è®¾è®¡

**æŠ€æœ¯é€‰å‹**ï¼š
- æ¨èä½¿ç”¨ **React 18** + **Ant Design** + **TypeScript**
- æˆ–ä½¿ç”¨ **Vue 3** + **Element Plus** + **TypeScript**
- çŠ¶æ€ç®¡ç†ï¼šZustandï¼ˆReactï¼‰æˆ– Piniaï¼ˆVueï¼‰
- HTTPå®¢æˆ·ç«¯ï¼šAxios + React Query

---

#### P5.1 é¡¹ç›®åˆå§‹åŒ–ä¸é€šç”¨ç»„ä»¶ï¼ˆ0.5å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. åˆ›å»ºå‰ç«¯é¡¹ç›®ï¼ˆä½¿ç”¨Vite + React/Vue + TypeScriptï¼‰
2. é…ç½®è·¯ç”±ï¼ˆReact Router v6 æˆ– Vue Router v4ï¼‰
3. é…ç½®çŠ¶æ€ç®¡ç†ï¼ˆZustandæˆ–Piniaï¼‰
4. é…ç½®HTTPå®¢æˆ·ç«¯ï¼ˆAxios + React Query/VueUseï¼‰
5. é…ç½®UIç»„ä»¶åº“ï¼ˆAnt Designæˆ–Element Plusï¼‰
6. å®ç°é€šç”¨ç»„ä»¶ï¼š
   - `Header` å¯¼èˆªæ 
   - `Loading` åŠ è½½ç»„ä»¶
   - `Toast` æç¤ºç»„ä»¶
   - `Modal` å¯¹è¯æ¡†ç»„ä»¶
7. é…ç½®ä»£ç†ï¼ˆå¼€å‘ç¯å¢ƒè°ƒç”¨åç«¯APIï¼‰

**ç›®å½•ç»“æ„**ï¼ˆå‚è€ƒè®¾è®¡æ–‡æ¡£v2.0 é™„å½•Bï¼‰ï¼š

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                    # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ client.ts           # Axiosé…ç½®
â”‚   â”‚   â”œâ”€â”€ diagnosis.ts        # è¯Šæ–­API
â”‚   â”‚   â”œâ”€â”€ knowledge.ts        # çŸ¥è¯†åº“API
â”‚   â”‚   â””â”€â”€ ontology.ts         # æœ¬ä½“API
â”‚   â”œâ”€â”€ components/             # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/             # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ diagnosis/          # è¯Šæ–­ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ batch/              # æ‰¹é‡è¯Šæ–­ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ontology/           # æœ¬ä½“ç»„ä»¶
â”‚   â”‚   â””â”€â”€ knowledge/          # çŸ¥è¯†ç®¡ç†ç»„ä»¶
â”‚   â”œâ”€â”€ pages/                  # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ SingleDiagnosis/    # ç•Œé¢1
â”‚   â”‚   â”œâ”€â”€ BatchDiagnosis/     # ç•Œé¢2
â”‚   â”‚   â”œâ”€â”€ OntologyManagement/ # ç•Œé¢3
â”‚   â”‚   â””â”€â”€ KnowledgeManagement/# ç•Œé¢4
â”‚   â”œâ”€â”€ store/                  # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ types/                  # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ main.tsx
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ tsconfig.json
```

**äº§å‡ºç‰©**ï¼š
- `frontend/` é¡¹ç›®ç›®å½•
- `frontend/src/components/common/` é€šç”¨ç»„ä»¶
- `frontend/src/api/client.ts` APIå®¢æˆ·ç«¯
- `frontend/vite.config.ts` ä»£ç†é…ç½®

**éªŒæ”¶æ ‡å‡†ï¼ˆG5.1ï¼‰**ï¼š
- [ ] å‰ç«¯é¡¹ç›®å¯åŠ¨æˆåŠŸï¼ˆ`npm run dev`ï¼‰
- [ ] è·¯ç”±é…ç½®æ­£ç¡®ï¼ˆ4ä¸ªé¡µé¢è·¯ç”±ï¼‰
- [ ] APIå®¢æˆ·ç«¯å¯æ­£å¸¸è°ƒç”¨åç«¯ï¼ˆæµ‹è¯•GET /api/v1/ontology/listï¼‰
- [ ] é€šç”¨ç»„ä»¶æ¸²æŸ“æ­£å¸¸

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬15.2èŠ‚ å‰ç«¯é¡¹ç›®åˆå§‹åŒ–ï¼ˆ15.2.1-15.2.2ï¼‰

---

#### P5.2 ç•Œé¢1: å•å›¾è¯Šæ–­ï¼ˆ1å¤©ï¼‰

**å‚è€ƒåŸå‹**: `docs/prototypes/interface1_single_diagnosis.html`

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°ä¸Šä¼ åŒºåŸŸï¼ˆæ”¯æŒæ‹–æ‹½å’Œç‚¹å‡»ä¸Šä¼ ï¼‰
2. å®ç°å›¾ç‰‡é¢„è§ˆåŒºåŸŸ
3. å®ç°"å¼€å§‹æ£€æµ‹"æŒ‰é’®å’ŒåŠ è½½çŠ¶æ€
4. å®ç°è¯Šæ–­ç»“æœå±•ç¤ºåŒºï¼š
   - å›¾ç‰‡å±•ç¤º + è¯Šæ–­ç»“æœå¡ç‰‡
   - VLMé—®ç­”å¯¹è¯¦æƒ…ï¼ˆå¯å±•å¼€ï¼Œå¸¦åŸå§‹é—®ç­”å¯¹å†…å®¹ï¼‰
     - Q0.0-Q0.5è¿‡æ»¤é—®ç­”ï¼ˆå¸¦é€šè¿‡/å¤±è´¥æ ‡è®°ï¼‰
     - Q1-Q6ç‰¹å¾æå–é—®ç­”ï¼ˆå¸¦ç»´åº¦åç§°ï¼‰
   - ç‰¹å¾åŒ¹é…è¯¦æƒ…ï¼ˆå¯å±•å¼€ï¼Œå¸¦æƒé‡å’Œå¾—åˆ†ï¼‰
     - æŒ‰æƒé‡åˆ†ç»„ï¼ˆä¸»è¦/æ¬¡è¦/å¯é€‰ï¼‰
     - æ˜¾ç¤ºåŒ¹é…çŠ¶æ€ï¼ˆå®Œå…¨åŒ¹é…âœ“ã€æ¨¡ç³ŠåŒ¹é…~ã€æœªåŒ¹é…âœ—ï¼‰
5. å¯¹æ¥ `POST /api/v1/diagnosis/single` API
6. é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `UploadArea.tsx` - ä¸Šä¼ åŒºåŸŸ
- `ImagePreview.tsx` - å›¾ç‰‡é¢„è§ˆ
- `DiagnosisResult.tsx` - è¯Šæ–­ç»“æœå¡ç‰‡
- `QADetails.tsx` - VLMé—®ç­”å¯¹è¯¦æƒ…
- `FeatureMatchDetails.tsx` - ç‰¹å¾åŒ¹é…è¯¦æƒ…

**äº§å‡ºç‰©**ï¼š
- `frontend/src/pages/SingleDiagnosis/` é¡µé¢ç»„ä»¶
- `frontend/src/components/diagnosis/` è¯Šæ–­ç›¸å…³ç»„ä»¶

**éªŒæ”¶æ ‡å‡†ï¼ˆG5.2ï¼‰**ï¼š
- [ ] ä¸Šä¼ â†’é¢„è§ˆâ†’æ£€æµ‹â†’ç»“æœå±•ç¤ºæµç¨‹å®Œæ•´
- [ ] VLMé—®ç­”å¯¹å¯å±•å¼€æŸ¥çœ‹åŸå§‹å†…å®¹ï¼ˆQ0.0-Q0.5å’ŒQ1-Q6ï¼‰
- [ ] ç‰¹å¾åŒ¹é…è¯¦æƒ…å±•ç¤ºæ­£ç¡®ï¼ˆæŒ‰æƒé‡åˆ†ç»„ï¼Œæ˜¾ç¤ºå¾—åˆ†ï¼‰
- [ ] æ ·å¼ä¸åŸå‹ä¸€è‡´ï¼ˆå¸ƒå±€ã€é¢œè‰²ã€å­—ä½“ï¼‰
- [ ] åŠ è½½çŠ¶æ€å’Œé”™è¯¯æç¤ºæ­£å¸¸
- [ ] APIè°ƒç”¨æˆåŠŸï¼Œæ•°æ®å±•ç¤ºæ­£ç¡®

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬15.2èŠ‚ å•å›¾è¯Šæ–­ç•Œé¢è®¾è®¡

---

#### P5.3 ç•Œé¢2: æ‰¹é‡è¯Šæ–­ï¼ˆ1å¤©ï¼‰

**å‚è€ƒåŸå‹**: `docs/prototypes/interface2_batch_diagnosis.html`

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°æ–‡ä»¶ä¸Šä¼ åŒºï¼ˆæ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ ï¼Œæœ€å¤š50å¼ ï¼‰
2. å®ç°ä¸Šä¼ è¿›åº¦æ¡
3. å®ç°ç»“æœåˆ—è¡¨å±•ç¤ºï¼š
   - æ˜¾ç¤ºå½“å‰æŸ¥çœ‹çš„å›¾ç‰‡ï¼ˆå¤§å›¾å±•ç¤ºï¼‰
   - æ˜¾ç¤ºè¯Šæ–­ç»“æœæ‘˜è¦ï¼ˆæ–‡ä»¶åã€ç–¾ç—…åç§°ã€ç½®ä¿¡åº¦ã€å…³é”®ç‰¹å¾ï¼‰
   - ç¿»é¡µæ§åˆ¶ï¼ˆä¸Šä¸€å¼ /ä¸‹ä¸€å¼ ï¼Œæ˜¾ç¤ºåºå·/æ€»æ•°ï¼‰
4. å®ç°åº•éƒ¨ç»“æœåˆ—è¡¨ï¼ˆç¼©ç•¥ï¼‰ï¼š
   - æ¯è¡Œæ˜¾ç¤ºï¼šåºå·ã€æ–‡ä»¶åã€è¯Šæ–­ç»“æœã€ç½®ä¿¡åº¦ã€[æŸ¥çœ‹]æŒ‰é’®
   - é«˜äº®æ˜¾ç¤ºå½“å‰æ­£åœ¨æŸ¥çœ‹çš„å›¾ç‰‡
   - æ”¯æŒç‚¹å‡»å¿«é€Ÿè·³è½¬
5. å®ç°åŒå‡»æŸ¥çœ‹è¯¦æƒ…åŠŸèƒ½ï¼š
   - åŒå‡»ç»“æœå¡ç‰‡æ‰“å¼€Modal
   - Modalæ˜¾ç¤ºå®Œæ•´è¯Šæ–­ä¿¡æ¯ï¼ˆä¸ç•Œé¢1æ ¼å¼ä¸€è‡´ï¼‰
   - åŒ…å«VLMé—®ç­”å¯¹è¯¦æƒ…å’Œç‰¹å¾åŒ¹é…è¯¦æƒ…
6. å®ç°å¯¼å‡ºExcelåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
7. å¯¹æ¥ `POST /api/v1/diagnosis/batch` API
8. å¯¹æ¥ `GET /api/v1/diagnosis/result/{diagnosis_id}` APIï¼ˆåŒå‡»æ—¶è°ƒç”¨ï¼‰

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `BatchUpload.tsx` - æ‰¹é‡ä¸Šä¼ 
- `ResultList.tsx` - ç»“æœåˆ—è¡¨
- `ResultCard.tsx` - ç»“æœå¡ç‰‡
- `DetailModal.tsx` - è¯¦æƒ…æ¨¡æ€æ¡†

**äº§å‡ºç‰©**ï¼š
- `frontend/src/pages/BatchDiagnosis/` é¡µé¢ç»„ä»¶
- `frontend/src/components/batch/` æ‰¹é‡è¯Šæ–­ç»„ä»¶

**éªŒæ”¶æ ‡å‡†ï¼ˆG5.3ï¼‰**ï¼š
- [ ] æ‰¹é‡ä¸Šä¼ å’Œè¯Šæ–­æµç¨‹å®Œæ•´
- [ ] åŒå‡»å¡ç‰‡å¯æŸ¥çœ‹è¯¦ç»†è¯Šæ–­ç»“æœï¼ˆModalå±•ç¤ºï¼‰
- [ ] æ”¯æŒç¿»é¡µæŸ¥çœ‹å¤šå¼ å›¾ç‰‡ï¼ˆä¸Šä¸€å¼ /ä¸‹ä¸€å¼ ï¼‰
- [ ] åº•éƒ¨ç»“æœåˆ—è¡¨å±•ç¤ºæ­£å¸¸ï¼Œé«˜äº®å½“å‰å›¾ç‰‡
- [ ] æ ·å¼ä¸åŸå‹ä¸€è‡´
- [ ] APIè°ƒç”¨æˆåŠŸï¼Œæ•°æ®å±•ç¤ºæ­£ç¡®

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬15.3èŠ‚ æ‰¹é‡è¯Šæ–­ç•Œé¢è®¾è®¡

---

#### P5.4 ç•Œé¢3: æœ¬ä½“ç»“æ„ç®¡ç†ï¼ˆ0.5å¤©ï¼‰

**å‚è€ƒåŸå‹**: `docs/prototypes/interface3_ontology_management.html`

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°å·¦ä¾§æœ¬ä½“ç±»å‹åˆ—è¡¨
2. å®ç°å³ä¾§æœ¬ä½“ç»“æ„å±•ç¤ºåŒºï¼š
   - æ˜¾ç¤ºæœ¬ä½“å…ƒä¿¡æ¯ï¼ˆæ–‡ä»¶åã€ç‰ˆæœ¬ã€æ›´æ–°æ—¶é—´ã€æè¿°ï¼‰
   - æ˜¾ç¤ºç»´åº¦åˆ—è¡¨ï¼ˆåŒ…å«ç»´åº¦æ•°é‡ï¼‰
   - æ”¯æŒå±•å¼€/æŠ˜å æŸ¥çœ‹è¯¦ç»†å®šä¹‰
3. å®ç°ç»´åº¦è¯¦æƒ…å±•ç¤ºï¼š
   - ç»´åº¦åç§°ï¼ˆä¸­è‹±æ–‡ï¼‰
   - æ•°æ®ç±»å‹
   - æšä¸¾å€¼åˆ—è¡¨ï¼ˆå¯å±•å¼€ï¼‰
   - æ¯ä¸ªæšä¸¾å€¼æ˜¾ç¤ºï¼šå€¼ã€ä¸­æ–‡æ ‡ç­¾ã€è‹±æ–‡æ ‡ç­¾
4. å®ç°æ¨¡ç³ŠåŒ¹é…è§„åˆ™å±•ç¤ºï¼ˆå¯é€‰ï¼‰
5. å¯¹æ¥ `GET /api/v1/ontology/list` API
6. å¯¹æ¥ `GET /api/v1/ontology/{type}` API

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `OntologyList.tsx` - æœ¬ä½“ç±»å‹åˆ—è¡¨
- `OntologyDetail.tsx` - æœ¬ä½“è¯¦æƒ…å±•ç¤º
- `DimensionCard.tsx` - ç»´åº¦å¡ç‰‡

**äº§å‡ºç‰©**ï¼š
- `frontend/src/pages/OntologyManagement/` é¡µé¢ç»„ä»¶
- `frontend/src/components/ontology/` æœ¬ä½“ç»„ä»¶

**éªŒæ”¶æ ‡å‡†ï¼ˆG5.4ï¼‰**ï¼š
- [ ] æœ¬ä½“ç±»å‹åˆ‡æ¢æ­£å¸¸
- [ ] ç»´åº¦å’Œæšä¸¾å€¼å±•ç¤ºæ­£ç¡®
- [ ] å±•å¼€/æŠ˜å åŠŸèƒ½æ­£å¸¸
- [ ] æ ·å¼ä¸åŸå‹ä¸€è‡´
- [ ] APIè°ƒç”¨æˆåŠŸï¼Œæ•°æ®å±•ç¤ºæ­£ç¡®

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬15.4èŠ‚ æœ¬ä½“ç®¡ç†ç•Œé¢è®¾è®¡

---

#### P5.5 ç•Œé¢4: çŸ¥è¯†è¯¦æƒ…ç®¡ç†ï¼ˆ1å¤©ï¼‰

**å‚è€ƒåŸå‹**: `docs/prototypes/interface4_knowledge_management.html`

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°å·¦ä¾§çŸ¥è¯†åº“ç›®å½•æ ‘ï¼š
   - æŒ‰å®¿ä¸»å±åˆ†ç»„ï¼ˆçˆ¶èŠ‚ç‚¹ï¼‰
   - æ¯ä¸ªå®¿ä¸»å±ä¸‹åˆ—å‡ºç–¾ç—…ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰
   - æ”¯æŒå±•å¼€/æŠ˜å 
   - åº•éƒ¨"å…¶ä»–"åŒºåŸŸï¼ˆæŠ˜å ï¼‰æ”¾ç½®é…ç½®æ–‡ä»¶
2. å®ç°å³ä¾§ç–¾ç—…è¯¦æƒ…å±•ç¤ºåŒºï¼š
   - åŸºæœ¬ä¿¡æ¯å¡ç‰‡ï¼ˆç–¾ç—…IDã€ç—…åŸä½“ã€å®¿ä¸»ï¼‰
   - å¤šç»´åº¦ç‰¹å¾å¡ç‰‡ï¼ˆ8ä¸ªç»´åº¦ï¼‰
     - æ¯ä¸ªç»´åº¦å¸¦æœ¬ä½“æ ‡è¯†badgeï¼ˆ"ç‰¹å¾æœ¬ä½“"ï¼‰
     - æ˜¾ç¤ºæ ‡å‡†å€¼ã€æœ¯è¯­ã€VLMæè¿°ã€æƒé‡
     - VLMæè¿°åŒ…å«ï¼šå½±åƒå­¦æè¿°ã€æ—¥å¸¸ç”¨è¯­ã€ç©ºé—´å®šä½
   - æ²»ç–—çŸ¥è¯†åŒºåŸŸï¼ˆå¯æŠ˜å ï¼Œé¢„ç•™æ¥å£ï¼‰
3. å®ç°ç¼–è¾‘åŠŸèƒ½ï¼š
   - ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®è¿›å…¥ç¼–è¾‘æ¨¡å¼
   - æ”¯æŒç¼–è¾‘VLMå¯ç†è§£çš„æè¿°
   - æ”¯æŒè°ƒæ•´ç‰¹å¾æƒé‡
   - å®æ—¶é¢„è§ˆä¿®æ”¹æ•ˆæœ
4. å®ç°ä¿å­˜å’ŒéªŒè¯ï¼š
   - ä¿å­˜å‰éªŒè¯æ•°æ®æ ¼å¼
   - è°ƒç”¨APIä¿å­˜ä¿®æ”¹
   - æ˜¾ç¤ºä¿å­˜æˆåŠŸ/å¤±è´¥æç¤º
5. å¯¹æ¥ `GET /api/v1/knowledge/tree` API
6. å¯¹æ¥ `GET /api/v1/knowledge/disease/{disease_id}` API
7. å¯¹æ¥ `PUT /api/v1/knowledge/disease/{disease_id}` API

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `KnowledgeTree.tsx` - çŸ¥è¯†åº“ç›®å½•æ ‘
- `DiseaseDetail.tsx` - ç–¾ç—…è¯¦æƒ…å±•ç¤º
- `DimensionCard.tsx` - ç»´åº¦å¡ç‰‡
- `VLMDescriptionEditor.tsx` - VLMæè¿°ç¼–è¾‘å™¨

**äº§å‡ºç‰©**ï¼š
- `frontend/src/pages/KnowledgeManagement/` é¡µé¢ç»„ä»¶
- `frontend/src/components/knowledge/` çŸ¥è¯†ç®¡ç†ç»„ä»¶

**éªŒæ”¶æ ‡å‡†ï¼ˆG5.5ï¼‰**ï¼š
- [ ] ç›®å½•æ ‘å±•ç¤ºæ­£å¸¸ï¼ˆæŒ‰å®¿ä¸»å±åˆ†ç»„ï¼‰
- [ ] ç–¾ç—…è¯¦æƒ…å±•ç¤ºå®Œæ•´ï¼ˆå«æœ¬ä½“æ ‡è¯†badgeï¼‰
- [ ] ç¼–è¾‘å’Œä¿å­˜åŠŸèƒ½æ­£å¸¸
- [ ] VLMæè¿°æ ¼å¼æ­£ç¡®ï¼ˆå½±åƒå­¦ã€æ—¥å¸¸ç”¨è¯­ã€ç©ºé—´å®šä½ï¼‰
- [ ] æ ·å¼ä¸åŸå‹ä¸€è‡´
- [ ] APIè°ƒç”¨æˆåŠŸï¼Œæ•°æ®å±•ç¤ºæ­£ç¡®

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬15.5èŠ‚ çŸ¥è¯†ç®¡ç†ç•Œé¢è®¾è®¡

---

**P5é˜¶æ®µGateï¼ˆG5ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [ ] G5.1: å‰ç«¯é¡¹ç›®åˆå§‹åŒ–å®Œæˆï¼Œé€šç”¨ç»„ä»¶å¯ç”¨
- [ ] G5.2: ç•Œé¢1å•å›¾è¯Šæ–­å®Œæ•´å¯ç”¨ï¼Œæ ·å¼ä¸åŸå‹ä¸€è‡´
- [ ] G5.3: ç•Œé¢2æ‰¹é‡è¯Šæ–­å®Œæ•´å¯ç”¨ï¼ŒåŒå‡»æŸ¥çœ‹è¯¦æƒ…æ­£å¸¸
- [ ] G5.4: ç•Œé¢3æœ¬ä½“ç®¡ç†å®Œæ•´å¯ç”¨ï¼Œå±•å¼€/æŠ˜å æ­£å¸¸
- [ ] G5.5: ç•Œé¢4çŸ¥è¯†ç®¡ç†å®Œæ•´å¯ç”¨ï¼Œç¼–è¾‘ä¿å­˜æ­£å¸¸
- [ ] G5.6: æ‰€æœ‰ç•Œé¢æ ·å¼ä¸åŸå‹ä¸€è‡´ï¼Œæ— æ˜æ˜¾è§†è§‰å·®å¼‚
- [ ] G5.7: å‰ç«¯æ„å»ºæˆåŠŸï¼ˆ`npm run build`ï¼‰

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `frontend/src/` ä¸‹æ‰€æœ‰é¡µé¢å’Œç»„ä»¶
- [ ] å‰ç«¯æ„å»ºäº§ç‰©ï¼ˆ`frontend/dist/`ï¼‰
- [ ] å‰ç«¯å¼€å‘æ–‡æ¡£ï¼ˆREADME.mdï¼‰

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœæ ·å¼ä¸åŸå‹ä¸ä¸€è‡´ â†’ å¯¹ç…§åŸå‹HTMLï¼Œè°ƒæ•´CSS
- å¦‚æœAPIè°ƒç”¨å¤±è´¥ â†’ æ£€æŸ¥APIå®¢æˆ·ç«¯é…ç½®ï¼Œæ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
- å¦‚æœç»„ä»¶æ¸²æŸ“å¼‚å¸¸ â†’ æ£€æŸ¥TypeScriptç±»å‹å®šä¹‰ï¼Œæ£€æŸ¥æ•°æ®æ ¼å¼

---

### P6: å‰åç«¯è”è°ƒ âœ¨

**âœ¨ v2.0æ–°å¢é˜¶æ®µ**: ç¡®ä¿å‰åç«¯å®Œå…¨è”é€šï¼Œç«¯åˆ°ç«¯æµç¨‹ç•…é€š

**ç›®æ ‡**ï¼šå®Œæˆå‰åç«¯APIå¯¹æ¥ï¼ŒéªŒè¯æ‰€æœ‰åŠŸèƒ½æµç¨‹ï¼Œæ‰§è¡Œç¬¬16.5èŠ‚çš„20+è”è°ƒæµ‹è¯•ç”¨ä¾‹

**é¢„ä¼°æ—¶é—´**ï¼š1.5å¤©ï¼ˆ12å°æ—¶ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**:
- è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬16ç«  å‰åç«¯è”è°ƒæŒ‡å—
- 16.1èŠ‚ï¼šè”è°ƒç¯å¢ƒé…ç½®ï¼ˆCORS + Vite Proxyï¼‰
- 16.2èŠ‚ï¼šè”è°ƒæµ‹è¯•æµç¨‹
- 16.5èŠ‚ï¼šè”è°ƒæµ‹è¯•ç”¨ä¾‹æ¸…å•ï¼ˆ20+åœºæ™¯ï¼Œå¿…é¡»å…¨éƒ¨æ‰§è¡Œï¼‰
  - TC-S01~S05ï¼šç•Œé¢1å•å›¾è¯Šæ–­æµ‹è¯•
  - TC-B01~B05ï¼šç•Œé¢2æ‰¹é‡è¯Šæ–­æµ‹è¯•
  - TC-O01~O03ï¼šç•Œé¢3æœ¬ä½“ç®¡ç†æµ‹è¯•
  - TC-K01~K07ï¼šç•Œé¢4çŸ¥è¯†åº“ç®¡ç†æµ‹è¯•
  - TC-E01~E02ï¼šé”™è¯¯å¤„ç†æµ‹è¯•

---

#### P6.1 APIå¯¹æ¥è°ƒè¯•ï¼ˆ0.75å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. é…ç½®å‰ç«¯ä»£ç†ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼š
   - Viteé…ç½®ä»£ç†ï¼Œå°†`/api`è¯·æ±‚è½¬å‘åˆ°`http://localhost:8000`
2. è°ƒè¯•æ‰€æœ‰APIè°ƒç”¨ï¼š
   - è¯Šæ–­APIï¼ˆå•å›¾ã€æ‰¹é‡ã€ç»“æœæŸ¥è¯¢ï¼‰
   - çŸ¥è¯†åº“APIï¼ˆç›®å½•æ ‘ã€è¯¦æƒ…æŸ¥è¯¢ã€æ›´æ–°ï¼‰
   - æœ¬ä½“APIï¼ˆç±»å‹åˆ—è¡¨ã€SchemaæŸ¥è¯¢ï¼‰
3. å¤„ç†è·¨åŸŸé—®é¢˜ï¼š
   - ç¡®ä¿FastAPI CORSé…ç½®æ­£ç¡®
   - éªŒè¯OPTIONSé¢„æ£€è¯·æ±‚é€šè¿‡
4. å¤„ç†é”™è¯¯å“åº”ï¼š
   - ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼ˆ400/404/500ï¼‰
   - æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
5. ä¼˜åŒ–åŠ è½½çŠ¶æ€ï¼š
   - æ·»åŠ LoadingæŒ‡ç¤ºå™¨
   - æ·»åŠ éª¨æ¶å±ï¼ˆSkeletonï¼‰
   - ä¼˜åŒ–ç”¨æˆ·ç­‰å¾…ä½“éªŒ

**äº§å‡ºç‰©**ï¼š
- `frontend/vite.config.ts` ä»£ç†é…ç½®
- `frontend/src/utils/errorHandler.ts` é”™è¯¯å¤„ç†å·¥å…·
- APIå¯¹æ¥è°ƒè¯•æ—¥å¿—

**éªŒæ”¶æ ‡å‡†ï¼ˆG6.1ï¼‰**ï¼š
- [ ] æ‰€æœ‰APIè°ƒç”¨æˆåŠŸï¼ˆæ— CORSé”™è¯¯ï¼‰
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®ï¼ˆæ˜¾ç¤ºå‹å¥½æç¤ºï¼‰
- [ ] åŠ è½½çŠ¶æ€æ˜¾ç¤ºæ­£ç¡®ï¼ˆLoadingã€éª¨æ¶å±ï¼‰
- [ ] OPTIONSé¢„æ£€è¯·æ±‚é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP4å®Œæˆï¼ˆåç«¯APIï¼‰+ P5å®Œæˆï¼ˆå‰ç«¯ç•Œé¢ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬16.1èŠ‚ APIå¯¹æ¥è°ƒè¯•

---

#### P6.2 ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•ï¼ˆ0.75å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š

1. **æµ‹è¯•å•å›¾è¯Šæ–­å®Œæ•´æµç¨‹**ï¼š
   - ä¸Šä¼ ç«ç‘°é»‘æ–‘ç—…å›¾ç‰‡ï¼ˆ`tests/fixtures/rose_black_spot.jpg`ï¼‰
   - éªŒè¯VLMè°ƒç”¨æˆåŠŸï¼ˆæŸ¥çœ‹Networkè¯·æ±‚ï¼‰
   - éªŒè¯è¯Šæ–­ç»“æœæ­£ç¡®ï¼ˆç–¾ç—…åç§°ã€ç½®ä¿¡åº¦ï¼‰
   - éªŒè¯VLMé—®ç­”å¯¹è¯¦æƒ…å±•ç¤ºå®Œæ•´ï¼ˆQ0.0-Q0.5, Q1-Q6ï¼‰
   - éªŒè¯ç‰¹å¾åŒ¹é…è¯¦æƒ…å±•ç¤ºæ­£ç¡®ï¼ˆæŒ‰æƒé‡åˆ†ç»„ï¼‰
   - è®°å½•æµ‹è¯•ç»“æœï¼ˆæˆªå›¾+æ—¥å¿—ï¼‰

2. **æµ‹è¯•æ‰¹é‡è¯Šæ–­æµç¨‹**ï¼š
   - ä¸Šä¼ 5å¼ ä¸åŒç–¾ç—…å›¾ç‰‡
   - éªŒè¯æ‰¹é‡è¯Šæ–­æˆåŠŸï¼ˆè¿›åº¦æ¡æ˜¾ç¤ºï¼‰
   - éªŒè¯ç¿»é¡µåŠŸèƒ½æ­£å¸¸
   - éªŒè¯åŒå‡»æŸ¥çœ‹è¯¦æƒ…æ­£å¸¸ï¼ˆModalå±•ç¤ºå®Œæ•´ä¿¡æ¯ï¼‰
   - è®°å½•æµ‹è¯•ç»“æœ

3. **æµ‹è¯•çŸ¥è¯†åº“ç®¡ç†æµç¨‹**ï¼š
   - æŸ¥çœ‹ç«ç‘°é»‘æ–‘ç—…è¯¦æƒ…
   - ç¼–è¾‘"è¾¹ç¼˜é¢œè‰²"ç»´åº¦çš„VLMæè¿°
     - ä¿®æ”¹æ—¥å¸¸ç”¨è¯­ï¼šæ·»åŠ "åƒæ‰‹ç”µç­’ç…§å°„æ—¶å‘¨å›´çš„é»„è‰²å…‰åœˆ"
   - ä¿å­˜å¹¶éªŒè¯ç”Ÿæ•ˆ
   - é‡æ–°ä¸Šä¼ ç«ç‘°é»‘æ–‘ç—…å›¾ç‰‡è¯Šæ–­
   - éªŒè¯çŸ¥è¯†æ›´æ–°æ˜¯å¦å½±å“è¯Šæ–­ç»“æœ
   - è®°å½•æµ‹è¯•ç»“æœ

4. **æµ‹è¯•æœ¬ä½“ç®¡ç†æµç¨‹**ï¼š
   - æŸ¥çœ‹ç‰¹å¾æœ¬ä½“Schema
   - éªŒè¯ç»´åº¦å’Œæšä¸¾å€¼å±•ç¤ºæ­£ç¡®
   - éªŒè¯å±•å¼€/æŠ˜å åŠŸèƒ½æ­£å¸¸
   - è®°å½•æµ‹è¯•ç»“æœ

5. **è®°å½•æ‰€æœ‰é—®é¢˜å¹¶ä¿®å¤**ï¼š
   - åˆ›å»ºé—®é¢˜æ¸…å•ï¼ˆBug Listï¼‰
   - ä¼˜å…ˆçº§æ’åºï¼ˆP0é˜»å¡æ€§é—®é¢˜/P1é‡è¦é—®é¢˜/P2ä¼˜åŒ–é—®é¢˜ï¼‰
   - é€ä¸ªä¿®å¤å¹¶å›å½’æµ‹è¯•

**äº§å‡ºç‰©**ï¼š
- ç«¯åˆ°ç«¯æµ‹è¯•æŠ¥å‘Šï¼ˆåŒ…å«æˆªå›¾å’Œæ—¥å¿—ï¼‰
- Bugæ¸…å•å’Œä¿®å¤è®°å½•
- æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£

**éªŒæ”¶æ ‡å‡†ï¼ˆG6.2ï¼‰**ï¼š
- [ ] å•å›¾è¯Šæ–­æµç¨‹æµ‹è¯•é€šè¿‡ï¼ˆâ‰¥2ä¸ªç–¾ç—…æµ‹è¯•ï¼‰
- [ ] æ‰¹é‡è¯Šæ–­æµç¨‹æµ‹è¯•é€šè¿‡ï¼ˆâ‰¥5å¼ å›¾ç‰‡ï¼‰
- [ ] çŸ¥è¯†åº“ç¼–è¾‘æµç¨‹æµ‹è¯•é€šè¿‡ï¼ˆç¼–è¾‘â†’ä¿å­˜â†’ç”Ÿæ•ˆï¼‰
- [ ] æœ¬ä½“ç®¡ç†æµç¨‹æµ‹è¯•é€šè¿‡
- [ ] **ç¬¬16.5èŠ‚çš„20+è”è°ƒæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨æ‰§è¡Œé€šè¿‡**ï¼ˆTC-S01~S05, TC-B01~B05, TC-O01~O03, TC-K01~K07, TC-E01~E02ï¼‰
- [ ] æ‰€æœ‰P0å’ŒP1é—®é¢˜å·²ä¿®å¤
- [ ] å›å½’æµ‹è¯•é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP6.1å®Œæˆï¼ˆAPIå¯¹æ¥è°ƒè¯•ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬16.2èŠ‚ ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•ï¼Œç¬¬16.5èŠ‚ è”è°ƒæµ‹è¯•ç”¨ä¾‹æ¸…å•

---

**P6é˜¶æ®µGateï¼ˆG6ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [ ] G6.1: å‰åç«¯APIå®Œå…¨è”é€šï¼Œæ— CORSé—®é¢˜
- [ ] G6.2: ç«¯åˆ°ç«¯è¯Šæ–­æµç¨‹æµ‹è¯•é€šè¿‡ï¼ˆå•å›¾+æ‰¹é‡ï¼‰
- [ ] G6.3: çŸ¥è¯†åº“ç¼–è¾‘åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼ˆç¼–è¾‘â†’ä¿å­˜â†’ç”Ÿæ•ˆï¼‰
- [ ] G6.4: æœ¬ä½“ç®¡ç†åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] G6.5: **ç¬¬16.5èŠ‚çš„20+è”è°ƒæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡**
- [ ] G6.6: æ— P0é˜»å¡æ€§Bugï¼ŒP1é‡è¦é—®é¢˜å·²ä¿®å¤

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] APIå¯¹æ¥è°ƒè¯•æ—¥å¿—
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•æŠ¥å‘Š
- [ ] Bugæ¸…å•å’Œä¿®å¤è®°å½•
- [ ] å›å½’æµ‹è¯•é€šè¿‡è¯æ˜

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœAPIå¯¹æ¥å¤±è´¥ â†’ æ£€æŸ¥ä»£ç†é…ç½®ã€CORSé…ç½®ã€åç«¯æœåŠ¡çŠ¶æ€
- å¦‚æœç«¯åˆ°ç«¯æµ‹è¯•å¤±è´¥ â†’ å®šä½å¤±è´¥ç¯èŠ‚ï¼ˆå‰ç«¯/åç«¯/VLMï¼‰ï¼Œè®°å½•è¯¦ç»†æ—¥å¿—
- å¦‚æœBugæ•°é‡è¿‡å¤š â†’ å»¶é•¿P6æ—¶é—´ï¼Œä¼˜å…ˆä¿®å¤é˜»å¡æ€§é—®é¢˜

---

### P7: æµ‹è¯•å¼€å‘ä¸æ‰§è¡Œ ğŸ”„

**ğŸ”„ v2.0ä¿®æ”¹**: å¢åŠ å‰ç«¯æµ‹è¯•å’ŒE2Eæµ‹è¯•

**ç›®æ ‡**ï¼šå®Œå–„æµ‹è¯•è¦†ç›–ï¼Œç¡®ä¿ç³»ç»Ÿè´¨é‡ï¼Œæ‰§è¡Œç¬¬16.6èŠ‚çš„4ä¸ªE2Eæµ‹è¯•åœºæ™¯

**é¢„ä¼°æ—¶é—´**ï¼š2.5å¤©ï¼ˆ20å°æ—¶ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**:
- è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬11ç«  æµ‹è¯•ç­–ç•¥
- è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬16.6èŠ‚ E2Eæµ‹è¯•åœºæ™¯è¯¦ç»†å®šä¹‰
  - 16.6.1èŠ‚ï¼šç•Œé¢1å•å›¾è¯Šæ–­E2Eåœºæ™¯
  - 16.6.2èŠ‚ï¼šç•Œé¢2æ‰¹é‡è¯Šæ–­E2Eåœºæ™¯
  - 16.6.3èŠ‚ï¼šç•Œé¢3æœ¬ä½“ç®¡ç†E2Eåœºæ™¯
  - 16.6.4èŠ‚ï¼šç•Œé¢4çŸ¥è¯†åº“ç®¡ç†E2Eåœºæ™¯

---

#### P7.1 åç«¯å•å…ƒæµ‹è¯•è¡¥å……ï¼ˆ0.75å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. è¡¥å……è¯Šæ–­APIçš„å•å…ƒæµ‹è¯•
2. è¡¥å……çŸ¥è¯†åº“APIçš„å•å…ƒæµ‹è¯•
3. è¡¥å……æœ¬ä½“APIçš„å•å…ƒæµ‹è¯•
4. ç¡®ä¿å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

**äº§å‡ºç‰©**ï¼š
- `backend/tests/unit/test_diagnosis_api.py`
- `backend/tests/unit/test_knowledge_api.py`
- `backend/tests/unit/test_ontology_api.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG7.1ï¼‰**ï¼š
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%ï¼ˆä½¿ç”¨pytest-covæ£€æŸ¥ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP4å®Œæˆï¼ˆåç«¯APIï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬12.1èŠ‚ å•å…ƒæµ‹è¯•ç­–ç•¥

---

#### P7.2 é›†æˆæµ‹è¯•ï¼ˆ0.75å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æµ‹è¯•å®Œæ•´è¯Šæ–­æµç¨‹ï¼ˆAPI â†’ Service â†’ VLM â†’ æ•°æ®åº“ï¼‰
2. æµ‹è¯•çŸ¥è¯†åº“æ›´æ–°æµç¨‹ï¼ˆAPI â†’ Service â†’ æ–‡ä»¶ç³»ç»Ÿ â†’ ç¼“å­˜åˆ·æ–°ï¼‰
3. æµ‹è¯•ç¼“å­˜æœºåˆ¶ï¼ˆRedisç¼“å­˜å‘½ä¸­ç‡ï¼‰
4. æµ‹è¯•å¼‚å¸¸å¤„ç†ï¼ˆVLMè°ƒç”¨å¤±è´¥ã€æ•°æ®åº“è¿æ¥å¤±è´¥ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/tests/integration/test_full_diagnosis_flow.py`
- `backend/tests/integration/test_knowledge_update.py`
- `backend/tests/integration/test_cache.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG7.2ï¼‰**ï¼š
- [ ] é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] å¼‚å¸¸åœºæ™¯è¦†ç›–ï¼ˆVLMå¤±è´¥ã€æ•°æ®åº“å¤±è´¥ã€æ–‡ä»¶è¯»å†™å¤±è´¥ï¼‰
- [ ] ç¼“å­˜æœºåˆ¶éªŒè¯é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP4å®Œæˆï¼ˆåç«¯APIï¼‰+ P2å®Œæˆï¼ˆåŸºç¡€è®¾æ–½ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬12.2èŠ‚ é›†æˆæµ‹è¯•ç­–ç•¥

---

#### P7.3 å‰ç«¯æµ‹è¯•ï¼ˆ0.5å¤©ï¼‰

**ğŸ†• v2.0æ–°å¢**

**ä»»åŠ¡æ¸…å•**ï¼š
1. ç¼–å†™å…³é”®ç»„ä»¶çš„å•å…ƒæµ‹è¯•ï¼ˆJest + React Testing Libraryï¼‰
   - æµ‹è¯•UploadAreaç»„ä»¶
   - æµ‹è¯•DiagnosisResultç»„ä»¶
   - æµ‹è¯•KnowledgeTreeç»„ä»¶
2. ç¼–å†™E2Eæµ‹è¯•ï¼ˆPlaywrightæˆ–Cypressï¼‰ï¼Œæ‰§è¡Œç¬¬16.6èŠ‚å®šä¹‰çš„4ä¸ªE2Eæµ‹è¯•åœºæ™¯ï¼š
   - **16.6.1èŠ‚ï¼šç•Œé¢1å•å›¾è¯Šæ–­E2Eåœºæ™¯**ï¼ˆä¸Šä¼ â†’è¯Šæ–­â†’æŸ¥çœ‹VLMé—®ç­”å¯¹â†’æ ‡æ³¨å‡†ç¡®æ€§ï¼‰
   - **16.6.2èŠ‚ï¼šç•Œé¢2æ‰¹é‡è¯Šæ–­E2Eåœºæ™¯**ï¼ˆæ‰¹é‡ä¸Šä¼ â†’æ‰‹åŠ¨åˆ·æ–°â†’æŸ¥çœ‹ç»“æœâ†’å¯¼å‡ºCSVï¼‰
   - **16.6.3èŠ‚ï¼šç•Œé¢3æœ¬ä½“ç®¡ç†E2Eåœºæ™¯**ï¼ˆæŸ¥çœ‹æœ¬ä½“ç±»å‹â†’æŸ¥çœ‹Schemaè¯¦æƒ…ï¼‰
   - **16.6.4èŠ‚ï¼šç•Œé¢4çŸ¥è¯†åº“ç®¡ç†E2Eåœºæ™¯**ï¼ˆæŸ¥çœ‹çŸ¥è¯†æ ‘â†’æ–°å»ºç–¾ç—…â†’ç¼–è¾‘â†’åˆ›å»ºå¿«ç…§ï¼‰

**äº§å‡ºç‰©**ï¼š
- `frontend/src/__tests__/` å•å…ƒæµ‹è¯•
- `frontend/e2e/` E2Eæµ‹è¯•ï¼ˆå¯¹åº”ç¬¬16.6èŠ‚çš„4ä¸ªåœºæ™¯ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG7.3ï¼‰**ï¼š
- [ ] å‰ç«¯å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] **ç¬¬16.6èŠ‚çš„4ä¸ªE2Eæµ‹è¯•åœºæ™¯å…¨éƒ¨é€šè¿‡**ï¼ˆç•Œé¢1-4çš„å®Œæ•´æµç¨‹éªŒè¯ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP5å®Œæˆï¼ˆå‰ç«¯ç•Œé¢ï¼‰+ P6å®Œæˆï¼ˆå‰åç«¯è”è°ƒï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬11.3èŠ‚ E2Eæµ‹è¯•ç­–ç•¥ï¼Œç¬¬16.6èŠ‚ E2Eæµ‹è¯•åœºæ™¯è¯¦ç»†å®šä¹‰

---

#### P7.4 æ€§èƒ½å’Œå‡†ç¡®ç‡æµ‹è¯•ï¼ˆ0.5å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æµ‹è¯•è¯Šæ–­å‡†ç¡®ç‡ï¼ˆä½¿ç”¨æµ‹è¯•æ•°æ®é›†ï¼‰ï¼š
   - ç«ç‘°é»‘æ–‘ç—…ï¼š12å¼ å›¾ç‰‡ï¼Œç¡®è¯Šç‡ç›®æ ‡ â‰¥ 65%
   - æ¨±èŠ±ç™½ç²‰ç—…ï¼š12å¼ å›¾ç‰‡ï¼Œç¡®è¯Šç‡ç›®æ ‡ â‰¥ 65%
2. æµ‹è¯•APIå“åº”æ—¶é—´ï¼š
   - å•å›¾è¯Šæ–­ï¼š< 5ç§’
   - æ‰¹é‡è¯Šæ–­ï¼š< 30ç§’ï¼ˆ10å¼ å›¾ç‰‡ï¼‰
3. æµ‹è¯•å¹¶å‘æ€§èƒ½ï¼ˆå¯é€‰ï¼‰ï¼š
   - ä½¿ç”¨Locustæˆ–JMeterè¿›è¡Œå‹åŠ›æµ‹è¯•
4. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

**äº§å‡ºç‰©**ï¼š
- `docs/reports/æ€§èƒ½æµ‹è¯•æŠ¥å‘Š_v2.md`
- `docs/reports/å‡†ç¡®ç‡æµ‹è¯•æŠ¥å‘Š_v2.md`

**éªŒæ”¶æ ‡å‡†ï¼ˆG7.4ï¼‰**ï¼š
- [ ] è¯Šæ–­å‡†ç¡®ç‡ â‰¥ 65%ï¼ˆè‡³å°‘2ç§ç–¾ç—…ï¼‰
- [ ] APIå“åº”æ—¶é—´æ»¡è¶³è¦æ±‚
- [ ] æµ‹è¯•æŠ¥å‘Šå®Œæ•´

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP6å®Œæˆï¼ˆç«¯åˆ°ç«¯æµç¨‹ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬12.4èŠ‚ æ€§èƒ½æµ‹è¯•ç­–ç•¥

---

**P7é˜¶æ®µGateï¼ˆG7ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [ ] G7.1: åç«¯å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- [ ] G7.2: é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] G7.3: å‰ç«¯å•å…ƒæµ‹è¯•å’ŒE2Eæµ‹è¯•é€šè¿‡
- [ ] G7.4: **ç¬¬16.6èŠ‚çš„4ä¸ªE2Eæµ‹è¯•åœºæ™¯å…¨éƒ¨é€šè¿‡**
- [ ] G7.5: è¯Šæ–­å‡†ç¡®ç‡ â‰¥ 65%ï¼ˆè‡³å°‘2ç§ç–¾ç—…ï¼‰
- [ ] G7.6: APIå“åº”æ—¶é—´æ»¡è¶³è¦æ±‚

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] æ‰€æœ‰æµ‹è¯•ä»£ç 
- [ ] æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- [ ] å‡†ç¡®ç‡æµ‹è¯•æŠ¥å‘Š
- [ ] æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

---

### P8: æœ¬åœ°éƒ¨ç½²ä¸éªŒæ”¶ ğŸ”„

**ğŸ”„ v2.0ä¿®æ”¹**: æ›´æ–°éƒ¨ç½²è„šæœ¬å’ŒéªŒæ”¶æ ‡å‡†

**ç›®æ ‡**ï¼šå®Œæ•´ç³»ç»Ÿæœ¬åœ°éƒ¨ç½²å¹¶éªŒæ”¶

**é¢„ä¼°æ—¶é—´**ï¼š1å¤©ï¼ˆ8å°æ—¶ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬14ç«  éƒ¨ç½²æ–¹æ¡ˆ

---

#### P8.1 éƒ¨ç½²è„šæœ¬å’Œæ–‡æ¡£ï¼ˆ0.5å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. ç¼–å†™ä¸€é”®å¯åŠ¨è„šæœ¬ï¼š
   - `scripts/start_backend.sh` - å¯åŠ¨åç«¯æœåŠ¡ï¼ˆFastAPIï¼‰
   - `scripts/start_frontend.sh` - å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆVite dev serveræˆ–nginxï¼‰
   - `scripts/start_all.sh` - å¯åŠ¨å®Œæ•´ç³»ç»Ÿï¼ˆåç«¯+å‰ç«¯ï¼‰
   - `scripts/stop_all.sh` - åœæ­¢æ‰€æœ‰æœåŠ¡

2. ç¼–å†™éƒ¨ç½²æ–‡æ¡£ï¼š
   - `docs/deployment/æœ¬åœ°éƒ¨ç½²æŒ‡å—_v2.md`
     - ç¯å¢ƒè¦æ±‚
     - ä¾èµ–å®‰è£…æ­¥éª¤
     - é…ç½®è¯´æ˜
     - å¯åŠ¨æ­¥éª¤
     - å¸¸è§é—®é¢˜æ’æŸ¥
   - `docs/deployment/ç¯å¢ƒé…ç½®è¯´æ˜_v2.md`
     - PostgreSQLé…ç½®
     - Redisé…ç½®
     - .envæ–‡ä»¶é…ç½®
     - VLM API Keyé…ç½®

3. ç¼–å†™ç”¨æˆ·æ‰‹å†Œï¼š
   - `docs/user_guide/ä½¿ç”¨æ‰‹å†Œ_v2.md`
     - ç•Œé¢1ä½¿ç”¨è¯´æ˜ï¼ˆå•å›¾è¯Šæ–­ï¼‰
     - ç•Œé¢2ä½¿ç”¨è¯´æ˜ï¼ˆæ‰¹é‡è¯Šæ–­ï¼‰
     - ç•Œé¢3ä½¿ç”¨è¯´æ˜ï¼ˆæœ¬ä½“ç®¡ç†ï¼‰
     - ç•Œé¢4ä½¿ç”¨è¯´æ˜ï¼ˆçŸ¥è¯†ç®¡ç†ï¼‰

**äº§å‡ºç‰©**ï¼š
- ä¸€é”®å¯åŠ¨è„šæœ¬ï¼ˆ`scripts/`ï¼‰
- éƒ¨ç½²æ–‡æ¡£ï¼ˆ`docs/deployment/`ï¼‰
- ç”¨æˆ·æ‰‹å†Œï¼ˆ`docs/user_guide/`ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG8.1ï¼‰**ï¼š
- [ ] ä¸€é”®å¯åŠ¨è„šæœ¬å¯ç”¨ï¼ˆæµ‹è¯•å¯åŠ¨å’Œåœæ­¢ï¼‰
- [ ] æ–‡æ¡£å®Œæ•´æ¸…æ™°ï¼ˆå¯ä¾›å…¶ä»–å¼€å‘è€…éƒ¨ç½²ï¼‰
- [ ] ç”¨æˆ·æ‰‹å†Œæ˜“è¯»ï¼ˆåŒ…å«æˆªå›¾ï¼‰

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬14.1èŠ‚ æœ¬åœ°éƒ¨ç½²æ–¹æ¡ˆ

---

#### P8.2 ç³»ç»ŸéªŒæ”¶ï¼ˆ0.5å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. éªŒæ”¶æµ‹è¯•ï¼ˆæŒ‰ç…§éªŒæ”¶æ ‡å‡†é€é¡¹æ£€æŸ¥ï¼‰ï¼š
   - åŠŸèƒ½å®Œæ•´æ€§éªŒæ”¶
   - æŠ€æœ¯æŒ‡æ ‡éªŒæ”¶
   - éƒ¨ç½²å¯ç”¨æ€§éªŒæ”¶
2. ç”ŸæˆéªŒæ”¶æŠ¥å‘Š
3. å½•åˆ¶æ¼”ç¤ºè§†é¢‘ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆè¯¦ç»†ï¼‰**ï¼š

**åŠŸèƒ½å®Œæ•´æ€§**ï¼š
- [ ] ç”¨æˆ·å¯ä»¥ä¸Šä¼ å›¾ç‰‡å¹¶åœ¨30ç§’å†…è·å¾—è¯Šæ–­ç»“æœ
- [ ] è¯Šæ–­ç»“æœåŒ…å«ç–¾ç—…åç§°ã€ç½®ä¿¡åº¦ã€VLMé—®ç­”å¯¹ã€ç‰¹å¾åŒ¹é…è¯¦æƒ…
- [ ] æ‰¹é‡è¯Šæ–­æ”¯æŒæœ€å¤š50å¼ å›¾ç‰‡
- [ ] çŸ¥è¯†åº“æ”¯æŒæ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤ç–¾ç—…çŸ¥è¯†
- [ ] æœ¬ä½“ç»“æ„å¯æ­£å¸¸å±•ç¤º

**æŠ€æœ¯æŒ‡æ ‡**ï¼š
- [ ] è¯Šæ–­å‡†ç¡®ç‡ â‰¥ 65%ï¼ˆåŸºäºæµ‹è¯•æ•°æ®é›†ï¼‰
- [ ] APIå“åº”æ—¶é—´ < 5ç§’ï¼ˆå•æ¬¡VLMè°ƒç”¨ï¼‰
- [ ] å‰ç«¯ç•Œé¢å“åº”æµç•…ï¼Œæ— æ˜æ˜¾å¡é¡¿
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

**éƒ¨ç½²å¯ç”¨æ€§**ï¼š
- [ ] ä¸€é”®å¯åŠ¨è„šæœ¬å¯ç”¨ï¼ˆå¯åŠ¨åç«¯+å‰ç«¯ï¼‰
- [ ] ç³»ç»Ÿå¯åœ¨æœ¬åœ°ç¯å¢ƒç¨³å®šè¿è¡Œ
- [ ] æœ‰å®Œæ•´çš„éƒ¨ç½²æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜

**äº§å‡ºç‰©**ï¼š
- `docs/reports/ç³»ç»ŸéªŒæ”¶æŠ¥å‘Š_v2.md`
- æ¼”ç¤ºè§†é¢‘ï¼ˆå¯é€‰ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG8.2ï¼‰**ï¼š
- [ ] æ‰€æœ‰åŠŸèƒ½éªŒæ”¶æ ‡å‡†é€šè¿‡
- [ ] æ‰€æœ‰æŠ€æœ¯æŒ‡æ ‡éªŒæ”¶æ ‡å‡†é€šè¿‡
- [ ] æ‰€æœ‰éƒ¨ç½²å¯ç”¨æ€§éªŒæ”¶æ ‡å‡†é€šè¿‡
- [ ] éªŒæ”¶æŠ¥å‘Šå®Œæ•´

**è®¾è®¡æ–‡æ¡£å¼•ç”¨**: è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0 ç¬¬14.2èŠ‚ ç³»ç»ŸéªŒæ”¶æ ‡å‡†

---

**P8é˜¶æ®µGateï¼ˆG8ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [ ] G8.1: ç³»ç»Ÿå¯ä¸€é”®å¯åŠ¨
- [ ] G8.2: æ‰€æœ‰åŠŸèƒ½éªŒæ”¶é€šè¿‡
- [ ] G8.3: æ‰€æœ‰æŠ€æœ¯æŒ‡æ ‡éªŒæ”¶é€šè¿‡
- [ ] G8.4: æ–‡æ¡£å®Œæ•´ï¼ˆéƒ¨ç½²æ–‡æ¡£+ç”¨æˆ·æ‰‹å†Œï¼‰
- [ ] G8.5: MVP v1.1äº¤ä»˜å®Œæˆ

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] ä¸€é”®å¯åŠ¨è„šæœ¬
- [ ] éƒ¨ç½²æ–‡æ¡£
- [ ] ç”¨æˆ·æ‰‹å†Œ
- [ ] ç³»ç»ŸéªŒæ”¶æŠ¥å‘Š
- [ ] æ¼”ç¤ºè§†é¢‘ï¼ˆå¯é€‰ï¼‰

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœéªŒæ”¶ä¸é€šè¿‡ â†’ æ ¹æ®éªŒæ”¶æŠ¥å‘Šä¿®å¤é—®é¢˜ï¼Œé‡æ–°éªŒæ”¶
- å¦‚æœéƒ¨ç½²å¤±è´¥ â†’ æ£€æŸ¥ç¯å¢ƒé…ç½®ï¼Œæ›´æ–°éƒ¨ç½²æ–‡æ¡£
- å¦‚æœæŠ€æœ¯æŒ‡æ ‡ä¸è¾¾æ ‡ â†’ ä¼˜åŒ–ä»£ç ï¼Œé‡æ–°æµ‹è¯•

---

## 6. é£é™©ä¸åº”å¯¹ ğŸ”„

| é£é™© | å½±å“ | æ¦‚ç‡ | v1.0åº”å¯¹ç­–ç•¥ | v2.0æ–°å¢åº”å¯¹ç­–ç•¥ |
|------|------|------|------------|---------------|
| React/Vueå­¦ä¹ æ›²çº¿ | é«˜ | ä¸­ | - | æå‰å‡†å¤‡æ•™ç¨‹èµ„æºï¼Œä½¿ç”¨æˆç†ŸUIç»„ä»¶åº“ï¼Œä¼˜å…ˆå‚è€ƒå®˜æ–¹æ–‡æ¡£ |
| APIè®¾è®¡ä¸åŒ¹é…ç•Œé¢éœ€æ±‚ | é«˜ | ä¸­ | - | P4é˜¶æ®µè¯¦ç»†æ¢³ç†æ¥å£åè®®ï¼Œä¸å‰ç«¯å¼€å‘è€…å……åˆ†æ²Ÿé€šï¼Œæå‰å®šä¹‰APIè§„èŒƒ |
| VLMè°ƒç”¨ä¸ç¨³å®š | ä¸­ | ä¸­ | å®ç°é‡è¯•æœºåˆ¶ï¼Œå‡†å¤‡å¤‡ç”¨VLMæä¾›å•† | âœ… ä¿æŒ |
| çŸ¥è¯†åº“æ•°æ®æœªå‡†å¤‡ | ä¸­ | ä½ | ä¼˜å…ˆä½¿ç”¨éªŒè¯è¿‡çš„ç–¾ç—…JSONï¼ˆRose Black Spotã€Cherry Powdery Mildewï¼‰ | âœ… ä¿æŒ |
| å‰åç«¯è”è°ƒæ—¶é—´ä¸è¶³ | ä¸­ | ä½ | - | é¢„ç•™å……è¶³çš„P6è”è°ƒæ—¶é—´ï¼ˆ1.5å¤©ï¼‰ï¼ŒåŠæ—¶æ²Ÿé€šé—®é¢˜ï¼Œå»ºç«‹é—®é¢˜æ¸…å• |
| æµ‹è¯•è¦†ç›–ä¸è¶³ | ä¸­ | ä½ | - | æ˜ç¡®æµ‹è¯•æ ‡å‡†ï¼Œä¼˜å…ˆæµ‹è¯•æ ¸å¿ƒæµç¨‹ï¼Œä½¿ç”¨E2Eæµ‹è¯•éªŒè¯ç«¯åˆ°ç«¯æµç¨‹ |
| PostgreSQLæ€§èƒ½é—®é¢˜ | ä½ | ä½ | MVPç‰ˆæœ¬æ•°æ®é‡å°ï¼Œæš‚ä¸è€ƒè™‘ | âœ… ä¿æŒ |

---

## 7. é™„å½• ğŸ”„

### é™„å½•A: å®Œæ•´ç›®å½•ç»“æ„

**âœ… åç«¯ç›®å½•ç»“æ„ä¸v1.0ä¿æŒä¸€è‡´**

**ğŸ†• å‰ç«¯ç›®å½•ç»“æ„ï¼ˆv2.0æ–°å¢ï¼‰**ï¼š

```
frontend/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                    # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ client.ts           # Axiosé…ç½®ï¼Œç»Ÿä¸€è¯·æ±‚/å“åº”æ‹¦æˆª
â”‚   â”‚   â”œâ”€â”€ diagnosis.ts        # è¯Šæ–­APIå°è£…
â”‚   â”‚   â”œâ”€â”€ knowledge.ts        # çŸ¥è¯†åº“APIå°è£…
â”‚   â”‚   â””â”€â”€ ontology.ts         # æœ¬ä½“APIå°è£…
â”‚   â”œâ”€â”€ assets/                 # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”œâ”€â”€ components/             # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/             # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx      # å¯¼èˆªæ 
â”‚   â”‚   â”‚   â”œâ”€â”€ Loading.tsx     # åŠ è½½ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Toast.tsx       # æç¤ºç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ Modal.tsx       # å¯¹è¯æ¡†ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ diagnosis/          # è¯Šæ–­ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ UploadArea.tsx  # ä¸Šä¼ åŒºåŸŸ
â”‚   â”‚   â”‚   â”œâ”€â”€ ImagePreview.tsx # å›¾ç‰‡é¢„è§ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ DiagnosisResult.tsx # è¯Šæ–­ç»“æœ
â”‚   â”‚   â”‚   â”œâ”€â”€ QADetails.tsx   # VLMé—®ç­”å¯¹è¯¦æƒ…
â”‚   â”‚   â”‚   â””â”€â”€ FeatureMatchDetails.tsx # ç‰¹å¾åŒ¹é…è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ batch/              # æ‰¹é‡è¯Šæ–­ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ BatchUpload.tsx # æ‰¹é‡ä¸Šä¼ 
â”‚   â”‚   â”‚   â”œâ”€â”€ ResultList.tsx  # ç»“æœåˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ResultCard.tsx  # ç»“æœå¡ç‰‡
â”‚   â”‚   â”‚   â””â”€â”€ DetailModal.tsx # è¯¦æƒ…æ¨¡æ€æ¡†
â”‚   â”‚   â”œâ”€â”€ ontology/           # æœ¬ä½“ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ OntologyList.tsx # æœ¬ä½“ç±»å‹åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ OntologyDetail.tsx # æœ¬ä½“è¯¦æƒ…
â”‚   â”‚   â”‚   â””â”€â”€ DimensionCard.tsx # ç»´åº¦å¡ç‰‡
â”‚   â”‚   â””â”€â”€ knowledge/          # çŸ¥è¯†ç®¡ç†ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ KnowledgeTree.tsx # çŸ¥è¯†åº“ç›®å½•æ ‘
â”‚   â”‚       â”œâ”€â”€ DiseaseDetail.tsx # ç–¾ç—…è¯¦æƒ…
â”‚   â”‚       â”œâ”€â”€ DimensionCard.tsx # ç»´åº¦å¡ç‰‡
â”‚   â”‚       â””â”€â”€ VLMDescriptionEditor.tsx # VLMæè¿°ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ pages/                  # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ SingleDiagnosis/    # ç•Œé¢1ï¼šå•å›¾è¯Šæ–­
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ BatchDiagnosis/     # ç•Œé¢2ï¼šæ‰¹é‡è¯Šæ–­
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ OntologyManagement/ # ç•Œé¢3ï¼šæœ¬ä½“ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â””â”€â”€ KnowledgeManagement/# ç•Œé¢4ï¼šçŸ¥è¯†ç®¡ç†
â”‚   â”‚       â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ store/                  # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ diagnosisStore.ts   # è¯Šæ–­çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ knowledgeStore.ts   # çŸ¥è¯†åº“çŠ¶æ€
â”‚   â”‚   â””â”€â”€ globalStore.ts      # å…¨å±€çŠ¶æ€
â”‚   â”œâ”€â”€ types/                  # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ diagnosis.ts
â”‚   â”‚   â”œâ”€â”€ knowledge.ts
â”‚   â”‚   â”œâ”€â”€ ontology.ts
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ formatters.ts       # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â”œâ”€â”€ validators.ts       # éªŒè¯å·¥å…·
â”‚   â”‚   â””â”€â”€ errorHandler.ts     # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ App.tsx                 # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ main.tsx                # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ routes.tsx              # è·¯ç”±é…ç½®
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ README.md
```

### é™„å½•B: æŠ€æœ¯æ ˆå¯¹æ¯”ï¼ˆv1.0 vs v2.0ï¼‰

| æŠ€æœ¯æ ˆ | v1.0 | v2.0 | å˜åŒ–è¯´æ˜ |
|--------|------|------|---------|
| **åç«¯æ¡†æ¶** | FastAPI | FastAPI | âœ… ä¸å˜ |
| **å‰ç«¯æ¡†æ¶** | Streamlit + Next.js | React/Vue | ğŸ”„ ç»Ÿä¸€ä¸ºå•ä¸€æŠ€æœ¯æ ˆ |
| **UIç»„ä»¶åº“** | - | Ant Design / Element Plus | âœ¨ æ–°å¢ |
| **çŠ¶æ€ç®¡ç†** | - | Zustand / Pinia | âœ¨ æ–°å¢ |
| **HTTPå®¢æˆ·ç«¯** | - | Axios + React Query | âœ¨ æ–°å¢ |
| **VLMå®¢æˆ·ç«¯** | Instructor + è‡ªå®šä¹‰adapter | Instructor + è‡ªå®šä¹‰adapter | âœ… ä¸å˜ |
| **æ•°æ®åº“** | PostgreSQL | PostgreSQL | âœ… ä¸å˜ |
| **ç¼“å­˜** | Redis | Redis | âœ… ä¸å˜ |
| **æµ‹è¯•æ¡†æ¶** | Pytest | Pytest + Jest + Playwright | ğŸ”„ å¢åŠ å‰ç«¯æµ‹è¯• |

---

## 8. æ–‡æ¡£ä¿®è®¢è®°å½• âœ¨

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®è®¢äºº | ä¸»è¦å˜æ›´ |
|------|------|--------|---------|
| v1.0 | 2025-11-11 | ç³»ç»Ÿæ¶æ„å¸ˆ | åˆå§‹ç‰ˆæœ¬ |
| v2.0 | 2025-11-14 | ç³»ç»Ÿæ¶æ„å¸ˆ | **é‡å¤§ä¿®è®¢**: åŸºäºHTMLåŸå‹éœ€æ±‚ï¼Œè°ƒæ•´P4-P8é˜¶æ®µè§„åˆ’ï¼Œæ”¹ä¸ºReact/Vueå•ä¸€æŠ€æœ¯æ ˆï¼Œæ‰©å±•APIèŒƒå›´ï¼Œæ–°å¢P6å‰åç«¯è”è°ƒé˜¶æ®µï¼Œè¯¦ç»†æ¢³ç†æ¥å£åè®® |

**v2.0ä¿®è®¢è¯¦æƒ…**ï¼š
1. **P4: è¯Šæ–­APIå¼€å‘** â†’ **P4: å®Œæ•´åç«¯APIå¼€å‘**
   - å·¥æœŸ: 1.25å¤© â†’ 2.5å¤©
   - æ–°å¢: çŸ¥è¯†åº“ç®¡ç†APIï¼ˆP4.3ï¼‰ã€æœ¬ä½“ç®¡ç†APIï¼ˆP4.4ï¼‰
   - æ–°å¢: è¯¦ç»†çš„æ¥å£åè®®æ¢³ç†ï¼Œå¼•ç”¨è®¾è®¡æ–‡æ¡£v2.0ç¬¬6ç« 

2. **P5: ç®¡ç†åå°å¼€å‘ï¼ˆStreamlitï¼‰** â†’ **P5: React/Vueå‰ç«¯å¼€å‘**
   - å·¥æœŸ: 2å¤© â†’ 4å¤©
   - å˜æ›´: æ”¹ä¸ºReact/Vueå®ç°4ä¸ªå®Œæ•´ç•Œé¢
   - æ–°å¢: è¯¦ç»†çš„ç•Œé¢å®ç°ä»»åŠ¡æ¸…å•å’ŒéªŒæ”¶æ ‡å‡†

3. **P6: WebéªŒè¯ç•Œé¢å¼€å‘ï¼ˆNext.jsï¼‰** â†’ **P6: å‰åç«¯è”è°ƒ**
   - å·¥æœŸ: 1.5å¤©ï¼ˆä¿æŒï¼‰
   - å˜æ›´: æ”¹ä¸ºå‰åç«¯APIå¯¹æ¥å’Œç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
   - æ–°å¢: è¯¦ç»†çš„è”è°ƒæ­¥éª¤å’ŒBugä¿®å¤æµç¨‹

4. **P7: æµ‹è¯•å¼€å‘ä¸æ‰§è¡Œ**
   - å·¥æœŸ: 2å¤© â†’ 2.5å¤©
   - æ–°å¢: å‰ç«¯æµ‹è¯•ï¼ˆP7.3ï¼‰
   - æ–°å¢: E2Eæµ‹è¯•

5. **P8: æœ¬åœ°éƒ¨ç½²ä¸éªŒæ”¶**
   - å·¥æœŸ: 1å¤©ï¼ˆä¿æŒï¼‰
   - æ›´æ–°: éƒ¨ç½²è„šæœ¬ï¼ˆå‰ç«¯éƒ¨ç½²ï¼‰
   - æ›´æ–°: éªŒæ”¶æ ‡å‡†ï¼ˆå¢åŠ å‰ç«¯ç›¸å…³æ ‡å‡†ï¼‰

6. **æ€»å·¥æœŸ**: 15.75å¤© â†’ 16.5å¤©ï¼ˆå¢åŠ 0.75å¤©ï¼‰

7. **æ–°å¢é™„å½•B**: æŠ€æœ¯æ ˆå¯¹æ¯”è¡¨ï¼ˆv1.0 vs v2.0ï¼‰

---

## ç»“è¯­

æœ¬æ–‡æ¡£ï¼ˆv2.0ï¼‰åŸºäºå®é™…æƒ…å†µè°ƒæ•´äº†P4-P8é˜¶æ®µçš„å®æ–½è®¡åˆ’ï¼Œä¿æŒP0-P3å·²å®Œæˆå†…å®¹ä¸å˜ï¼Œç¡®ä¿ç ”å‘è®¡åˆ’ä¸å½“å‰è¿›åº¦å’Œç›®æ ‡ä¸€è‡´ã€‚

**å…³é”®å˜åŒ–**:
- å‰ç«¯æŠ€æœ¯æ ˆç»Ÿä¸€ä¸ºReact/Vue
- åç«¯APIèŒƒå›´æ‰©å±•ä¸ºå®Œæ•´CRUD
- æ–°å¢å‰åç«¯è”è°ƒé˜¶æ®µ
- è¯¦ç»†æ¢³ç†æ¥å£åè®®

**ä¸‹ä¸€æ­¥**:
1. è¯„å®¡æœ¬ç ”å‘è®¡åˆ’v2.0
2. æ›´æ–°è¯¦ç»†è®¾è®¡æ–‡æ¡£v2.0ï¼ˆåŒæ­¥APIè®¾è®¡å’Œå‰ç«¯æ¶æ„ï¼‰
3. å¼€å§‹å®æ–½P4é˜¶æ®µ

---

**æ–‡æ¡£ç»“æŸ**
