# PhytoOracle MVP v1.1 ç ”å‘è®¡åˆ’

**ç‰ˆæœ¬**: v1.0ï¼ˆä¿®è®¢ç‰ˆï¼‰
**åˆ›å»ºæ—¶é—´**: 2025-11-11
**ä¿®è®¢æ—¶é—´**: 2025-11-11 22:00:00
**çŠ¶æ€**: å¾…è¯„å®¡
**ç›®æ ‡ç‰ˆæœ¬**: MVP v1.1

---

## ç›®å½•

- [1. é¡¹ç›®èƒŒæ™¯](#1-é¡¹ç›®èƒŒæ™¯)
- [2. æ€»ä½“ç›®æ ‡](#2-æ€»ä½“ç›®æ ‡)
- [3. é˜¶æ®µåˆ’åˆ†æ€»è§ˆ](#3-é˜¶æ®µåˆ’åˆ†æ€»è§ˆ)
- [4. å…³é”®é‡Œç¨‹ç¢‘](#4-å…³é”®é‡Œç¨‹ç¢‘)
- [5. è¯¦ç»†é˜¶æ®µè§„åˆ’](#5-è¯¦ç»†é˜¶æ®µè§„åˆ’)
- [6. é£é™©ä¸åº”å¯¹](#6-é£é™©ä¸åº”å¯¹)
- [7. é™„å½•](#7-é™„å½•)

---

## 1. é¡¹ç›®èƒŒæ™¯

PhytoOracle æ˜¯åŸºäºæœ¬ä½“å»ºæ¨¡çš„èŠ±å‰ç–¾ç—…è¯Šæ–­ç³»ç»Ÿï¼Œæ ¸å¿ƒæŠ€æœ¯è·¯çº¿ä¸ºï¼š**VLMè§†è§‰ç†è§£ + æœ¬ä½“çŸ¥è¯†åº“ + æç¤ºè¯å·¥ç¨‹ + åŠ æƒè¯Šæ–­å¼•æ“**ã€‚

### 1.1 æŠ€æœ¯éªŒè¯åŸºç¡€

- **FlowerSpecialist v4.1**ï¼šå·²éªŒè¯ç«ç‘°é»‘æ–‘ç—…ï¼ˆ100%ç‰¹å¾æ£€æµ‹ç‡ï¼‰ã€æ¨±èŠ±ç™½ç²‰ç—…ï¼ˆ70.8%ç¡®è¯Šç‡ï¼‰
- **æ–¹æ³•è®ºv5.0**ï¼šé›¶è®­ç»ƒè¯Šæ–­ã€äº”çŸ¥è¯†åº“æ¶æ„ã€è§†è§‰æè¿°ä¼˜åŒ–5å¤§æ–¹æ³•
- **æµ‹è¯•æ•°æ®é›†**ï¼š
  - `D:\é¡¹ç›®ç®¡ç†\æ¤ç‰©ç—…è™«å®³\æ•°æ®é›†\flower_data`
  - `D:\é¡¹ç›®ç®¡ç†\æ¤ç‰©ç—…è™«å®³\æ•°æ®é›†\Rose_leaf`

### 1.2 æ ¸å¿ƒæŒ‘æˆ˜

1. **çŸ¥è¯†åº“æ•°æ®æœªå®Œå…¨å‡†å¤‡**ï¼š18-24ç§ç–¾ç—…JSONéœ€è¦é€æ­¥æ„å»º
2. **å¯æ‰©å±•æ€§è¦æ±‚é«˜**ï¼šåç»­ä¸èƒ½å¤§è§„æ¨¡é‡å†™ï¼Œå¿…é¡»ä¸€æ¬¡æ€§è®¾è®¡å¥½æ¶æ„
3. **æœ¬åœ°éƒ¨ç½²ç¯å¢ƒ**ï¼šPostgreSQL + Rediséœ€è¦æœ¬åœ°æ­å»ºå¹¶éªŒè¯
4. **ç®¡ç†åå°ä¼˜å…ˆçº§é«˜**ï¼šç–¾ç—…æ¨¡å‹ç®¡ç†åŠŸèƒ½æ˜¯å…³é”®ï¼ˆé€šè¿‡AIè¾…åŠ©æ„å»ºç–¾ç—…JSONï¼‰

---

## 2. æ€»ä½“ç›®æ ‡

### 2.1 æ ¸å¿ƒç›®æ ‡

**äº§å‡ºä¸€ä¸ªå¯è¿è¡Œçš„èŠ±å‰ç–¾ç—…è¯Šæ–­ç³»ç»ŸMVP**ï¼Œå…·å¤‡ï¼š

1. âœ… **è¯Šæ–­èƒ½åŠ›**ï¼šæ”¯æŒQ0-Q6é—®è¯Šåºåˆ— + ä¸‰å±‚æ¸è¿›è¯Šæ–­
2. âœ… **ç®¡ç†èƒ½åŠ›**ï¼šStreamlitåå°ï¼Œæ”¯æŒç–¾ç—…CRUDã€è¯Šæ–­æµ‹è¯•ã€ç»Ÿè®¡åˆ†æ
3. âœ… **éªŒè¯ç•Œé¢**ï¼šNext.js Webç•Œé¢ï¼Œä¸Šä¼ å›¾ç‰‡â†’æ˜¾ç¤ºè¯Šæ–­ç»“æœ
4. âœ… **å¯æ‰©å±•æ€§**ï¼šåç»­æ–°å¢èŠ±å‰/ç–¾ç—…æ— éœ€å¤§è§„æ¨¡é‡æ„

### 2.2 è´¨é‡ç›®æ ‡

- **è¯Šæ–­å‡†ç¡®ç‡**ï¼šâ‰¥65%ï¼ˆä½¿ç”¨æµ‹è¯•æ•°æ®é›†éªŒè¯ï¼‰
- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**ï¼šâ‰¥80%ï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰
- **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šå®Œæ•´è¯Šæ–­æµç¨‹é€šè¿‡
- **ä»£ç è´¨é‡**ï¼šé€šè¿‡Pylint/Flake8æ£€æŸ¥

### 2.3 è¾¹ç•Œè¯´æ˜

**æœ¬è®¡åˆ’èŒƒå›´å†…**ï¼š
- âœ… åç«¯è¯Šæ–­APIï¼ˆFastAPIï¼‰
- âœ… ç®¡ç†åå°ï¼ˆStreamlitï¼‰
- âœ… WebéªŒè¯ç•Œé¢ï¼ˆNext.jsï¼‰
- âœ… æœ¬åœ°PostgreSQL + Rediséƒ¨ç½²
- âœ… ç®€å•è´¦å·å¯†ç è®¤è¯ï¼ˆåå°ç™»å½•ï¼‰
- âœ… å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + E2Eæµ‹è¯•

**æœ¬è®¡åˆ’èŒƒå›´å¤–**ï¼š
- âŒ äº‘æœåŠ¡å™¨éƒ¨ç½²
- âŒ CI/CDæµæ°´çº¿
- âŒ å¤æ‚çš„API Keyè®¤è¯æœºåˆ¶
- âŒ ç”Ÿäº§çº§ç›‘æ§å‘Šè­¦

---

## 3. é˜¶æ®µåˆ’åˆ†æ€»è§ˆ

| é˜¶æ®µ | åç§° | æ ¸å¿ƒäº§å‡º | é¢„ä¼°å·¥ä½œé‡ | Gate |
|------|------|----------|-----------|------|
| **P0** | ç¯å¢ƒå‡†å¤‡ä¸æ¶æ„è®¾è®¡ | å®Œæ•´ç›®å½•è“å›¾ + ç¯å¢ƒéªŒè¯ | 0.5å¤© | G0 |
| **P1** | æ¥å£åè®®ä¸æ•°æ®åº“è®¾è®¡ | OpenAPIè§„èŒƒ + DDLè„šæœ¬ | 1å¤© | G1 |
| **P2** | æ ¸å¿ƒåŸºç¡€è®¾æ–½å¼€å‘ | VLMå®¢æˆ·ç«¯ + çŸ¥è¯†åº“åŠ è½½å™¨ + æç¤ºè¯æ¡†æ¶ + æœ¬åœ°å›¾ç‰‡å­˜å‚¨ | 3å¤© | G2 |
| **P3** | è¯Šæ–­å¼•æ“æ ¸å¿ƒé€»è¾‘ | Q0-Q6é—®è¯Š + ä¸‰å±‚æ¸è¿›è¯Šæ–­ + çŸ¥è¯†åº“æœåŠ¡ + å›¾ç‰‡æœåŠ¡ | 3å¤© | G3 |
| **P4** | è¯Šæ–­APIå¼€å‘ | FastAPIæœåŠ¡ + å›¾ç‰‡ç®¡ç†API | 1.25å¤© | G4 |
| **P5** | ç®¡ç†åå°å¼€å‘ | Streamlitç•Œé¢ï¼ˆç–¾ç—…ç®¡ç†/è¯Šæ–­æµ‹è¯•/ç»Ÿè®¡ï¼‰ | 2å¤© | G5 |
| **P6** | WebéªŒè¯ç•Œé¢å¼€å‘ | Next.jsè¯Šæ–­ç•Œé¢ | 1.5å¤© | G6 |
| **P7** | æµ‹è¯•å¼€å‘ä¸æ‰§è¡Œ | å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + E2Eæµ‹è¯• | 2å¤© | G7 |
| **P8** | æœ¬åœ°éƒ¨ç½²ä¸éªŒæ”¶ | å®Œæ•´ç³»ç»Ÿè¿è¡Œ + éªŒæ”¶æŠ¥å‘Š | 1å¤© | G8 |
| **æ€»è®¡** | - | - | **15.25å¤©** | - |

---

## 4. å…³é”®é‡Œç¨‹ç¢‘

```mermaid
gantt
    title PhytoOracle MVP v1.1 å…³é”®é‡Œç¨‹ç¢‘
    dateFormat  YYYY-MM-DD
    section åŸºç¡€è®¾æ–½
    P0 ç¯å¢ƒå‡†å¤‡           :p0, 2025-11-11, 0.5d
    P1 æ¥å£ä¸æ•°æ®åº“è®¾è®¡    :p1, after p0, 1d
    P2 æ ¸å¿ƒåŸºç¡€è®¾æ–½å¼€å‘    :p2, after p1, 2.5d
    section æ ¸å¿ƒåŠŸèƒ½
    P3 è¯Šæ–­å¼•æ“æ ¸å¿ƒé€»è¾‘    :p3, after p2, 2d
    P4 è¯Šæ–­APIå¼€å‘        :p4, after p3, 1.5d
    section å‰ç«¯ç•Œé¢
    P5 ç®¡ç†åå°å¼€å‘        :p5, after p4, 2d
    P6 WebéªŒè¯ç•Œé¢        :p6, after p5, 1.5d
    section æµ‹è¯•ä¸éªŒæ”¶
    P7 æµ‹è¯•å¼€å‘ä¸æ‰§è¡Œ      :p7, after p6, 2d
    P8 æœ¬åœ°éƒ¨ç½²ä¸éªŒæ”¶      :p8, after p7, 1d
```

**å…³é”®é‡Œç¨‹ç¢‘èŠ‚ç‚¹**ï¼š

- **D+1.5ï¼ˆG1é€šè¿‡ï¼‰**ï¼šæ•°æ®åº“è¡¨åˆ›å»ºå®Œæˆï¼ŒAPIæ¥å£è§„èŒƒè¯„å®¡é€šè¿‡
- **D+4ï¼ˆG2é€šè¿‡ï¼‰**ï¼šVLMè°ƒç”¨æˆåŠŸï¼ŒçŸ¥è¯†åº“åŠ è½½éªŒè¯é€šè¿‡
- **D+6ï¼ˆG3é€šè¿‡ï¼‰**ï¼šå®Œæ•´è¯Šæ–­å¼•æ“é€»è¾‘éªŒè¯é€šè¿‡ï¼ˆå•ç–¾ç—…æµ‹è¯•ï¼‰
- **D+7.5ï¼ˆG4é€šè¿‡ï¼‰**ï¼šè¯Šæ–­APIè¿è¡Œï¼ŒPostmanæµ‹è¯•é€šè¿‡
- **D+9.5ï¼ˆG5é€šè¿‡ï¼‰**ï¼šç®¡ç†åå°è¿è¡Œï¼Œç–¾ç—…CRUDåŠŸèƒ½éªŒè¯
- **D+11ï¼ˆG6é€šè¿‡ï¼‰**ï¼šWebç•Œé¢è¿è¡Œï¼Œå›¾ç‰‡ä¸Šä¼ è¯Šæ–­æˆåŠŸ
- **D+13ï¼ˆG7é€šè¿‡ï¼‰**ï¼šæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- **D+14ï¼ˆG8é€šè¿‡ï¼‰**ï¼šéªŒæ”¶æµ‹è¯•é€šè¿‡ï¼ŒMVPäº¤ä»˜

---

## 5. è¯¦ç»†é˜¶æ®µè§„åˆ’

---

### P0: ç¯å¢ƒå‡†å¤‡ä¸æ¶æ„è®¾è®¡

**ç›®æ ‡**ï¼šæ­å»ºå¼€å‘ç¯å¢ƒï¼Œäº§å‡ºå®Œæ•´ç›®å½•è“å›¾ï¼ŒéªŒè¯æŠ€æœ¯æ ˆå¯ç”¨æ€§

**é¢„ä¼°æ—¶é—´**ï¼š0.5å¤©ï¼ˆ4å°æ—¶ï¼‰

---

#### P0.1 å¼€å‘ç¯å¢ƒæ­å»º

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®‰è£…Python 3.10+ï¼ˆéªŒè¯ç‰ˆæœ¬ï¼‰
2. å®‰è£…PostgreSQL 14+ï¼ˆæœ¬åœ°ï¼‰
3. å®‰è£…Redis 7+ï¼ˆæœ¬åœ°ï¼‰
4. å®‰è£…Node.js 18+ï¼ˆç”¨äºNext.jså‰ç«¯ï¼‰
5. åˆ›å»ºé¡¹ç›®æ ¹ç›®å½• `D:\é¡¹ç›®ç®¡ç†\PhytoOracle`

**äº§å‡ºç‰©**ï¼š
- `backend/.env.example`ï¼šç¯å¢ƒå˜é‡æ¨¡æ¿
- `backend/pyproject.toml`ï¼šPoetryä¾èµ–é…ç½®ï¼ˆåˆå§‹ç‰ˆæœ¬ï¼‰
- `frontend/package.json`ï¼šNode.jsä¾èµ–é…ç½®ï¼ˆåˆå§‹ç‰ˆæœ¬ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG0.1ï¼‰**ï¼š
- [ ] Pythonç‰ˆæœ¬ â‰¥ 3.10
- [ ] PostgreSQLæœåŠ¡è¿è¡ŒæˆåŠŸï¼ˆ`psql --version`ï¼‰
- [ ] RedisæœåŠ¡è¿è¡ŒæˆåŠŸï¼ˆ`redis-cli ping` è¿”å› `PONG`ï¼‰
- [ ] Node.jsç‰ˆæœ¬ â‰¥ 18

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šæ— 

---

#### P0.2 å®Œæ•´ç›®å½•è“å›¾æ„å»º

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬4ç« ï¼Œåˆ›å»ºå®Œæ•´ç›®å½•ç»“æ„
2. åˆ›å»ºæ‰€æœ‰ `__init__.py` æ–‡ä»¶ï¼ˆPythonåŒ…ç»“æ„ï¼‰
3. åˆ›å»ºå…³é”®é…ç½®æ–‡ä»¶æ¨¡æ¿

**äº§å‡ºç‰©**ï¼š
- **å®Œæ•´ç›®å½•æ ‘**ï¼ˆè§é™„å½•Aï¼‰
- `backend/core/config.py`ï¼ˆç©ºç™½æ¨¡æ¿ï¼ŒåŒ…å«Settingsç±»å®šä¹‰ï¼‰
- `backend/apps/api/main.py`ï¼ˆFastAPIåº”ç”¨éª¨æ¶ï¼‰
- `backend/apps/admin/app.py`ï¼ˆStreamlitåº”ç”¨éª¨æ¶ï¼‰
- `frontend/app/page.tsx`ï¼ˆNext.jsé¦–é¡µéª¨æ¶ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG0.2ï¼‰**ï¼š
- [ ] ç›®å½•ç»“æ„ä¸è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬4ç« å®Œå…¨ä¸€è‡´
- [ ] æ‰€æœ‰PythonåŒ…åŒ…å« `__init__.py`
- [ ] `backend/` å’Œ `frontend/` ç»“æ„åˆ†ç¦»æ¸…æ™°
- [ ] ç›®å½•æ ‘å¯é€šè¿‡ `tree` å‘½ä»¤è¾“å‡ºéªŒè¯

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP0.1å®Œæˆ

**äº§å‡ºç¤ºä¾‹**ï¼š
```
PhytoOracle/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ apps/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ main.py            # âœ“ åˆ›å»ºéª¨æ¶
â”‚   â”‚   â”‚   â”œâ”€â”€ deps.py            # âœ“ åˆ›å»ºç©ºæ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”‚   â”‚       â””â”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ app.py             # âœ“ åˆ›å»ºéª¨æ¶
â”‚   â”‚       â””â”€â”€ pages/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py              # âœ“ Settingsç±»æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ knowledge_base/
â”‚   â”‚   â”œâ”€â”€ diseases/
â”‚   â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”œâ”€â”€ plants/
â”‚   â”‚   â””â”€â”€ host_disease/
â”‚   â””â”€â”€ storage/
â”‚       â””â”€â”€ images/
â””â”€â”€ frontend/
    â”œâ”€â”€ app/
    â”‚   â”œâ”€â”€ layout.tsx
    â”‚   â””â”€â”€ page.tsx               # âœ“ åˆ›å»ºéª¨æ¶
    â”œâ”€â”€ components/
    â””â”€â”€ lib/
```

---

#### P0.3 æŠ€æœ¯æ ˆéªŒè¯

**ä»»åŠ¡æ¸…å•**ï¼š
1. åˆ›å»ºæœ€å°åŒ–FastAPI Hello Worldï¼ˆéªŒè¯FastAPIå¯è¿è¡Œï¼‰
2. åˆ›å»ºæœ€å°åŒ–Streamlit Hello Worldï¼ˆéªŒè¯Streamlitå¯è¿è¡Œï¼‰
3. åˆ›å»ºæœ€å°åŒ–Next.jsé¡µé¢ï¼ˆéªŒè¯Next.jså¯è¿è¡Œï¼‰
4. æµ‹è¯•PostgreSQLè¿æ¥ï¼ˆä½¿ç”¨asyncpgï¼‰
5. æµ‹è¯•Redisè¿æ¥ï¼ˆä½¿ç”¨redis-pyï¼‰
6. æµ‹è¯•Qwen VL Plus APIè°ƒç”¨ï¼ˆä½¿ç”¨llm_config.jsonä¸­çš„API Keyï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/tests/test_env_validation.py`ï¼šç¯å¢ƒéªŒè¯æµ‹è¯•è„šæœ¬
- `backend/scripts/test_qwen_api.py`ï¼šQwen VL APIæµ‹è¯•è„šæœ¬

**éªŒæ”¶æ ‡å‡†ï¼ˆG0.3ï¼‰**ï¼š
- [ ] FastAPIæœåŠ¡å¯åŠ¨æˆåŠŸï¼ˆ`http://localhost:8000/docs` å¯è®¿é—®ï¼‰
- [ ] Streamlitåº”ç”¨å¯åŠ¨æˆåŠŸï¼ˆ`http://localhost:8501` å¯è®¿é—®ï¼‰
- [ ] Next.jså¼€å‘æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼ˆ`http://localhost:3000` å¯è®¿é—®ï¼‰
- [ ] PostgreSQLè¿æ¥æˆåŠŸï¼ˆåˆ›å»ºæµ‹è¯•æ•°æ®åº“ `phytooracle_test`ï¼‰
- [ ] Redisè¿æ¥æˆåŠŸï¼ˆ`SET test_key test_value` æˆåŠŸï¼‰
- [ ] Qwen VL Plus APIè°ƒç”¨æˆåŠŸï¼ˆè¿”å›æœ‰æ•ˆå“åº”ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP0.1 + P0.2å®Œæˆ

---

**P0é˜¶æ®µGateï¼ˆG0ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G0.1ï¼šå¼€å‘ç¯å¢ƒéªŒè¯é€šè¿‡
- [x] G0.2ï¼šå®Œæ•´ç›®å½•è“å›¾åˆ›å»ºå®Œæˆ
- [x] G0.3ï¼šæŠ€æœ¯æ ˆéªŒè¯å…¨éƒ¨é€šè¿‡

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœPostgreSQL/Redisè¿æ¥å¤±è´¥ â†’ æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼Œé‡æ–°å®‰è£…
- å¦‚æœQwen APIè°ƒç”¨å¤±è´¥ â†’ æ£€æŸ¥API Keyæœ‰æ•ˆæ€§ï¼Œæ ‡è®°ä¸º **[å¾…å†³ç­–]**ï¼Œå‘ç”¨æˆ·æé—®

---

### P1: æ¥å£åè®®ä¸æ•°æ®åº“è®¾è®¡

**ç›®æ ‡**ï¼šå®ŒæˆAPIæ¥å£è®¾è®¡ã€æ•°æ®åº“è¡¨è®¾è®¡ã€æ•°æ®æ¨¡å‹è®¾è®¡ï¼Œäº§å‡ºå¯è¯„å®¡çš„è®¾è®¡æ–‡æ¡£

**é¢„ä¼°æ—¶é—´**ï¼š1å¤©ï¼ˆ8å°æ—¶ï¼‰

---

#### P1.1 APIæ¥å£è®¾è®¡ï¼ˆOpenAPIè§„èŒƒï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬6ç« ï¼Œç¼–å†™å®Œæ•´OpenAPI 3.0è§„èŒƒ
2. å®šä¹‰æ ¸å¿ƒæ¥å£ï¼š
   - `POST /api/v1/diagnose`ï¼šè¯Šæ–­æ¥å£
   - `GET /api/v1/diseases`ï¼šè·å–ç–¾ç—…åˆ—è¡¨
   - `POST /api/v1/admin/reload`ï¼šé‡è½½çŸ¥è¯†åº“
   - `POST /api/v1/auth/login`ï¼šåå°ç™»å½•
3. å®šä¹‰æ‰€æœ‰è¯·æ±‚/å“åº”Schema

**äº§å‡ºç‰©**ï¼š
- `docs/api/openapi.yaml`ï¼šå®Œæ•´OpenAPI 3.0è§„èŒƒæ–‡æ¡£
- `docs/api/æ¥å£åè®®è¯´æ˜.md`ï¼šæ¥å£ä½¿ç”¨è¯´æ˜ï¼ˆä¸­æ–‡ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG1.1ï¼‰**ï¼š
- [ ] OpenAPIè§„èŒƒé€šè¿‡Swagger EditoréªŒè¯ï¼ˆæ— è¯­æ³•é”™è¯¯ï¼‰
- [ ] æ‰€æœ‰æ ¸å¿ƒæ¥å£å®šä¹‰å®Œæ•´ï¼ˆè·¯å¾„ã€æ–¹æ³•ã€å‚æ•°ã€å“åº”ï¼‰
- [ ] Schemaå®šä¹‰ç¬¦åˆè¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬7ç« æ•°æ®æ¨¡å‹
- [ ] æ¥å£åè®®è¯„å®¡é€šè¿‡ï¼ˆæ¶æ„å¸ˆå®¡æ ¸ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP0å®Œæˆ

**è¯„å®¡æ£€æŸ¥ç‚¹**ï¼š
- è¯Šæ–­æ¥å£æ˜¯å¦æ”¯æŒ `multipart/form-data`ï¼Ÿ
- å“åº”Schemaæ˜¯å¦åŒ…å« `feature_vector`ã€`diagnosis_result`ã€`scores`ï¼Ÿ
- æ˜¯å¦å®šä¹‰äº†é”™è¯¯å“åº”æ ¼å¼ï¼ˆ400/401/500ï¼‰ï¼Ÿ

---

#### P1.2 æ•°æ®åº“è¡¨è®¾è®¡ï¼ˆDDLï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬9ç« ï¼Œç¼–å†™å®Œæ•´PostgreSQL DDLè„šæœ¬
2. åˆ›å»º5å¼ æ ¸å¿ƒè¡¨ï¼š
   - `diagnoses`ï¼šè¯Šæ–­è®°å½•
   - `images`ï¼šå›¾ç‰‡å…ƒæ•°æ®
   - `api_keys`ï¼šAPIå¯†é’¥ï¼ˆæš‚ä¸ä½¿ç”¨ï¼Œé¢„ç•™ï¼‰
   - `admin_users`ï¼šç®¡ç†å‘˜è´¦å·
   - `knowledge_versions`ï¼šçŸ¥è¯†åº“ç‰ˆæœ¬
3. è®¾è®¡ç´¢å¼•ï¼ˆtimestampã€plant_genusã€accuracy_labelç­‰ï¼‰
4. è®¾è®¡çº¦æŸï¼ˆCHECKçº¦æŸã€å¤–é”®çº¦æŸï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/scripts/init_db.sql`ï¼šå®Œæ•´DDLè„šæœ¬
- `backend/scripts/seed_data.sql`ï¼šåˆå§‹åŒ–æ•°æ®è„šæœ¬ï¼ˆç®¡ç†å‘˜è´¦å·ï¼‰
- `docs/design/æ•°æ®åº“è®¾è®¡è¯„å®¡.md`ï¼šæ•°æ®åº“è®¾è®¡è¯´æ˜ï¼ˆè¡¨ç»“æ„ã€ç´¢å¼•ç­–ç•¥ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG1.2ï¼‰**ï¼š
- [ ] DDLè„šæœ¬åœ¨PostgreSQLä¸­æ‰§è¡ŒæˆåŠŸï¼ˆæ— é”™è¯¯ï¼‰
- [ ] æ‰€æœ‰è¡¨åˆ›å»ºæˆåŠŸï¼ˆ`\dt` å‘½ä»¤å¯æŸ¥çœ‹ï¼‰
- [ ] ç´¢å¼•åˆ›å»ºæˆåŠŸï¼ˆ`\di` å‘½ä»¤å¯æŸ¥çœ‹ï¼‰
- [ ] åˆå§‹åŒ–æ•°æ®æ’å…¥æˆåŠŸï¼ˆè‡³å°‘1ä¸ªç®¡ç†å‘˜è´¦å·ï¼‰
- [ ] æ•°æ®åº“è®¾è®¡è¯„å®¡é€šè¿‡ï¼ˆæ£€æŸ¥è¡¨ç»“æ„ã€ç´¢å¼•åˆç†æ€§ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP0å®Œæˆ

**è¯„å®¡æ£€æŸ¥ç‚¹**ï¼š
- `diagnoses` è¡¨æ˜¯å¦ä½¿ç”¨JSONBå­˜å‚¨ `feature_vector`ï¼Ÿ
- `images` è¡¨æ˜¯å¦æœ‰ `accuracy_label` å­—æ®µï¼ˆunlabeled/correct/incorrectï¼‰ï¼Ÿ
- `admin_users` è¡¨æ˜¯å¦å­˜å‚¨å¯†ç å“ˆå¸Œï¼ˆbcryptï¼‰ï¼Ÿ
- æ˜¯å¦åˆ›å»ºäº†åˆé€‚çš„ç´¢å¼•ï¼ˆé¿å…å…¨è¡¨æ‰«æï¼‰ï¼Ÿ

---

#### P1.3 æ•°æ®æ¨¡å‹è®¾è®¡ï¼ˆPydanticï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬7ç« ï¼Œç¼–å†™æ‰€æœ‰Pydantic V2æ•°æ®æ¨¡å‹
2. åˆ›å»ºé¢†åŸŸæ¨¡å‹ï¼ˆ`domain/`ï¼‰ï¼š
   - `DiagnosisAggregate`ï¼šè¯Šæ–­èšåˆæ ¹
   - `DiseaseOntology`ï¼šç–¾ç—…æœ¬ä½“
   - `FeatureVector`ï¼šç‰¹å¾å‘é‡
   - `PlantOntology`ï¼šæ¤ç‰©æœ¬ä½“
3. åˆ›å»ºAPI Schemaï¼ˆ`apps/api/schemas/`ï¼‰ï¼š
   - `DiagnosisRequest`/`DiagnosisResponse`
   - `DiseaseSchema`
   - `LoginRequest`/`LoginResponse`
4. ä½¿ç”¨Pydantic V2ç‰¹æ€§ï¼ˆFieldã€validatorã€model_validatorï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/domain/diagnosis.py`
- `backend/domain/disease.py`
- `backend/domain/feature.py`
- `backend/domain/plant.py`
- `backend/domain/value_objects.py`
- `backend/apps/api/schemas/diagnosis.py`
- `backend/apps/api/schemas/auth.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG1.3ï¼‰**ï¼š
- [ ] æ‰€æœ‰Pydanticæ¨¡å‹å¯æˆåŠŸå¯¼å…¥ï¼ˆæ— è¯­æ³•é”™è¯¯ï¼‰
- [ ] ä½¿ç”¨ `pydantic.BaseModel` V2è¯­æ³•
- [ ] å¿…å¡«å­—æ®µä½¿ç”¨ `Field(..., description="...")` å®šä¹‰
- [ ] å¯é€‰å­—æ®µä½¿ç”¨ `Optional[T] = None` æˆ– `T | None = None`
- [ ] æ¨¡å‹é€šè¿‡å•å…ƒæµ‹è¯•éªŒè¯ï¼ˆåˆ›å»ºç¤ºä¾‹å®ä¾‹ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.1å®Œæˆï¼ˆAPI Schemaéœ€å‚è€ƒOpenAPIå®šä¹‰ï¼‰

**ä»£ç ç¤ºä¾‹**ï¼š
```python
# backend/domain/diagnosis.py
from pydantic import BaseModel, Field
from typing import Optional
from uuid import UUID

class DiagnosisResult(BaseModel):
    """è¯Šæ–­ç»“æœé¢†åŸŸæ¨¡å‹"""
    diagnosis_id: UUID
    status: str = Field(..., description="è¯Šæ–­çŠ¶æ€ï¼šconfirmed/suspected/uncertain/rejected")
    confirmed_disease: Optional[str] = Field(None, description="ç¡®è¯Šç–¾ç—…ID")
    suspected_diseases: Optional[list[str]] = Field(None, description="ç–‘ä¼¼ç–¾ç—…IDåˆ—è¡¨")
    confidence: float = Field(..., ge=0.0, le=1.0, description="ç½®ä¿¡åº¦")
    reasoning: Optional[str] = Field(None, description="è¯Šæ–­æ¨ç†è¿‡ç¨‹")
```

---

**P1é˜¶æ®µGateï¼ˆG1ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G1.1ï¼šOpenAPIè§„èŒƒè¯„å®¡é€šè¿‡
- [x] G1.2ï¼šæ•°æ®åº“DDLæ‰§è¡ŒæˆåŠŸï¼Œåˆå§‹åŒ–æ•°æ®æ’å…¥æˆåŠŸ
- [x] G1.3ï¼šPydanticæ¨¡å‹åˆ›å»ºå®Œæˆï¼Œå•å…ƒæµ‹è¯•é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `docs/api/openapi.yaml`
- [ ] `backend/scripts/init_db.sql`
- [ ] `backend/scripts/seed_data.sql`
- [ ] `backend/domain/` ä¸‹æ‰€æœ‰æ¨¡å‹æ–‡ä»¶
- [ ] `backend/apps/api/schemas/` ä¸‹æ‰€æœ‰Schemaæ–‡ä»¶

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœOpenAPIè§„èŒƒè¯„å®¡ä¸é€šè¿‡ â†’ ä¿®æ­£åé‡æ–°è¯„å®¡
- å¦‚æœDDLæ‰§è¡Œå¤±è´¥ â†’ æ£€æŸ¥SQLè¯­æ³•ï¼Œä¿®æ­£åé‡è¯•
- å¦‚æœå‘ç°æ•°æ®æ¨¡å‹é—æ¼ â†’ æ ‡è®°ä¸º **[å¾…å†³ç­–]**ï¼Œå‘ç”¨æˆ·æé—®

---

### P2: æ ¸å¿ƒåŸºç¡€è®¾æ–½å¼€å‘

**ç›®æ ‡**ï¼šå®ç°VLMå®¢æˆ·ç«¯ã€çŸ¥è¯†åº“åŠ è½½å™¨ã€æç¤ºè¯æ¡†æ¶ã€æ¨¡ç³ŠåŒ¹é…å¼•æ“ã€åŠ æƒè¯Šæ–­è¯„åˆ†å™¨ã€æœ¬åœ°å›¾ç‰‡å­˜å‚¨

**é¢„ä¼°æ—¶é—´**ï¼š3å¤©ï¼ˆ24å°æ—¶ï¼‰

---

#### P2.1 æç¤ºè¯æ¡†æ¶ï¼ˆPROOF Framework + Instructorï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ ¹æ®è¯¦ç»†è®¾è®¡æ–‡æ¡£5.6èŠ‚ï¼Œå®ç°PROOF Framework
2. å®ç°Instructoré›†æˆï¼ˆåŒ…è£…Qwen VL Plus APIï¼‰
3. å®šä¹‰æ‰€æœ‰VLMå“åº”Schemaï¼ˆQ00Response ~ Q05Response + FeatureResponseï¼‰
4. ç¼–å†™Q0-Q6æç¤ºè¯æ¨¡æ¿

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/llm/prompts/framework.py`ï¼šPROOF FrameworkåŸºç±»
- `backend/infrastructure/llm/prompts/response_schema.py`ï¼šVLMå“åº”Schema
- `backend/infrastructure/llm/prompts/q0_0_content.py`ï¼šQ0.0æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q0_1_category.py`ï¼šQ0.1æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q0_2_genus.py`ï¼šQ0.2æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q0_3_organ.py`ï¼šQ0.3æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q0_4_completeness.py`ï¼šQ0.4æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q0_5_abnormality.py`ï¼šQ0.5æç¤ºè¯å®šä¹‰
- `backend/infrastructure/llm/prompts/q1_q6_features.py`ï¼šQ1-Q6åŠ¨æ€ç‰¹å¾æå–æ¨¡æ¿

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.1ï¼‰**ï¼š
- [ ] PROOF Frameworkç±»å¯æˆåŠŸå®ä¾‹åŒ–
- [ ] `PROOFPrompt.render()` æ–¹æ³•å¯ç”Ÿæˆå®Œæ•´æç¤ºè¯å­—ç¬¦ä¸²
- [ ] æ‰€æœ‰VLMå“åº”Schemaä½¿ç”¨ `Literal` ç±»å‹ä¸¥æ ¼é™åˆ¶é€‰é¡¹
- [ ] Q0.2æç¤ºè¯åŒ…å«5ç§èŠ±å‰çš„visual_cuesï¼ˆè¯¦ç»†è®¾è®¡æ–‡æ¡£5.6.3ç¤ºä¾‹ï¼‰
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆæµ‹è¯•æç¤ºè¯æ¸²æŸ“è¾“å‡ºï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.3å®Œæˆï¼ˆéœ€è¦Pydanticæ¨¡å‹ï¼‰

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_proof_framework.py
def test_q0_2_genus_prompt_render():
    """æµ‹è¯•Q0.2æç¤ºè¯æ¸²æŸ“"""
    from infrastructure.llm.prompts.q0_2_genus import q0_2_prompt

    rendered = q0_2_prompt.render()

    # éªŒè¯åŒ…å«å…³é”®å­—æ®µ
    assert "ROLE: plant disease diagnosis assistant" in rendered
    assert "TASK: Identify the genus" in rendered
    assert "Rosa" in rendered
    assert "Prunus" in rendered
    assert "RESPONSE FORMAT (JSON only)" in rendered
```

---

#### P2.2 VLMå®¢æˆ·ç«¯ï¼ˆFallbackæœºåˆ¶ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°VLM ProvideræŠ½è±¡æ¥å£ï¼ˆ`VLMProtocol`ï¼‰
2. å®ç°Qwen VL Plus Providerï¼ˆè¯»å– `llm_config.json`ï¼‰
3. å®ç°Instructoré›†æˆï¼ˆè‡ªåŠ¨éªŒè¯ + é‡è¯•ï¼‰
4. å®ç°Fallbackæœºåˆ¶ï¼ˆQwen â†’ ChatGPT â†’ Grok â†’ Claudeï¼Œå½“å‰ä»…Qwenå¯ç”¨ï¼‰
5. å®ç°ç¼“å­˜æœºåˆ¶ï¼ˆRedisï¼Œkey = `vlm:{image_hash}:{question_id}`ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/llm/base.py`ï¼šVLMProtocolæŠ½è±¡æ¥å£
- `backend/infrastructure/llm/client.py`ï¼šVLMClientä¸»ç±»
- `backend/infrastructure/llm/providers/qwen.py`ï¼šQwenVLPlusProvider
- `backend/infrastructure/llm/providers/chatgpt.py`ï¼šChatGPTProviderï¼ˆå ä½ï¼Œæ ‡è®°TODOï¼‰
- `backend/core/cache.py`ï¼šRedisCacheå°è£…ç±»

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.2ï¼‰**ï¼š
- [ ] VLMClientå¯æˆåŠŸåˆå§‹åŒ–ï¼ˆåŠ è½½Qwen API Keyï¼‰
- [ ] è°ƒç”¨ `VLMClient.call_with_fallback()` æˆåŠŸï¼ˆä½¿ç”¨æµ‹è¯•å›¾ç‰‡ï¼‰
- [ ] è¿”å›çš„å“åº”ç¬¦åˆPydantic Schemaï¼ˆå¦‚ `Q00Response`ï¼‰
- [ ] ç¼“å­˜æœºåˆ¶ç”Ÿæ•ˆï¼ˆç¬¬äºŒæ¬¡è°ƒç”¨åŒä¸€å›¾ç‰‡æ—¶ä»Redisè¯»å–ï¼‰
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆæµ‹è¯•å®Œæ•´VLMè°ƒç”¨æµç¨‹ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.1å®Œæˆï¼ˆéœ€è¦å“åº”Schemaï¼‰

**é›†æˆæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/integration/test_vlm_client.py
async def test_vlm_client_q0_0_call():
    """æµ‹è¯•VLMå®¢æˆ·ç«¯Q0.0è°ƒç”¨"""
    from infrastructure.llm.client import VLMClient
    from infrastructure.llm.prompts.q0_0_content import Q0_0_PROMPT
    from infrastructure.llm.prompts.response_schema import Q00Response

    client = VLMClient()

    # åŠ è½½æµ‹è¯•å›¾ç‰‡
    with open("tests/fixtures/rose_black_spot.jpg", "rb") as f:
        image_bytes = f.read()

    # è°ƒç”¨VLM
    response = await client.call_with_fallback(
        prompt=Q0_0_PROMPT,
        image=image_bytes,
        response_model=Q00Response,
        question_id="Q0.0"
    )

    # éªŒè¯å“åº”
    assert response.choice in ["plant", "animal", "person", "object", "landscape", "other"]
    assert 0.0 <= response.confidence <= 1.0
```

---

#### P2.3 çŸ¥è¯†åº“åŠ è½½å™¨

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°JSONçŸ¥è¯†åº“åŠ è½½å™¨ï¼ˆ`JSONKnowledgeLoader`ï¼‰
2. åŠ è½½ç–¾ç—…æœ¬ä½“ï¼ˆ`knowledge_base/diseases/*.json`ï¼‰
3. åŠ è½½ç‰¹å¾æœ¬ä½“ï¼ˆ`knowledge_base/features/feature_ontology.json`ï¼‰
4. åŠ è½½æ¤ç‰©æœ¬ä½“ï¼ˆ`knowledge_base/plants/*.json`ï¼Œv1.2+é¢„ç•™ï¼‰
5. åŠ è½½å®¿ä¸»-ç–¾ç—…å…³ç³»ï¼ˆ`knowledge_base/host_disease/associations.json`ï¼‰
6. è§£æJSON â†’ Pydanticç±»ï¼ˆç±»å‹å®‰å…¨ï¼‰
7. æ”¯æŒçƒ­æ›´æ–°ï¼ˆç®¡ç†åå°è°ƒç”¨ `reload()` æ–¹æ³•ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/ontology/loader.py`ï¼šJSONKnowledgeLoader
- `backend/knowledge_base/diseases/rose_black_spot.json`ï¼šç«ç‘°é»‘æ–‘ç—…JSONï¼ˆå¤åˆ¶FlowerSpecialistæ•°æ®ï¼‰
- `backend/knowledge_base/diseases/cherry_powdery_mildew.json`ï¼šæ¨±èŠ±ç™½ç²‰ç—…JSON
- `backend/knowledge_base/features/feature_ontology.json`ï¼šç‰¹å¾æœ¬ä½“JSON
- `backend/knowledge_base/host_disease/associations.json`ï¼šå®¿ä¸»-ç–¾ç—…å…³ç³»JSON

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.3ï¼‰**ï¼š
- [ ] çŸ¥è¯†åº“åŠ è½½æˆåŠŸï¼ˆè‡³å°‘2ç§ç–¾ç—…ï¼šRose Black Spot + Cherry Powdery Mildewï¼‰
- [ ] JSONè§£æä¸ºPydanticå¯¹è±¡ï¼ˆ`DiseaseOntology`ï¼‰
- [ ] å¯é€šè¿‡ `knowledge_base.get_disease_by_id("rose_black_spot")` æŸ¥è¯¢
- [ ] çƒ­æ›´æ–°æœºåˆ¶éªŒè¯ï¼ˆä¿®æ”¹JSONæ–‡ä»¶åè°ƒç”¨ `reload()` ç”Ÿæ•ˆï¼‰
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆæµ‹è¯•åŠ è½½ã€æŸ¥è¯¢ã€é‡è½½ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.3å®Œæˆï¼ˆéœ€è¦ `DiseaseOntology` æ¨¡å‹ï¼‰

**çŸ¥è¯†åº“JSONç¤ºä¾‹**ï¼š
```json
{
  "version": "4.1",
  "disease_id": "rose_black_spot",
  "disease_name": "ç«ç‘°é»‘æ–‘ç—…",
  "common_name_en": "Rose Black Spot",
  "pathogen": "Diplocarpon rosae",
  "feature_vector": {
    "symptom_type": "necrosis_spot",
    "color_center": "black",
    "color_border": "yellow",
    "location": "lamina",
    "size": "medium",
    "distribution": "scattered"
  },
  "feature_importance": {
    "major_features": {
      "_weight": 0.8,
      "features": [
        {
          "dimension": "symptom_type",
          "expected_values": ["necrosis_spot"],
          "weight": 0.5
        },
        {
          "dimension": "color_center",
          "expected_values": ["black", "dark_brown"],
          "weight": 0.3
        }
      ]
    }
  },
  "visual_descriptions": {
    "color_border": "åƒç…è›‹çš„è›‹ç™½éƒ¨åˆ†ç¯ç»•ç€è›‹é»„ï¼ˆé»„è‰²æ™•åœˆï¼‰"
  }
}
```

---

#### P2.4 æ¨¡ç³ŠåŒ¹é…å¼•æ“

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°é¢œè‰²æ¨¡ç³ŠåŒ¹é…ï¼ˆ`COLOR_GROUPS`ï¼‰
2. å®ç°å°ºå¯¸æ¨¡ç³ŠåŒ¹é…ï¼ˆ`SIZE_ORDER`ï¼Œå…è®¸Â±1çº§åˆ«è¯¯å·®ï¼‰
3. å®ç°ä½ç½®æ¨¡ç³ŠåŒ¹é…ï¼ˆå¦‚ `lamina` åŒ¹é… `["lamina", "petiole"]`ï¼‰
4. å°è£…ä¸º `FuzzyMatcher` ç±»

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/ontology/matcher.py`ï¼šFuzzyMatcherç±»

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.4ï¼‰**ï¼š
- [ ] é¢œè‰²æ¨¡ç³ŠåŒ¹é…æµ‹è¯•é€šè¿‡ï¼ˆå¦‚ `black` åŒ¹é… `dark_brown`ï¼‰
- [ ] å°ºå¯¸æ¨¡ç³ŠåŒ¹é…æµ‹è¯•é€šè¿‡ï¼ˆå¦‚ `medium` åŒ¹é… `medium_small`ï¼‰
- [ ] ä½ç½®æ¨¡ç³ŠåŒ¹é…æµ‹è¯•é€šè¿‡
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.3å®Œæˆï¼ˆéœ€è¦çŸ¥è¯†åº“æ•°æ®ï¼‰

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_matcher.py
def test_color_fuzzy_match():
    """æµ‹è¯•é¢œè‰²æ¨¡ç³ŠåŒ¹é…"""
    from infrastructure.ontology.matcher import FuzzyMatcher

    matcher = FuzzyMatcher()

    # åŒè‰²ç³»åŒ¹é…
    assert matcher.match_color("black", "dark_brown") == True
    assert matcher.match_color("yellow", "light_yellow") == True

    # ä¸åŒè‰²ç³»ä¸åŒ¹é…
    assert matcher.match_color("black", "yellow") == False

def test_size_fuzzy_match():
    """æµ‹è¯•å°ºå¯¸æ¨¡ç³ŠåŒ¹é…"""
    from infrastructure.ontology.matcher import FuzzyMatcher

    matcher = FuzzyMatcher()

    # Â±1çº§åˆ«åŒ¹é…
    assert matcher.match_size("medium", "medium_small") == True
    assert matcher.match_size("medium", "small") == False  # ç›¸å·®2çº§
```

---

#### P2.5 åŠ æƒè¯Šæ–­è¯„åˆ†å™¨

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°åŠ æƒè¯Šæ–­è¯„åˆ†ç®—æ³•ï¼ˆè¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬5.4èŠ‚ï¼‰
2. ä¸»è¦ç‰¹å¾æƒé‡0.8ï¼ˆsymptom_type: 0.5 + color_center: 0.3ï¼‰
3. æ¬¡è¦ç‰¹å¾æƒé‡0.15ï¼ˆlocation: 0.1 + additional_features: 0.05ï¼‰
4. å¯é€‰ç‰¹å¾æƒé‡0.05ï¼ˆsize: 0.03 + distribution: 0.02ï¼‰
5. å®Œæ•´æ€§ä¿®æ­£ç³»æ•°ï¼ˆcomplete: 1.0, partial: 0.8, close_up: 0.6ï¼‰
6. è¯Šæ–­è§„åˆ™ï¼ˆconfirmed: â‰¥0.85ä¸”ä¸»è¦ç‰¹å¾â‰¥2/2, suspected: 0.6-0.85ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/ontology/scorer.py`ï¼šDiagnosisScorerç±»

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.5ï¼‰**ï¼š
- [ ] è¯„åˆ†ç®—æ³•ä¸FlowerSpecialist v11å®éªŒç»“æœä¸€è‡´
- [ ] ä¸»è¦ç‰¹å¾å®Œå…¨åŒ¹é…æ—¶ï¼Œtotal_score â‰¥ 0.8
- [ ] è¯Šæ–­è§„åˆ™æ­£ç¡®ï¼ˆconfirmed/suspected/unlikelyï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 95%

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.3 + P2.4å®Œæˆ

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_scorer.py
def test_weighted_scoring():
    """æµ‹è¯•åŠ æƒè¯„åˆ†ç®—æ³•"""
    from infrastructure.ontology.scorer import DiagnosisScorer
    from domain.feature import FeatureVector
    from domain.disease import DiseaseOntology

    scorer = DiagnosisScorer()

    # æ„å»ºç‰¹å¾å‘é‡ï¼ˆå®Œå…¨åŒ¹é…ï¼‰
    feature_vector = FeatureVector(
        symptom_type="necrosis_spot",
        color_center="black",
        color_border="yellow",
        location="lamina"
    )

    # åŠ è½½ç–¾ç—…
    disease = load_disease("rose_black_spot")

    # è®¡ç®—è¯„åˆ†
    score = scorer.calculate_score(feature_vector, disease)

    # éªŒè¯
    assert score.total_score >= 0.85  # åº”ä¸ºconfirmed
    assert score.major_matched == 2   # ä¸»è¦ç‰¹å¾å…¨åŒ¹é…
    assert score.diagnosis_level == "confirmed"
```

---

#### P2.6 æœ¬åœ°å›¾ç‰‡å­˜å‚¨ï¼ˆLocalImageStorageï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå›¾ç‰‡å­˜å‚¨ï¼ˆ`LocalImageStorage`ç±»ï¼‰
2. æŒ‰å‡†ç¡®ç‡+èŠ±å‰å+æ—¥æœŸåˆ†ç±»å­˜å‚¨è§„åˆ™ï¼š
   - è·¯å¾„è§„èŒƒï¼š`storage/images/{accuracy_label}/{genus}/{year-month}/{day}/{diagnosis_id}.jpg`
   - accuracy_label: unlabeled / correct / incorrect
3. å®ç°æ–‡ä»¶è·¯å¾„ç”Ÿæˆè§„èŒƒåŒ–ï¼ˆ`get_path`æ–¹æ³•ï¼‰
4. å®ç°æ–‡ä»¶ç§»åŠ¨åŠŸèƒ½ï¼ˆ`move`æ–¹æ³•ï¼Œç”¨äºå‡†ç¡®æ€§æ ‡æ³¨æ—¶ç§»åŠ¨æ–‡ä»¶ï¼‰
5. å®ç°å›¾ç‰‡ä¿å­˜åŠŸèƒ½ï¼ˆ`save`æ–¹æ³•ï¼Œå¼‚æ­¥ä¿å­˜å›¾ç‰‡ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/storage/local_storage.py`ï¼šLocalImageStorageç±»
- `backend/infrastructure/storage/__init__.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG2.6ï¼‰**ï¼š
- [ ] LocalImageStorageç±»å¯æˆåŠŸå®ä¾‹åŒ–
- [ ] `save()` æ–¹æ³•æµ‹è¯•é€šè¿‡ï¼ˆç”Ÿæˆæ­£ç¡®çš„æ–‡ä»¶è·¯å¾„ï¼Œä¿å­˜å›¾ç‰‡æˆåŠŸï¼‰
- [ ] `move()` æ–¹æ³•æµ‹è¯•é€šè¿‡ï¼ˆç§»åŠ¨æ–‡ä»¶åˆ°correct/incorrectæ–‡ä»¶å¤¹ï¼‰
- [ ] `get_path()` æ–¹æ³•æµ‹è¯•é€šè¿‡ï¼ˆè·¯å¾„ç”Ÿæˆè§„èŒƒæ­£ç¡®ï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šæ— ï¼ˆLayer 1æ¨¡å—ï¼Œæ— ä¾èµ–ï¼‰

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_local_storage.py
import pytest
from infrastructure.storage.local_storage import LocalImageStorage
from pathlib import Path

@pytest.mark.asyncio
async def test_save_image():
    """æµ‹è¯•å›¾ç‰‡ä¿å­˜"""
    storage = LocalImageStorage(base_path="tests/storage_test")

    # æ¨¡æ‹Ÿå›¾ç‰‡æ•°æ®
    image_bytes = b"fake_image_data"
    diagnosis_id = "diag_20251111_001"
    plant_genus = "rosa"

    # ä¿å­˜å›¾ç‰‡
    saved_path = await storage.save(
        image_bytes=image_bytes,
        diagnosis_id=diagnosis_id,
        plant_genus=plant_genus,
        accuracy_label="unlabeled"
    )

    # éªŒè¯è·¯å¾„æ ¼å¼
    assert "unlabeled/rosa/2025-11/" in saved_path
    assert diagnosis_id in saved_path

    # éªŒè¯æ–‡ä»¶å­˜åœ¨
    assert Path(saved_path).exists()

@pytest.mark.asyncio
async def test_move_file():
    """æµ‹è¯•æ–‡ä»¶ç§»åŠ¨ï¼ˆå‡†ç¡®æ€§æ ‡æ³¨ï¼‰"""
    storage = LocalImageStorage(base_path="tests/storage_test")

    # å…ˆä¿å­˜ä¸€å¼ å›¾ç‰‡
    image_bytes = b"fake_image_data"
    old_path = await storage.save(
        image_bytes=image_bytes,
        diagnosis_id="diag_20251111_002",
        plant_genus="rosa",
        accuracy_label="unlabeled"
    )

    # ç§»åŠ¨åˆ°correctæ–‡ä»¶å¤¹
    new_path = await storage.move(
        old_path=old_path,
        new_accuracy_label="correct"
    )

    # éªŒè¯
    assert "correct/rosa/" in new_path
    assert Path(new_path).exists()
    assert not Path(old_path).exists()  # æ—§æ–‡ä»¶å·²åˆ é™¤
```

**æ¶æ„è¯´æ˜**ï¼š
- LocalImageStorageæ˜¯**Layer 1åŸºç¡€è®¾æ–½æ¨¡å—**ï¼ˆæ— ä¾èµ–ï¼‰
- è¢«ImageServiceï¼ˆLayer 3æœåŠ¡ï¼‰è°ƒç”¨
- å®ç°é¡ºåºï¼šP2.6 â†’ P3.6ï¼ˆImageServiceï¼‰ â†’ P4.3ï¼ˆå›¾ç‰‡ç®¡ç†APIï¼‰

---

**P2é˜¶æ®µGateï¼ˆG2ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G2.1ï¼šPROOF Framework + VLMå“åº”Schemaåˆ›å»ºå®Œæˆï¼Œå•å…ƒæµ‹è¯•é€šè¿‡
- [x] G2.2ï¼šVLMå®¢æˆ·ç«¯è°ƒç”¨æˆåŠŸï¼Œé›†æˆæµ‹è¯•é€šè¿‡
- [x] G2.3ï¼šçŸ¥è¯†åº“åŠ è½½æˆåŠŸï¼ˆè‡³å°‘2ç§ç–¾ç—…ï¼‰
- [x] G2.4ï¼šæ¨¡ç³ŠåŒ¹é…å¼•æ“å•å…ƒæµ‹è¯•é€šè¿‡
- [x] G2.5ï¼šåŠ æƒè¯Šæ–­è¯„åˆ†å™¨å•å…ƒæµ‹è¯•é€šè¿‡
- [x] G2.6ï¼šæœ¬åœ°å›¾ç‰‡å­˜å‚¨å•å…ƒæµ‹è¯•é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `backend/infrastructure/llm/` ä¸‹æ‰€æœ‰æ–‡ä»¶
- [ ] `backend/infrastructure/ontology/` ä¸‹æ‰€æœ‰æ–‡ä»¶
- [ ] `backend/infrastructure/storage/` ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆLocalImageStorageï¼‰
- [ ] `backend/knowledge_base/` ä¸‹è‡³å°‘2ç§ç–¾ç—…JSON
- [ ] `backend/tests/unit/` ä¸‹æ‰€æœ‰å•å…ƒæµ‹è¯•
- [ ] `backend/tests/integration/test_vlm_client.py`

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœVLMè°ƒç”¨å¤±è´¥ â†’ æ£€æŸ¥API Keyï¼Œæ£€æŸ¥ç½‘ç»œï¼Œæ ‡è®°ä¸º **[å¾…å†³ç­–]**
- å¦‚æœçŸ¥è¯†åº“åŠ è½½å¤±è´¥ â†’ æ£€æŸ¥JSONæ ¼å¼ï¼Œä½¿ç”¨JSON SchemaéªŒè¯
- å¦‚æœè¯„åˆ†ç®—æ³•ä¸v11ä¸ä¸€è‡´ â†’ å¯¹ç…§v11æºç ä¿®æ­£

---

### P3: è¯Šæ–­å¼•æ“æ ¸å¿ƒé€»è¾‘

**ç›®æ ‡**ï¼šå®ç°Q0-Q6é—®è¯Šåºåˆ—ã€ä¸‰å±‚æ¸è¿›è¯Šæ–­æµç¨‹ã€VLMå…œåº•ç­–ç•¥ã€çŸ¥è¯†åº“æœåŠ¡ã€å›¾ç‰‡æœåŠ¡

**é¢„ä¼°æ—¶é—´**ï¼š3å¤©ï¼ˆ24å°æ—¶ï¼‰

---

#### P3.1 Q0é€çº§è¿‡æ»¤å®ç°

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°Q0.0å†…å®¹ç±»å‹è¯†åˆ«ï¼ˆplant/animal/person/object/landscape/otherï¼‰
2. å®ç°Q0.1æ¤ç‰©ç±»åˆ«è¯†åˆ«ï¼ˆflower/vegetable/tree/crop/grass/otherï¼‰
3. å®ç°Q0.2èŠ±å‰ç§å±è¯†åˆ«ï¼ˆRosa/Prunus/Tulipa/Dianthus/Paeonia/unknownï¼‰
4. å®ç°Q0.3å™¨å®˜è¯†åˆ«ï¼ˆflower/leafï¼‰
5. å®ç°Q0.4å®Œæ•´æ€§æ£€æŸ¥ï¼ˆcomplete/partial/close_upï¼‰
6. å®ç°Q0.5å¼‚å¸¸åˆ¤æ–­ï¼ˆhealthy/abnormalï¼‰
7. æ—©æœŸé€€å‡ºæœºåˆ¶ï¼ˆå¦‚Q0.0 != plant â†’ ç›´æ¥è¿”å›é”™è¯¯ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/services/diagnosis_service.py`ï¼šDiagnosisServiceç±»ï¼ˆéƒ¨åˆ†å®ç°ï¼‰
  - `_execute_q0_sequence()` æ–¹æ³•
  - `_check_content_type()` æ–¹æ³•
  - `_check_plant_category()` æ–¹æ³•
  - `_check_flower_genus()` æ–¹æ³•

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.1ï¼‰**ï¼š
- [ ] Q0é€çº§è¿‡æ»¤å®Œæ•´æµç¨‹æµ‹è¯•é€šè¿‡
- [ ] éæ¤ç‰©å›¾ç‰‡è¿”å›"ä¸æ”¯æŒçš„å›¾ç‰‡ç±»å‹"
- [ ] éèŠ±å‰å›¾ç‰‡è¿”å›"å½“å‰ä»…æ”¯æŒèŠ±å‰è¯Šæ–­"
- [ ] Q0.2è¿”å›çš„flower_genuså¯ç”¨äºå€™é€‰ç–¾ç—…å‰ªæ
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨æµ‹è¯•æ•°æ®é›†ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.1 + P2.2å®Œæˆ

**é›†æˆæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/integration/test_q0_filtering.py
async def test_q0_sequence_with_rose_image():
    """æµ‹è¯•Q0åºåˆ—ï¼ˆç«ç‘°å›¾ç‰‡ï¼‰"""
    from services.diagnosis_service import DiagnosisService

    service = DiagnosisService(...)

    # åŠ è½½ç«ç‘°å›¾ç‰‡
    with open("tests/fixtures/rose_black_spot.jpg", "rb") as f:
        image_bytes = f.read()

    # æ‰§è¡ŒQ0åºåˆ—
    q0_responses = await service._execute_q0_sequence(image_bytes)

    # éªŒè¯
    assert q0_responses["content_type"] == "plant"
    assert q0_responses["plant_category"] == "flower"
    assert q0_responses["flower_genus"] in ["Rosa", "Prunus", "unknown"]
    assert q0_responses["organ"] in ["flower", "leaf"]
    assert q0_responses["completeness"] in ["complete", "partial", "close_up"]
    assert q0_responses["has_abnormality"] in ["healthy", "abnormal"]
```

---

#### P3.2 Q1-Q6åŠ¨æ€ç‰¹å¾æå–

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°Q1ç—‡çŠ¶ç±»å‹è¯†åˆ«ï¼ˆsymptom_typeï¼‰
2. æ ¹æ®Q1ç»“æœåŠ¨æ€ç”ŸæˆQ2-Q6é—®é¢˜ï¼š
   - å¦‚symptom_type = "necrosis_spot" â†’ Q2: color_center, Q3: color_border, Q4: location
   - å¦‚symptom_type = "powdery_coating" â†’ Q2: coverage_color, Q3: coverage_density
3. å®ç°ç‰¹å¾å‘é‡æ„å»ºï¼ˆ`FeatureVector` Pydanticå¯¹è±¡ï¼‰
4. å¤„ç†VLMä¸ç¡®å®šæ€§ï¼ˆconfidence < 0.5æ—¶æ ‡è®°ä¸ºuncertainï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/services/diagnosis_service.py`ï¼šDiagnosisServiceç±»ï¼ˆéƒ¨åˆ†å®ç°ï¼‰
  - `_execute_q1_q6_sequence()` æ–¹æ³•
  - `_build_feature_vector()` æ–¹æ³•

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.2ï¼‰**ï¼š
- [ ] Q1-Q6åŠ¨æ€é—®é¢˜ç”ŸæˆæˆåŠŸ
- [ ] ç‰¹å¾å‘é‡æ„å»ºå®Œæ•´ï¼ˆåŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µï¼‰
- [ ] VLMä¸ç¡®å®šæ€§å¤„ç†æ­£ç¡®
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨æµ‹è¯•æ•°æ®é›†ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP3.1å®Œæˆ

---

#### P3.3 ä¸‰å±‚æ¸è¿›è¯Šæ–­æµç¨‹

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°Layer1ï¼šVLMè§†è§‰ç‰¹å¾æå–ï¼ˆQ0-Q6ï¼‰
2. å®ç°Layer2ï¼šçŸ¥è¯†åº“åŒ¹é…å¼•æ“
   - å€™é€‰ç–¾ç—…ç­›é€‰ï¼ˆæ ¹æ®flower_genuså‰ªæï¼‰
   - åŠ æƒè¯Šæ–­è¯„åˆ†ï¼ˆè°ƒç”¨DiagnosisScorerï¼‰
   - æ’åºï¼ˆæŒ‰total_scoreé™åºï¼‰
3. å®ç°Layer3ï¼šç½®ä¿¡åº¦åˆ†å±‚å†³ç­–
   - High Confidence (â‰¥0.85) â†’ è¿”å›confirmed
   - Medium Confidence (0.60-0.85) â†’ è¿”å›suspectedï¼ˆTop 2-3å€™é€‰ï¼‰
   - Low Confidence (<0.60) â†’ è§¦å‘å…œåº•ç­–ç•¥ï¼ˆP3.4ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/services/diagnosis_service.py`ï¼šDiagnosisServiceç±»ï¼ˆå®Œæ•´å®ç°ï¼‰
  - `diagnose()` ä¸»æ–¹æ³•ï¼ˆç¼–æ’å®Œæ•´æµç¨‹ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.3ï¼‰**ï¼š
- [ ] å®Œæ•´è¯Šæ–­æµç¨‹æµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨Rose Black Spotæµ‹è¯•å›¾ç‰‡ï¼‰
- [ ] ç¡®è¯Šç»“æœæ­£ç¡®ï¼ˆtotal_score â‰¥ 0.85ï¼Œdisease_idæ­£ç¡®ï¼‰
- [ ] ç–‘ä¼¼ç»“æœæ­£ç¡®ï¼ˆè¿”å›Top 2-3å€™é€‰ç–¾ç—…ï¼‰
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–confirmed/suspectedä¸¤ç§åœºæ™¯ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP3.2 + P2.3 + P2.5å®Œæˆ

**é›†æˆæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/integration/test_diagnosis_flow.py
async def test_complete_diagnosis_rose_black_spot():
    """æµ‹è¯•å®Œæ•´è¯Šæ–­æµç¨‹ï¼ˆç«ç‘°é»‘æ–‘ç—…ï¼‰"""
    from services.diagnosis_service import DiagnosisService

    service = DiagnosisService(...)

    # åŠ è½½æµ‹è¯•å›¾ç‰‡
    with open("tests/fixtures/rose_black_spot.jpg", "rb") as f:
        image_bytes = f.read()

    # æ‰§è¡Œè¯Šæ–­
    result = await service.diagnose(image_bytes)

    # éªŒè¯
    assert result.status == "confirmed"
    assert result.confirmed_disease == "rose_black_spot"
    assert result.confidence >= 0.85
    assert "feature_vector" in result.dict()
    assert "scores" in result.dict()
```

---

#### P3.4 VLMå…œåº•ç­–ç•¥

**ä»»åŠ¡æ¸…å•**ï¼š
1. å½“æ‰€æœ‰å€™é€‰ç–¾ç—…score < 0.6æ—¶è§¦å‘å…œåº•ç­–ç•¥
2. è°ƒç”¨VLMå¼€æ”¾å¼è¯Šæ–­ï¼ˆä½¿ç”¨fallbackæç¤ºè¯æ¨¡æ¿ï¼‰
3. è¿”å›VLMæ¨æµ‹ç»“æœï¼Œæ ‡è®°ä¸º"VLMæ¨æµ‹"
4. è®°å½•caseç”¨äºåç»­çŸ¥è¯†åº“è¡¥å……

**äº§å‡ºç‰©**ï¼š
- `backend/infrastructure/llm/prompts/fallback.py`ï¼šVLMå¼€æ”¾å¼è¯Šæ–­æç¤ºè¯
- `backend/services/diagnosis_service.py`ï¼šDiagnosisServiceç±»
  - `_vlm_fallback_diagnosis()` æ–¹æ³•

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.4ï¼‰**ï¼š
- [ ] å…œåº•ç­–ç•¥è§¦å‘æµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨çŸ¥è¯†åº“å¤–ç–¾ç—…å›¾ç‰‡ï¼‰
- [ ] VLMå¼€æ”¾å¼è¯Šæ–­è¿”å›æœ‰æ•ˆç»“æœ
- [ ] ç»“æœæ ‡è®°ä¸º"VLMæ¨æµ‹"
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP3.3å®Œæˆ

---

#### P3.5 çŸ¥è¯†åº“æœåŠ¡å®ç°ï¼ˆKnowledgeServiceï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°KnowledgeServiceç±»ï¼ˆ`backend/services/knowledge_service.py`ï¼‰
2. å®ç°çŸ¥è¯†åº“åˆå§‹åŒ–ï¼ˆ`initialize`æ–¹æ³•ï¼Œè°ƒç”¨KnowledgeLoaderåŠ è½½æ‰€æœ‰çŸ¥è¯†åº“ï¼‰
3. å®ç°çŸ¥è¯†åº“çƒ­æ›´æ–°ï¼ˆ`reload`æ–¹æ³•ï¼Œæ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½ï¼‰
4. å®ç°å€™é€‰ç–¾ç—…æŸ¥è¯¢ï¼ˆ`get_diseases_by_genus`æ–¹æ³•ï¼Œç”¨äºP3.3çš„å€™é€‰ç–¾ç—…ç­›é€‰ï¼‰
5. å®ç°å…¨éƒ¨ç–¾ç—…æŸ¥è¯¢ï¼ˆ`get_all_diseases`æ–¹æ³•ï¼Œç”¨äºç®¡ç†åå°ï¼‰
6. å®ç°å•ä¸ªç–¾ç—…æŸ¥è¯¢ï¼ˆ`get_disease_by_id`æ–¹æ³•ï¼‰
7. å®ç°çŸ¥è¯†åº“ç‰ˆæœ¬ç®¡ç†ï¼ˆè®°å½•Git commit hashï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/services/knowledge_service.py`ï¼šKnowledgeServiceç±»
- `backend/services/__init__.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.5ï¼‰**ï¼š
- [ ] KnowledgeServiceå¯æˆåŠŸåˆå§‹åŒ–ï¼ˆåŠ è½½è‡³å°‘2ç§ç–¾ç—…ï¼‰
- [ ] `get_diseases_by_genus("Rosa")` è¿”å›ç«ç‘°å±ç–¾ç—…åˆ—è¡¨
- [ ] `get_all_diseases()` è¿”å›æ‰€æœ‰ç–¾ç—…åˆ—è¡¨
- [ ] `get_disease_by_id("rose_black_spot")` è¿”å›æ­£ç¡®çš„ç–¾ç—…å¯¹è±¡
- [ ] `reload()` çƒ­æ›´æ–°æµ‹è¯•é€šè¿‡ï¼ˆä¿®æ”¹JSONåé‡æ–°åŠ è½½ç”Ÿæ•ˆï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.3ï¼ˆKnowledgeLoaderï¼‰å®Œæˆ

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_knowledge_service.py
import pytest
from services.knowledge_service import KnowledgeService
from infrastructure.ontology.loader import JSONKnowledgeLoader

@pytest.mark.asyncio
async def test_initialize_knowledge_service():
    """æµ‹è¯•çŸ¥è¯†åº“æœåŠ¡åˆå§‹åŒ–"""
    loader = JSONKnowledgeLoader(base_path="backend/knowledge_base")
    service = KnowledgeService(loader=loader)

    # åˆå§‹åŒ–çŸ¥è¯†åº“
    await service.initialize()

    # éªŒè¯
    assert service.knowledge_base is not None
    all_diseases = service.get_all_diseases()
    assert len(all_diseases) >= 2  # è‡³å°‘2ç§ç–¾ç—…

@pytest.mark.asyncio
async def test_get_diseases_by_genus():
    """æµ‹è¯•æŒ‰èŠ±å‰å±æŸ¥è¯¢ç–¾ç—…"""
    loader = JSONKnowledgeLoader(base_path="backend/knowledge_base")
    service = KnowledgeService(loader=loader)
    await service.initialize()

    # æŸ¥è¯¢ç«ç‘°å±ç–¾ç—…
    rosa_diseases = service.get_diseases_by_genus("Rosa")

    # éªŒè¯
    assert len(rosa_diseases) > 0
    assert all(d.host_genus == "Rosa" for d in rosa_diseases)

@pytest.mark.asyncio
async def test_reload_knowledge_base():
    """æµ‹è¯•çŸ¥è¯†åº“çƒ­æ›´æ–°"""
    loader = JSONKnowledgeLoader(base_path="backend/knowledge_base")
    service = KnowledgeService(loader=loader)
    await service.initialize()

    # è®°å½•åˆå§‹ç–¾ç—…æ•°é‡
    initial_count = len(service.get_all_diseases())

    # çƒ­æ›´æ–°
    await service.reload()

    # éªŒè¯ï¼ˆæ•°é‡åº”è¯¥ä¸€è‡´ï¼Œè¯æ˜é‡æ–°åŠ è½½æˆåŠŸï¼‰
    new_count = len(service.get_all_diseases())
    assert new_count == initial_count
```

**æ¶æ„è¯´æ˜**ï¼š
- KnowledgeServiceæ˜¯**Layer 3åº”ç”¨æœåŠ¡**ï¼ˆä¾èµ–KnowledgeLoaderï¼‰
- è¢«DiagnosisServiceï¼ˆLayer 4æœåŠ¡ï¼‰è°ƒç”¨
- å®ç°é¡ºåºï¼šP2.3ï¼ˆKnowledgeLoaderï¼‰ â†’ P3.5ï¼ˆKnowledgeServiceï¼‰ â†’ P3.1-P3.4ï¼ˆDiagnosisServiceï¼‰

---

#### P3.6 å›¾ç‰‡æœåŠ¡å®ç°ï¼ˆImageServiceï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°ImageServiceç±»ï¼ˆ`backend/services/image_service.py`ï¼‰
2. å®ç°å›¾ç‰‡ä¿å­˜ï¼ˆ`save_image`æ–¹æ³•ï¼Œè°ƒç”¨LocalImageStorageä¿å­˜å›¾ç‰‡ï¼‰
3. å®ç°å›¾ç‰‡å…ƒæ•°æ®æŒä¹…åŒ–ï¼ˆè°ƒç”¨ImageRepositoryä¿å­˜åˆ°æ•°æ®åº“ï¼‰
4. å®ç°å‡†ç¡®æ€§æ ‡æ³¨ï¼ˆ`update_accuracy_label`æ–¹æ³•ï¼Œç§»åŠ¨æ–‡ä»¶åˆ°correct/incorrectæ–‡ä»¶å¤¹ï¼‰
5. å®ç°å›¾ç‰‡æŸ¥è¯¢ï¼ˆ`query_images`æ–¹æ³•ï¼ŒæŒ‰èŠ±å‰å±ã€å‡†ç¡®æ€§ã€æ—¥æœŸèŒƒå›´ç­›é€‰ï¼‰
6. å®ç°å›¾ç‰‡åˆ é™¤ï¼ˆ`delete_image`æ–¹æ³•ï¼Œè½¯åˆ é™¤ï¼‰
7. å®ç°ImageRepositoryï¼ˆ`backend/infrastructure/persistence/repositories/image_repo.py`ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/services/image_service.py`ï¼šImageServiceç±»
- `backend/infrastructure/persistence/repositories/image_repo.py`ï¼šImageRepositoryç±»

**éªŒæ”¶æ ‡å‡†ï¼ˆG3.6ï¼‰**ï¼š
- [ ] ImageServiceå¯æˆåŠŸä¿å­˜å›¾ç‰‡ï¼ˆæ–‡ä»¶å­˜åœ¨äºæ­£ç¡®è·¯å¾„ï¼‰
- [ ] å›¾ç‰‡å…ƒæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆ`images`è¡¨ï¼‰
- [ ] `update_accuracy_label()` æµ‹è¯•é€šè¿‡ï¼ˆæ–‡ä»¶ç§»åŠ¨æˆåŠŸï¼‰
- [ ] `query_images()` æµ‹è¯•é€šè¿‡ï¼ˆæŒ‰æ¡ä»¶ç­›é€‰ï¼‰
- [ ] `delete_image()` æµ‹è¯•é€šè¿‡ï¼ˆè½¯åˆ é™¤ï¼Œæ–‡ä»¶å’Œæ•°æ®åº“è®°å½•éƒ½æ ‡è®°ä¸ºå·²åˆ é™¤ï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.6ï¼ˆLocalImageStorageï¼‰å®Œæˆ

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# backend/tests/unit/test_image_service.py
import pytest
from services.image_service import ImageService
from infrastructure.storage.local_storage import LocalImageStorage
from infrastructure.persistence.repositories.image_repo import ImageRepository

@pytest.mark.asyncio
async def test_save_image():
    """æµ‹è¯•å›¾ç‰‡ä¿å­˜"""
    storage = LocalImageStorage(base_path="tests/storage_test")
    repo = ImageRepository(db_pool=...)
    service = ImageService(storage=storage, image_repo=repo)

    # ä¿å­˜å›¾ç‰‡
    image_bytes = b"fake_image_data"
    image_id = await service.save_image(
        image_bytes=image_bytes,
        diagnosis_id="diag_20251111_001",
        plant_genus="rosa",
        organ="leaf"
    )

    # éªŒè¯æ–‡ä»¶å­˜åœ¨
    assert image_id is not None

    # éªŒè¯æ•°æ®åº“è®°å½•
    image_metadata = await repo.get_by_id(image_id)
    assert image_metadata.plant_genus == "rosa"
    assert image_metadata.accuracy_label == "unlabeled"

@pytest.mark.asyncio
async def test_update_accuracy_label():
    """æµ‹è¯•å‡†ç¡®æ€§æ ‡æ³¨"""
    storage = LocalImageStorage(base_path="tests/storage_test")
    repo = ImageRepository(db_pool=...)
    service = ImageService(storage=storage, image_repo=repo)

    # å…ˆä¿å­˜ä¸€å¼ å›¾ç‰‡
    image_bytes = b"fake_image_data"
    image_id = await service.save_image(
        image_bytes=image_bytes,
        diagnosis_id="diag_20251111_002",
        plant_genus="rosa",
        organ="leaf"
    )

    # æ›´æ–°å‡†ç¡®æ€§æ ‡ç­¾
    await service.update_accuracy_label(
        image_id=image_id,
        label="correct"
    )

    # éªŒè¯æ•°æ®åº“æ›´æ–°
    image_metadata = await repo.get_by_id(image_id)
    assert image_metadata.accuracy_label == "correct"

    # éªŒè¯æ–‡ä»¶å·²ç§»åŠ¨
    assert "correct/rosa/" in image_metadata.file_path

@pytest.mark.asyncio
async def test_query_images():
    """æµ‹è¯•å›¾ç‰‡æŸ¥è¯¢"""
    storage = LocalImageStorage(base_path="tests/storage_test")
    repo = ImageRepository(db_pool=...)
    service = ImageService(storage=storage, image_repo=repo)

    # æŸ¥è¯¢æ‰€æœ‰ç«ç‘°å±å›¾ç‰‡
    images = await service.query_images(
        genus="rosa",
        accuracy_label="unlabeled"
    )

    # éªŒè¯
    assert len(images) > 0
    assert all(img.plant_genus == "rosa" for img in images)
    assert all(img.accuracy_label == "unlabeled" for img in images)
```

**æ¶æ„è¯´æ˜**ï¼š
- ImageServiceæ˜¯**Layer 3åº”ç”¨æœåŠ¡**ï¼ˆä¾èµ–LocalImageStorage + ImageRepositoryï¼‰
- è¢«DiagnosisServiceï¼ˆLayer 4æœåŠ¡ï¼‰å’ŒAdminRouterè°ƒç”¨
- å®ç°é¡ºåºï¼šP2.6ï¼ˆLocalImageStorageï¼‰ â†’ P3.6ï¼ˆImageServiceï¼‰ â†’ P4.3ï¼ˆå›¾ç‰‡ç®¡ç†APIï¼‰

---

**P3é˜¶æ®µGateï¼ˆG3ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G3.1ï¼šQ0é€çº§è¿‡æ»¤æµ‹è¯•é€šè¿‡
- [x] G3.2ï¼šQ1-Q6åŠ¨æ€ç‰¹å¾æå–æµ‹è¯•é€šè¿‡
- [x] G3.3ï¼šä¸‰å±‚æ¸è¿›è¯Šæ–­æµç¨‹æµ‹è¯•é€šè¿‡ï¼ˆä½¿ç”¨Rose Black Spot + Cherry Powdery Mildewæµ‹è¯•ï¼‰
- [x] G3.4ï¼šVLMå…œåº•ç­–ç•¥æµ‹è¯•é€šè¿‡
- [x] G3.5ï¼šçŸ¥è¯†åº“æœåŠ¡å•å…ƒæµ‹è¯•é€šè¿‡
- [x] G3.6ï¼šå›¾ç‰‡æœåŠ¡å•å…ƒæµ‹è¯•é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `backend/services/diagnosis_service.py`ï¼ˆDiagnosisServiceå®Œæ•´å®ç°ï¼‰
- [ ] `backend/services/knowledge_service.py`ï¼ˆKnowledgeServiceå®Œæ•´å®ç°ï¼‰
- [ ] `backend/services/image_service.py`ï¼ˆImageServiceå®Œæ•´å®ç°ï¼‰
- [ ] `backend/infrastructure/persistence/repositories/image_repo.py`ï¼ˆImageRepositoryï¼‰
- [ ] `backend/tests/integration/test_q0_filtering.py`
- [ ] `backend/tests/integration/test_diagnosis_flow.py`

éªŒæ”¶æµ‹è¯•ï¼š
- [ ] ä½¿ç”¨æµ‹è¯•æ•°æ®é›†ï¼ˆRose Black Spot 12å¼ å›¾ç‰‡ï¼‰ï¼Œç¡®è¯Šç‡ â‰¥ 65%
- [ ] ä½¿ç”¨æµ‹è¯•æ•°æ®é›†ï¼ˆCherry Powdery Mildew 12å¼ å›¾ç‰‡ï¼‰ï¼Œç¡®è¯Šç‡ â‰¥ 65%

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœç¡®è¯Šç‡ < 65% â†’ è°ƒæ•´æç¤ºè¯ã€ç‰¹å¾æƒé‡ï¼Œé‡æ–°æµ‹è¯•
- å¦‚æœVLMå…œåº•å¤±è´¥ â†’ æ ‡è®°ä¸º **[å¾…å†³ç­–]**ï¼Œå‘ç”¨æˆ·æé—®

---

### P4: è¯Šæ–­APIå¼€å‘

**ç›®æ ‡**ï¼šå®ç°FastAPIæœåŠ¡ã€è¯Šæ–­è·¯ç”±ã€å›¾ç‰‡ç®¡ç†APIã€ç®€å•è®¤è¯ä¸­é—´ä»¶

**é¢„ä¼°æ—¶é—´**ï¼š1.25å¤©ï¼ˆ10å°æ—¶ï¼‰

---

#### P4.1 FastAPIåŸºç¡€æ¡†æ¶

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°FastAPIåº”ç”¨ä¸»å…¥å£ï¼ˆ`apps/api/main.py`ï¼‰
2. é…ç½®CORSä¸­é—´ä»¶ï¼ˆå…è®¸å‰ç«¯è·¨åŸŸï¼‰
3. é…ç½®å¼‚å¸¸å¤„ç†å™¨ï¼ˆç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼ï¼‰
4. å®ç°ä¾èµ–æ³¨å…¥ï¼ˆ`apps/api/deps.py`ï¼‰ï¼š
   - `get_db_pool()`ï¼šPostgreSQLè¿æ¥æ± 
   - `get_redis_client()`ï¼šRediså®¢æˆ·ç«¯
   - `get_vlm_client()`ï¼šVLMå®¢æˆ·ç«¯
   - `get_knowledge_base()`ï¼šçŸ¥è¯†åº“
5. å®ç°é…ç½®ç®¡ç†ï¼ˆ`core/config.py`ï¼‰ï¼šä» `.env` åŠ è½½é…ç½®

**äº§å‡ºç‰©**ï¼š
- `backend/apps/api/main.py`
- `backend/apps/api/deps.py`
- `backend/core/config.py`
- `backend/.env.example`

**éªŒæ”¶æ ‡å‡†ï¼ˆG4.1ï¼‰**ï¼š
- [ ] FastAPIæœåŠ¡å¯åŠ¨æˆåŠŸï¼ˆ`uvicorn apps.api.main:app --reload`ï¼‰
- [ ] `/docs` å¯è®¿é—®ï¼ˆSwagger UIï¼‰
- [ ] ä¾èµ–æ³¨å…¥æµ‹è¯•é€šè¿‡ï¼ˆæ•°æ®åº“è¿æ¥æ± ã€Redisã€VLMå®¢æˆ·ç«¯å¯æ­£å¸¸è·å–ï¼‰
- [ ] é…ç½®ç®¡ç†æµ‹è¯•é€šè¿‡ï¼ˆä» `.env` è¯»å–é…ç½®ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.1å®Œæˆï¼ˆéœ€è¦APIæ¥å£å®šä¹‰ï¼‰

---

#### P4.2 è¯Šæ–­è·¯ç”±å®ç°

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç° `POST /api/v1/diagnose` è·¯ç”±
2. å¤„ç† `multipart/form-data` å›¾ç‰‡ä¸Šä¼ 
3. è°ƒç”¨DiagnosisServiceæ‰§è¡Œè¯Šæ–­
4. è¿”å›DiagnosisResponseï¼ˆç¬¦åˆOpenAPIè§„èŒƒï¼‰
5. é”™è¯¯å¤„ç†ï¼ˆ400/500é”™è¯¯ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/apps/api/routers/diagnosis.py`
- `backend/apps/api/schemas/diagnosis.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG4.2ï¼‰**ï¼š
- [ ] Postmanæµ‹è¯•é€šè¿‡ï¼ˆä¸Šä¼ å›¾ç‰‡ â†’ è¿”å›è¯Šæ–­ç»“æœï¼‰
- [ ] å“åº”æ ¼å¼ç¬¦åˆOpenAPIè§„èŒƒ
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®ï¼ˆå¦‚ä¸Šä¼ éå›¾ç‰‡æ–‡ä»¶ â†’ 400é”™è¯¯ï¼‰
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP3.3å®Œæˆï¼ˆéœ€è¦DiagnosisServiceï¼‰

**Postmanæµ‹è¯•æ­¥éª¤**ï¼š
1. è¯·æ±‚æ–¹æ³•ï¼šPOST
2. URLï¼š`http://localhost:8000/api/v1/diagnose`
3. Bodyï¼šform-dataï¼Œkey=`image`ï¼Œvalue=é€‰æ‹©å›¾ç‰‡æ–‡ä»¶
4. å‘é€è¯·æ±‚ â†’ éªŒè¯å“åº”

---

#### P4.3 å›¾ç‰‡ç®¡ç†API

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°å›¾ç‰‡æŸ¥è¯¢APIï¼ˆ`GET /api/v1/images`ï¼‰ï¼š
   - æ”¯æŒæŒ‰èŠ±å‰å±ï¼ˆgenusï¼‰ç­›é€‰
   - æ”¯æŒæŒ‰å‡†ç¡®æ€§æ ‡ç­¾ï¼ˆaccuracy_labelï¼‰ç­›é€‰
   - æ”¯æŒæŒ‰æ—¥æœŸèŒƒå›´ï¼ˆdate_rangeï¼‰ç­›é€‰
   - è¿”å›å›¾ç‰‡åˆ—è¡¨ï¼ˆåŒ…å«å…ƒæ•°æ®ï¼‰
2. å®ç°å‡†ç¡®æ€§æ ‡æ³¨APIï¼ˆ`PATCH /api/v1/images/{image_id}/label`ï¼‰ï¼š
   - æ¥æ”¶å‡†ç¡®æ€§æ ‡ç­¾ï¼ˆcorrect/incorrectï¼‰
   - è°ƒç”¨ImageServiceæ›´æ–°æ ‡ç­¾ï¼ˆç§»åŠ¨æ–‡ä»¶ï¼‰
3. å®ç°å›¾ç‰‡åˆ é™¤APIï¼ˆ`DELETE /api/v1/images/{image_id}`ï¼‰ï¼š
   - è½¯åˆ é™¤å›¾ç‰‡ï¼ˆæ ‡è®°ä¸ºå·²åˆ é™¤ï¼‰
4. é”™è¯¯å¤„ç†ï¼ˆ404/400/500é”™è¯¯ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/apps/api/routers/image.py`ï¼šå›¾ç‰‡ç®¡ç†è·¯ç”±
- `backend/apps/api/schemas/image.py`ï¼šå›¾ç‰‡API Schema

**éªŒæ”¶æ ‡å‡†ï¼ˆG4.3ï¼‰**ï¼š
- [ ] å›¾ç‰‡æŸ¥è¯¢APIæµ‹è¯•é€šè¿‡ï¼ˆPostmanæµ‹è¯•ï¼Œæ”¯æŒç­›é€‰æ¡ä»¶ï¼‰
- [ ] å‡†ç¡®æ€§æ ‡æ³¨APIæµ‹è¯•é€šè¿‡ï¼ˆæ ‡æ³¨åæ–‡ä»¶ç§»åŠ¨æˆåŠŸï¼‰
- [ ] å›¾ç‰‡åˆ é™¤APIæµ‹è¯•é€šè¿‡ï¼ˆè½¯åˆ é™¤æˆåŠŸï¼‰
- [ ] å“åº”æ ¼å¼ç¬¦åˆOpenAPIè§„èŒƒ
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®ï¼ˆå¦‚å›¾ç‰‡ä¸å­˜åœ¨ â†’ 404é”™è¯¯ï¼‰
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP3.6ï¼ˆImageServiceï¼‰å®Œæˆ

**Postmanæµ‹è¯•æ­¥éª¤**ï¼š
1. **æŸ¥è¯¢å›¾ç‰‡**ï¼š
   - GET `/api/v1/images?genus=rosa&accuracy_label=unlabeled`
   - éªŒè¯è¿”å›ç«ç‘°å±æœªæ ‡æ³¨å›¾ç‰‡åˆ—è¡¨
2. **æ ‡æ³¨å›¾ç‰‡**ï¼š
   - PATCH `/api/v1/images/{image_id}/label`
   - Body: `{"label": "correct"}`
   - éªŒè¯è¿”å›200ï¼Œæ–‡ä»¶ç§»åŠ¨åˆ°correctæ–‡ä»¶å¤¹
3. **åˆ é™¤å›¾ç‰‡**ï¼š
   - DELETE `/api/v1/images/{image_id}`
   - éªŒè¯è¿”å›204ï¼Œå›¾ç‰‡æ ‡è®°ä¸ºå·²åˆ é™¤

**æ¶æ„è¯´æ˜**ï¼š
- P4.3æ˜¯**çº¯APIå±‚**ï¼ˆä¸å®ç°åŸºç¡€è®¾æ–½æ¨¡å—æˆ–æœåŠ¡ï¼‰
- LocalImageStorageå·²åœ¨P2.6å®ç°ï¼ˆLayer 1æ¨¡å—ï¼‰
- ImageServiceå·²åœ¨P3.6å®ç°ï¼ˆLayer 3æœåŠ¡ï¼‰
- P4.3åªè´Ÿè´£APIè·¯ç”±å’Œè¯·æ±‚å¤„ç†

---

#### P4.4 ç®€å•è®¤è¯ä¸­é—´ä»¶

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°ç®¡ç†åå°è´¦å·å¯†ç ç™»å½•ï¼ˆ`POST /api/v1/auth/login`ï¼‰
2. ä½¿ç”¨bcryptå“ˆå¸Œå­˜å‚¨å¯†ç ï¼ˆ`admin_users` è¡¨ï¼‰
3. ç™»å½•æˆåŠŸè¿”å›ç®€å•tokenï¼ˆæˆ–sessionï¼‰
4. å®ç°è®¤è¯ä¸­é—´ä»¶ï¼ˆéªŒè¯tokenï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/apps/api/routers/auth.py`
- `backend/apps/api/middleware/auth.py`
- `backend/core/security.py`ï¼ˆå¯†ç å“ˆå¸Œã€tokenç”Ÿæˆï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG4.4ï¼‰**ï¼š
- [ ] ç™»å½•æ¥å£æµ‹è¯•é€šè¿‡ï¼ˆæ­£ç¡®å¯†ç  â†’ è¿”å›tokenï¼‰
- [ ] è®¤è¯ä¸­é—´ä»¶æµ‹è¯•é€šè¿‡ï¼ˆæ— token â†’ 401é”™è¯¯ï¼‰
- [ ] å¯†ç å“ˆå¸Œæµ‹è¯•é€šè¿‡ï¼ˆbcryptéªŒè¯ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.2å®Œæˆï¼ˆéœ€è¦ `admin_users` è¡¨ï¼‰

**ç®€åŒ–æ–¹æ¡ˆ**ï¼ˆMVPç‰ˆæœ¬ï¼‰ï¼š
- ä½¿ç”¨JWT tokenï¼ˆæœ‰æ•ˆæœŸ7å¤©ï¼‰
- æ— éœ€åˆ·æ–°tokenæœºåˆ¶
- æ— éœ€éªŒè¯ç 

---

**P4é˜¶æ®µGateï¼ˆG4ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G4.1ï¼šFastAPIæœåŠ¡å¯åŠ¨æˆåŠŸï¼ŒSwagger UIå¯è®¿é—®
- [x] G4.2ï¼šè¯Šæ–­API Postmanæµ‹è¯•é€šè¿‡
- [x] G4.3ï¼šå›¾ç‰‡ç®¡ç†API Postmanæµ‹è¯•é€šè¿‡
- [x] G4.4ï¼šè®¤è¯ä¸­é—´ä»¶æµ‹è¯•é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `backend/apps/api/` ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆå«routers/diagnosis.py, routers/image.py, routers/auth.pyï¼‰
- [ ] Postmanæµ‹è¯•é›†åˆï¼ˆå¯¼å‡ºJSONæ–‡ä»¶ï¼‰

éªŒæ”¶æµ‹è¯•ï¼š
- [ ] ä½¿ç”¨Postmanå®Œæ•´æµ‹è¯•è¯Šæ–­APIæµç¨‹ï¼ˆä¸Šä¼ å›¾ç‰‡ â†’ è·å–ç»“æœ â†’ éªŒè¯å‡†ç¡®æ€§ï¼‰

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœAPIè¿”å›500é”™è¯¯ â†’ æ£€æŸ¥æ—¥å¿—ï¼Œä¿®å¤bug
- å¦‚æœå›¾ç‰‡å­˜å‚¨å¤±è´¥ â†’ æ£€æŸ¥æ–‡ä»¶æƒé™ï¼Œä¿®æ­£è·¯å¾„

---

### P5: ç®¡ç†åå°å¼€å‘ï¼ˆStreamlitï¼‰

**ç›®æ ‡**ï¼šå®ç°ç–¾ç—…ç®¡ç†ç•Œé¢ã€è¯Šæ–­æµ‹è¯•ç•Œé¢ã€ç»Ÿè®¡åˆ†æç•Œé¢ã€è´¦å·å¯†ç ç™»å½•

**é¢„ä¼°æ—¶é—´**ï¼š2å¤©ï¼ˆ16å°æ—¶ï¼‰

---

#### P5.1 ç–¾ç—…ç®¡ç†ç•Œé¢ï¼ˆCRUDï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. åˆ›å»ºStreamlitå¤šé¡µé¢åº”ç”¨ï¼ˆ`apps/admin/app.py`ï¼‰
2. å®ç°ç–¾ç—…åˆ—è¡¨å±•ç¤ºï¼ˆåˆ†é¡µã€æœç´¢ã€ç­›é€‰ï¼‰
3. å®ç°ç–¾ç—…è¯¦æƒ…æŸ¥çœ‹ï¼ˆå±•ç¤ºJSONå†…å®¹ï¼Œä½¿ç”¨Monaco Editorï¼‰
4. å®ç°ç–¾ç—…æ–°å¢ï¼ˆè¡¨å• + JSONç¼–è¾‘å™¨ï¼‰
5. å®ç°ç–¾ç—…ç¼–è¾‘ï¼ˆä¿å­˜æ—¶åˆ›å»ºæ–°ç‰ˆæœ¬ï¼‰
6. å®ç°ç–¾ç—…åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼Œä¸åˆ é™¤JSONæ–‡ä»¶ï¼‰
7. å®ç°çŸ¥è¯†åº“é‡è½½ï¼ˆè°ƒç”¨ `POST /api/v1/admin/reload`ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/apps/admin/app.py`
- `backend/apps/admin/pages/1_ğŸŒ¸_ç–¾ç—…ç®¡ç†.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG5.1ï¼‰**ï¼š
- [ ] Streamlitåº”ç”¨å¯åŠ¨æˆåŠŸï¼ˆ`streamlit run apps/admin/app.py`ï¼‰
- [ ] ç–¾ç—…åˆ—è¡¨æ˜¾ç¤ºæ­£ç¡®ï¼ˆè‡³å°‘æ˜¾ç¤º2ç§ç–¾ç—…ï¼‰
- [ ] æ–°å¢ç–¾ç—…æµ‹è¯•é€šè¿‡ï¼ˆå¡«å†™è¡¨å• â†’ ä¿å­˜ â†’ JSONæ–‡ä»¶åˆ›å»ºï¼‰
- [ ] ç¼–è¾‘ç–¾ç—…æµ‹è¯•é€šè¿‡ï¼ˆä¿®æ”¹JSON â†’ ä¿å­˜ â†’ çŸ¥è¯†åº“é‡è½½ç”Ÿæ•ˆï¼‰
- [ ] åˆ é™¤ç–¾ç—…æµ‹è¯•é€šè¿‡
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼ˆç”¨æˆ·ä½“éªŒæµç•…ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2.3å®Œæˆï¼ˆéœ€è¦çŸ¥è¯†åº“åŠ è½½å™¨ï¼‰

**ç•Œé¢åŸå‹**ï¼š
```
ç–¾ç—…ç®¡ç†

[æœç´¢æ¡†ï¼šç–¾ç—…åç§°]  [ç­›é€‰ï¼šèŠ±å‰å± â–¼]  [+ æ–°å¢ç–¾ç—…]

| ç–¾ç—…ID              | ç–¾ç—…åç§°      | èŠ±å‰å± | ç‰ˆæœ¬ | æ“ä½œ        |
|--------------------|-------------|--------|------|------------|
| rose_black_spot    | ç«ç‘°é»‘æ–‘ç—…    | Rosa   | v4.1 | æŸ¥çœ‹ ç¼–è¾‘ åˆ é™¤ |
| cherry_powdery_... | æ¨±èŠ±ç™½ç²‰ç—…    | Prunus | v4.1 | æŸ¥çœ‹ ç¼–è¾‘ åˆ é™¤ |

[å½“å‰çŸ¥è¯†åº“ç‰ˆæœ¬: v1.0]  [ğŸ”„ é‡è½½çŸ¥è¯†åº“]
```

---

#### P5.2 è¯Šæ–­æµ‹è¯•ç•Œé¢

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼ˆæ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼‰
2. è°ƒç”¨è¯Šæ–­APIï¼ˆ`POST /api/v1/diagnose`ï¼‰
3. æ˜¾ç¤ºè¯Šæ–­ç»“æœï¼š
   - è¯Šæ–­çŠ¶æ€ï¼ˆconfirmed/suspected/uncertainï¼‰
   - ç–¾ç—…åç§°
   - ç½®ä¿¡åº¦
   - åŒ¹é…çš„å…³é”®ç‰¹å¾
   - ç‰¹å¾å‘é‡ï¼ˆJSONæŠ˜å æ˜¾ç¤ºï¼‰
4. æ”¯æŒå‡†ç¡®æ€§æ ‡æ³¨ï¼ˆæ­£ç¡®/é”™è¯¯ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/apps/admin/pages/2_ğŸ”¬_è¯Šæ–­æµ‹è¯•.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG5.2ï¼‰**ï¼š
- [ ] å›¾ç‰‡ä¸Šä¼ æˆåŠŸ
- [ ] è¯Šæ–­ç»“æœæ˜¾ç¤ºæ­£ç¡®
- [ ] å‡†ç¡®æ€§æ ‡æ³¨åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼ˆæ ‡æ³¨åå›¾ç‰‡ç§»åŠ¨åˆ°correct/incorrectæ–‡ä»¶å¤¹ï¼‰
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP4.2å®Œæˆï¼ˆéœ€è¦è¯Šæ–­APIï¼‰

**ç•Œé¢åŸå‹**ï¼š
```
è¯Šæ–­æµ‹è¯•

[ä¸Šä¼ å›¾ç‰‡ï¼ˆæ‹–æ‹½æˆ–ç‚¹å‡»é€‰æ‹©ï¼‰]

è¯Šæ–­ç»“æœï¼š

âœ… ç¡®è¯Šï¼ˆConfirmedï¼‰
ç–¾ç—…åç§°ï¼šç«ç‘°é»‘æ–‘ç—… (Rose Black Spot)
ç½®ä¿¡åº¦ï¼š0.95
ç—…åŸï¼šDiplocarpon rosae

åŒ¹é…çš„å…³é”®ç‰¹å¾ï¼š
âœ“ ç—‡çŠ¶ç±»å‹ï¼šåæ­»æ–‘ç‚¹ (necrosis_spot)
âœ“ ä¸­å¿ƒé¢œè‰²ï¼šé»‘è‰² (black)
âœ“ è¾¹ç¼˜é¢œè‰²ï¼šé»„è‰²æ™•åœˆ (yellow)

[æŸ¥çœ‹å®Œæ•´ç‰¹å¾å‘é‡ â–¼]

å‡†ç¡®æ€§æ ‡æ³¨ï¼š
( ) æ­£ç¡®  ( ) é”™è¯¯  [æäº¤æ ‡æ³¨]
```

---

#### P5.3 ç»Ÿè®¡åˆ†æç•Œé¢

**ä»»åŠ¡æ¸…å•**ï¼š
1. ç»Ÿè®¡è¯Šæ–­æ€»é‡ï¼ˆæŒ‰æ—¥æœŸã€èŠ±å‰å±ï¼‰
2. ç»Ÿè®¡å‡†ç¡®ç‡ï¼ˆæŒ‰ç–¾ç—…ã€æŒ‰èŠ±å‰å±ï¼‰
3. æ˜¾ç¤ºè¯¯è¯Šæ¡ˆä¾‹åˆ—è¡¨
4. å›¾è¡¨å±•ç¤ºï¼ˆä½¿ç”¨StreamlitåŸç”Ÿå›¾è¡¨ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/apps/admin/pages/3_ğŸ“Š_ç»Ÿè®¡åˆ†æ.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG5.3ï¼‰**ï¼š
- [ ] ç»Ÿè®¡æ•°æ®æ˜¾ç¤ºæ­£ç¡®
- [ ] å‡†ç¡®ç‡è®¡ç®—æ­£ç¡®
- [ ] è¯¯è¯Šæ¡ˆä¾‹åˆ—è¡¨å¯æŸ¥çœ‹
- [ ] å›¾è¡¨æ˜¾ç¤ºæ­£å¸¸

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP4.3å®Œæˆï¼ˆéœ€è¦å›¾ç‰‡å…ƒæ•°æ®ï¼‰

**ç•Œé¢åŸå‹**ï¼š
```
ç»Ÿè®¡åˆ†æ

æ€»è¯Šæ–­é‡ï¼š128
å‡†ç¡®ç‡ï¼š72.5% (93/128)

æŒ‰ç–¾ç—…ç»Ÿè®¡ï¼š
| ç–¾ç—…åç§°      | è¯Šæ–­é‡ | æ­£ç¡® | é”™è¯¯ | å‡†ç¡®ç‡ |
|-------------|--------|-----|------|--------|
| ç«ç‘°é»‘æ–‘ç—…    | 64     | 58  | 6    | 90.6%  |
| æ¨±èŠ±ç™½ç²‰ç—…    | 64     | 35  | 29   | 54.7%  |

[å‡†ç¡®ç‡è¶‹åŠ¿å›¾]

è¯¯è¯Šæ¡ˆä¾‹ï¼š
| å›¾ç‰‡         | è¯Šæ–­ç»“æœ      | å®é™…ç–¾ç—… | æ—¥æœŸ       |
|-------------|-------------|---------|-----------|
| rose_001.jpg| æ¨±èŠ±ç™½ç²‰ç—…    | ç«ç‘°é»‘æ–‘ç—… | 2025-11-10 |
```

---

#### P5.4 è´¦å·å¯†ç ç™»å½•

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°Streamlitè®¤è¯ï¼ˆä½¿ç”¨ `st.session_state`ï¼‰
2. ç™»å½•è¡¨å•ï¼ˆè´¦å· + å¯†ç ï¼‰
3. è°ƒç”¨ `POST /api/v1/auth/login`
4. ç™»å½•æˆåŠŸåæ˜¾ç¤ºä¸»ç•Œé¢

**äº§å‡ºç‰©**ï¼š
- `backend/apps/admin/utils/auth.py`
- `backend/apps/admin/app.py`ï¼ˆåŠ å…¥ç™»å½•é€»è¾‘ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG5.4ï¼‰**ï¼š
- [ ] æœªç™»å½•æ—¶æ˜¾ç¤ºç™»å½•è¡¨å•
- [ ] ç™»å½•æˆåŠŸåè·³è½¬åˆ°ä¸»ç•Œé¢
- [ ] ç™»å½•å¤±è´¥æ˜¾ç¤ºé”™è¯¯æç¤º
- [ ] ç™»å‡ºåŠŸèƒ½æµ‹è¯•é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP4.4å®Œæˆï¼ˆéœ€è¦è®¤è¯APIï¼‰

---

**P5é˜¶æ®µGateï¼ˆG5ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G5.1ï¼šç–¾ç—…ç®¡ç†ç•Œé¢åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [x] G5.2ï¼šè¯Šæ–­æµ‹è¯•ç•Œé¢åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [x] G5.3ï¼šç»Ÿè®¡åˆ†æç•Œé¢åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [x] G5.4ï¼šè´¦å·å¯†ç ç™»å½•åŠŸèƒ½æµ‹è¯•é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `backend/apps/admin/` ä¸‹æ‰€æœ‰æ–‡ä»¶
- [ ] ç®¡ç†åå°åŠŸèƒ½æµ‹è¯•æŠ¥å‘Šï¼ˆæˆªå›¾ + æµ‹è¯•æ­¥éª¤ï¼‰

éªŒæ”¶æµ‹è¯•ï¼š
- [ ] ä½¿ç”¨ç®¡ç†åå°å®Œæ•´æµç¨‹æµ‹è¯•ï¼šç™»å½• â†’ æ–°å¢ç–¾ç—… â†’ è¯Šæ–­æµ‹è¯• â†’ å‡†ç¡®æ€§æ ‡æ³¨ â†’ æŸ¥çœ‹ç»Ÿè®¡

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœStreamlitå¯åŠ¨å¤±è´¥ â†’ æ£€æŸ¥ä¾èµ–å®‰è£…ï¼Œæ£€æŸ¥ç«¯å£å ç”¨
- å¦‚æœç•Œé¢åŠŸèƒ½å¼‚å¸¸ â†’ æ£€æŸ¥æ—¥å¿—ï¼Œä¿®å¤bug

---

### P6: WebéªŒè¯ç•Œé¢å¼€å‘ï¼ˆNext.jsï¼‰

**ç›®æ ‡**ï¼šå®ç°å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ã€è¯Šæ–­ç»“æœå±•ç¤ºã€å†å²è®°å½•æŸ¥è¯¢

**é¢„ä¼°æ—¶é—´**ï¼š1.5å¤©ï¼ˆ12å°æ—¶ï¼‰

---

#### P6.1 å›¾ç‰‡ä¸Šä¼ ç»„ä»¶

**ä»»åŠ¡æ¸…å•**ï¼š
1. åˆ›å»ºNext.js 15é¡¹ç›®ï¼ˆApp Routerï¼‰
2. å®ç°å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼ˆä½¿ç”¨Shadcn UIï¼‰
3. æ”¯æŒæ‹–æ‹½ä¸Šä¼ 
4. å›¾ç‰‡é¢„è§ˆ
5. è°ƒç”¨è¯Šæ–­APIï¼ˆ`POST /api/v1/diagnose`ï¼‰

**äº§å‡ºç‰©**ï¼š
- `frontend/components/ImageUploader.tsx`
- `frontend/app/diagnose/page.tsx`
- `frontend/lib/api.ts`ï¼ˆAPIè°ƒç”¨å°è£…ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG6.1ï¼‰**ï¼š
- [ ] Next.jså¼€å‘æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
- [ ] å›¾ç‰‡ä¸Šä¼ ç»„ä»¶æ˜¾ç¤ºæ­£å¸¸
- [ ] æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] å›¾ç‰‡é¢„è§ˆåŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] è°ƒç”¨è¯Šæ–­APIæˆåŠŸ

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP4.2å®Œæˆï¼ˆéœ€è¦è¯Šæ–­APIï¼‰

---

#### P6.2 è¯Šæ–­ç»“æœå±•ç¤º

**ä»»åŠ¡æ¸…å•**ï¼š
1. åˆ›å»ºè¯Šæ–­ç»“æœå±•ç¤ºç»„ä»¶
2. æ˜¾ç¤ºç–¾ç—…åç§°ã€ç½®ä¿¡åº¦ã€ç—…åŸ
3. æ˜¾ç¤ºåŒ¹é…çš„å…³é”®ç‰¹å¾
4. æ”¯æŒç‰¹å¾å‘é‡JSONæŠ˜å æ˜¾ç¤º

**äº§å‡ºç‰©**ï¼š
- `frontend/components/DiagnosisResult.tsx`

**éªŒæ”¶æ ‡å‡†ï¼ˆG6.2ï¼‰**ï¼š
- [ ] è¯Šæ–­ç»“æœæ˜¾ç¤ºæ­£å¸¸
- [ ] ç¡®è¯Š/ç–‘ä¼¼/ä¸ç¡®å®šçŠ¶æ€æ˜¾ç¤ºæ­£ç¡®
- [ ] ç‰¹å¾å‘é‡JSONæŠ˜å æ˜¾ç¤ºæ­£å¸¸
- [ ] æ ·å¼ç¾è§‚

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP6.1å®Œæˆ

---

#### P6.3 å†å²è®°å½•æŸ¥è¯¢

**ä»»åŠ¡æ¸…å•**ï¼š
1. åˆ›å»ºå†å²è®°å½•é¡µé¢
2. è°ƒç”¨APIæŸ¥è¯¢å†å²è¯Šæ–­è®°å½•
3. æ˜¾ç¤ºè¯Šæ–­æ—¶é—´ã€ç–¾ç—…åç§°ã€ç½®ä¿¡åº¦
4. æ”¯æŒæŒ‰æ—¥æœŸç­›é€‰

**äº§å‡ºç‰©**ï¼š
- `frontend/app/history/page.tsx`
- `backend/apps/api/routers/diagnosis.py`ï¼ˆæ–°å¢ `GET /api/v1/diagnoses` æ¥å£ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼ˆG6.3ï¼‰**ï¼š
- [ ] å†å²è®°å½•é¡µé¢æ˜¾ç¤ºæ­£å¸¸
- [ ] å†å²è®°å½•æŸ¥è¯¢APIæµ‹è¯•é€šè¿‡
- [ ] ç­›é€‰åŠŸèƒ½æµ‹è¯•é€šè¿‡

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP6.2å®Œæˆ

---

**P6é˜¶æ®µGateï¼ˆG6ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G6.1ï¼šå›¾ç‰‡ä¸Šä¼ ç»„ä»¶åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [x] G6.2ï¼šè¯Šæ–­ç»“æœå±•ç¤ºåŠŸèƒ½æµ‹è¯•é€šè¿‡
- [x] G6.3ï¼šå†å²è®°å½•æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `frontend/` ä¸‹æ‰€æœ‰æ–‡ä»¶
- [ ] Webç•Œé¢åŠŸèƒ½æµ‹è¯•æŠ¥å‘Šï¼ˆæˆªå›¾ + æµ‹è¯•æ­¥éª¤ï¼‰

éªŒæ”¶æµ‹è¯•ï¼š
- [ ] ä½¿ç”¨Webç•Œé¢å®Œæ•´æµç¨‹æµ‹è¯•ï¼šä¸Šä¼ å›¾ç‰‡ â†’ æ˜¾ç¤ºè¯Šæ–­ç»“æœ â†’ æŸ¥çœ‹å†å²è®°å½•

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœNext.jså¯åŠ¨å¤±è´¥ â†’ æ£€æŸ¥ä¾èµ–å®‰è£…ï¼Œæ£€æŸ¥Node.jsç‰ˆæœ¬
- å¦‚æœAPIè°ƒç”¨å¤±è´¥ â†’ æ£€æŸ¥CORSé…ç½®ï¼Œæ£€æŸ¥APIåœ°å€

---

### P7: æµ‹è¯•å¼€å‘ä¸æ‰§è¡Œ

**ç›®æ ‡**ï¼šç¼–å†™å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œæ‰§è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹

**é¢„ä¼°æ—¶é—´**ï¼š2å¤©ï¼ˆ16å°æ—¶ï¼‰

---

#### P7.1 å•å…ƒæµ‹è¯•ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. ç¼–å†™æ¨¡ç³ŠåŒ¹é…å¼•æ“å•å…ƒæµ‹è¯•ï¼ˆ`test_matcher.py`ï¼‰
2. ç¼–å†™åŠ æƒè¯Šæ–­è¯„åˆ†å™¨å•å…ƒæµ‹è¯•ï¼ˆ`test_scorer.py`ï¼‰
3. ç¼–å†™çŸ¥è¯†åº“åŠ è½½å™¨å•å…ƒæµ‹è¯•ï¼ˆ`test_loader.py`ï¼‰
4. ç¼–å†™PROOF Frameworkå•å…ƒæµ‹è¯•ï¼ˆ`test_proof_framework.py`ï¼‰
5. ç¼–å†™VLMå®¢æˆ·ç«¯å•å…ƒæµ‹è¯•ï¼ˆ`test_vlm_client.py`ï¼Œä½¿ç”¨mockï¼‰
6. ç¡®ä¿å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

**äº§å‡ºç‰©**ï¼š
- `backend/tests/unit/` ä¸‹æ‰€æœ‰å•å…ƒæµ‹è¯•æ–‡ä»¶

**éªŒæ”¶æ ‡å‡†ï¼ˆG7.1ï¼‰**ï¼š
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆ`pytest backend/tests/unit/`ï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%ï¼ˆä½¿ç”¨ `pytest-cov`ï¼‰
- [ ] æµ‹è¯•æŠ¥å‘Šç”Ÿæˆï¼ˆHTMLæ ¼å¼ï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP2-P3å®Œæˆ

---

#### P7.2 é›†æˆæµ‹è¯•ï¼ˆAPIæµç¨‹ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. ç¼–å†™è¯Šæ–­APIé›†æˆæµ‹è¯•ï¼ˆ`test_diagnosis_api.py`ï¼‰
2. ç¼–å†™çŸ¥è¯†åº“é‡è½½é›†æˆæµ‹è¯•ï¼ˆ`test_knowledge_reload.py`ï¼‰
3. ç¼–å†™è®¤è¯æµç¨‹é›†æˆæµ‹è¯•ï¼ˆ`test_auth_flow.py`ï¼‰
4. ä½¿ç”¨çœŸå®çš„PostgreSQL + Redisï¼ˆæµ‹è¯•æ•°æ®åº“ï¼‰

**äº§å‡ºç‰©**ï¼š
- `backend/tests/integration/` ä¸‹æ‰€æœ‰é›†æˆæµ‹è¯•æ–‡ä»¶

**éªŒæ”¶æ ‡å‡†ï¼ˆG7.2ï¼‰**ï¼š
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆ`pytest backend/tests/integration/`ï¼‰
- [ ] æµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“ï¼ˆ`phytooracle_test`ï¼‰
- [ ] æµ‹è¯•åè‡ªåŠ¨æ¸…ç†æ•°æ®

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP4-P5å®Œæˆ

---

#### P7.3 ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå®Œæ•´è¯Šæ–­æµç¨‹ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
1. ç¼–å†™E2Eæµ‹è¯•ï¼ˆä½¿ç”¨Playwrightï¼‰
2. æµ‹è¯•å®Œæ•´è¯Šæ–­æµç¨‹ï¼š
   - æ‰“å¼€Webç•Œé¢
   - ä¸Šä¼ å›¾ç‰‡
   - ç­‰å¾…è¯Šæ–­ç»“æœ
   - éªŒè¯ç»“æœæ­£ç¡®æ€§
3. æµ‹è¯•ç®¡ç†åå°æµç¨‹ï¼š
   - ç™»å½•
   - æ–°å¢ç–¾ç—…
   - è¯Šæ–­æµ‹è¯•
   - æŸ¥çœ‹ç»Ÿè®¡

**äº§å‡ºç‰©**ï¼š
- `backend/tests/e2e/test_diagnosis_flow.py`
- `backend/tests/e2e/test_admin_flow.py`

**éªŒæ”¶æ ‡å‡†ï¼ˆG7.3ï¼‰**ï¼š
- [ ] E2Eæµ‹è¯•é€šè¿‡ï¼ˆ`pytest backend/tests/e2e/`ï¼‰
- [ ] æµ‹è¯•è¦†ç›–Webç•Œé¢ + ç®¡ç†åå°ä¸¤ä¸ªå‰ç«¯åº”ç”¨

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP6å®Œæˆ

---

**P7é˜¶æ®µGateï¼ˆG7ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G7.1ï¼šå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œè¦†ç›–ç‡ â‰¥ 80%
- [x] G7.2ï¼šé›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [x] G7.3ï¼šE2Eæµ‹è¯•å…¨éƒ¨é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `backend/tests/` ä¸‹æ‰€æœ‰æµ‹è¯•æ–‡ä»¶
- [ ] æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼ˆHTMLï¼‰
- [ ] æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Šï¼ˆPytest HTML Reportï¼‰

å¤±è´¥æ—¶è¡ŒåŠ¨ï¼š
- å¦‚æœæµ‹è¯•å¤±è´¥ â†’ ä¿®å¤bugï¼Œé‡æ–°æ‰§è¡Œæµ‹è¯•
- å¦‚æœè¦†ç›–ç‡ä¸è¶³ â†’ è¡¥å……æµ‹è¯•ç”¨ä¾‹

---

### P8: æœ¬åœ°éƒ¨ç½²ä¸éªŒæ”¶

**ç›®æ ‡**ï¼šéƒ¨ç½²PostgreSQL + Redisï¼Œå¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼Œæ‰§è¡ŒéªŒæ”¶æµ‹è¯•

**é¢„ä¼°æ—¶é—´**ï¼š1å¤©ï¼ˆ8å°æ—¶ï¼‰

---

#### P8.1 PostgreSQL + Rediséƒ¨ç½²

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®‰è£…PostgreSQL 14+ï¼ˆWindowsæœ¬åœ°ï¼‰
2. åˆ›å»ºæ•°æ®åº“ `phytooracle`
3. æ‰§è¡ŒDDLè„šæœ¬ï¼ˆ`backend/scripts/init_db.sql`ï¼‰
4. æ‰§è¡Œåˆå§‹åŒ–æ•°æ®è„šæœ¬ï¼ˆ`backend/scripts/seed_data.sql`ï¼‰
5. å®‰è£…Redis 7+ï¼ˆWindowsæœ¬åœ°ï¼‰
6. éªŒè¯PostgreSQL + RedisæœåŠ¡è¿è¡Œ

**äº§å‡ºç‰©**ï¼š
- `docs/deployment/æœ¬åœ°éƒ¨ç½²æŒ‡å—.md`

**éªŒæ”¶æ ‡å‡†ï¼ˆG8.1ï¼‰**ï¼š
- [ ] PostgreSQLæœåŠ¡è¿è¡ŒæˆåŠŸ
- [ ] æ•°æ®åº“ `phytooracle` åˆ›å»ºæˆåŠŸ
- [ ] æ‰€æœ‰è¡¨åˆ›å»ºæˆåŠŸ
- [ ] RedisæœåŠ¡è¿è¡ŒæˆåŠŸ

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP1.2å®Œæˆ

---

#### P8.2 æœåŠ¡å¯åŠ¨ä¸è”è°ƒ

**ä»»åŠ¡æ¸…å•**ï¼š
1. å¯åŠ¨åç«¯APIæœåŠ¡ï¼ˆ`uvicorn apps.api.main:app --reload`ï¼‰
2. å¯åŠ¨ç®¡ç†åå°ï¼ˆ`streamlit run apps/admin/app.py`ï¼‰
3. å¯åŠ¨WebéªŒè¯ç•Œé¢ï¼ˆ`npm run dev`ï¼Œåœ¨ `frontend/` ç›®å½•ï¼‰
4. éªŒè¯ä¸‰ä¸ªæœåŠ¡äº’ç›¸è”è°ƒæˆåŠŸ

**äº§å‡ºç‰©**ï¼š
- æ— 

**éªŒæ”¶æ ‡å‡†ï¼ˆG8.2ï¼‰**ï¼š
- [ ] åç«¯APIæœåŠ¡å¯åŠ¨æˆåŠŸï¼ˆhttp://localhost:8000ï¼‰
- [ ] ç®¡ç†åå°å¯åŠ¨æˆåŠŸï¼ˆhttp://localhost:8501ï¼‰
- [ ] WebéªŒè¯ç•Œé¢å¯åŠ¨æˆåŠŸï¼ˆhttp://localhost:3000ï¼‰
- [ ] æœåŠ¡é—´è”è°ƒæˆåŠŸï¼ˆWebç•Œé¢å¯è°ƒç”¨åç«¯APIï¼‰

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP8.1å®Œæˆ

---

#### P8.3 éªŒæ”¶æµ‹è¯•æ‰§è¡Œ

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ‰§è¡ŒéªŒæ”¶æµ‹è¯•ï¼ˆä½¿ç”¨æµ‹è¯•æ•°æ®é›†ï¼‰
2. æµ‹è¯•è¯Šæ–­å‡†ç¡®ç‡ï¼š
   - Rose Black Spotï¼š12å¼ å›¾ç‰‡ï¼Œç¡®è¯Šç‡ â‰¥ 65%
   - Cherry Powdery Mildewï¼š12å¼ å›¾ç‰‡ï¼Œç¡®è¯Šç‡ â‰¥ 65%
3. æµ‹è¯•ç®¡ç†åå°åŠŸèƒ½ï¼š
   - æ–°å¢ç–¾ç—…æˆåŠŸ
   - è¯Šæ–­æµ‹è¯•æˆåŠŸ
   - ç»Ÿè®¡åˆ†ææ­£ç¡®
4. æµ‹è¯•WebéªŒè¯ç•Œé¢åŠŸèƒ½ï¼š
   - å›¾ç‰‡ä¸Šä¼ æˆåŠŸ
   - è¯Šæ–­ç»“æœæ˜¾ç¤ºæ­£ç¡®
5. ç”ŸæˆéªŒæ”¶æŠ¥å‘Š

**äº§å‡ºç‰©**ï¼š
- `docs/acceptance/éªŒæ”¶æµ‹è¯•æŠ¥å‘Š.md`

**éªŒæ”¶æ ‡å‡†ï¼ˆG8.3ï¼‰**ï¼š
- [ ] è¯Šæ–­å‡†ç¡®ç‡ â‰¥ 65%ï¼ˆRose Black Spot + Cherry Powdery Mildewå¹³å‡ï¼‰
- [ ] ç®¡ç†åå°åŠŸèƒ½éªŒæ”¶é€šè¿‡
- [ ] WebéªŒè¯ç•Œé¢åŠŸèƒ½éªŒæ”¶é€šè¿‡
- [ ] éªŒæ”¶æŠ¥å‘Šå®Œæˆ

**ä¸Šä¸‹æ–‡ä¾èµ–**ï¼šP8.2å®Œæˆ

---

**P8é˜¶æ®µGateï¼ˆG8ï¼‰**ï¼š

é€šè¿‡æ¡ä»¶ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰ï¼š
- [x] G8.1ï¼šPostgreSQL + Rediséƒ¨ç½²æˆåŠŸ
- [x] G8.2ï¼šä¸‰ä¸ªæœåŠ¡å¯åŠ¨æˆåŠŸï¼Œè”è°ƒé€šè¿‡
- [x] G8.3ï¼šéªŒæ”¶æµ‹è¯•é€šè¿‡

äº§å‡ºç‰©æ¸…å•ï¼š
- [ ] `docs/deployment/æœ¬åœ°éƒ¨ç½²æŒ‡å—.md`
- [ ] `docs/acceptance/éªŒæ”¶æµ‹è¯•æŠ¥å‘Š.md`

**MVP v1.1äº¤ä»˜**ï¼š
- [ ] æ‰€æœ‰ä»£ç æäº¤åˆ°Git
- [ ] æ‰€æœ‰æ–‡æ¡£æ›´æ–°
- [ ] éªŒæ”¶æŠ¥å‘Šè¯„å®¡é€šè¿‡

---

## 6. é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| **VLM APIä¸ç¨³å®š** | é«˜ | ä¸­ | 1. å®ç°ç¼“å­˜æœºåˆ¶ï¼ˆé¿å…é‡å¤è°ƒç”¨ï¼‰<br>2. å®ç°Fallbackæœºåˆ¶ï¼ˆå¤‡ç”¨Providerï¼‰<br>3. è®°å½•å¤±è´¥æ—¥å¿—ï¼Œäººå·¥å®¡æŸ¥ |
| **è¯Šæ–­å‡†ç¡®ç‡ä¸è¾¾æ ‡** | é«˜ | ä¸­ | 1. è°ƒæ•´æç¤ºè¯ï¼ˆä½¿ç”¨æ–¹æ³•è®ºv5.0ä¼˜åŒ–ï¼‰<br>2. è°ƒæ•´ç‰¹å¾æƒé‡<br>3. å¢åŠ æµ‹è¯•å›¾ç‰‡æ•°é‡ |
| **çŸ¥è¯†åº“JSONæ ¼å¼é”™è¯¯** | ä¸­ | ä½ | 1. ä½¿ç”¨JSON SchemaéªŒè¯<br>2. ç®¡ç†åå°æä¾›JSONç¼–è¾‘å™¨ï¼ˆMonaco Editorï¼‰<br>3. ä¿å­˜å‰éªŒè¯æ ¼å¼ |
| **PostgreSQLæ€§èƒ½é—®é¢˜** | ä½ | ä½ | 1. åˆ›å»ºåˆé€‚çš„ç´¢å¼•<br>2. ä½¿ç”¨è¿æ¥æ± ï¼ˆasyncpgï¼‰<br>3. å®šæœŸæ¸…ç†å†å²æ•°æ® |
| **å‰ç«¯å…¼å®¹æ€§é—®é¢˜** | ä½ | ä½ | 1. ä½¿ç”¨ç°ä»£æµè§ˆå™¨ï¼ˆChrome/Edge/Firefoxï¼‰<br>2. ä½¿ç”¨Tailwind CSSç¡®ä¿æ ·å¼ä¸€è‡´ |
| **ä¾èµ–åº“ç‰ˆæœ¬å†²çª** | ä¸­ | ä½ | 1. ä½¿ç”¨Poetryé”å®šä¾èµ–ç‰ˆæœ¬<br>2. å®šæœŸæ›´æ–°ä¾èµ– |

---

## 7. é™„å½•

### é™„å½•Aï¼šå®Œæ•´ç›®å½•è“å›¾

è§è¯¦ç»†è®¾è®¡æ–‡æ¡£ç¬¬4ç« ã€‚

### é™„å½•Bï¼šæµ‹è¯•æ•°æ®é›†è·¯å¾„

- `D:\é¡¹ç›®ç®¡ç†\æ¤ç‰©ç—…è™«å®³\æ•°æ®é›†\flower_data`
- `D:\é¡¹ç›®ç®¡ç†\æ¤ç‰©ç—…è™«å®³\æ•°æ®é›†\Rose_leaf`

### é™„å½•Cï¼šå…³é”®é…ç½®æ–‡ä»¶è·¯å¾„

- Qwen VL APIé…ç½®ï¼š`D:\é¡¹ç›®ç®¡ç†\NewBloomCheck\FlowerSpecialist\config\llm_config.json`
- FlowerSpecialistå®éªŒä»£ç ï¼š`D:\é¡¹ç›®ç®¡ç†\NewBloomCheck\FlowerSpecialist`

### é™„å½•Dï¼šGateé€šè¿‡æ¸…å•

| Gate | é˜¶æ®µ | é€šè¿‡æ¡ä»¶ |
|------|------|----------|
| G0 | P0 | å¼€å‘ç¯å¢ƒéªŒè¯ + ç›®å½•è“å›¾ + æŠ€æœ¯æ ˆéªŒè¯ |
| G1 | P1 | OpenAPIè§„èŒƒè¯„å®¡ + DDLæ‰§è¡ŒæˆåŠŸ + Pydanticæ¨¡å‹åˆ›å»º |
| G2 | P2 | PROOF Framework + VLMå®¢æˆ·ç«¯ + çŸ¥è¯†åº“åŠ è½½å™¨ + æ¨¡ç³ŠåŒ¹é… + è¯„åˆ†å™¨ + æœ¬åœ°å›¾ç‰‡å­˜å‚¨ |
| G3 | P3 | Q0è¿‡æ»¤ + Q1-Q6ç‰¹å¾æå– + ä¸‰å±‚è¯Šæ–­ + VLMå…œåº• + çŸ¥è¯†åº“æœåŠ¡ + å›¾ç‰‡æœåŠ¡ |
| G4 | P4 | FastAPIå¯åŠ¨ + è¯Šæ–­APIæµ‹è¯• + å›¾ç‰‡ç®¡ç†API + è®¤è¯ä¸­é—´ä»¶ |
| G5 | P5 | ç–¾ç—…ç®¡ç† + è¯Šæ–­æµ‹è¯• + ç»Ÿè®¡åˆ†æ + è´¦å·ç™»å½• |
| G6 | P6 | å›¾ç‰‡ä¸Šä¼  + è¯Šæ–­ç»“æœå±•ç¤º + å†å²è®°å½• |
| G7 | P7 | å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + E2Eæµ‹è¯• |
| G8 | P8 | PostgreSQLéƒ¨ç½² + æœåŠ¡è”è°ƒ + éªŒæ”¶æµ‹è¯• |

### é™„å½•Eï¼šå…³é”®å†³ç­–è®°å½•

| å†³ç­–é¡¹ | å†³ç­– | ç†ç”± |
|--------|------|------|
| æœ¬åœ°éƒ¨ç½² | PostgreSQL + Redisæœ¬åœ°å®‰è£… | MVPé˜¶æ®µç®€åŒ–éƒ¨ç½²ï¼Œä¸ä½¿ç”¨Docker |
| è®¤è¯æ–¹å¼ | ç®€å•è´¦å·å¯†ç ç™»å½• | MVPé˜¶æ®µæ— éœ€å¤æ‚çš„API Keyæœºåˆ¶ |
| ç®¡ç†åå°ä¼˜å…ˆçº§ | ç¬¬ä¸€é˜¶æ®µå®ç° | ç–¾ç—…æ¨¡å‹ç®¡ç†åŠŸèƒ½æ˜¯å…³é”® |
| çŸ¥è¯†åº“æ•°æ® | é€æ­¥æ„å»º | ä½¿ç”¨æµ‹è¯•æ•°æ®é›†é€æ­¥è¡¥å……ç–¾ç—…JSON |
| å‰ç«¯æŠ€æœ¯æ ˆ | Next.js 15 + Shadcn UI | ç°ä»£åŒ–ã€å¼€å‘æ•ˆç‡é«˜ |
| åç«¯æŠ€æœ¯æ ˆ | FastAPI + Streamlit | FastAPIå¼‚æ­¥é«˜æ€§èƒ½ï¼ŒStreamlitå¿«é€Ÿæ„å»ºåå° |

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å¾…è¯„å®¡
**è¯„å®¡äºº**: [å¾…å¡«å†™]
**æ‰¹å‡†äºº**: [å¾…å¡«å†™]

---

## æ–‡æ¡£ä¿®è®¢è®°å½•

| ç‰ˆæœ¬ | ä¿®è®¢æ—¥æœŸ | ä¿®è®¢å†…å®¹ | ä¿®è®¢äºº |
|-----|---------|---------|--------|
| v1.0ï¼ˆä¿®è®¢ç‰ˆï¼‰ | 2025-11-11 22:00:00 | **æ¶æ„å¯¹é½ä¿®è®¢**ï¼šæ ¹æ®è¯¦ç»†è®¾è®¡v1.1çš„4å±‚ä¾èµ–ç»“æ„ï¼Œè°ƒæ•´ç ”å‘è®¡åˆ’<br>1. **P2é˜¶æ®µæ–°å¢P2.6**ï¼šLocalImageStorageï¼ˆLayer 1æ¨¡å—ï¼Œ0.5å¤©ï¼‰<br>2. **P3é˜¶æ®µæ–°å¢P3.5/P3.6**ï¼šKnowledgeServiceå’ŒImageServiceï¼ˆLayer 3æœåŠ¡ï¼Œå„0.5å¤©ï¼‰<br>3. **P4.3ä¿®æ­£**ï¼šä»"LocalImageStorage + ImageServiceå®ç°"æ”¹ä¸º"çº¯APIå±‚ï¼ˆå›¾ç‰‡ç®¡ç†APIï¼‰"<br>4. **æ—¶é—´è°ƒæ•´**ï¼šP2: 2.5å¤©â†’3å¤©, P3: 2å¤©â†’3å¤©, P4: 1.5å¤©â†’1.25å¤©, æ€»è®¡: 14å¤©â†’15.25å¤©<br>5. **ä¾èµ–å…³ç³»ä¿®æ­£**ï¼šç¡®ä¿å®ç°é¡ºåºç¬¦åˆLayer 1â†’2â†’3â†’4ä¾èµ–ç»“æ„ | ç³»ç»Ÿæ¶æ„å¸ˆ |
| v1.0 | 2025-11-11 | åˆå§‹ç‰ˆæœ¬ï¼šå®Œæ•´14å¤©MVPç ”å‘è®¡åˆ’ | ç³»ç»Ÿæ¶æ„å¸ˆ |

---

**ä¿®è®¢è¯´æ˜**ï¼š

æœ¬æ¬¡ä¿®è®¢ä¸»è¦è§£å†³ç ”å‘è®¡åˆ’ä¸è¯¦ç»†è®¾è®¡æ–‡æ¡£v1.1æ¶æ„ä¸ä¸€è‡´çš„é—®é¢˜ã€‚è¯¦ç»†è®¾è®¡v1.1æ˜ç¡®åŒºåˆ†äº†åº”ç”¨æœåŠ¡å±‚å’ŒåŸºç¡€è®¾æ–½æ¨¡å—å±‚ï¼Œå¹¶å®šä¹‰äº†4å±‚ä¾èµ–ç»“æ„ã€‚åŸç ”å‘è®¡åˆ’v1.0çš„å®ç°é¡ºåºå­˜åœ¨3ä¸ªå…³é”®é—®é¢˜ï¼š

1. **LocalImageStorageç¼ºå¤±ï¼ˆP2é˜¶æ®µï¼‰**ï¼šLocalImageStorageæ˜¯Layer 1åŸºç¡€è®¾æ–½æ¨¡å—ï¼ˆæ— ä¾èµ–ï¼‰ï¼Œåº”åœ¨P2é˜¶æ®µå®ç°ï¼Œä½†åŸè®¡åˆ’å°†å…¶å»¶ååˆ°P4é˜¶æ®µï¼Œè¿åäº†åˆ†å±‚åŸåˆ™ã€‚

2. **KnowledgeServiceå’ŒImageServiceæœªæ˜ç¡®ï¼ˆP3é˜¶æ®µï¼‰**ï¼šDiagnosisServiceï¼ˆLayer 4ï¼‰ä¾èµ–KnowledgeServiceå’ŒImageServiceï¼ˆLayer 3ï¼‰ï¼Œä½†åŸè®¡åˆ’æœªæ˜ç¡®å®ç°è¿™ä¸¤ä¸ªæœåŠ¡ï¼Œå¯¼è‡´ä¾èµ–å…³ç³»æ–­å±‚ã€‚

3. **P4.3å®ç°é¡ºåºé”™è¯¯**ï¼šåŸP4.3åŒæ—¶å®ç°LocalImageStorageï¼ˆLayer 1ï¼‰å’ŒImageServiceï¼ˆLayer 3ï¼‰ï¼Œè¿åäº†æ¶æ„åˆ†å±‚åŸåˆ™ã€‚

ä¿®è®¢åçš„è®¡åˆ’ä¸¥æ ¼éµå¾ªè¯¦ç»†è®¾è®¡çš„4å±‚ä¾èµ–ç»“æ„ï¼š
- **Layer 1**ï¼ˆæ— ä¾èµ–ï¼‰ï¼šFuzzyMatcher, PROOF Framework, LocalImageStorage
- **Layer 2**ï¼ˆä¾èµ–Layer 1ï¼‰ï¼šVLMClient, DiagnosisScorer, KnowledgeLoader
- **Layer 3**ï¼ˆä¾èµ–Layer 2ï¼‰ï¼šKnowledgeService, ImageService
- **Layer 4**ï¼ˆä¾èµ–Layer 3ï¼‰ï¼šDiagnosisService

æ—¶é—´å‡€å¢1.25å¤©ï¼Œæ€»è®¡15.25å¤©å®ŒæˆMVP v1.1ã€‚
