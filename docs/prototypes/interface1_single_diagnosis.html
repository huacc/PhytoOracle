<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhytoOracle - å•å›¾è¯Šæ–­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: #fff;
            border-bottom: 1px solid #e8e8e8;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 500;
            color: #1890ff;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn:hover {
            color: #1890ff;
            border-color: #1890ff;
        }

        .btn-primary {
            background: #1890ff;
            color: #fff;
            border-color: #1890ff;
        }

        .btn-primary:hover {
            background: #40a9ff;
            border-color: #40a9ff;
        }

        .btn-success {
            background: #52c41a;
            color: #fff;
            border-color: #52c41a;
        }

        .btn-success:hover {
            background: #73d13d;
        }

        .btn-danger {
            background: #ff4d4f;
            color: #fff;
            border-color: #ff4d4f;
        }

        .btn-danger:hover {
            background: #ff7875;
        }

        .btn-large {
            padding: 12px 32px;
            font-size: 16px;
        }

        .container {
            max-width: 1400px;
            margin: 24px auto;
            padding: 0 24px;
        }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-section {
            background: #fff;
            border-radius: 8px;
            padding: 60px 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        .upload-section.hidden {
            display: none;
        }

        .upload-area {
            border: 2px dashed #d9d9d9;
            border-radius: 8px;
            padding: 80px 24px;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 24px;
        }

        .upload-area:hover {
            border-color: #1890ff;
            background: #e6f7ff;
        }

        .upload-area.dragover {
            border-color: #1890ff;
            background: #e6f7ff;
        }

        .upload-icon {
            font-size: 64px;
            color: #1890ff;
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 14px;
            color: #999;
        }

        /* é¢„è§ˆå’Œæ£€æµ‹åŒºåŸŸ */
        .preview-section {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: none;
        }

        .preview-section.active {
            display: block;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .preview-title {
            font-size: 18px;
            font-weight: 500;
            color: #333;
        }

        .preview-content {
            text-align: center;
            margin-bottom: 24px;
        }

        .preview-image {
            max-width: 100%;
            max-height: 500px;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* è¯Šæ–­ç»“æœåŒºåŸŸ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
            display: none;
        }

        .main-content.active {
            display: grid;
        }

        .card {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .image-container {
            text-align: center;
        }

        .image-preview {
            max-width: 100%;
            max-height: 500px;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
        }

        .result-card h2 {
            font-size: 18px;
            margin-bottom: 16px;
            color: #333;
        }

        .diagnosis-result {
            margin-bottom: 24px;
        }

        .disease-name {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .confidence {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
        }

        .confidence.high {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }

        .confidence.medium {
            background: #fff7e6;
            color: #fa8c16;
            border: 1px solid #ffd591;
        }

        .pathogen {
            color: #8c8c8c;
            font-size: 14px;
            margin-top: 8px;
        }

        .reasoning-section {
            margin-top: 16px;
        }

        .reasoning-title {
            font-weight: 500;
            margin-bottom: 12px;
            color: #333;
        }

        .feature-list {
            list-style: none;
        }

        .feature-item {
            padding: 8px 0;
            display: flex;
            align-items: center;
        }

        .feature-item::before {
            content: 'âœ“';
            color: #52c41a;
            font-weight: bold;
            margin-right: 8px;
        }

        .detail-section {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .collapsible {
            border: 1px solid #e8e8e8;
            border-radius: 4px;
            margin-bottom: 16px;
        }

        .collapsible-header {
            padding: 12px 16px;
            background: #fafafa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .collapsible-header:hover {
            background: #f0f0f0;
        }

        .collapsible-header h3 {
            font-size: 16px;
            font-weight: 500;
        }

        .collapsible-content {
            padding: 16px;
            display: none;
        }

        .collapsible.active .collapsible-content {
            display: block;
        }

        .collapsible-icon {
            transition: transform 0.3s;
        }

        .collapsible.active .collapsible-icon {
            transform: rotate(180deg);
        }

        .qa-table {
            width: 100%;
        }

        .qa-row {
            display: grid;
            grid-template-columns: 200px 1fr 80px 60px;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
        }

        .qa-row:last-child {
            border-bottom: none;
        }

        .qa-label {
            color: #8c8c8c;
            font-size: 14px;
        }

        .qa-value {
            color: #333;
            font-size: 14px;
        }

        .qa-status {
            text-align: right;
        }

        .status-pass {
            color: #52c41a;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-small:hover {
            color: #1890ff;
            border-color: #1890ff;
        }

        .qa-detail {
            grid-column: 1 / -1;
            display: none;
            margin-top: 12px;
            padding: 16px;
            background: #f9f9f9;
            border-radius: 4px;
            border-left: 3px solid #1890ff;
        }

        .qa-row.expanded .qa-detail {
            display: block;
        }

        .qa-detail-section {
            margin-bottom: 16px;
        }

        .qa-detail-section:last-child {
            margin-bottom: 0;
        }

        .qa-detail-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .qa-detail-content {
            color: #666;
            font-size: 13px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: #fff;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #e8e8e8;
        }

        .expand-arrow {
            transition: transform 0.3s;
            display: inline-block;
        }

        .qa-row.expanded .expand-arrow {
            transform: rotate(180deg);
        }

        .feature-match {
            margin-bottom: 24px;
        }

        .score-display {
            font-size: 32px;
            font-weight: 600;
            color: #52c41a;
            text-align: center;
            margin: 16px 0;
        }

        .feature-group {
            margin-bottom: 20px;
        }

        .feature-group-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 12px;
            font-size: 15px;
        }

        .feature-detail {
            padding: 12px;
            background: #fafafa;
            border-left: 3px solid #52c41a;
            margin-bottom: 8px;
            border-radius: 4px;
        }

        .feature-detail.partial {
            border-left-color: #fa8c16;
        }

        .feature-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .feature-score {
            color: #52c41a;
            font-weight: 500;
        }

        .feedback-section {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        .feedback-section p {
            margin-bottom: 16px;
            color: #666;
        }

        .feedback-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .modal-body {
            margin-bottom: 24px;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>PhytoOracle - å•å›¾è¯Šæ–­</h1>
        <button class="btn" onclick="goBack()">è¿”å›é¦–é¡µ</button>
    </div>

    <div class="container">
        <!-- æ­¥éª¤1: ä¸Šä¼ å›¾ç‰‡ -->
        <div class="upload-section" id="uploadSection">
            <div class="upload-area" id="uploadArea"
                 ondrop="handleDrop(event)"
                 ondragover="handleDragOver(event)"
                 ondragleave="handleDragLeave(event)"
                 onclick="triggerFileInput()">
                <div class="upload-icon">ğŸ“¤</div>
                <div class="upload-text">æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
                <div class="upload-hint">æ”¯æŒ JPGã€PNG æ ¼å¼å›¾ç‰‡</div>
                <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
            </div>
        </div>

        <!-- æ­¥éª¤2: é¢„è§ˆå’Œå¼€å§‹æ£€æµ‹ -->
        <div class="preview-section" id="previewSection">
            <div class="preview-header">
                <div class="preview-title">å›¾ç‰‡é¢„è§ˆ</div>
                <button class="btn" onclick="reupload()">é‡æ–°ä¸Šä¼ </button>
            </div>
            <div class="preview-content">
                <img id="previewImage" class="preview-image" src="" alt="é¢„è§ˆå›¾ç‰‡">
            </div>
            <div class="action-buttons">
                <button class="btn btn-success btn-large" onclick="startDiagnosis()">ğŸ” å¼€å§‹æ£€æµ‹</button>
            </div>
        </div>

        <!-- æ­¥éª¤3: è¯Šæ–­ç»“æœ -->
        <div class="main-content" id="resultSection">
            <!-- å·¦ä¾§ï¼šå›¾ç‰‡å±•ç¤º -->
            <div class="card image-container">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23e8f5e9' width='400' height='400'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='20' fill='%23666'%3Eç«ç‘°å¶ç‰‡å›¾ç‰‡%3C/text%3E%3C/svg%3E"
                     alt="è¯Šæ–­å›¾ç‰‡" class="image-preview" id="diagnosisImage">
            </div>

            <!-- å³ä¾§ï¼šè¯Šæ–­ç»“æœ -->
            <div class="card result-card">
                <h2>è¯Šæ–­ç»“æœ</h2>
                <div class="diagnosis-result">
                    <div class="disease-name">ç«ç‘°é»‘æ–‘ç—…</div>
                    <div class="confidence high">ç½®ä¿¡åº¦ï¼š95%</div>
                    <div class="pathogen">ç—…åŸä½“ï¼šDiplocarpon rosae (çœŸèŒ)</div>
                </div>

                <div class="reasoning-section">
                    <div class="reasoning-title">æ¨ç†ä¾æ®ï¼š</div>
                    <ul class="feature-list">
                        <li class="feature-item">ç—‡çŠ¶ç±»å‹ï¼šåæ­»æ–‘ç‚¹</li>
                        <li class="feature-item">ä¸­å¿ƒé¢œè‰²ï¼šé»‘è‰²</li>
                        <li class="feature-item">è¾¹ç¼˜é¢œè‰²ï¼šé»„è‰²æ™•åœˆ</li>
                        <li class="feature-item">å‘ç—…ä½ç½®ï¼šå¶ç‰‡</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- VLMé—®ç­”å¯¹è¯¦æƒ… -->
        <div class="detail-section">
            <div class="collapsible" id="vlmSection">
                <div class="collapsible-header" onclick="toggleCollapsible('vlmSection')">
                    <h3>ğŸ“‹ VLMé—®ç­”å¯¹è¯¦æƒ…</h3>
                    <span class="collapsible-icon">â–¼</span>
                </div>
                <div class="collapsible-content">
                    <div class="qa-table">
                        <div class="qa-row">
                            <div class="qa-label">Q0.0 å›¾ç‰‡å†…å®¹</div>
                            <div class="qa-value">èŠ±å‰å›¾ç‰‡</div>
                            <div class="qa-status status-pass">âœ“</div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_0_0')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_0_0">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">è¯·åˆ¤æ–­è¿™å¼ å›¾ç‰‡çš„å†…å®¹ç±»å‹ã€‚å¦‚æœæ˜¯èŠ±å‰æˆ–æ¤ç‰©å›¾ç‰‡ï¼Œå›ç­”"èŠ±å‰å›¾ç‰‡"ï¼›å¦‚æœä¸æ˜¯ï¼Œå›ç­”"éèŠ±å‰å›¾ç‰‡"ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">èŠ±å‰å›¾ç‰‡</div>
                                </div>
                            </div>
                        </div>
                        <div class="qa-row">
                            <div class="qa-label">Q0.1 å›¾ç‰‡ç±»åˆ«</div>
                            <div class="qa-value">å¶éƒ¨ç—…å®³</div>
                            <div class="qa-status status-pass">âœ“</div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_0_1')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_0_1">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">è¿™å¼ èŠ±å‰å›¾ç‰‡å±•ç¤ºçš„æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿè¯·ä»ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©ï¼š
- å¶éƒ¨ç—…å®³
- èŠ±éƒ¨ç—…å®³
- èŒéƒ¨ç—…å®³
- æ ¹éƒ¨ç—…å®³
- æœå®ç—…å®³
- å¥åº·æ¤æ ª

åªå›ç­”é€‰é¡¹å†…å®¹ï¼Œä¸è¦é¢å¤–è§£é‡Šã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">å¶éƒ¨ç—…å®³</div>
                                </div>
                            </div>
                        </div>
                        <div class="qa-row">
                            <div class="qa-label">Q0.2 èŠ±å‰å±</div>
                            <div class="qa-value">Rosa (è”·è–‡å±)</div>
                            <div class="qa-status status-pass">âœ“</div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_0_2')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_0_2">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">è¯·è¯†åˆ«å›¾ç‰‡ä¸­çš„èŠ±å‰æ¤ç‰©å±äºå“ªä¸ªå±ï¼ˆGenusï¼‰ã€‚è¯·ç”¨æ‹‰ä¸å­¦åå›ç­”ï¼Œæ ¼å¼ä¸º"å±å (ä¸­æ–‡å)"ï¼Œä¾‹å¦‚ï¼š"Rosa (è”·è–‡å±)"ã€‚

å¦‚æœæ— æ³•ç¡®å®šï¼Œè¯·å›ç­”"æœªçŸ¥å±"ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">Rosa (è”·è–‡å±)</div>
                                </div>
                            </div>
                        </div>
                        <div class="qa-row">
                            <div class="qa-label">Q0.3 å™¨å®˜ç±»å‹</div>
                            <div class="qa-value">å¶ç‰‡</div>
                            <div class="qa-status status-pass">âœ“</div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_0_3')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_0_3">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">å›¾ç‰‡ä¸­ä¸»è¦å±•ç¤ºçš„æ˜¯æ¤ç‰©çš„å“ªä¸ªå™¨å®˜ï¼Ÿè¯·ä»ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©ï¼š
- å¶ç‰‡
- èŠ±æœµ
- èŒå¹²
- æœå®
- æ ¹éƒ¨

åªå›ç­”é€‰é¡¹å†…å®¹ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">å¶ç‰‡</div>
                                </div>
                            </div>
                        </div>
                        <div class="qa-row">
                            <div class="qa-label">Q0.4 å®Œæ•´æ€§</div>
                            <div class="qa-value">å®Œæ•´å¯è§</div>
                            <div class="qa-status status-pass">âœ“</div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_0_4')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_0_4">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">å›¾ç‰‡ä¸­çš„å™¨å®˜æ˜¯å¦å®Œæ•´å¯è§ï¼Œæ²¡æœ‰è¢«ä¸¥é‡é®æŒ¡æˆ–æˆªæ–­ï¼Ÿè¯·å›ç­”"å®Œæ•´å¯è§"æˆ–"ä¸å®Œæ•´"ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">å®Œæ•´å¯è§</div>
                                </div>
                            </div>
                        </div>
                        <div class="qa-row">
                            <div class="qa-label">Q0.5 å¼‚å¸¸æ£€æµ‹</div>
                            <div class="qa-value">å­˜åœ¨å¼‚å¸¸</div>
                            <div class="qa-status status-pass">âœ“</div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_0_5')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_0_5">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">ä»”ç»†è§‚å¯Ÿå›¾ç‰‡ä¸­çš„å™¨å®˜ï¼Œæ˜¯å¦å­˜åœ¨ç—…å®³ç—‡çŠ¶æˆ–å¼‚å¸¸ç‰¹å¾ï¼ˆå¦‚æ–‘ç‚¹ã€å˜è‰²ã€ç²‰çŠ¶ç‰©ã€è…çƒ‚ç­‰ï¼‰ï¼Ÿ

å¦‚æœå‘ç°æ˜æ˜¾çš„å¼‚å¸¸ï¼Œå›ç­”"å­˜åœ¨å¼‚å¸¸"ï¼›å¦‚æœçœ‹èµ·æ¥å¥åº·æ­£å¸¸ï¼Œå›ç­”"æ— å¼‚å¸¸"ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">å­˜åœ¨å¼‚å¸¸ã€‚å¶ç‰‡ä¸Šå¯è§å¤šä¸ªé»‘è‰²æ–‘ç‚¹ï¼Œå‘¨å›´æœ‰é»„è‰²æ™•åœˆï¼Œè¿™æ˜¯å…¸å‹çš„ç—…å®³ç—‡çŠ¶ã€‚</div>
                                </div>
                            </div>
                        </div>
                        <div style="margin: 16px 0; border-top: 2px solid #e8e8e8;"></div>
                        <div class="qa-row">
                            <div class="qa-label">Q1 ç—‡çŠ¶ç±»å‹</div>
                            <div class="qa-value">åæ­»æ–‘ç‚¹ (necrosis_spot)</div>
                            <div class="qa-status"></div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_1')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_1">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">è¯·æè¿°å›¾ç‰‡ä¸­ç—…å®³çš„ä¸»è¦ç—‡çŠ¶ç±»å‹ã€‚è¯·ä»ä»¥ä¸‹ç±»å‹ä¸­é€‰æ‹©æœ€ç¬¦åˆçš„ä¸€é¡¹ï¼š

- necrosis_spotï¼ˆåæ­»æ–‘ç‚¹ï¼‰: ç»„ç»‡åæ­»å½¢æˆçš„é»‘è‰²æˆ–è¤è‰²æ–‘ç‚¹ï¼Œåƒè¢«çƒ«è¿‡çš„ç„¦ç—•
- powdery_mildewï¼ˆç™½ç²‰ç—…ï¼‰: å¶ç‰‡è¡¨é¢è¦†ç›–ç™½è‰²ç²‰æœ«çŠ¶ç‰©è´¨
- rustï¼ˆé”ˆç—…ï¼‰: å¶ç‰‡ä¸Šå‡ºç°æ©™é»„è‰²æˆ–è¤è‰²çš„ç–±æ–‘ï¼Œåƒé“é”ˆ
- mosaicï¼ˆèŠ±å¶ç—…ï¼‰: å¶ç‰‡å‡ºç°æ·±æµ…ä¸ä¸€çš„ç»¿è‰²æ–‘é©³ï¼Œåƒé©¬èµ›å…‹å›¾æ¡ˆ
- wiltï¼ˆèè”«ï¼‰: å¶ç‰‡æˆ–èŒå¹²å¤±æ°´ä¸‹å‚
- rotï¼ˆè…çƒ‚ï¼‰: ç»„ç»‡è½¯åŒ–è…çƒ‚ï¼Œå‘ˆæ°´æ¸çŠ¶
- cankerï¼ˆæºƒç–¡ï¼‰: èŒå¹²æˆ–ææ¡ä¸Šçš„å‡¹é™·ç—…æ–‘
- gallï¼ˆè™«ç˜¿ï¼‰: ç»„ç»‡å¼‚å¸¸å¢ç”Ÿå½¢æˆçš„ç˜¤çŠ¶çªèµ·

åªå›ç­”å¯¹åº”çš„è‹±æ–‡ä»£ç ï¼Œå¦‚"necrosis_spot"ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">necrosis_spot

è¿™äº›é»‘è‰²æ–‘ç‚¹æ˜¯å…¸å‹çš„ç»„ç»‡åæ­»ç—‡çŠ¶ï¼Œè¾¹ç•Œæ¸…æ™°ï¼Œä¸­å¿ƒæ·±é»‘è‰²ï¼Œç¬¦åˆåæ­»æ–‘ç‚¹çš„ç‰¹å¾ã€‚</div>
                                </div>
                            </div>
                        </div>
                        <div class="qa-row">
                            <div class="qa-label">Q2 ä¸­å¿ƒé¢œè‰²</div>
                            <div class="qa-value">é»‘è‰² (black)</div>
                            <div class="qa-status"></div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_2')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_2">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">è¯·è§‚å¯Ÿç—…æ–‘çš„ä¸­å¿ƒåŒºåŸŸæ˜¯ä»€ä¹ˆé¢œè‰²ã€‚ä»ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©ï¼š

- blackï¼ˆé»‘è‰²ï¼‰
- brownï¼ˆè¤è‰²ï¼‰
- grayï¼ˆç°è‰²ï¼‰
- whiteï¼ˆç™½è‰²ï¼‰
- yellowï¼ˆé»„è‰²ï¼‰
- orangeï¼ˆæ©™è‰²ï¼‰
- redï¼ˆçº¢è‰²ï¼‰
- purpleï¼ˆç´«è‰²ï¼‰

åªå›ç­”é¢œè‰²å¯¹åº”çš„è‹±æ–‡ä»£ç ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">black</div>
                                </div>
                            </div>
                        </div>
                        <div class="qa-row">
                            <div class="qa-label">Q3 è¾¹ç¼˜é¢œè‰²</div>
                            <div class="qa-value">é»„è‰²æ™•åœˆ (halo_yellow)</div>
                            <div class="qa-status"></div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_3')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_3">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">è¯·è§‚å¯Ÿç—…æ–‘è¾¹ç¼˜æˆ–å‘¨å›´æ˜¯å¦æœ‰æ™•åœˆã€‚ä»ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©ï¼š

- halo_yellowï¼ˆé»„è‰²æ™•åœˆï¼‰: ç—…æ–‘å‘¨å›´æœ‰æ˜æ˜¾çš„é»„è‰²å…‰æ™•
- halo_redï¼ˆçº¢è‰²æ™•åœˆï¼‰: ç—…æ–‘å‘¨å›´æœ‰çº¢è‰²æˆ–ç´«çº¢è‰²æ™•åœˆ
- halo_purpleï¼ˆç´«è‰²æ™•åœˆï¼‰: ç—…æ–‘å‘¨å›´æœ‰ç´«è‰²æ™•åœˆ
- no_haloï¼ˆæ— æ™•åœˆï¼‰: è¾¹ç¼˜æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾æ™•åœˆ
- dark_brownï¼ˆæ·±è¤è‰²è¾¹ç¼˜ï¼‰: è¾¹ç¼˜ä¸ºæ·±è¤è‰²
- black_borderï¼ˆé»‘è‰²è¾¹ç¼˜ï¼‰: è¾¹ç¼˜æœ‰é»‘è‰²çº¿æ¡

åªå›ç­”å¯¹åº”çš„è‹±æ–‡ä»£ç ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">halo_yellow

ç—…æ–‘å‘¨å›´æœ‰æ˜æ˜¾çš„é»„è‰²æ™•åœˆï¼Œè¿™æ˜¯ç»„ç»‡å—æŸåå¶ç»¿ç´ é™è§£çš„è¡¨ç°ã€‚</div>
                                </div>
                            </div>
                        </div>
                        <div class="qa-row">
                            <div class="qa-label">Q4 å‘ç—…ä½ç½®</div>
                            <div class="qa-value">å¶ç‰‡ä¸»ä½“ (lamina)</div>
                            <div class="qa-status"></div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_4')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_4">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">ç—…å®³ä¸»è¦å‘ç”Ÿåœ¨å™¨å®˜çš„å“ªä¸ªéƒ¨ä½ï¼Ÿä»ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©ï¼š

- laminaï¼ˆå¶ç‰‡ä¸»ä½“ï¼‰: å¶ç‰‡çš„ä¸»è¦åŒºåŸŸï¼Œä¸åœ¨è¾¹ç¼˜æˆ–å°–ç«¯
- leaf_tipï¼ˆå¶å°–ï¼‰: å¶ç‰‡æœ€å‰ç«¯åŒºåŸŸ
- leaf_edgeï¼ˆå¶ç¼˜ï¼‰: å¶ç‰‡è¾¹ç¼˜
- leaf_baseï¼ˆå¶åŸºï¼‰: å¶ç‰‡åŸºéƒ¨ï¼Œé è¿‘å¶æŸ„å¤„
- veinï¼ˆå¶è„‰ï¼‰: æ²¿ç€å¶è„‰åˆ†å¸ƒ
- petioleï¼ˆå¶æŸ„ï¼‰: è¿æ¥å¶ç‰‡å’ŒèŒçš„éƒ¨åˆ†
- stemï¼ˆèŒï¼‰: èŒå¹²éƒ¨ä½
- flowerï¼ˆèŠ±ï¼‰: èŠ±æœµéƒ¨ä½

åªå›ç­”å¯¹åº”çš„è‹±æ–‡ä»£ç ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">lamina</div>
                                </div>
                            </div>
                        </div>
                        <div class="qa-row">
                            <div class="qa-label">Q5 æ–‘ç‚¹å¤§å°</div>
                            <div class="qa-value">ä¸­ç­‰ (medium)</div>
                            <div class="qa-status"></div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_5')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_5">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">ç—…æ–‘çš„å¤§å°å¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿä»ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©ï¼š

- pinpointï¼ˆé’ˆå°–å¤§å°ï¼‰: ç›´å¾„ < 2mm
- smallï¼ˆå°å‹ï¼‰: ç›´å¾„ 2-3mm
- mediumï¼ˆä¸­ç­‰ï¼‰: ç›´å¾„ 3-8mm
- largeï¼ˆå¤§å‹ï¼‰: ç›´å¾„ 8-15mm
- coalescedï¼ˆèåˆï¼‰: å¤šä¸ªç—…æ–‘è¿æ¥æˆå¤§ç‰‡

åªå›ç­”å¯¹åº”çš„è‹±æ–‡ä»£ç ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">medium

ç—…æ–‘ç›´å¾„å¤§çº¦åœ¨5-7mmå·¦å³ï¼Œå±äºä¸­ç­‰å¤§å°ã€‚</div>
                                </div>
                            </div>
                        </div>
                        <div class="qa-row">
                            <div class="qa-label">Q6 åˆ†å¸ƒæ¨¡å¼</div>
                            <div class="qa-value">æ•£ç‚¹åˆ†å¸ƒ (scattered)</div>
                            <div class="qa-status"></div>
                            <button class="btn-small" onclick="toggleQADetail(event, 'qa_6')">
                                <span class="expand-arrow">â–¼</span>
                            </button>
                            <div class="qa-detail" id="qa_6">
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¤ åŸå§‹é—®é¢˜ (Prompt)</div>
                                    <div class="qa-detail-content">ç—…æ–‘åœ¨å™¨å®˜ä¸Šæ˜¯å¦‚ä½•åˆ†å¸ƒçš„ï¼Ÿä»ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©ï¼š

- scatteredï¼ˆæ•£ç‚¹åˆ†å¸ƒï¼‰: ç—…æ–‘åˆ†æ•£åˆ†å¸ƒï¼Œé—´éš”è¾ƒè¿œ
- clusteredï¼ˆèšé›†åˆ†å¸ƒï¼‰: ç—…æ–‘é›†ä¸­åœ¨æŸä¸ªåŒºåŸŸ
- linearï¼ˆçº¿çŠ¶åˆ†å¸ƒï¼‰: ç—…æ–‘æ²¿ç›´çº¿æˆ–å¶è„‰æ’åˆ—
- circularï¼ˆç¯çŠ¶åˆ†å¸ƒï¼‰: ç—…æ–‘å‘ˆåœ†å½¢æˆ–ç¯çŠ¶æ’åˆ—
- marginalï¼ˆè¾¹ç¼˜åˆ†å¸ƒï¼‰: ç—…æ–‘ä¸»è¦åœ¨å™¨å®˜è¾¹ç¼˜
- uniformï¼ˆå‡åŒ€åˆ†å¸ƒï¼‰: ç—…æ–‘å¯†é›†ä¸”å‡åŒ€åˆ†å¸ƒ

åªå›ç­”å¯¹åº”çš„è‹±æ–‡ä»£ç ã€‚</div>
                                </div>
                                <div class="qa-detail-section">
                                    <div class="qa-detail-title">ğŸ“¥ VLMåŸå§‹å›ç­”</div>
                                    <div class="qa-detail-content">scattered

ç—…æ–‘åœ¨å¶ç‰‡ä¸Šæ•£å¸ƒï¼Œå½¼æ­¤ä¹‹é—´æœ‰ä¸€å®šè·ç¦»ï¼Œæ²¡æœ‰é›†ä¸­åœ¨æŸä¸€åŒºåŸŸã€‚</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç‰¹å¾åŒ¹é…è¯¦æƒ… -->
        <div class="detail-section">
            <div class="collapsible active" id="matchSection">
                <div class="collapsible-header" onclick="toggleCollapsible('matchSection')">
                    <h3>ğŸ¯ ç‰¹å¾åŒ¹é…è¯¦æƒ…</h3>
                    <span class="collapsible-icon">â–¼</span>
                </div>
                <div class="collapsible-content">
                    <div class="score-display">92 / 100</div>

                    <div class="feature-group">
                        <div class="feature-group-title">ä¸»è¦ç‰¹å¾ (æƒé‡80%)ï¼š</div>
                        <div class="feature-detail">
                            <div class="feature-name">â€¢ symptom_type: åæ­»æ–‘ç‚¹ âœ“</div>
                            <div class="feature-score">å¾—åˆ†ï¼š50 åˆ†</div>
                        </div>
                        <div class="feature-detail">
                            <div class="feature-name">â€¢ color_border: é»„è‰²æ™•åœˆ âœ“</div>
                            <div class="feature-score">å¾—åˆ†ï¼š30 åˆ†</div>
                        </div>
                    </div>

                    <div class="feature-group">
                        <div class="feature-group-title">æ¬¡è¦ç‰¹å¾ (æƒé‡15%)ï¼š</div>
                        <div class="feature-detail">
                            <div class="feature-name">â€¢ color_center: é»‘è‰² âœ“</div>
                            <div class="feature-score">å¾—åˆ†ï¼š10 åˆ†</div>
                        </div>
                        <div class="feature-detail">
                            <div class="feature-name">â€¢ location: å¶ç‰‡ âœ“</div>
                            <div class="feature-score">å¾—åˆ†ï¼š5 åˆ†</div>
                        </div>
                    </div>

                    <div class="feature-group">
                        <div class="feature-group-title">å¯é€‰ç‰¹å¾ (æƒé‡5%)ï¼š</div>
                        <div class="feature-detail partial">
                            <div class="feature-name">â€¢ size: ä¸­ç­‰ ~ (æ¨¡ç³ŠåŒ¹é…)</div>
                            <div class="feature-score" style="color: #fa8c16;">å¾—åˆ†ï¼š2 åˆ†</div>
                        </div>
                        <div class="feature-detail">
                            <div class="feature-name">â€¢ distribution: æ•£ç‚¹åˆ†å¸ƒ âœ“</div>
                            <div class="feature-score">å¾—åˆ†ï¼š2 åˆ†</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- äººå·¥åé¦ˆ -->
        <div class="feedback-section">
            <p>æ ¹æ®æ‚¨çš„ä¸“ä¸šåˆ¤æ–­ï¼Œæ­¤è¯Šæ–­ç»“æœæ˜¯å¦æ­£ç¡®ï¼Ÿ</p>
            <div class="feedback-buttons">
                <button class="btn btn-success" onclick="submitFeedback('correct')">åˆ¤æ–­æ­£ç¡®</button>
                <button class="btn btn-danger" onclick="submitFeedback('incorrect')">åˆ¤æ–­é”™è¯¯</button>
            </div>
        </div>
    </div>

    <!-- åé¦ˆæˆåŠŸæ¨¡æ€æ¡† -->
    <div class="modal" id="feedbackModal">
        <div class="modal-content">
            <div class="modal-header">åé¦ˆå·²æäº¤</div>
            <div class="modal-body">
                <p>æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼æ‚¨çš„ä¸“ä¸šåˆ¤æ–­å°†å¸®åŠ©æˆ‘ä»¬æ”¹è¿›ç³»ç»Ÿã€‚</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('feedbackModal')">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <script>
        let currentImageFile = null;

        // ä¸Šä¼ ç›¸å…³å‡½æ•°
        function triggerFileInput() {
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                currentImageFile = file;
                showPreview(file);
            } else {
                alert('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶ï¼');
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('uploadArea').classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('uploadArea').classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('uploadArea').classList.remove('dragover');

            const files = event.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                currentImageFile = files[0];
                showPreview(files[0]);
            } else {
                alert('è¯·ä¸Šä¼ æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶ï¼');
            }
        }

        function showPreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('uploadSection').classList.add('hidden');
                document.getElementById('previewSection').classList.add('active');
            };
            reader.readAsDataURL(file);
        }

        function reupload() {
            document.getElementById('uploadSection').classList.remove('hidden');
            document.getElementById('previewSection').classList.remove('active');
            document.getElementById('resultSection').classList.remove('active');
            document.getElementById('fileInput').value = '';
            currentImageFile = null;
        }

        function startDiagnosis() {
            // æ¨¡æ‹Ÿæ£€æµ‹è¿‡ç¨‹
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'ğŸ”„ æ£€æµ‹ä¸­...';

            // æ›´æ–°ç»“æœåŒºåŸŸçš„å›¾ç‰‡
            setTimeout(() => {
                const previewSrc = document.getElementById('previewImage').src;
                document.getElementById('diagnosisImage').src = previewSrc;

                // æ˜¾ç¤ºç»“æœï¼Œéšè—é¢„è§ˆ
                document.getElementById('previewSection').classList.remove('active');
                document.getElementById('resultSection').classList.add('active');

                btn.disabled = false;
                btn.textContent = 'ğŸ” å¼€å§‹æ£€æµ‹';
            }, 1500);
        }

        function toggleCollapsible(id) {
            const section = document.getElementById(id);
            section.classList.toggle('active');
        }

        function toggleQADetail(event, detailId) {
            event.stopPropagation();
            const qaRow = event.target.closest('.qa-row');
            qaRow.classList.toggle('expanded');
        }

        function goBack() {
            if (confirm('ç¡®å®šè¦è¿”å›é¦–é¡µå—ï¼Ÿ')) {
                window.location.reload();
            }
        }

        function submitFeedback(type) {
            const modal = document.getElementById('feedbackModal');
            modal.classList.add('active');
            console.log('Feedback submitted:', type);
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            modal.classList.remove('active');
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>