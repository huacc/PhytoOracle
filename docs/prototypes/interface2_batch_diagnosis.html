<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhytoOracle - æ‰¹é‡è¯Šæ–­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: #fff;
            border-bottom: 1px solid #e8e8e8;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 500;
            color: #1890ff;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn:hover {
            color: #1890ff;
            border-color: #1890ff;
        }

        .btn-primary {
            background: #1890ff;
            color: #fff;
            border-color: #1890ff;
        }

        .btn-primary:hover {
            background: #40a9ff;
            border-color: #40a9ff;
        }

        .btn-success {
            background: #52c41a;
            color: #fff;
            border-color: #52c41a;
        }

        .btn-success:hover {
            background: #73d13d;
        }

        .container {
            max-width: 1400px;
            margin: 24px auto;
            padding: 0 24px;
        }

        .upload-section {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .upload-area {
            border: 2px dashed #d9d9d9;
            border-radius: 8px;
            padding: 60px 24px;
            text-align: center;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #1890ff;
            background: #e6f7ff;
        }

        .upload-area.dragover {
            border-color: #1890ff;
            background: #e6f7ff;
        }

        .upload-icon {
            font-size: 48px;
            color: #1890ff;
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 14px;
            color: #999;
        }

        .viewer-section {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: none;
        }

        .viewer-section.active {
            display: block;
        }

        .viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .viewer-title {
            font-size: 18px;
            font-weight: 500;
            color: #333;
        }

        .pagination {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .page-info {
            color: #666;
            font-size: 14px;
        }

        .viewer-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .image-container {
            text-align: center;
        }

        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
        }

        .result-summary {
            padding: 24px;
            background: #fafafa;
            border-radius: 8px;
        }

        .result-summary h3 {
            font-size: 16px;
            margin-bottom: 16px;
            color: #333;
        }

        .disease-name {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .confidence {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .confidence.high {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }

        .confidence.medium {
            background: #fff7e6;
            color: #fa8c16;
            border: 1px solid #ffd591;
        }

        .confidence.low {
            background: #fff1f0;
            color: #ff4d4f;
            border: 1px solid #ffa39e;
        }

        .pathogen {
            color: #8c8c8c;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .key-features {
            margin-top: 16px;
        }

        .feature-title {
            font-weight: 500;
            margin-bottom: 12px;
            color: #333;
        }

        .feature-list {
            list-style: none;
        }

        .feature-item {
            padding: 6px 0;
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #666;
        }

        .feature-item::before {
            content: 'â€¢';
            color: #1890ff;
            font-weight: bold;
            margin-right: 8px;
        }

        .results-grid {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: none;
        }

        .results-grid.active {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .results-header h2 {
            font-size: 18px;
            font-weight: 500;
            color: #333;
        }

        .results-stats {
            color: #666;
            font-size: 14px;
        }

        .results-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .result-card {
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fff;
            position: relative;
        }

        .result-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .result-card:hover::after {
            content: 'åŒå‡»æŸ¥çœ‹è¯¦æƒ…';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            white-space: nowrap;
        }

        .result-card.active {
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24,144,255,0.2);
        }

        .result-thumbnail {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 8px;
            background: #f0f0f0;
        }

        .result-info {
            font-size: 13px;
        }

        .result-disease {
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .result-confidence {
            color: #666;
            font-size: 12px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
        }

        .modal-header {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .modal-body {
            margin-bottom: 24px;
            color: #666;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* è¯¦ç»†è¯Šæ–­æ¨¡æ€æ¡†æ ·å¼ */
        .detail-modal .modal-content {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 0;
        }

        .detail-modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 10;
        }

        .detail-modal-title {
            font-size: 20px;
            font-weight: 500;
            color: #333;
        }

        .detail-modal-body {
            padding: 24px;
        }

        .detail-image-result {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .detail-image {
            text-align: center;
            background: #fafafa;
            padding: 16px;
            border-radius: 8px;
        }

        .detail-image img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 4px;
        }

        .detail-result {
            padding: 16px;
        }

        .detail-disease-name {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .collapsible {
            margin-bottom: 16px;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            overflow: hidden;
        }

        .collapsible-header {
            padding: 16px 20px;
            background: #fafafa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .collapsible-header:hover {
            background: #f0f0f0;
        }

        .collapsible-header h3 {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin: 0;
        }

        .collapsible-icon {
            transition: transform 0.3s;
        }

        .collapsible.active .collapsible-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            padding: 20px;
            display: none;
        }

        .collapsible.active .collapsible-content {
            display: block;
        }

        .qa-table {
            width: 100%;
        }

        .qa-row {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .qa-row:last-child {
            border-bottom: none;
        }

        .qa-label {
            color: #8c8c8c;
            margin-bottom: 4px;
        }

        .qa-value {
            color: #333;
        }

        .feature-group {
            margin-bottom: 20px;
        }

        .feature-group-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 12px;
        }

        .feature-detail {
            padding: 12px;
            background: #fafafa;
            border-left: 3px solid #52c41a;
            margin-bottom: 8px;
            border-radius: 4px;
        }

        .feature-name {
            color: #333;
            font-size: 14px;
        }

        .feature-score {
            color: #52c41a;
            font-size: 13px;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>PhytoOracle - æ‰¹é‡è¯Šæ–­</h1>
        <div class="header-actions">
            <button class="btn btn-success" onclick="exportToExcel()" id="exportBtn" style="display: none;">å¯¼å‡ºExcel</button>
            <button class="btn" onclick="goBack()">è¿”å›é¦–é¡µ</button>
        </div>
    </div>

    <div class="container">
        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-section" id="uploadSection">
            <div class="upload-area" id="uploadArea" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="triggerFileInput()">
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
                <div class="upload-hint">æ”¯æŒæ‰¹é‡ä¸Šä¼  JPGã€PNG æ ¼å¼å›¾ç‰‡</div>
                <input type="file" id="fileInput" multiple accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
            </div>
        </div>

        <!-- å•å›¾æŸ¥çœ‹åŒºåŸŸ -->
        <div class="viewer-section" id="viewerSection">
            <div class="viewer-header">
                <div class="viewer-title">è¯Šæ–­è¯¦æƒ…</div>
                <div class="pagination">
                    <button class="btn" onclick="previousImage()">â† ä¸Šä¸€å¼ </button>
                    <span class="page-info" id="pageInfo">1 / 15</span>
                    <button class="btn" onclick="nextImage()">ä¸‹ä¸€å¼  â†’</button>
                </div>
            </div>

            <div class="viewer-content">
                <div class="image-container">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23e8f5e9' width='400' height='400'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='20' fill='%23666'%3Eç«ç‘°å¶ç‰‡ - 001%3C/text%3E%3C/svg%3E"
                         alt="è¯Šæ–­å›¾ç‰‡" class="image-preview" id="currentImage">
                </div>

                <div class="result-summary">
                    <h3>è¯Šæ–­ç»“æœ</h3>
                    <div class="disease-name" id="diseaseName">ç«ç‘°é»‘æ–‘ç—…</div>
                    <div class="confidence high" id="confidenceTag">ç½®ä¿¡åº¦ï¼š95%</div>
                    <div class="pathogen" id="pathogenInfo">ç—…åŸä½“ï¼šDiplocarpon rosae (çœŸèŒ)</div>

                    <div class="key-features">
                        <div class="feature-title">å…³é”®ç‰¹å¾ï¼š</div>
                        <ul class="feature-list" id="featureList">
                            <li class="feature-item">ç—‡çŠ¶ç±»å‹ï¼šåæ­»æ–‘ç‚¹</li>
                            <li class="feature-item">ä¸­å¿ƒé¢œè‰²ï¼šé»‘è‰²</li>
                            <li class="feature-item">è¾¹ç¼˜é¢œè‰²ï¼šé»„è‰²æ™•åœˆ</li>
                            <li class="feature-item">å‘ç—…ä½ç½®ï¼šå¶ç‰‡ä¸»ä½“</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç»“æœåˆ—è¡¨ -->
        <div class="results-grid" id="resultsGrid">
            <div class="results-header">
                <h2>å…¨éƒ¨è¯Šæ–­ç»“æœ</h2>
                <div class="results-stats">
                    å…± <span id="totalCount">15</span> å¼ å›¾ç‰‡ |
                    æˆåŠŸ <span style="color: #52c41a;" id="successCount">13</span> å¼  |
                    å¾…ç¡®è®¤ <span style="color: #fa8c16;" id="pendingCount">2</span> å¼ 
                </div>
            </div>

            <div class="results-list" id="resultsList">
                <!-- ç»“æœå¡ç‰‡å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- æˆåŠŸæç¤ºæ¨¡æ€æ¡† -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-header">âœ“ ä¸Šä¼ æˆåŠŸ</div>
            <div class="modal-body">
                å·²æˆåŠŸä¸Šä¼  <span id="uploadCount">15</span> å¼ å›¾ç‰‡ï¼Œè¯Šæ–­å®Œæˆï¼
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('successModal')">æŸ¥çœ‹ç»“æœ</button>
            </div>
        </div>
    </div>

    <!-- è¯¦ç»†è¯Šæ–­ç»“æœæ¨¡æ€æ¡† -->
    <div class="modal detail-modal" id="detailModal">
        <div class="modal-content">
            <div class="detail-modal-header">
                <div class="detail-modal-title" id="detailTitle">è¯¦ç»†è¯Šæ–­ç»“æœ</div>
                <button class="btn" onclick="closeModal('detailModal')">âœ• å…³é—­</button>
            </div>
            <div class="detail-modal-body">
                <!-- å›¾ç‰‡å’Œè¯Šæ–­ç»“æœ -->
                <div class="detail-image-result">
                    <div class="detail-image">
                        <img id="detailImage" src="" alt="è¯Šæ–­å›¾ç‰‡">
                    </div>
                    <div class="detail-result">
                        <h2 style="margin-bottom: 16px;">è¯Šæ–­ç»“æœ</h2>
                        <div class="detail-disease-name" id="detailDiseaseName">ç«ç‘°é»‘æ–‘ç—…</div>
                        <div class="confidence high" id="detailConfidence">ç½®ä¿¡åº¦ï¼š95%</div>
                        <div class="pathogen" id="detailPathogen">ç—…åŸä½“ï¼šDiplocarpon rosae (çœŸèŒ)</div>

                        <div class="key-features">
                            <div class="feature-title">å…³é”®ç‰¹å¾ï¼š</div>
                            <ul class="feature-list" id="detailFeatures">
                                <li class="feature-item">ç—‡çŠ¶ç±»å‹ï¼šåæ­»æ–‘ç‚¹</li>
                                <li class="feature-item">ä¸­å¿ƒé¢œè‰²ï¼šé»‘è‰²</li>
                                <li class="feature-item">è¾¹ç¼˜é¢œè‰²ï¼šé»„è‰²æ™•åœˆ</li>
                                <li class="feature-item">å‘ç—…ä½ç½®ï¼šå¶ç‰‡ä¸»ä½“</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- VLMé—®ç­”å¯¹è¯¦æƒ… -->
                <div class="collapsible" id="detailVlmSection">
                    <div class="collapsible-header" onclick="toggleCollapsible('detailVlmSection')">
                        <h3>ğŸ“‹ VLMé—®ç­”å¯¹è¯¦æƒ…</h3>
                        <span class="collapsible-icon">â–¼</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="qa-table">
                            <div class="qa-row">
                                <div class="qa-label">Q0.0 å›¾ç‰‡å†…å®¹</div>
                                <div class="qa-value">èŠ±å‰å›¾ç‰‡ âœ“</div>
                            </div>
                            <div class="qa-row">
                                <div class="qa-label">Q0.1 å›¾ç‰‡ç±»åˆ«</div>
                                <div class="qa-value">å¶éƒ¨ç—…å®³ âœ“</div>
                            </div>
                            <div class="qa-row">
                                <div class="qa-label">Q0.2 èŠ±å‰å±</div>
                                <div class="qa-value">Rosa (è”·è–‡å±) âœ“</div>
                            </div>
                            <div class="qa-row">
                                <div class="qa-label">Q1 ç—‡çŠ¶ç±»å‹</div>
                                <div class="qa-value">åæ­»æ–‘ç‚¹ (necrosis_spot)</div>
                            </div>
                            <div class="qa-row">
                                <div class="qa-label">Q2 ä¸­å¿ƒé¢œè‰²</div>
                                <div class="qa-value">é»‘è‰² (black)</div>
                            </div>
                            <div class="qa-row">
                                <div class="qa-label">Q3 è¾¹ç¼˜é¢œè‰²</div>
                                <div class="qa-value">é»„è‰²æ™•åœˆ (halo_yellow)</div>
                            </div>
                            <div class="qa-row">
                                <div class="qa-label">Q4 å‘ç—…ä½ç½®</div>
                                <div class="qa-value">å¶ç‰‡ä¸»ä½“ (lamina)</div>
                            </div>
                            <div class="qa-row">
                                <div class="qa-label">Q5 æ–‘ç‚¹å¤§å°</div>
                                <div class="qa-value">ä¸­ç­‰ (medium)</div>
                            </div>
                            <div class="qa-row">
                                <div class="qa-label">Q6 åˆ†å¸ƒæ¨¡å¼</div>
                                <div class="qa-value">æ•£ç‚¹åˆ†å¸ƒ (scattered)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç‰¹å¾åŒ¹é…è¯¦æƒ… -->
                <div class="collapsible active" id="detailMatchSection">
                    <div class="collapsible-header" onclick="toggleCollapsible('detailMatchSection')">
                        <h3>ğŸ¯ ç‰¹å¾åŒ¹é…è¯¦æƒ…</h3>
                        <span class="collapsible-icon">â–¼</span>
                    </div>
                    <div class="collapsible-content">
                        <div style="text-align: center; font-size: 32px; font-weight: 600; color: #52c41a; margin-bottom: 20px;">
                            92 / 100
                        </div>

                        <div class="feature-group">
                            <div class="feature-group-title">ä¸»è¦ç‰¹å¾ (æƒé‡80%)ï¼š</div>
                            <div class="feature-detail">
                                <div class="feature-name">â€¢ symptom_type: åæ­»æ–‘ç‚¹ âœ“</div>
                                <div class="feature-score">å¾—åˆ†ï¼š50 åˆ†</div>
                            </div>
                            <div class="feature-detail">
                                <div class="feature-name">â€¢ color_border: é»„è‰²æ™•åœˆ âœ“</div>
                                <div class="feature-score">å¾—åˆ†ï¼š30 åˆ†</div>
                            </div>
                        </div>

                        <div class="feature-group">
                            <div class="feature-group-title">æ¬¡è¦ç‰¹å¾ (æƒé‡15%)ï¼š</div>
                            <div class="feature-detail">
                                <div class="feature-name">â€¢ color_center: é»‘è‰² âœ“</div>
                                <div class="feature-score">å¾—åˆ†ï¼š10 åˆ†</div>
                            </div>
                            <div class="feature-detail">
                                <div class="feature-name">â€¢ location: å¶ç‰‡ âœ“</div>
                                <div class="feature-score">å¾—åˆ†ï¼š5 åˆ†</div>
                            </div>
                        </div>

                        <div class="feature-group">
                            <div class="feature-group-title">å¯é€‰ç‰¹å¾ (æƒé‡5%)ï¼š</div>
                            <div class="feature-detail">
                                <div class="feature-name">â€¢ size: ä¸­ç­‰ âœ“</div>
                                <div class="feature-score">å¾—åˆ†ï¼š2 åˆ†</div>
                            </div>
                            <div class="feature-detail">
                                <div class="feature-name">â€¢ distribution: æ•£ç‚¹åˆ†å¸ƒ âœ“</div>
                                <div class="feature-score">å¾—åˆ†ï¼š2 åˆ†</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿè¯Šæ–­æ•°æ®
        const mockDiagnoses = [
            { id: 1, image: 'ç«ç‘°å¶ç‰‡ - 001', disease: 'ç«ç‘°é»‘æ–‘ç—…', confidence: 95, level: 'high', pathogen: 'Diplocarpon rosae (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'é»‘è‰²ä¸­å¿ƒ', 'é»„è‰²æ™•åœˆ', 'å¶ç‰‡ä¸»ä½“'] },
            { id: 2, image: 'æ¨±èŠ±å¶ç‰‡ - 002', disease: 'æ¨±èŠ±è¤æ–‘ç—…', confidence: 88, level: 'high', pathogen: 'Cercospora sp. (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'è¤è‰²ä¸­å¿ƒ', 'æ— æ˜æ˜¾æ™•åœˆ', 'å¶ç‰‡ä¸»ä½“'] },
            { id: 3, image: 'æœˆå­£å¶ç‰‡ - 003', disease: 'æœˆå­£ç™½ç²‰ç—…', confidence: 92, level: 'high', pathogen: 'Podosphaera pannosa (çœŸèŒ)', features: ['ç™½è‰²ç²‰æœ«', 'å¶ç‰‡è¡¨é¢', 'å¶è„‰é™„è¿‘', 'æ•£ç‚¹åˆ†å¸ƒ'] },
            { id: 4, image: 'ç‰¡ä¸¹å¶ç‰‡ - 004', disease: 'ç‰¡ä¸¹è¤æ–‘ç—…', confidence: 78, level: 'medium', pathogen: 'Alternaria sp. (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'è¤è‰²ä¸­å¿ƒ', 'åŒå¿ƒè½®çº¹', 'å¶ç¼˜åˆ†å¸ƒ'] },
            { id: 5, image: 'èŠèŠ±å¶ç‰‡ - 005', disease: 'èŠèŠ±æ–‘æ¯ç—…', confidence: 85, level: 'high', pathogen: 'Septoria chrysanthemella (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'è¤è‰²æ–‘ç‚¹', 'é»„è‰²æ™•åœˆ', 'å¶ç‰‡ä¸»ä½“'] },
            { id: 6, image: 'èŒ¶èŠ±å¶ç‰‡ - 006', disease: 'èŒ¶èŠ±ç‚­ç–½ç—…', confidence: 90, level: 'high', pathogen: 'Colletotrichum camelliae (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'è¤è‰²ä¸­å¿ƒ', 'å‡¹é™·æ–‘ç‚¹', 'å¶å°–å¶ç¼˜'] },
            { id: 7, image: 'æœé¹ƒå¶ç‰‡ - 007', disease: 'æœé¹ƒè¤æ–‘ç—…', confidence: 82, level: 'high', pathogen: 'Cercospora sp. (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'è¤è‰²æ–‘ç‚¹', 'ç´«è‰²è¾¹ç¼˜', 'å¶ç‰‡ä¸»ä½“'] },
            { id: 8, image: 'ç™¾åˆå¶ç‰‡ - 008', disease: 'ç™¾åˆå¶æ¯ç—…', confidence: 65, level: 'medium', pathogen: 'Botrytis elliptica (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'è¤è‰²æ–‘ç‚¹', 'æ°´æ¸çŠ¶', 'å¶å°–å¼€å§‹'] },
            { id: 9, image: 'éƒé‡‘é¦™å¶ç‰‡ - 009', disease: 'éƒé‡‘é¦™ç°éœ‰ç—…', confidence: 87, level: 'high', pathogen: 'Botrytis tulipae (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'ç°è¤è‰²', 'æ°´æ¸çŠ¶', 'å¶ç‰‡ä¸»ä½“'] },
            { id: 10, image: 'åº·ä¹ƒé¦¨å¶ç‰‡ - 010', disease: 'åº·ä¹ƒé¦¨å¶æ–‘ç—…', confidence: 91, level: 'high', pathogen: 'Alternaria dianthi (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'è¤è‰²æ–‘ç‚¹', 'åŒå¿ƒè½®çº¹', 'å¶ç‰‡ä¸»ä½“'] },
            { id: 11, image: 'å…°èŠ±å¶ç‰‡ - 011', disease: 'å…°èŠ±ç‚­ç–½ç—…', confidence: 89, level: 'high', pathogen: 'Colletotrichum sp. (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'é»‘è¤è‰²', 'å‡¹é™·æ–‘ç‚¹', 'å¶å°–å¶ç¼˜'] },
            { id: 12, image: 'è”·è–‡å¶ç‰‡ - 012', disease: 'è”·è–‡é”ˆç—…', confidence: 94, level: 'high', pathogen: 'Phragmidium mucronatum (çœŸèŒ)', features: ['æ©™é»„è‰²ç–±æ–‘', 'å¶ç‰‡èƒŒé¢', 'ç²‰æœ«çŠ¶', 'æ•£ç‚¹åˆ†å¸ƒ'] },
            { id: 13, image: 'èŒ‰è‰å¶ç‰‡ - 013', disease: 'èŒ‰è‰å¶æ–‘ç—…', confidence: 80, level: 'high', pathogen: 'Cercospora sp. (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'è¤è‰²æ–‘ç‚¹', 'é»„è‰²æ™•åœˆ', 'å¶ç‰‡ä¸»ä½“'] },
            { id: 14, image: 'å±±èŒ¶å¶ç‰‡ - 014', disease: 'å±±èŒ¶è—»æ–‘ç—…', confidence: 75, level: 'medium', pathogen: 'Cephaleuros virescens (è—»ç±»)', features: ['æ©™è¤è‰²æ–‘å—', 'ç»’æ¯›çŠ¶', 'å¶ç‰‡è¡¨é¢', 'ä¸è§„åˆ™å½¢çŠ¶'] },
            { id: 15, image: 'æ¡‚èŠ±å¶ç‰‡ - 015', disease: 'æ¡‚èŠ±è¤æ–‘ç—…', confidence: 86, level: 'high', pathogen: 'Pseudocercospora sp. (çœŸèŒ)', features: ['åæ­»æ–‘ç‚¹', 'è¤è‰²æ–‘ç‚¹', 'ç°ç™½ä¸­å¿ƒ', 'å¶ç‰‡ä¸»ä½“'] }
        ];

        let currentIndex = 0;

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        function triggerFileInput() {
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length > 0) {
                simulateUpload(files.length);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('uploadArea').classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('uploadArea').classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('uploadArea').classList.remove('dragover');

            const files = event.dataTransfer.files;
            if (files.length > 0) {
                simulateUpload(files.length);
            }
        }

        function simulateUpload(count) {
            // æ¨¡æ‹Ÿä¸Šä¼ å’Œè¯Šæ–­è¿‡ç¨‹
            document.getElementById('uploadCount').textContent = count;
            document.getElementById('successModal').classList.add('active');

            // æ˜¾ç¤ºç»“æœ
            setTimeout(() => {
                showResults();
            }, 500);
        }

        function showResults() {
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('viewerSection').classList.add('active');
            document.getElementById('resultsGrid').classList.add('active');
            document.getElementById('exportBtn').style.display = 'block';

            renderResultsList();
            updateViewer();
        }

        function renderResultsList() {
            const container = document.getElementById('resultsList');
            container.innerHTML = '';

            mockDiagnoses.forEach((diagnosis, index) => {
                const card = document.createElement('div');
                card.className = 'result-card' + (index === currentIndex ? ' active' : '');
                card.onclick = () => selectImage(index);
                card.ondblclick = () => showDetailModal(index);

                card.innerHTML = `
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='120'%3E%3Crect fill='%23${diagnosis.level === 'high' ? 'e8f5e9' : 'fff7e6'}' width='200' height='120'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='14' fill='%23666'%3E${diagnosis.image}%3C/text%3E%3C/svg%3E"
                         alt="${diagnosis.image}" class="result-thumbnail">
                    <div class="result-info">
                        <div class="result-disease">${diagnosis.disease}</div>
                        <div class="result-confidence">ç½®ä¿¡åº¦: ${diagnosis.confidence}%</div>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        function selectImage(index) {
            currentIndex = index;
            updateViewer();

            // æ›´æ–°å¡ç‰‡é€‰ä¸­çŠ¶æ€
            const cards = document.querySelectorAll('.result-card');
            cards.forEach((card, i) => {
                card.classList.toggle('active', i === index);
            });
        }

        function updateViewer() {
            const diagnosis = mockDiagnoses[currentIndex];

            // æ›´æ–°å›¾ç‰‡
            document.getElementById('currentImage').src = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23${diagnosis.level === 'high' ? 'e8f5e9' : 'fff7e6'}' width='400' height='400'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='20' fill='%23666'%3E${diagnosis.image}%3C/text%3E%3C/svg%3E`;

            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            document.getElementById('pageInfo').textContent = `${currentIndex + 1} / ${mockDiagnoses.length}`;

            // æ›´æ–°è¯Šæ–­ä¿¡æ¯
            document.getElementById('diseaseName').textContent = diagnosis.disease;
            document.getElementById('confidenceTag').textContent = `ç½®ä¿¡åº¦ï¼š${diagnosis.confidence}%`;
            document.getElementById('confidenceTag').className = `confidence ${diagnosis.level}`;
            document.getElementById('pathogenInfo').textContent = `ç—…åŸä½“ï¼š${diagnosis.pathogen}`;

            // æ›´æ–°ç‰¹å¾åˆ—è¡¨
            const featureList = document.getElementById('featureList');
            featureList.innerHTML = diagnosis.features.map(f =>
                `<li class="feature-item">${f}</li>`
            ).join('');
        }

        function previousImage() {
            if (currentIndex > 0) {
                selectImage(currentIndex - 1);
            }
        }

        function nextImage() {
            if (currentIndex < mockDiagnoses.length - 1) {
                selectImage(currentIndex + 1);
            }
        }

        function exportToExcel() {
            alert('æ­£åœ¨å¯¼å‡ºExcelæ–‡ä»¶...\n\nå°†åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š\n- å›¾ç‰‡æ–‡ä»¶å\n- è¯Šæ–­ç»“æœ\n- ç½®ä¿¡åº¦\n- ç—…åŸä½“ä¿¡æ¯\n- å…³é”®ç‰¹å¾');
            console.log('å¯¼å‡ºæ•°æ®:', mockDiagnoses);
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function showDetailModal(index) {
            const diagnosis = mockDiagnoses[index];

            // æ›´æ–°æ¨¡æ€æ¡†æ ‡é¢˜
            document.getElementById('detailTitle').textContent = `è¯¦ç»†è¯Šæ–­ç»“æœ - ${diagnosis.image}`;

            // æ›´æ–°å›¾ç‰‡
            document.getElementById('detailImage').src =
                `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='500' height='400'%3E%3Crect fill='%23${diagnosis.level === 'high' ? 'e8f5e9' : 'fff7e6'}' width='500' height='400'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='24' fill='%23666'%3E${diagnosis.image}%3C/text%3E%3C/svg%3E`;

            // æ›´æ–°è¯Šæ–­ç»“æœ
            document.getElementById('detailDiseaseName').textContent = diagnosis.disease;
            document.getElementById('detailConfidence').textContent = `ç½®ä¿¡åº¦ï¼š${diagnosis.confidence}%`;
            document.getElementById('detailConfidence').className = `confidence ${diagnosis.level}`;
            document.getElementById('detailPathogen').textContent = `ç—…åŸä½“ï¼š${diagnosis.pathogen}`;

            // æ›´æ–°å…³é”®ç‰¹å¾
            const featureList = document.getElementById('detailFeatures');
            featureList.innerHTML = diagnosis.features.map(f =>
                `<li class="feature-item">${f}</li>`
            ).join('');

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('detailModal').classList.add('active');
        }

        function toggleCollapsible(id) {
            const section = document.getElementById(id);
            section.classList.toggle('active');
        }

        function goBack() {
            if (confirm('ç¡®å®šè¦è¿”å›é¦–é¡µå—ï¼Ÿ')) {
                window.location.reload();
            }
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>
