# PhytoOracle Frontend Demo - 阶段3功能测试指南

**版本**: v1.0
**日期**: 2025-11-13
**测试内容**: 图片对比与统计分析功能

---

## 测试概述

本文档提供阶段3功能的完整测试指南，包括：
1. **推理调试中心 - Tab 3**：图片对比功能
2. **统计分析页面**：准确率趋势图和增强导出功能

---

## 测试前准备

### 1. 启动应用

```bash
cd d:\项目管理\PhytoOracle\demo\frontend_demo
streamlit run app.py
```

### 2. 生成测试数据

在使用阶段3功能之前，需要先生成一些历史推理数据：

**方法A：使用单张调试模式**
1. 访问「推理调试中心」页面
2. 在 Tab 1（单张调试）中上传 3-5 张图片
3. 对每张图片执行推理
4. 完成人工标注（正确/错误）

**方法B：使用批量验证**
1. 访问「批量验证中心」页面
2. 批量上传 10-15 张图片
3. 执行批量推理
4. 在结果表格中完成部分标注

---

## 功能测试清单

### 测试1：图片对比 - 图片选择功能

**测试位置**: 推理调试中心 → Tab 3: 图片对比

**测试步骤**:
1. 点击「Tab 3: 图片对比」标签页
2. 确认显示历史统计卡片：
   - 历史记录数
   - 已标注数
   - 准确率
   - 误诊案例数

**筛选测试**:
1. 使用「按花卉属筛选」下拉菜单，选择特定花属
2. 使用「按置信度级别筛选」，选择不同置信度
3. 使用「按准确性筛选」，选择已标注状态
4. 确认筛选结果数量正确

**选择测试**:
1. 从筛选结果中选择 2 张图片
   - ✅ 期望：显示「已选择 2 张图片」提示
2. 选择 4 张图片
   - ✅ 期望：显示「已选择 4 张图片」提示
3. 尝试选择 1 张图片
   - ✅ 期望：显示「请至少选择 2 张图片进行对比」提示

**检查标准**:
- [ ] 历史统计卡片数据正确
- [ ] 筛选功能正常工作
- [ ] 图片选择器支持多选
- [ ] 选择数量提示准确

---

### 测试2：图片对比 - 并排展示与差异高亮

**测试步骤**:
1. 选择 2-4 张具有不同特征的图片
2. 查看并排对比展示

**验证内容**:
1. **基本信息展示**：
   - [ ] 每列显示图片名称
   - [ ] 显示图片占位符
   - [ ] 显示 Q0.2 花卉属
   - [ ] 显示 Q0.5 异常判断

2. **关键特征展示**：
   - [ ] 症状类型（symptom_type）
   - [ ] 中心颜色（color_center）
   - [ ] 边缘颜色（color_border）

3. **诊断结果展示**：
   - [ ] 诊断疾病名称
   - [ ] 置信度分数和级别
   - [ ] 准确性标注状态

4. **差异高亮**：
   - [ ] 相同的特征：普通样式
   - [ ] 不同的特征：有颜色高亮
   - [ ] 少数值：红色高亮 + ⚠️ 图标
   - [ ] 多数值：绿色高亮 + ✓ 图标

**检查标准**:
- [ ] 并排展示布局清晰
- [ ] 所有字段正确显示
- [ ] 差异高亮准确
- [ ] 颜色区分明显

---

### 测试3：图片对比 - 差异分析报告

**测试步骤**:
1. 在并排展示下方查看「差异分析报告」

**验证内容**:
1. **特征差异统计表格**：
   - [ ] 显示所有有差异的特征
   - [ ] 显示不同值数量
   - [ ] 列出具体值

2. **相同点分析**：
   - [ ] 列出所有相同的特征
   - [ ] 显示特征值

3. **差异点分析**：
   - [ ] 列出所有不同的特征
   - [ ] 显示不同值的数量

4. **差异原因分析与优化建议**：
   - [ ] 根据差异类型提供针对性建议
   - [ ] 花卉属识别差异建议
   - [ ] 症状特征识别差异建议
   - [ ] 诊断结果差异建议
   - [ ] 标注不一致建议

**检查标准**:
- [ ] 差异统计表格准确
- [ ] 相同点和差异点分析正确
- [ ] 优化建议合理且有价值

---

### 测试4：统计分析 - 数据源选择

**测试位置**: 统计分析页面

**测试步骤**:
1. 访问「统计分析」页面
2. 如果同时存在批量推理结果和历史记录，会显示数据源选择器

**验证内容**:
1. **数据源选项**：
   - [ ] 当前批量推理结果
   - [ ] 历史推理记录
   - [ ] 合并所有数据

2. **数据统计**：
   - [ ] 切换数据源后，统计卡片数据更新
   - [ ] 总诊断量正确
   - [ ] 准确率计算正确

**检查标准**:
- [ ] 数据源选择正常
- [ ] 数据统计准确
- [ ] 切换后界面更新

---

### 测试5：统计分析 - Tab 5 准确率趋势

**测试步骤**:
1. 在统计分析页面点击「Tab 5: 准确率趋势」

**验证内容**:
1. **趋势图展示**：
   - [ ] 显示过去30天的准确率趋势线
   - [ ] X轴：日期
   - [ ] Y轴：准确率（%）
   - [ ] 数据点清晰可见
   - [ ] 悬停显示具体数值

2. **筛选器**：
   - [ ] 按花卉属筛选下拉菜单
   - [ ] 按疾病类型筛选下拉菜单
   - [ ] 筛选后生成新的趋势图

3. **趋势分析摘要**：
   - [ ] 当前准确率（带7天前对比）
   - [ ] 30天平均准确率
   - [ ] 历史最高准确率

4. **导出功能**：
   - [ ] 导出趋势数据CSV按钮
   - [ ] 导出趋势数据JSON按钮
   - [ ] 点击后正确下载文件

**检查标准**:
- [ ] 趋势图正确渲染
- [ ] 筛选功能正常
- [ ] 摘要数据准确
- [ ] 导出功能正常

---

### 测试6：统计分析 - 增强导出功能

**测试步骤**:
1. 在统计分析页面的各个Tab中测试导出功能

**Tab 4: 误诊分析导出**:
1. 如果存在误诊案例：
   - [ ] 点击「导出误诊案例CSV」
   - [ ] 点击「导出误诊案例JSON」
   - [ ] 确认文件正确下载
   - [ ] 打开文件验证内容

**侧边栏全部数据导出**:
1. 在侧边栏找到「导出全部数据」部分
2. 点击「导出全部数据CSV」
3. 确认文件包含：
   - [ ] 图片名称
   - [ ] 花卉属
   - [ ] 诊断疾病
   - [ ] 置信度分数和级别
   - [ ] 标注状态
   - [ ] 实际疾病
   - [ ] 备注
   - [ ] 诊断时间

**检查标准**:
- [ ] 所有导出按钮正常工作
- [ ] CSV文件格式正确（UTF-8-BOM编码）
- [ ] JSON文件格式正确
- [ ] 导出数据完整准确

---

## 回归测试

确保阶段3的新功能不影响现有功能：

### 阶段1功能回归测试
- [ ] 单张调试模式正常
- [ ] 推理过程可视化正常
- [ ] 人工标注功能正常
- [ ] 本体使用导出正常

### 阶段2功能回归测试
- [ ] 批量验证功能正常
- [ ] 结果汇总表格正常
- [ ] 混淆矩阵正常
- [ ] 知识库管理正常

---

## 边界测试

### 空数据测试
1. **无历史数据时访问图片对比**：
   - [ ] 显示友好提示
   - [ ] 提供跳转按钮

2. **无标注数据时查看误诊分析**：
   - [ ] 显示「暂无已标注样本」提示
   - [ ] 不显示混淆矩阵

### 最小数据测试
1. **仅1张历史记录时访问图片对比**：
   - [ ] 提示需要至少2张图片
   - [ ] 不显示对比界面

2. **仅1条误诊案例**：
   - [ ] 正确显示误诊案例表格
   - [ ] 误诊模式分析正常

---

## 性能测试

### 大数据量测试
1. **50+ 历史记录**：
   - [ ] 图片选择器加载流畅
   - [ ] 筛选器响应迅速
   - [ ] 统计计算速度正常

2. **4张图片对比**：
   - [ ] 并排展示布局正常
   - [ ] 差异分析计算快速

---

## 用户体验测试

### 交互流畅性
- [ ] 页面切换无卡顿
- [ ] 按钮点击响应及时
- [ ] 图表渲染流畅

### 界面友好性
- [ ] 所有提示信息清晰
- [ ] 错误提示友好
- [ ] 配色和布局美观

### 操作便捷性
- [ ] 筛选器易于使用
- [ ] 导出功能便捷
- [ ] 导航清晰直观

---

## 已知限制

1. **图片预览**：图片对比中使用占位符而非真实图片（需集成真实存储）
2. **趋势数据**：准确率趋势为模拟数据（需要真实的时序数据库）
3. **实时更新**：批量验证与历史管理器的数据同步需要手动刷新

---

## 测试完成标准

所有上述测试项均通过（✅）且无严重bug时，阶段3功能验收通过。

---

## 问题反馈

如发现问题，请记录：
- 问题类型：功能/性能/UI/其他
- 复现步骤
- 期望行为
- 实际行为
- 截图/日志

---

**测试完成日期**: ___________
**测试人员**: ___________
**测试结果**: [ ] 通过 / [ ] 不通过
